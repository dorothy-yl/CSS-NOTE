<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript é—­åŒ…åº”ç”¨åœºæ™¯æ•™å­¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'å¾®è½¯é›…é»‘', sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        h2 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
        }

        .demo-area {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #28a745;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            min-height: 30px;
        }

        .highlight {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
    </style>
    <!-- ä»£ç é«˜äº®æ ·å¼ -->
    <link rel="stylesheet" href="../shared/code-highlight.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ JavaScript é—­åŒ…åº”ç”¨åœºæ™¯æ•™å­¦</h1>

        <div class="section">
            <h2>1. æ•°æ®ç§æœ‰åŒ– - æ¨¡æ‹Ÿç§æœ‰å˜é‡</h2>
            <p>é—­åŒ…æœ€ç»å…¸çš„åº”ç”¨åœºæ™¯ä¹‹ä¸€ï¼Œåˆ›å»ºç§æœ‰å˜é‡ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚</p>
            
            <div class="code-block">
function createCounter() {
    let count = 0; // ç§æœ‰å˜é‡
    
    return {
        increment: function() {
            count++;
            return count;
        },
        decrement: function() {
            count--;
            return count;
        },
        getCount: function() {
            return count;
        }
    };
}

const counter = createCounter();
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <button onclick="testCounter1()">è®¡æ•°+1</button>
                <button onclick="testCounter2()">è®¡æ•°-1</button>
                <button onclick="testCounter3()">è·å–è®¡æ•°</button>
                <button onclick="testCounter4()">å°è¯•ç›´æ¥è®¿é—®count</button>
                <div class="output" id="counter-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>2. å‡½æ•°æŸ¯é‡ŒåŒ– (Currying)</h2>
            <p>å°†å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—å•å‚æ•°å‡½æ•°ã€‚</p>
            
            <div class="code-block">
function curry(fn) {
    return function curried(...args) {
        if (args.length >= fn.length) {
            return fn.apply(this, args);
        } else {
            return function(...nextArgs) {
                return curried.apply(this, args.concat(nextArgs));
            }
        }
    }
}

// åŸå§‹å‡½æ•°
function add(a, b, c) {
    return a + b + c;
}

const curriedAdd = curry(add);
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <button onclick="testCurry1()">æ­£å¸¸è°ƒç”¨ add(1,2,3)</button>
                <button onclick="testCurry2()">æŸ¯é‡ŒåŒ– curriedAdd(1)(2)(3)</button>
                <button onclick="testCurry3()">éƒ¨åˆ†åº”ç”¨ curriedAdd(1,2)(3)</button>
                <div class="output" id="curry-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>3. é˜²æŠ–å’ŒèŠ‚æµ</h2>
            <p>åˆ©ç”¨é—­åŒ…ä¿å­˜å®šæ—¶å™¨çŠ¶æ€ï¼Œæ§åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡ã€‚</p>
            
            <div class="code-block">
// é˜²æŠ–å‡½æ•°
function debounce(func, delay) {
    let timer;
    return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
}

// èŠ‚æµå‡½æ•°
function throttle(func, delay) {
    let lastTime = 0;
    return function(...args) {
        let now = Date.now();
        if (now - lastTime > delay) {
            func.apply(this, args);
            lastTime = now;
        }
    };
}
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <input type="text" id="debounce-input" placeholder="è¾“å…¥æ–‡å­—æµ‹è¯•é˜²æŠ–...">
                <button onclick="startThrottle()">å¼€å§‹èŠ‚æµæµ‹è¯•</button>
                <button onclick="stopThrottle()">åœæ­¢æµ‹è¯•</button>
                <div class="output" id="debounce-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>4. æ¨¡å—æ¨¡å¼ (Module Pattern)</h2>
            <p>åˆ›å»ºå…·æœ‰å…¬å…±å’Œç§æœ‰æ–¹æ³•çš„æ¨¡å—ã€‚</p>
            
            <div class="code-block">
const UserModule = (function() {
    // ç§æœ‰å˜é‡å’Œæ–¹æ³•
    let users = [];
    let currentId = 1;
    
    function generateId() {
        return currentId++;
    }
    
    function validateUser(user) {
        return user && user.name && user.email;
    }
    
    // å…¬å…±æ¥å£
    return {
        addUser: function(name, email) {
            const user = { id: generateId(), name, email };
            if (validateUser(user)) {
                users.push(user);
                return user;
            }
            return null;
        },
        
        getUser: function(id) {
            return users.find(user => user.id === id);
        },
        
        getAllUsers: function() {
            return [...users]; // è¿”å›å‰¯æœ¬
        },
        
        getUserCount: function() {
            return users.length;
        }
    };
})();
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <input type="text" id="username" placeholder="ç”¨æˆ·å">
                <input type="email" id="email" placeholder="é‚®ç®±">
                <button onclick="addUser()">æ·»åŠ ç”¨æˆ·</button>
                <button onclick="showUsers()">æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·</button>
                <div class="output" id="module-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>5. ç¼“å­˜å‡½æ•° (Memoization)</h2>
            <p>åˆ©ç”¨é—­åŒ…ç¼“å­˜å‡½æ•°è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</p>
            
            <div class="code-block">
function memoize(fn) {
    const cache = {};
    
    return function(...args) {
        const key = JSON.stringify(args);
        
        if (cache[key]) {
            console.log('ä»ç¼“å­˜ä¸­è·å–ç»“æœ');
            return cache[key];
        }
        
        console.log('è®¡ç®—æ–°ç»“æœ');
        const result = fn.apply(this, args);
        cache[key] = result;
        return result;
    };
}

// æ–æ³¢é‚£å¥‘æ•°åˆ—
function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

const memoizedFib = memoize(fibonacci);
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <input type="number" id="fib-input" placeholder="è¾“å…¥æ•°å­—è®¡ç®—æ–æ³¢é‚£å¥‘" min="0" max="40">
                <button onclick="calcFib()">æ™®é€šè®¡ç®—</button>
                <button onclick="calcMemoFib()">ç¼“å­˜è®¡ç®—</button>
                <div class="output" id="memo-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>6. äº‹ä»¶ç›‘å¬å™¨ç®¡ç†</h2>
            <p>åˆ›å»ºå¯ä»¥ç®¡ç†äº‹ä»¶ç›‘å¬å™¨çš„é—­åŒ…å‡½æ•°ã€‚</p>
            
            <div class="code-block">
function createEventManager() {
    const listeners = new Map();
    
    return {
        on: function(event, callback) {
            if (!listeners.has(event)) {
                listeners.set(event, []);
            }
            listeners.get(event).push(callback);
        },
        
        off: function(event, callback) {
            if (listeners.has(event)) {
                const callbacks = listeners.get(event);
                const index = callbacks.indexOf(callback);
                if (index > -1) {
                    callbacks.splice(index, 1);
                }
            }
        },
        
        emit: function(event, ...args) {
            if (listeners.has(event)) {
                listeners.get(event).forEach(callback => {
                    callback(...args);
                });
            }
        },
        
        getListenerCount: function(event) {
            return listeners.has(event) ? listeners.get(event).length : 0;
        }
    };
}

const eventManager = createEventManager();
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <button onclick="addListener()">æ·»åŠ ç›‘å¬å™¨</button>
                <button onclick="emitEvent()">è§¦å‘äº‹ä»¶</button>
                <button onclick="showListeners()">æ˜¾ç¤ºç›‘å¬å™¨æ•°é‡</button>
                <div class="output" id="event-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>7. å•ä¾‹æ¨¡å¼ (Singleton Pattern)</h2>
            <p>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚</p>
            
            <div class="code-block">
const Singleton = (function() {
    let instance;
    let instanceCount = 0;
    
    function createInstance() {
        instanceCount++;
        return {
            id: instanceCount,
            getData: function() {
                return `å•ä¾‹å®ä¾‹ ID: ${this.id}`;
            },
            timestamp: Date.now()
        };
    }
    
    return {
        getInstance: function() {
            if (!instance) {
                instance = createInstance();
            }
            return instance;
        },
        
        getInstanceCount: function() {
            return instanceCount;
        }
    };
})();
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <button onclick="getSingleton1()">è·å–å®ä¾‹1</button>
                <button onclick="getSingleton2()">è·å–å®ä¾‹2</button>
                <button onclick="compareSingleton()">æ¯”è¾ƒä¸¤ä¸ªå®ä¾‹</button>
                <div class="output" id="singleton-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>8. å·¥å‚å‡½æ•°</h2>
            <p>ä½¿ç”¨é—­åŒ…åˆ›å»ºå¯¹è±¡çš„å·¥å‚å‡½æ•°ï¼Œå°è£…å¯¹è±¡åˆ›å»ºé€»è¾‘ã€‚</p>
            
            <div class="code-block">
function createPersonFactory() {
    let personId = 0;
    const persons = [];
    
    return function(name, age, profession) {
        const id = ++personId;
        
        const person = {
            id,
            name,
            age,
            profession,
            introduce: function() {
                return `æˆ‘æ˜¯${this.name}ï¼Œ${this.age}å²ï¼ŒèŒä¸šæ˜¯${this.profession}`;
            },
            updateAge: function(newAge) {
                this.age = newAge;
                return this;
            }
        };
        
        persons.push(person);
        
        // è¿”å›å¸¦æœ‰é¢å¤–æ–¹æ³•çš„å¯¹è±¡
        return Object.assign(person, {
            getAllPersons: () => persons.slice(),
            getTotalCount: () => persons.length
        });
    };
}

const PersonFactory = createPersonFactory();
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <input type="text" id="person-name" placeholder="å§“å">
                <input type="number" id="person-age" placeholder="å¹´é¾„">
                <input type="text" id="person-profession" placeholder="èŒä¸š">
                <button onclick="createPerson()">åˆ›å»ºäººå‘˜</button>
                <button onclick="showAllPersons()">æ˜¾ç¤ºæ‰€æœ‰äººå‘˜</button>
                <div class="output" id="factory-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>9. å¾ªç¯ä¸­çš„å¼‚æ­¥é—®é¢˜è§£å†³</h2>
            <p>ç»å…¸çš„é—­åŒ…åº”ç”¨åœºæ™¯ï¼šè§£å†³å¾ªç¯ä¸­å¼‚æ­¥æ“ä½œçš„å˜é‡æ•è·é—®é¢˜ã€‚</p>
            
            <div class="code-block">
// é—®é¢˜ä»£ç  - éƒ½ä¼šè¾“å‡º3
function problemCode() {
    for (var i = 0; i < 3; i++) {
        setTimeout(function() {
            console.log('é—®é¢˜ä»£ç è¾“å‡º:', i); // éƒ½æ˜¯3
        }, 100 * i);
    }
}

// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨é—­åŒ…
function solutionWithClosure() {
    for (var i = 0; i < 3; i++) {
        (function(j) {
            setTimeout(function() {
                console.log('é—­åŒ…è§£å†³æ–¹æ¡ˆè¾“å‡º:', j);
            }, 100 * j);
        })(i);
    }
}

// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨let
function solutionWithLet() {
    for (let i = 0; i < 3; i++) {
        setTimeout(function() {
            console.log('letè§£å†³æ–¹æ¡ˆè¾“å‡º:', i);
        }, 100 * i);
    }
}

// è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨bind
function solutionWithBind() {
    for (var i = 0; i < 3; i++) {
        setTimeout(function(j) {
            console.log('bindè§£å†³æ–¹æ¡ˆè¾“å‡º:', j);
        }.bind(null, i), 100 * i);
    }
}
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <button onclick="testProblemCode()">é—®é¢˜ä»£ç </button>
                <button onclick="testClosureSolution()">é—­åŒ…è§£å†³</button>
                <button onclick="testLetSolution()">letè§£å†³</button>
                <button onclick="testBindSolution()">bindè§£å†³</button>
                <div class="output" id="async-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>10. åå‡½æ•°åº”ç”¨ (Partial Application)</h2>
            <p>åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œå…¶ä¸­ä¸€äº›å‚æ•°å·²ç»è¢«é¢„è®¾ã€‚</p>
            
            <div class="code-block">
function partial(fn, ...presetArgs) {
    return function(...laterArgs) {
        return fn(...presetArgs, ...laterArgs);
    };
}

// åŸå§‹å‡½æ•°
function multiply(a, b, c) {
    return a * b * c;
}

function greet(greeting, punctuation, name) {
    return `${greeting}, ${name}${punctuation}`;
}

// åˆ›å»ºåå‡½æ•°
const double = partial(multiply, 2);
const sayHello = partial(greet, 'Hello', '!');
const multiplyBy10 = partial(multiply, 10);
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤ºï¼š</h3>
                <input type="number" id="partial-input1" placeholder="è¾“å…¥æ•°å­—" value="5">
                <input type="number" id="partial-input2" placeholder="è¾“å…¥æ•°å­—" value="3">
                <button onclick="testPartial1()">double(5, 3)</button>
                <button onclick="testPartial2()">multiplyBy10(2, 4)</button>
                <input type="text" id="name-input" placeholder="è¾“å…¥å§“å" value="å¼ ä¸‰">
                <button onclick="testPartial3()">sayHello('å¼ ä¸‰')</button>
                <div class="output" id="partial-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>11. çŠ¶æ€æœº (State Machine)</h2>
            <p>ä½¿ç”¨é—­åŒ…ç»´æŠ¤çŠ¶æ€è½¬æ¢é€»è¾‘ã€‚</p>
            
            <div class="code-block">
function createStateMachine(initialState, transitions) {
    let currentState = initialState;
    const history = [initialState];
    
    return {
        getCurrentState: function() {
            return currentState;
        },
        
        transition: function(action) {
            const possibleStates = transitions[currentState];
            
            if (possibleStates && possibleStates[action]) {
                const previousState = currentState;
                currentState = possibleStates[action];
                history.push(currentState);
                
                return {
                    success: true,
                    from: previousState,
                    to: currentState,
                    action: action
                };
            }
            
            return {
                success: false,
                message: `æ— æ³•ä» ${currentState} æ‰§è¡Œ ${action} æ“ä½œ`
            };
        },
        
        getHistory: function() {
            return [...history];
        },
        
        canTransition: function(action) {
            const possibleStates = transitions[currentState];
            return possibleStates && possibleStates[action] !== undefined;
        }
    };
}

// åˆ›å»ºä¸€ä¸ªç®€å•çš„é—¨çŠ¶æ€æœº
const doorStates = {
    'closed': { 'open': 'open' },
    'open': { 'close': 'closed', 'lock': 'locked' },
    'locked': { 'unlock': 'closed' }
};

const door = createStateMachine('closed', doorStates);
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤º - é—¨çš„çŠ¶æ€æœºï¼š</h3>
                <button onclick="doorAction('open')">å¼€é—¨</button>
                <button onclick="doorAction('close')">å…³é—¨</button>
                <button onclick="doorAction('lock')">é”é—¨</button>
                <button onclick="doorAction('unlock')">å¼€é”</button>
                <button onclick="showDoorState()">æ˜¾ç¤ºçŠ¶æ€</button>
                <button onclick="showDoorHistory()">æ˜¾ç¤ºå†å²</button>
                <div class="output" id="state-output"></div>
            </div>
        </div>

        <div class="section">
            <h2>12. è®¡æ—¶å™¨å’Œå»¶è¿Ÿæ‰§è¡Œ</h2>
            <p>ä½¿ç”¨é—­åŒ…åˆ›å»ºå¯æ§åˆ¶çš„è®¡æ—¶å™¨ã€‚</p>
            
            <div class="code-block">
function createTimer() {
    let timerId = null;
    let startTime = null;
    let pauseTime = 0;
    let isRunning = false;
    
    return {
        start: function(callback, interval = 1000) {
            if (isRunning) return false;
            
            startTime = Date.now() - pauseTime;
            isRunning = true;
            
            timerId = setInterval(() => {
                const elapsed = Date.now() - startTime;
                callback(Math.floor(elapsed / 1000));
            }, interval);
            
            return true;
        },
        
        pause: function() {
            if (!isRunning) return false;
            
            clearInterval(timerId);
            pauseTime = Date.now() - startTime;
            isRunning = false;
            return true;
        },
        
        stop: function() {
            clearInterval(timerId);
            timerId = null;
            startTime = null;
            pauseTime = 0;
            isRunning = false;
            return true;
        },
        
        isRunning: function() {
            return isRunning;
        },
        
        getElapsed: function() {
            if (startTime === null) return 0;
            
            if (isRunning) {
                return Math.floor((Date.now() - startTime) / 1000);
            } else {
                return Math.floor(pauseTime / 1000);
            }
        }
    };
}

const timer = createTimer();
            </div>
            
            <div class="demo-area">
                <h3>æ¼”ç¤º - å¯æ§è®¡æ—¶å™¨ï¼š</h3>
                <button onclick="startTimer()">å¼€å§‹è®¡æ—¶</button>
                <button onclick="pauseTimer()">æš‚åœè®¡æ—¶</button>
                <button onclick="stopTimer()">åœæ­¢è®¡æ—¶</button>
                <button onclick="showTimerStatus()">æ˜¾ç¤ºçŠ¶æ€</button>
                <div class="output" id="timer-output">è®¡æ—¶å™¨: 0ç§’</div>
            </div>
        </div>

        <div class="highlight">
            <h3>ğŸ’¡ é—­åŒ…çš„æ ¸å¿ƒè¦ç‚¹ï¼š</h3>
            <ul>
                <li><strong>è¯æ³•ä½œç”¨åŸŸï¼š</strong>å‡½æ•°å¯ä»¥è®¿é—®å®šä¹‰æ—¶çš„å¤–éƒ¨å˜é‡</li>
                <li><strong>å˜é‡ä¿æŒï¼š</strong>å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå†…éƒ¨å‡½æ•°ä»èƒ½è®¿é—®å¤–éƒ¨å˜é‡</li>
                <li><strong>æ•°æ®å°è£…ï¼š</strong>åˆ›å»ºç§æœ‰å˜é‡ï¼Œæ§åˆ¶è®¿é—®æƒé™</li>
                <li><strong>çŠ¶æ€ä¿æŒï¼š</strong>åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ä¿æŒçŠ¶æ€</li>
                <li><strong>å†…å­˜ç®¡ç†ï¼š</strong>æ³¨æ„é¿å…å†…å­˜æ³„æ¼</li>
            </ul>
        </div>
    </div>

    <script>
        // 1. æ•°æ®ç§æœ‰åŒ–æ¼”ç¤º
        const counter = (function() {
            let count = 0;
            return {
                increment: function() {
                    count++;
                    return count;
                },
                decrement: function() {
                    count--;
                    return count;
                },
                getCount: function() {
                    return count;
                }
            };
        })();

        function testCounter1() {
            const result = counter.increment();
            document.getElementById('counter-output').innerHTML = `è®¡æ•°å™¨é€’å¢ï¼š${result}`;
        }

        function testCounter2() {
            const result = counter.decrement();
            document.getElementById('counter-output').innerHTML = `è®¡æ•°å™¨é€’å‡ï¼š${result}`;
        }

        function testCounter3() {
            const result = counter.getCount();
            document.getElementById('counter-output').innerHTML = `å½“å‰è®¡æ•°ï¼š${result}`;
        }

        function testCounter4() {
            try {
                const result = counter.count;
                document.getElementById('counter-output').innerHTML = `ç›´æ¥è®¿é—®count: ${result} (undefined - æ— æ³•ç›´æ¥è®¿é—®ç§æœ‰å˜é‡)`;
            } catch (e) {
                document.getElementById('counter-output').innerHTML = `é”™è¯¯ï¼š${e.message}`;
            }
        }

        // 2. æŸ¯é‡ŒåŒ–æ¼”ç¤º
        function curry(fn) {
            return function curried(...args) {
                if (args.length >= fn.length) {
                    return fn.apply(this, args);
                } else {
                    return function(...nextArgs) {
                        return curried.apply(this, args.concat(nextArgs));
                    }
                }
            }
        }

        function add(a, b, c) {
            return a + b + c;
        }

        const curriedAdd = curry(add);

        function testCurry1() {
            const result = add(1, 2, 3);
            document.getElementById('curry-output').innerHTML = `æ­£å¸¸è°ƒç”¨ç»“æœï¼š${result}`;
        }

        function testCurry2() {
            const result = curriedAdd(1)(2)(3);
            document.getElementById('curry-output').innerHTML = `æŸ¯é‡ŒåŒ–è°ƒç”¨ç»“æœï¼š${result}`;
        }

        function testCurry3() {
            const result = curriedAdd(1, 2)(3);
            document.getElementById('curry-output').innerHTML = `éƒ¨åˆ†åº”ç”¨ç»“æœï¼š${result}`;
        }

        // 3. é˜²æŠ–èŠ‚æµæ¼”ç¤º
        function debounce(func, delay) {
            let timer;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }

        function throttle(func, delay) {
            let lastTime = 0;
            return function(...args) {
                let now = Date.now();
                if (now - lastTime > delay) {
                    func.apply(this, args);
                    lastTime = now;
                }
            };
        }

        const debouncedSearch = debounce(function(value) {
            document.getElementById('debounce-output').innerHTML = `é˜²æŠ–æœç´¢ï¼š${value}`;
        }, 500);

        document.getElementById('debounce-input').addEventListener('input', function(e) {
            debouncedSearch(e.target.value);
        });

        let throttleInterval;
        const throttledLog = throttle(function() {
            const time = new Date().toLocaleTimeString();
            document.getElementById('debounce-output').innerHTML = `èŠ‚æµæ‰§è¡Œæ—¶é—´ï¼š${time}`;
        }, 1000);

        function startThrottle() {
            if (throttleInterval) return;
            throttleInterval = setInterval(throttledLog, 100);
        }

        function stopThrottle() {
            if (throttleInterval) {
                clearInterval(throttleInterval);
                throttleInterval = null;
            }
        }

        // 4. æ¨¡å—æ¨¡å¼æ¼”ç¤º
        const UserModule = (function() {
            let users = [];
            let currentId = 1;
            
            function generateId() {
                return currentId++;
            }
            
            function validateUser(user) {
                return user && user.name && user.email;
            }
            
            return {
                addUser: function(name, email) {
                    const user = { id: generateId(), name, email };
                    if (validateUser(user)) {
                        users.push(user);
                        return user;
                    }
                    return null;
                },
                
                getUser: function(id) {
                    return users.find(user => user.id === id);
                },
                
                getAllUsers: function() {
                    return [...users];
                },
                
                getUserCount: function() {
                    return users.length;
                }
            };
        })();

        function addUser() {
            const name = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            
            if (name && email) {
                const user = UserModule.addUser(name, email);
                if (user) {
                    document.getElementById('module-output').innerHTML = `æ·»åŠ ç”¨æˆ·æˆåŠŸï¼š${JSON.stringify(user)}`;
                    document.getElementById('username').value = '';
                    document.getElementById('email').value = '';
                } else {
                    document.getElementById('module-output').innerHTML = 'æ·»åŠ ç”¨æˆ·å¤±è´¥';
                }
            } else {
                document.getElementById('module-output').innerHTML = 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯';
            }
        }

        function showUsers() {
            const users = UserModule.getAllUsers();
            const count = UserModule.getUserCount();
            document.getElementById('module-output').innerHTML = 
                `ç”¨æˆ·æ€»æ•°ï¼š${count}<br>ç”¨æˆ·åˆ—è¡¨ï¼š${JSON.stringify(users, null, 2)}`;
        }

        // 5. ç¼“å­˜å‡½æ•°æ¼”ç¤º
        function memoize(fn) {
            const cache = {};
            
            return function(...args) {
                const key = JSON.stringify(args);
                
                if (cache[key]) {
                    document.getElementById('memo-output').innerHTML += '<br>ä»ç¼“å­˜ä¸­è·å–ç»“æœ';
                    return cache[key];
                }
                
                document.getElementById('memo-output').innerHTML += '<br>è®¡ç®—æ–°ç»“æœ';
                const result = fn.apply(this, args);
                cache[key] = result;
                return result;
            };
        }

        function fibonacci(n) {
            if (n <= 1) return n;
            return fibonacci(n - 1) + fibonacci(n - 2);
        }

        const memoizedFib = memoize(fibonacci);

        function calcFib() {
            const n = parseInt(document.getElementById('fib-input').value);
            if (isNaN(n)) return;
            
            const start = Date.now();
            const result = fibonacci(n);
            const time = Date.now() - start;
            
            document.getElementById('memo-output').innerHTML = 
                `æ™®é€šè®¡ç®— fib(${n}) = ${result}ï¼Œè€—æ—¶ï¼š${time}ms`;
        }

        function calcMemoFib() {
            const n = parseInt(document.getElementById('fib-input').value);
            if (isNaN(n)) return;
            
            const start = Date.now();
            const result = memoizedFib(n);
            const time = Date.now() - start;
            
            document.getElementById('memo-output').innerHTML += 
                `<br>ç¼“å­˜è®¡ç®— fib(${n}) = ${result}ï¼Œè€—æ—¶ï¼š${time}ms`;
        }

        // 6. äº‹ä»¶ç®¡ç†å™¨æ¼”ç¤º
        const eventManager = (function() {
            const listeners = new Map();
            
            return {
                on: function(event, callback) {
                    if (!listeners.has(event)) {
                        listeners.set(event, []);
                    }
                    listeners.get(event).push(callback);
                },
                
                off: function(event, callback) {
                    if (listeners.has(event)) {
                        const callbacks = listeners.get(event);
                        const index = callbacks.indexOf(callback);
                        if (index > -1) {
                            callbacks.splice(index, 1);
                        }
                    }
                },
                
                emit: function(event, ...args) {
                    if (listeners.has(event)) {
                        listeners.get(event).forEach(callback => {
                            callback(...args);
                        });
                    }
                },
                
                getListenerCount: function(event) {
                    return listeners.has(event) ? listeners.get(event).length : 0;
                }
            };
        })();

        let listenerCount = 0;

        function addListener() {
            const callback = function(message) {
                document.getElementById('event-output').innerHTML += 
                    `<br>ç›‘å¬å™¨${++listenerCount}æ”¶åˆ°æ¶ˆæ¯ï¼š${message}`;
            };
            
            eventManager.on('test', callback);
            document.getElementById('event-output').innerHTML = 
                `æ·»åŠ äº†ç›‘å¬å™¨ï¼Œå½“å‰ç›‘å¬å™¨æ•°é‡ï¼š${eventManager.getListenerCount('test')}`;
        }

        function emitEvent() {
            eventManager.emit('test', `Hello at ${new Date().toLocaleTimeString()}`);
        }

        function showListeners() {
            const count = eventManager.getListenerCount('test');
            document.getElementById('event-output').innerHTML = `å½“å‰testäº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡ï¼š${count}`;
        }

        // 7. å•ä¾‹æ¨¡å¼æ¼”ç¤º
        const Singleton = (function() {
            let instance;
            let instanceCount = 0;
            
            function createInstance() {
                instanceCount++;
                return {
                    id: instanceCount,
                    getData: function() {
                        return `å•ä¾‹å®ä¾‹ ID: ${this.id}`;
                    },
                    timestamp: Date.now()
                };
            }
            
            return {
                getInstance: function() {
                    if (!instance) {
                        instance = createInstance();
                    }
                    return instance;
                },
                
                getInstanceCount: function() {
                    return instanceCount;
                }
            };
        })();

        let singletonInstance1, singletonInstance2;

        function getSingleton1() {
            singletonInstance1 = Singleton.getInstance();
            document.getElementById('singleton-output').innerHTML = 
                `å®ä¾‹1ï¼š${singletonInstance1.getData()}ï¼Œæ—¶é—´æˆ³ï¼š${singletonInstance1.timestamp}`;
        }

        function getSingleton2() {
            singletonInstance2 = Singleton.getInstance();
            document.getElementById('singleton-output').innerHTML = 
                `å®ä¾‹2ï¼š${singletonInstance2.getData()}ï¼Œæ—¶é—´æˆ³ï¼š${singletonInstance2.timestamp}`;
        }

        function compareSingleton() {
            if (singletonInstance1 && singletonInstance2) {
                const isSame = singletonInstance1 === singletonInstance2;
                document.getElementById('singleton-output').innerHTML = 
                    `ä¸¤ä¸ªå®ä¾‹æ˜¯å¦ç›¸åŒï¼š${isSame}<br>å®ä¾‹åˆ›å»ºæ€»æ•°ï¼š${Singleton.getInstanceCount()}`;
            } else {
                document.getElementById('singleton-output').innerHTML = 'è¯·å…ˆè·å–ä¸¤ä¸ªå®ä¾‹';
            }
        }

        // 8. å·¥å‚å‡½æ•°æ¼”ç¤º
        function createPersonFactory() {
            let personId = 0;
            const persons = [];
            
            return function(name, age, profession) {
                const id = ++personId;
                
                const person = {
                    id,
                    name,
                    age,
                    profession,
                    introduce: function() {
                        return `æˆ‘æ˜¯${this.name}ï¼Œ${this.age}å²ï¼ŒèŒä¸šæ˜¯${this.profession}`;
                    }
                };
                
                persons.push(person);
                
                return Object.assign(person, {
                    getAllPersons: () => persons.slice(),
                    getTotalCount: () => persons.length
                });
            };
        }

        const PersonFactory = createPersonFactory();

        function createPerson() {
            const name = document.getElementById('person-name').value;
            const age = parseInt(document.getElementById('person-age').value);
            const profession = document.getElementById('person-profession').value;
            
            if (name && age && profession) {
                const person = PersonFactory(name, age, profession);
                document.getElementById('factory-output').innerHTML = 
                    `${person.introduce()}<br>æ€»äººæ•°ï¼š${person.getTotalCount()}`;
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('person-name').value = '';
                document.getElementById('person-age').value = '';
                document.getElementById('person-profession').value = '';
            } else {
                document.getElementById('factory-output').innerHTML = 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯';
            }
        }

        function showAllPersons() {
            const person = PersonFactory('ä¸´æ—¶', 0, 'ä¸´æ—¶'); // åˆ›å»ºä¸´æ—¶å¯¹è±¡æ¥è®¿é—®æ–¹æ³•
            const persons = person.getAllPersons();
            persons.pop(); // ç§»é™¤ä¸´æ—¶å¯¹è±¡
            
            if (persons.length === 0) {
                document.getElementById('factory-output').innerHTML = 'æš‚æ— äººå‘˜';
            } else {
                let html = `å…±${persons.length}ä¸ªäººå‘˜ï¼š<br>`;
                persons.forEach(p => {
                    html += `${p.id}. ${p.name}(${p.age}å², ${p.profession})<br>`;
                });
                document.getElementById('factory-output').innerHTML = html;
            }
        }

        // 9. å¾ªç¯å¼‚æ­¥é—®é¢˜æ¼”ç¤º
        function testProblemCode() {
            document.getElementById('async-output').innerHTML = 'é—®é¢˜ä»£ç è¾“å‡ºï¼ˆéƒ½æ˜¯3ï¼‰ï¼š';
            for (var i = 0; i < 3; i++) {
                setTimeout(function() {
                    document.getElementById('async-output').innerHTML += ` ${i}`;
                }, 100 * i);
            }
        }

        function testClosureSolution() {
            document.getElementById('async-output').innerHTML = 'é—­åŒ…è§£å†³æ–¹æ¡ˆè¾“å‡ºï¼š';
            for (var i = 0; i < 3; i++) {
                (function(j) {
                    setTimeout(function() {
                        document.getElementById('async-output').innerHTML += ` ${j}`;
                    }, 100 * j);
                })(i);
            }
        }

        function testLetSolution() {
            document.getElementById('async-output').innerHTML = 'letè§£å†³æ–¹æ¡ˆè¾“å‡ºï¼š';
            for (let i = 0; i < 3; i++) {
                setTimeout(function() {
                    document.getElementById('async-output').innerHTML += ` ${i}`;
                }, 100 * i);
            }
        }

        function testBindSolution() {
            document.getElementById('async-output').innerHTML = 'bindè§£å†³æ–¹æ¡ˆè¾“å‡ºï¼š';
            for (var i = 0; i < 3; i++) {
                setTimeout(function(j) {
                    document.getElementById('async-output').innerHTML += ` ${j}`;
                }.bind(null, i), 100 * i);
            }
        }

        // 10. åå‡½æ•°åº”ç”¨æ¼”ç¤º
        function partial(fn, ...presetArgs) {
            return function(...laterArgs) {
                return fn(...presetArgs, ...laterArgs);
            };
        }

        function multiply(a, b, c) {
            return a * b * c;
        }

        function greet(greeting, punctuation, name) {
            return `${greeting}, ${name}${punctuation}`;
        }

        const double = partial(multiply, 2);
        const sayHello = partial(greet, 'Hello', '!');
        const multiplyBy10 = partial(multiply, 10);

        function testPartial1() {
            const val1 = parseInt(document.getElementById('partial-input1').value) || 5;
            const val2 = parseInt(document.getElementById('partial-input2').value) || 3;
            const result = double(val1, val2);
            document.getElementById('partial-output').innerHTML = 
                `double(${val1}, ${val2}) = 2 Ã— ${val1} Ã— ${val2} = ${result}`;
        }

        function testPartial2() {
            const val1 = parseInt(document.getElementById('partial-input1').value) || 2;
            const val2 = parseInt(document.getElementById('partial-input2').value) || 4;
            const result = multiplyBy10(val1, val2);
            document.getElementById('partial-output').innerHTML = 
                `multiplyBy10(${val1}, ${val2}) = 10 Ã— ${val1} Ã— ${val2} = ${result}`;
        }

        function testPartial3() {
            const name = document.getElementById('name-input').value || 'å¼ ä¸‰';
            const result = sayHello(name);
            document.getElementById('partial-output').innerHTML = 
                `sayHello('${name}') = "${result}"`;
        }

        // 11. çŠ¶æ€æœºæ¼”ç¤º
        function createStateMachine(initialState, transitions) {
            let currentState = initialState;
            const history = [initialState];
            
            return {
                getCurrentState: function() {
                    return currentState;
                },
                
                transition: function(action) {
                    const possibleStates = transitions[currentState];
                    
                    if (possibleStates && possibleStates[action]) {
                        const previousState = currentState;
                        currentState = possibleStates[action];
                        history.push(currentState);
                        
                        return {
                            success: true,
                            from: previousState,
                            to: currentState,
                            action: action
                        };
                    }
                    
                    return {
                        success: false,
                        message: `æ— æ³•ä» ${currentState} æ‰§è¡Œ ${action} æ“ä½œ`
                    };
                },
                
                getHistory: function() {
                    return [...history];
                },
                
                canTransition: function(action) {
                    const possibleStates = transitions[currentState];
                    return possibleStates && possibleStates[action] !== undefined;
                }
            };
        }

        const doorStates = {
            'closed': { 'open': 'open' },
            'open': { 'close': 'closed', 'lock': 'locked' },
            'locked': { 'unlock': 'closed' }
        };

        const door = createStateMachine('closed', doorStates);

        function doorAction(action) {
            const result = door.transition(action);
            if (result.success) {
                document.getElementById('state-output').innerHTML = 
                    `æ‰§è¡Œ${action}æ“ä½œæˆåŠŸï¼š${result.from} â†’ ${result.to}`;
            } else {
                document.getElementById('state-output').innerHTML = 
                    `æ‰§è¡Œå¤±è´¥ï¼š${result.message}`;
            }
        }

        function showDoorState() {
            document.getElementById('state-output').innerHTML = 
                `å½“å‰é—¨çš„çŠ¶æ€ï¼š${door.getCurrentState()}`;
        }

        function showDoorHistory() {
            const history = door.getHistory();
            document.getElementById('state-output').innerHTML = 
                `çŠ¶æ€å†å²ï¼š${history.join(' â†’ ')}`;
        }

        // 12. è®¡æ—¶å™¨æ¼”ç¤º
        function createTimer() {
            let timerId = null;
            let startTime = null;
            let pauseTime = 0;
            let isRunning = false;
            
            return {
                start: function(callback, interval = 1000) {
                    if (isRunning) return false;
                    
                    startTime = Date.now() - pauseTime;
                    isRunning = true;
                    
                    timerId = setInterval(() => {
                        const elapsed = Date.now() - startTime;
                        callback(Math.floor(elapsed / 1000));
                    }, interval);
                    
                    return true;
                },
                
                pause: function() {
                    if (!isRunning) return false;
                    
                    clearInterval(timerId);
                    pauseTime = Date.now() - startTime;
                    isRunning = false;
                    return true;
                },
                
                stop: function() {
                    clearInterval(timerId);
                    timerId = null;
                    startTime = null;
                    pauseTime = 0;
                    isRunning = false;
                    return true;
                },
                
                isRunning: function() {
                    return isRunning;
                },
                
                getElapsed: function() {
                    if (startTime === null) return 0;
                    
                    if (isRunning) {
                        return Math.floor((Date.now() - startTime) / 1000);
                    } else {
                        return Math.floor(pauseTime / 1000);
                    }
                }
            };
        }

        const timer = createTimer();

        function startTimer() {
            const success = timer.start(function(seconds) {
                document.getElementById('timer-output').innerHTML = `è®¡æ—¶å™¨: ${seconds}ç§’ (è¿è¡Œä¸­)`;
            });
            
            if (success) {
                document.getElementById('timer-output').innerHTML = 'è®¡æ—¶å™¨å·²å¼€å§‹';
            } else {
                document.getElementById('timer-output').innerHTML = 'è®¡æ—¶å™¨å·²ç»åœ¨è¿è¡Œä¸­';
            }
        }

        function pauseTimer() {
            const success = timer.pause();
            if (success) {
                const elapsed = timer.getElapsed();
                document.getElementById('timer-output').innerHTML = `è®¡æ—¶å™¨å·²æš‚åœ: ${elapsed}ç§’`;
            } else {
                document.getElementById('timer-output').innerHTML = 'è®¡æ—¶å™¨æœªåœ¨è¿è¡Œ';
            }
        }

        function stopTimer() {
            timer.stop();
            document.getElementById('timer-output').innerHTML = 'è®¡æ—¶å™¨å·²åœæ­¢: 0ç§’';
        }

        function showTimerStatus() {
            const elapsed = timer.getElapsed();
            const running = timer.isRunning();
            document.getElementById('timer-output').innerHTML = 
                `è®¡æ—¶å™¨çŠ¶æ€ï¼š${running ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}ï¼Œå·²ç”¨æ—¶ï¼š${elapsed}ç§’`;
        }
    </script>
    <!-- ä»£ç é«˜äº®è„šæœ¬ -->
    <script src="../shared/code-highlight.js"></script>
</body>
</html>