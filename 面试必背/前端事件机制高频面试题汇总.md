# å‰ç«¯äº‹ä»¶æœºåˆ¶é«˜é¢‘é¢è¯•é¢˜æ±‡æ€» â­â­â­â­â­

> ğŸ’¡ **é‡è¦ç¨‹åº¦**: é«˜é¢‘å¿…è€ƒ
> ğŸ“Œ **è®°å¿†å£è¯€**:
> - äº‹ä»¶æµï¼š**æ•è·ç›®æ ‡å†’æ³¡ï¼ˆcaptureã€targetã€bubbleï¼‰**
> - äº‹ä»¶å§”æ‰˜ï¼š**çˆ¶ä»£å­ã€å‡å†…å­˜ã€åŠ¨æ€ç»‘**
> - é˜»æ­¢ä¼ æ’­ï¼š**stopPropagationé˜»å†’æ³¡ã€preventDefaulté˜»é»˜è®¤**

---

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

| ç« èŠ‚ | é‡è¦çº§åˆ« | æ ¸å¿ƒå†…å®¹ | è®°å¿†å£è¯€ |
|------|---------|---------|---------|
| [ä¸€ã€JavaScriptåŸç”Ÿäº‹ä»¶æœºåˆ¶](#ä¸€javascriptåŸç”Ÿäº‹ä»¶æœºåˆ¶-) | â­â­â­â­â­ | äº‹ä»¶æµã€äº‹ä»¶å§”æ‰˜ã€äº‹ä»¶å¯¹è±¡ | æ•è·ç›®æ ‡å†’æ³¡ |
| [â”œâ”€ 1. äº‹ä»¶æµ](#1-äº‹ä»¶æµ-) | â­â­â­â­â­ | æ•è·â†’ç›®æ ‡â†’å†’æ³¡ä¸‰é˜¶æ®µ | å¤–åˆ°å†…å†åˆ°å¤– |
| [â”œâ”€ 2. äº‹ä»¶å§”æ‰˜/ä»£ç†](#2-äº‹ä»¶å§”æ‰˜ä»£ç†-) | â­â­â­â­â­ | åŸç†ã€ä¼˜ç¼ºç‚¹ã€å®ç° | çˆ¶ä»£å­ã€å‡å†…å­˜ã€åŠ¨æ€ç»‘ |
| [â”œâ”€ 3. äº‹ä»¶å¯¹è±¡](#3-äº‹ä»¶å¯¹è±¡-) | â­â­â­â­ | target vs currentTarget | targetæ˜¯æºã€currentTargetæ˜¯ç»‘ |
| [â”œâ”€ 4. è‡ªå®šä¹‰äº‹ä»¶](#4-è‡ªå®šä¹‰äº‹ä»¶) | â­â­â­â­ | CustomEventã€EventEmitter | åˆ›å»ºç›‘å¬è§¦å‘ |
| [â””â”€ 5. äº‹ä»¶æ€§èƒ½ä¼˜åŒ–](#5-äº‹ä»¶æ€§èƒ½ä¼˜åŒ–-) | â­â­â­â­ | é˜²æŠ–èŠ‚æµã€passive | é˜²æŠ–ç­‰å¾…ã€èŠ‚æµé—´éš” |
| [äºŒã€Vueäº‹ä»¶æœºåˆ¶](#äºŒvueäº‹ä»¶æœºåˆ¶-) | â­â­â­â­â­ | äº‹ä»¶ä¿®é¥°ç¬¦ã€ç»„ä»¶é€šä¿¡ | stopã€preventã€once |
| [ä¸‰ã€Reactäº‹ä»¶æœºåˆ¶](#ä¸‰reactäº‹ä»¶æœºåˆ¶-) | â­â­â­â­ | åˆæˆäº‹ä»¶ã€äº‹ä»¶æ±  | åˆæˆç»Ÿä¸€ã€è‡ªåŠ¨ç»‘å®š |
| [å››ã€æ¡†æ¶äº‹ä»¶æœºåˆ¶å¯¹æ¯”](#å››æ¡†æ¶äº‹ä»¶æœºåˆ¶å¯¹æ¯”-) | â­â­â­ | åŸç”Ÿvs Vue vs React | å„æœ‰ç‰¹è‰²ã€æŒ‰éœ€é€‰æ‹© |
| [äº”ã€ç»å…¸é¢è¯•é¢˜å®æˆ˜](#äº”ç»å…¸é¢è¯•é¢˜å®æˆ˜-) | â­â­â­â­â­ | ç»¼åˆåº”ç”¨é¢˜ | å®æˆ˜æ¼”ç»ƒ |
| [å…­ã€addEventListener æ·±å…¥è§£æ](#å…­addeventlistener-æ·±å…¥è§£æ-) | â­â­â­â­â­ | å‚æ•°è¯¦è§£ã€æœ€ä½³å®è·µ | typeã€listenerã€options |@

---

## ğŸ¯ è®°å¿†å£è¯€

### äº‹ä»¶æœºåˆ¶æ ¸å¿ƒå£è¯€
```
äº‹ä»¶æµä¸‰é˜¶æ®µï¼šæ•è·â†’ç›®æ ‡â†’å†’æ³¡
äº‹ä»¶å§”æ‰˜ä¼˜åŠ¿ï¼šçˆ¶ä»£å­ã€å‡å†…å­˜ã€åŠ¨æ€ç»‘
é˜»æ­¢ä¼ æ’­æ–¹æ³•ï¼šstopPropagationã€preventDefaultã€return false
äº‹ä»¶å¯¹è±¡åŒºåˆ«ï¼štargetæ˜¯æºã€currentTargetæ˜¯ç»‘å®šè€…
```

### è¯¦ç»†å£è¯€

**äº‹ä»¶æµå£è¯€ï¼š**
```
æ•è·é˜¶æ®µä»å¤–åˆ°å†…ï¼ˆwindow â†’ document â†’ body â†’ div â†’ buttonï¼‰
ç›®æ ‡é˜¶æ®µåˆ°è¾¾ç›®æ ‡
å†’æ³¡é˜¶æ®µä»å†…åˆ°å¤–ï¼ˆbutton â†’ div â†’ body â†’ document â†’ windowï¼‰
è®°ä½ï¼šæ•è·å°‘ç”¨ã€å†’æ³¡å¸¸ç”¨
```

**äº‹ä»¶å§”æ‰˜å£è¯€ï¼š**
```
çˆ¶ä»£å­ã€å‡å†…å­˜ï¼ˆä¸€ä¸ªç›‘å¬å™¨ç®¡å¤šä¸ªå­å…ƒç´ ï¼‰
åŠ¨æ€ç»‘ï¼ˆæ–°å¢å…ƒç´ è‡ªåŠ¨æœ‰äº‹ä»¶ï¼‰
ç²¾ç¡®åˆ¤ï¼ˆevent.targetåˆ¤æ–­ç‚¹å‡»æºï¼‰
å‘ä¸Šæ‰¾ï¼ˆmatchesé…åˆclosestï¼‰
```

**addEventListenerå£è¯€ï¼š**
```
ä¸‰å‚æ•°ï¼štypeã€listenerã€options/useCapture
optionsåŒ…å«ï¼šcaptureã€onceã€passiveã€signal
captureä¸ºtrueæ•è·ã€falseå†’æ³¡ï¼ˆé»˜è®¤falseï¼‰
onceä¸ºtrueåªè§¦å‘ä¸€æ¬¡
passiveä¸ºtrueä¸ä¼šè°ƒç”¨preventDefaultï¼ˆä¼˜åŒ–æ»šåŠ¨ï¼‰
```

**äº‹ä»¶å¯¹è±¡å±æ€§å£è¯€ï¼š**
```
targetæ˜¯çœŸæ­£ç‚¹å‡»çš„å…ƒç´ ï¼ˆäº‹ä»¶æºï¼‰
currentTargetæ˜¯ç»‘å®šç›‘å¬å™¨çš„å…ƒç´ ï¼ˆthisæŒ‡å‘å®ƒï¼‰
typeæ˜¯äº‹ä»¶ç±»å‹ï¼ˆclickã€inputç­‰ï¼‰
preventDefaulté˜»æ­¢é»˜è®¤è¡Œä¸º
stopPropagationé˜»æ­¢å†’æ³¡
stopImmediatePropagationç«‹å³åœæ­¢ï¼ˆåŒçº§ä¹Ÿä¸æ‰§è¡Œï¼‰
```

**è‡ªå®šä¹‰äº‹ä»¶å£è¯€ï¼š**
```
new CustomEventåˆ›å»ºï¼ˆå¯ä¼ detailæ•°æ®ï¼‰
addEventListenerç›‘å¬
dispatchEventè§¦å‘
è®°ä½ï¼šåˆ›å»ºâ†’ç›‘å¬â†’è§¦å‘ä¸‰æ­¥èµ°
```

**Vueäº‹ä»¶å£è¯€ï¼š**
```
@clickç»‘å®šã€.stopé˜»å†’æ³¡ã€.preventé˜»é»˜è®¤
.onceåªä¸€æ¬¡ã€.captureæ•è·ã€.selfåªè‡ªå·±
.nativeåŸç”Ÿã€$emitå­ä¼ çˆ¶ã€v-onç›‘å¬
```

**Reactäº‹ä»¶å£è¯€ï¼š**
```
åˆæˆäº‹ä»¶ç»Ÿä¸€ç®¡ç†ã€é©¼å³°å‘½åï¼ˆonClickï¼‰
è‡ªåŠ¨ç»‘å®šthiséœ€ç®­å¤´ã€äº‹ä»¶æ± å¤ç”¨ææ€§èƒ½
é˜»æ­¢å†’æ³¡ç”¨stopPropagationã€åŸç”Ÿäº‹ä»¶ç”¨nativeEvent
```

---

## ä¸€ã€JavaScriptåŸç”Ÿäº‹ä»¶æœºåˆ¶ â­â­â­â­â­

### 1. äº‹ä»¶æµ
#### çƒ­åº¦ï¼šâ­â­â­â­â­

#### é¢˜ç›®1ï¼šä»€ä¹ˆæ˜¯äº‹ä»¶æµï¼Ÿäº‹ä»¶æµçš„ä¸‰ä¸ªé˜¶æ®µæ˜¯ä»€ä¹ˆï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
æƒ³è±¡ä½ ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™ä¸ªç‚¹å‡»äº‹ä»¶ä¸æ˜¯ç›´æ¥å°±åˆ°æŒ‰é’®ä¸Šçš„ï¼Œè€Œæ˜¯åƒæ°´æµä¸€æ ·æœ‰ä¸ªä¼ æ’­è¿‡ç¨‹ã€‚äº‹ä»¶æµå°±æ˜¯æè¿°è¿™ä¸ªç‚¹å‡»äº‹ä»¶æ˜¯æ€ä¹ˆä»æµè§ˆå™¨çª—å£ä¸€å±‚å±‚ä¼ åˆ°æŒ‰é’®ï¼Œç„¶åå†ä¸€å±‚å±‚ä¼ å›å»çš„è¿‡ç¨‹ã€‚å°±åƒæ‰”çŸ³å¤´åˆ°æ°´é‡Œï¼Œæ°´æ³¢ä¼šå…ˆå‘å¤–æ‰©æ•£ï¼Œç„¶åå†å›æ¥ä¸€æ ·ã€‚

**ç­”æ¡ˆï¼š**
äº‹ä»¶æµæè¿°çš„æ˜¯ä»é¡µé¢ä¸­æ¥æ”¶äº‹ä»¶çš„é¡ºåºã€‚å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šåœ¨å…ƒç´ ä¹‹é—´æŒ‰ç…§ç‰¹å®šçš„é¡ºåºä¼ æ’­ï¼Œè¿™ä¸ªä¼ æ’­è¿‡ç¨‹å°±æ˜¯äº‹ä»¶æµã€‚

**äº‹ä»¶æµçš„ä¸‰ä¸ªé˜¶æ®µï¼š**
1. **æ•è·é˜¶æ®µï¼ˆCapture Phaseï¼‰**ï¼šäº‹ä»¶ä»windowå¯¹è±¡å‘ç›®æ ‡å…ƒç´ ä¼ æ’­
2. **ç›®æ ‡é˜¶æ®µï¼ˆTarget Phaseï¼‰**ï¼šäº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ 
3. **å†’æ³¡é˜¶æ®µï¼ˆBubble Phaseï¼‰**ï¼šäº‹ä»¶ä»ç›®æ ‡å…ƒç´ å‘windowå¯¹è±¡ä¼ æ’­

```javascript
// äº‹ä»¶æµç¤ºä¾‹
document.getElementById('parent').addEventListener('click', function(e) {
  console.log('çˆ¶å…ƒç´ æ•è·');
}, true); // trueè¡¨ç¤ºåœ¨æ•è·é˜¶æ®µè§¦å‘

document.getElementById('child').addEventListener('click', function(e) {
  console.log('å­å…ƒç´ å†’æ³¡');
}, false); // falseè¡¨ç¤ºåœ¨å†’æ³¡é˜¶æ®µè§¦å‘ï¼ˆé»˜è®¤ï¼‰

// ç‚¹å‡»å­å…ƒç´ æ—¶çš„è¾“å‡ºé¡ºåºï¼š
// 1. çˆ¶å…ƒç´ æ•è·
// 2. å­å…ƒç´ å†’æ³¡
```

#### é¢˜ç›®2ï¼šå¦‚ä½•é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œæ•è·ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›äº‹ä»¶åƒæ°´æ³¢ä¸€æ ·ä¼ æ’­ï¼Œæ¯”å¦‚ç‚¹å‡»äº†å­å…ƒç´ ï¼Œä¸æƒ³è®©çˆ¶å…ƒç´ ä¹Ÿæ”¶åˆ°è¿™ä¸ªç‚¹å‡»ã€‚å°±åƒåœ¨ä¼ è¯æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®©æŸä¸ªäººåœæ­¢å¾€ä¸‹ä¼ è¯ã€‚é˜»æ­¢å†’æ³¡å°±æ˜¯è®©äº‹ä»¶ä¸å†å‘ä¸Šä¼ æ’­ï¼Œé˜»æ­¢æ•è·å°±æ˜¯è®©äº‹ä»¶ä¸å†å‘ä¸‹ä¼ æ’­ã€‚

**ç­”æ¡ˆï¼š**

**å£è¿°è¦ç‚¹ï¼š**

è¿™äº›æ–¹æ³•éƒ½éœ€è¦åœ¨ **addEventListener çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰ä¸­**è°ƒç”¨ï¼Œé€šè¿‡äº‹ä»¶å¯¹è±¡ï¼ˆeventï¼‰æ¥ä½¿ç”¨ï¼š

1. **é˜»æ­¢äº‹ä»¶å†’æ³¡** - ä½¿ç”¨ `event.stopPropagation()` æ–¹æ³•ï¼Œé˜»æ­¢äº‹ä»¶ç»§ç»­å‘çˆ¶å…ƒç´ ä¼ æ’­ï¼Œä½†å½“å‰å…ƒç´ ä¸Šçš„å…¶ä»–åŒç±»å‹ç›‘å¬å™¨ä»ä¼šæ‰§è¡Œ
2. **ç«‹å³åœæ­¢ä¼ æ’­** - ä½¿ç”¨ `event.stopImmediatePropagation()` æ–¹æ³•ï¼Œä¸ä»…é˜»æ­¢å†’æ³¡å’Œæ•è·ï¼Œè¿˜ä¼šé˜»æ­¢å½“å‰å…ƒç´ ä¸Šå…¶ä»–åŒç±»å‹ç›‘å¬å™¨çš„æ‰§è¡Œ
3. **é˜»æ­¢é»˜è®¤è¡Œä¸º** - ä½¿ç”¨ `event.preventDefault()` æ–¹æ³•ï¼Œé˜»æ­¢å…ƒç´ çš„é»˜è®¤è¡Œä¸ºï¼ˆå¦‚ `<a>` æ ‡ç­¾è·³è½¬ã€`<form>` è¡¨å•æäº¤ã€å³é”®èœå•ç­‰ï¼‰
4. **return false** - åœ¨ä¼ ç»Ÿçš„ `onclick` å±æ€§ç»‘å®šä¸­å¯ä»¥åŒæ—¶é˜»æ­¢å†’æ³¡å’Œé»˜è®¤è¡Œä¸ºï¼Œä½†åœ¨ `addEventListener` ä¸­æ— æ•ˆ

**æ ¸å¿ƒåŒºåˆ«ï¼š**
- `stopPropagation()` åªé˜»æ­¢ä¼ æ’­ï¼Œä¸å½±å“é»˜è®¤è¡Œä¸º
- `preventDefault()` åªé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œä¸å½±å“ä¼ æ’­
- `stopImmediatePropagation()` æœ€å½»åº•ï¼Œè¿åŒçº§ç›‘å¬å™¨éƒ½ä¸æ‰§è¡Œ

```javascript
element.addEventListener('click', function(e) {
  // é˜»æ­¢äº‹ä»¶å†’æ³¡
  e.stopPropagation();

  // é˜»æ­¢äº‹ä»¶æ•è·å’Œå†’æ³¡ï¼ˆç«‹å³åœæ­¢ï¼ŒåŒçº§åˆ«çš„å…¶ä»–ç›‘å¬å™¨ä¹Ÿä¸ä¼šæ‰§è¡Œï¼‰
  e.stopImmediatePropagation();

  // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆå¦‚é“¾æ¥è·³è½¬ã€è¡¨å•æäº¤ï¼‰
  e.preventDefault();

  // åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œè¿”å›falseå¯ä»¥åŒæ—¶é˜»æ­¢å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
  // ä½†åªåœ¨onclickç­‰å±æ€§ç»‘å®šä¸­æœ‰æ•ˆï¼ŒaddEventListenerä¸­æ— æ•ˆ
  return false;
});
```

#### é¢˜ç›®3ï¼šäº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·çš„å®é™…åº”ç”¨åœºæ™¯ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
äº‹ä»¶å†’æ³¡æœ€å¸¸ç”¨çš„åœºæ™¯æ˜¯"äº‹ä»¶å§”æ‰˜"ï¼Œå°±åƒç­é•¿ä»£è¡¨å…¨ç­åŒå­¦ä¸€æ ·ã€‚æ¯”å¦‚æœ‰100ä¸ªæŒ‰é’®ï¼Œæˆ‘ä»¬ä¸ç”¨ç»™æ¯ä¸ªæŒ‰é’®éƒ½ç»‘å®šäº‹ä»¶ï¼Œåªéœ€è¦ç»™å®ƒä»¬çš„çˆ¶å®¹å™¨ç»‘å®šä¸€ä¸ªäº‹ä»¶å°±è¡Œäº†ï¼Œåˆ©ç”¨å†’æ³¡æœºåˆ¶æ¥å¤„ç†ã€‚äº‹ä»¶æ•è·åˆ™å¸¸ç”¨äºå…¨å±€æ‹¦æˆªï¼Œæ¯”å¦‚åœ¨æœ€å¤–å±‚æ‹¦æˆªæ‰€æœ‰ç‚¹å‡»ï¼Œåšæƒé™æ£€æŸ¥ã€‚

**ç­”æ¡ˆï¼š**

äº‹ä»¶å†’æ³¡å’Œæ•è·åœ¨å®é™…å¼€å‘ä¸­æœ‰ä¸¤ä¸ªä¸»è¦åº”ç”¨åœºæ™¯ï¼š

**äº‹ä»¶å†’æ³¡çš„åº”ç”¨ - äº‹ä»¶å§”æ‰˜ï¼š** è¿™æ˜¯æœ€å¸¸ç”¨çš„åœºæ™¯ã€‚å½“é¡µé¢æœ‰å¤§é‡ç›¸åŒç±»å‹çš„å­å…ƒç´ éœ€è¦ç»‘å®šäº‹ä»¶æ—¶ï¼Œä¸ç”¨ç»™æ¯ä¸ªå­å…ƒç´ å•ç‹¬ç»‘å®šï¼Œè€Œæ˜¯å°†äº‹ä»¶ç›‘å¬å™¨ç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šï¼Œåˆ©ç”¨å†’æ³¡æœºåˆ¶ï¼Œåœ¨çˆ¶å…ƒç´ ä¸­é€šè¿‡ `event.target` åˆ¤æ–­å®é™…è§¦å‘çš„å­å…ƒç´ ã€‚è¿™æ ·åšå¯ä»¥å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œè€Œä¸”åŠ¨æ€æ·»åŠ çš„å­å…ƒç´ ä¹Ÿä¼šè‡ªåŠ¨æ‹¥æœ‰äº‹ä»¶å¤„ç†èƒ½åŠ›ã€‚

**äº‹ä»¶æ•è·çš„åº”ç”¨ - å…¨å±€äº‹ä»¶æ‹¦æˆªï¼š** åœ¨æ•è·é˜¶æ®µå¯ä»¥æœ€æ—©æ‹¦æˆªåˆ°äº‹ä»¶ï¼Œå¸¸ç”¨äºå…¨å±€æƒé™æ§åˆ¶ã€åŸ‹ç‚¹ç»Ÿè®¡ç­‰åœºæ™¯ã€‚é€šè¿‡åœ¨ `addEventListener` çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º `true` æ¥ç›‘å¬æ•è·é˜¶æ®µï¼Œå¯ä»¥åœ¨äº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ ä¹‹å‰è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œå¦‚æœä¸ç¬¦åˆæ¡ä»¶å°±é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­ã€‚

```javascript
// 1. äº‹ä»¶å†’æ³¡åº”ç”¨ï¼šäº‹ä»¶å§”æ‰˜
// ä¸å¥½çš„åšæ³•ï¼šä¸ºæ¯ä¸ªliç»‘å®šäº‹ä»¶
const lis = document.querySelectorAll('li');
lis.forEach(li => {
  li.addEventListener('click', handleClick);
});

// å¥½çš„åšæ³•ï¼šåˆ©ç”¨å†’æ³¡ï¼Œåªåœ¨çˆ¶å…ƒç´ ç»‘å®šä¸€æ¬¡
document.querySelector('ul').addEventListener('click', function(e) {
  if (e.target.tagName === 'LI') {
    handleClick(e);
  }
});

// 2. äº‹ä»¶æ•è·åº”ç”¨ï¼šå…¨å±€äº‹ä»¶æ‹¦æˆª
// åœ¨æ•è·é˜¶æ®µæ‹¦æˆªæ‰€æœ‰ç‚¹å‡»äº‹ä»¶
document.addEventListener('click', function(e) {
  // å¯ä»¥åœ¨è¿™é‡Œåšæƒé™éªŒè¯ã€åŸ‹ç‚¹ç»Ÿè®¡ç­‰
  if (!hasPermission()) {
    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­
    e.preventDefault();
    showNoPermissionDialog();
  }
}, true);
```

### 2. äº‹ä»¶å§”æ‰˜/ä»£ç†
#### çƒ­åº¦ï¼šâ­â­â­â­â­

#### é¢˜ç›®1ï¼šä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼ŸåŸç†å’Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
äº‹ä»¶å§”æ‰˜å°±åƒæ˜¯"ä»£ç†äºº"çš„æ¦‚å¿µã€‚æ¯”å¦‚ä¸€ä¸ªç­çº§é‡Œæœ‰30ä¸ªå­¦ç”Ÿï¼Œè€å¸ˆä¸ç”¨è·Ÿæ¯ä¸ªå­¦ç”Ÿå•ç‹¬è¯´è¯ï¼Œåªéœ€è¦è·Ÿç­é•¿è¯´ï¼Œç­é•¿å†è½¬è¾¾ç»™å…¶ä»–åŒå­¦ã€‚åœ¨ç½‘é¡µä¸­ï¼Œæˆ‘ä»¬ä¸ç»™æ¯ä¸ªå­å…ƒç´ ç»‘å®šäº‹ä»¶ï¼Œè€Œæ˜¯ç»™çˆ¶å…ƒç´ ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œè®©çˆ¶å…ƒç´ æ¥"ä»£ç†"å¤„ç†æ‰€æœ‰å­å…ƒç´ çš„äº‹ä»¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯çœå†…å­˜ã€ä»£ç ç®€æ´ï¼Œæ–°å¢çš„å­å…ƒç´ ä¹Ÿè‡ªåŠ¨æœ‰äº‹ä»¶å¤„ç†èƒ½åŠ›ã€‚

**ç­”æ¡ˆï¼š**
äº‹ä»¶å§”æ‰˜æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå°†äº‹ä»¶ç›‘å¬å™¨ç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šï¼Œé€šè¿‡åˆ¤æ–­äº‹ä»¶ç›®æ ‡æ¥å¤„ç†å­å…ƒç´ çš„äº‹ä»¶ã€‚

**åŸç†ï¼š**
åŸºäºäº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå­å…ƒç´ çš„äº‹ä»¶ä¼šå†’æ³¡åˆ°çˆ¶å…ƒç´ ï¼Œåœ¨çˆ¶å…ƒç´ çš„ç›‘å¬å™¨ä¸­é€šè¿‡event.targetåˆ¤æ–­äº‹ä»¶æºã€‚

**ä¼˜ç‚¹ï¼š**
1. **å‡å°‘å†…å­˜æ¶ˆè€—**ï¼šåªéœ€è¦ç»‘å®šä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨
2. **åŠ¨æ€å…ƒç´ æ”¯æŒ**ï¼šæ–°æ·»åŠ çš„å­å…ƒç´ è‡ªåŠ¨æœ‰äº‹ä»¶å¤„ç†
3. **ç®€åŒ–ä»£ç **ï¼šé¿å…é‡å¤ç»‘å®š

**ç¼ºç‚¹ï¼š**
1. **ä¸æ”¯æŒä¸å†’æ³¡çš„äº‹ä»¶**ï¼šå¦‚focusã€blurç­‰
2. **å¯èƒ½è¯¯è§¦å‘**ï¼šéœ€è¦å‡†ç¡®åˆ¤æ–­äº‹ä»¶ç›®æ ‡
3. **é˜»æ­¢å†’æ³¡ä¼šå¤±æ•ˆ**ï¼šå¦‚æœä¸­é—´å…ƒç´ é˜»æ­¢å†’æ³¡

```javascript
// å®Œæ•´çš„äº‹ä»¶å§”æ‰˜å®ç°
class EventDelegate {
  constructor(parent, selector, eventType, handler) {
    this.parent = parent;
    this.selector = selector;
    this.handler = handler;

    parent.addEventListener(eventType, this.handleEvent.bind(this));
  }

  handleEvent(e) {
    let target = e.target;

    // å‘ä¸ŠæŸ¥æ‰¾åŒ¹é…çš„å…ƒç´ 
    while (target && target !== this.parent) {
      if (target.matches(this.selector)) {
        this.handler.call(target, e);
        break;
      }
      target = target.parentElement;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
new EventDelegate(
  document.getElementById('list'),
  '.item',
  'click',
  function(e) {
    console.log('ç‚¹å‡»äº†:', this.textContent);
  }
);
```

#### é¢˜ç›®2ï¼šäº‹ä»¶å§”æ‰˜çš„ç»å…¸é¢è¯•é¢˜

**é€šä¿—æ¦‚è¿°ï¼š**
è¿™æ˜¯ä¸€ä¸ªå®é™…åº”ç”¨é¢˜ï¼Œè¦æ±‚ç”¨äº‹ä»¶å§”æ‰˜å®ç°ä¸€ä¸ªå¾…åŠäº‹é¡¹åˆ—è¡¨ã€‚å…³é”®æ€è·¯æ˜¯ï¼šä¸ç»™æ¯ä¸ªæŒ‰é’®å•ç‹¬ç»‘å®šäº‹ä»¶ï¼Œè€Œæ˜¯ç»™æ•´ä¸ªå®¹å™¨ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åé€šè¿‡åˆ¤æ–­ç‚¹å‡»çš„æ˜¯å“ªä¸ªæŒ‰é’®æ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼ˆåˆ é™¤ã€ç¼–è¾‘ã€æ ‡è®°å®Œæˆç­‰ï¼‰ã€‚

**ç­”æ¡ˆï¼š**

ä½¿ç”¨äº‹ä»¶å§”æ‰˜å®ç°å¾…åŠäº‹é¡¹åˆ—è¡¨çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼šåœ¨çˆ¶å®¹å™¨ä¸Šç»‘å®šä¸€ä¸ªç»Ÿä¸€çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œé€šè¿‡ `event.target` åˆ¤æ–­å®é™…ç‚¹å‡»çš„æ˜¯å“ªä¸ªæŒ‰é’®ï¼Œå†é€šè¿‡ `dataset.action` å±æ€§è¯†åˆ«æ“ä½œç±»å‹ï¼Œæœ€åç”¨ `closest()` æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„å¾…åŠé¡¹å…ƒç´ æ‰§è¡Œç›¸åº”æ“ä½œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åªéœ€è¦ä¸€ä¸ªç›‘å¬å™¨å°±èƒ½å¤„ç†æ‰€æœ‰æŒ‰é’®çš„äº‹ä»¶ï¼Œè€Œä¸”åŠ¨æ€æ·»åŠ çš„æ–°å¾…åŠé¡¹ä¹Ÿä¼šè‡ªåŠ¨æ‹¥æœ‰äº‹ä»¶å¤„ç†èƒ½åŠ›ï¼Œå¤§å¤§å‡å°‘äº†å†…å­˜å ç”¨å’Œä»£ç é‡ã€‚

```javascript
// é¢˜ç›®ï¼šå®ç°ä¸€ä¸ªtodolistï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æ ‡è®°å®Œæˆ
class TodoList {
  constructor(container) {
    this.container = container;
    this.init();
  }

  init() {
    // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†æ‰€æœ‰äº‹ä»¶
    this.container.addEventListener('click', (e) => {
      const target = e.target;
      const action = target.dataset.action;
      const todoItem = target.closest('.todo-item');

      if (!action || !todoItem) return;

      switch(action) {
        case 'delete':
          this.deleteTodo(todoItem);
          break;
        case 'toggle':
          this.toggleTodo(todoItem);
          break;
        case 'edit':
          this.editTodo(todoItem);
          break;
      }
    });
  }

  addTodo(text) {
    const html = `
      <div class="todo-item">
        <input type="checkbox" data-action="toggle">
        <span class="todo-text">${text}</span>
        <button data-action="edit">ç¼–è¾‘</button>
        <button data-action="delete">åˆ é™¤</button>
      </div>
    `;
    this.container.insertAdjacentHTML('beforeend', html);
  }

  deleteTodo(item) {
    item.remove();
  }

  toggleTodo(item) {
    item.classList.toggle('completed');
  }

  editTodo(item) {
    const textElement = item.querySelector('.todo-text');
    const newText = prompt('ç¼–è¾‘ä»»åŠ¡:', textElement.textContent);
    if (newText) {
      textElement.textContent = newText;
    }
  }
}
```

### 3. äº‹ä»¶å¯¹è±¡
#### çƒ­åº¦ï¼šâ­â­â­â­

#### é¢˜ç›®1ï¼šäº‹ä»¶å¯¹è±¡çš„å¸¸ç”¨å±æ€§å’Œæ–¹æ³•ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæµè§ˆå™¨ä¼šåˆ›å»ºä¸€ä¸ª"äº‹ä»¶å¯¹è±¡"ï¼Œé‡Œé¢åŒ…å«äº†è¿™æ¬¡äº‹ä»¶çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå°±åƒæ˜¯äº‹ä»¶çš„"èº«ä»½è¯"ã€‚æ¯”å¦‚ç‚¹å‡»äº‹ä»¶çš„å¯¹è±¡ä¼šå‘Šè¯‰ä½ ï¼šç‚¹å‡»çš„æ˜¯å“ªä¸ªå…ƒç´ ã€é¼ æ ‡åœ¨å“ªä¸ªä½ç½®ã€æŒ‰äº†å“ªäº›é”®ç­‰ç­‰ã€‚æŒæ¡è¿™äº›å±æ€§å’Œæ–¹æ³•ï¼Œå°±èƒ½è·å–äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯å¹¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚

**ç­”æ¡ˆï¼š**

äº‹ä»¶å¯¹è±¡åŒ…å«ä¸‰ç±»é‡è¦çš„å±æ€§å’Œæ–¹æ³•ï¼š

**é€šç”¨å±æ€§ï¼š** `type` è¡¨ç¤ºäº‹ä»¶ç±»å‹ï¼Œ`target` æ˜¯è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼Œ`currentTarget` æ˜¯ç»‘å®šäº‹ä»¶çš„å…ƒç´ ï¼Œ`eventPhase` è¡¨ç¤ºå½“å‰äº‹ä»¶å¤„äºæ•è·ã€ç›®æ ‡è¿˜æ˜¯å†’æ³¡é˜¶æ®µï¼Œ`bubbles` è¡¨ç¤ºæ˜¯å¦å†’æ³¡ï¼Œ`timeStamp` æ˜¯äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´æˆ³ï¼Œ`isTrusted` ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯ç”¨æˆ·çœŸå®è§¦å‘çš„äº‹ä»¶ã€‚

**é¼ æ ‡äº‹ä»¶ç‰¹æœ‰å±æ€§ï¼š** `clientX/clientY` æ˜¯ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„åæ ‡ï¼Œ`pageX/pageY` æ˜¯ç›¸å¯¹äºæ•´ä¸ªé¡µé¢çš„åæ ‡ï¼ˆåŒ…å«æ»šåŠ¨è·ç¦»ï¼‰ï¼Œ`screenX/screenY` æ˜¯ç›¸å¯¹äºå±å¹•çš„åæ ‡ï¼Œ`offsetX/offsetY` æ˜¯ç›¸å¯¹äºç›®æ ‡å…ƒç´ çš„åæ ‡ã€‚

**é”®ç›˜äº‹ä»¶ç‰¹æœ‰å±æ€§ï¼š** `key` è¡¨ç¤ºæŒ‰é”®çš„å€¼ï¼Œ`code` è¡¨ç¤ºæŒ‰é”®çš„ç‰©ç†ä½ç½®ï¼Œ`altKey/ctrlKey/shiftKey/metaKey` ç”¨äºåˆ¤æ–­ç»„åˆé”®æ˜¯å¦æŒ‰ä¸‹ã€‚

**å¸¸ç”¨æ–¹æ³•ï¼š** `preventDefault()` é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œ`stopPropagation()` é˜»æ­¢å†’æ³¡ï¼Œ`stopImmediatePropagation()` ç«‹å³åœæ­¢ä¼ æ’­å¹¶é˜»æ­¢åŒçº§ç›‘å¬å™¨æ‰§è¡Œã€‚

```javascript
element.addEventListener('click', function(event) {
  // å¸¸ç”¨å±æ€§
  console.log(event.type);           // äº‹ä»¶ç±»å‹ï¼š'click'
  console.log(event.target);         // è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼ˆäº‹ä»¶æºï¼‰
  console.log(event.currentTarget);  // ç»‘å®šäº‹ä»¶çš„å…ƒç´ ï¼ˆthisï¼‰
  console.log(event.eventPhase);     // äº‹ä»¶é˜¶æ®µï¼š1(æ•è·) 2(ç›®æ ‡) 3(å†’æ³¡)
  console.log(event.bubbles);        // æ˜¯å¦å†’æ³¡
  console.log(event.cancelable);     // æ˜¯å¦å¯å–æ¶ˆé»˜è®¤è¡Œä¸º
  console.log(event.timeStamp);      // äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´æˆ³
  console.log(event.isTrusted);      // æ˜¯å¦æ˜¯ç”¨æˆ·è§¦å‘çš„äº‹ä»¶

  // é¼ æ ‡äº‹ä»¶ç‰¹æœ‰å±æ€§
  console.log(event.clientX, event.clientY); // ç›¸å¯¹äºè§†å£çš„åæ ‡
  console.log(event.pageX, event.pageY);     // ç›¸å¯¹äºé¡µé¢çš„åæ ‡
  console.log(event.screenX, event.screenY); // ç›¸å¯¹äºå±å¹•çš„åæ ‡
  console.log(event.offsetX, event.offsetY); // ç›¸å¯¹äºç›®æ ‡å…ƒç´ çš„åæ ‡

  // é”®ç›˜äº‹ä»¶ç‰¹æœ‰å±æ€§
  console.log(event.key);      // æŒ‰é”®çš„å€¼
  console.log(event.code);     // æŒ‰é”®çš„ç‰©ç†ä½ç½®
  console.log(event.keyCode);  // æŒ‰é”®ç¼–ç ï¼ˆå·²åºŸå¼ƒï¼‰
  console.log(event.altKey);   // æ˜¯å¦æŒ‰ä¸‹Alté”®
  console.log(event.ctrlKey);  // æ˜¯å¦æŒ‰ä¸‹Ctrlé”®
  console.log(event.shiftKey); // æ˜¯å¦æŒ‰ä¸‹Shifté”®
  console.log(event.metaKey);  // æ˜¯å¦æŒ‰ä¸‹Metaé”®ï¼ˆMacçš„Commandé”®ï¼‰

  // å¸¸ç”¨æ–¹æ³•
  event.preventDefault();        // é˜»æ­¢é»˜è®¤è¡Œä¸º
  event.stopPropagation();       // é˜»æ­¢å†’æ³¡
  event.stopImmediatePropagation(); // ç«‹å³åœæ­¢ä¼ æ’­
});
```

#### é¢˜ç›®2ï¼ševent.targetå’Œevent.currentTargetçš„åŒºåˆ«ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
è¿™æ˜¯ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚ç®€å•è¯´ï¼štargetæ˜¯"çœŸæ­£è¢«ç‚¹å‡»çš„å…ƒç´ "ï¼ŒcurrentTargetæ˜¯"ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°çš„å…ƒç´ "ã€‚å°±åƒä½ ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®é‡Œçš„æ–‡å­—ï¼Œtargetæ˜¯é‚£ä¸ªæ–‡å­—ï¼ŒcurrentTargetæ˜¯æŒ‰é’®ã€‚åœ¨äº‹ä»¶å§”æ‰˜ä¸­ï¼Œtargetæ˜¯å­å…ƒç´ ï¼ŒcurrentTargetæ˜¯çˆ¶å…ƒç´ ã€‚

**ç­”æ¡ˆï¼š**

`event.target` å’Œ `event.currentTarget` çš„æ ¸å¿ƒåŒºåˆ«åœ¨äºæŒ‡å‘çš„å…ƒç´ ä¸åŒï¼š

**event.target** æ˜¯å®é™…è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çœŸæ­£ç‚¹å‡»æˆ–æ“ä½œçš„é‚£ä¸ªå…ƒç´ ã€‚å®ƒåœ¨äº‹ä»¶æµçš„æ•´ä¸ªä¼ æ’­è¿‡ç¨‹ä¸­éƒ½æŒ‡å‘åŒä¸€ä¸ªå…ƒç´ ï¼ˆäº‹ä»¶æºï¼‰ã€‚

**event.currentTarget** æ˜¯ç»‘å®šäº‹ä»¶ç›‘å¬å™¨çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°çš„å…ƒç´ ã€‚å®ƒä¼šéšç€äº‹ä»¶æµçš„ä¼ æ’­è€Œå˜åŒ–ï¼Œåœ¨ä¸åŒçš„å…ƒç´ ä¸Šæ‰§è¡Œæ—¶ä¼šæŒ‡å‘ä¸åŒçš„å…ƒç´ ã€‚å¦å¤–ï¼Œ`this` å…³é”®å­—æ€»æ˜¯ç­‰äº `currentTarget`ã€‚

åœ¨äº‹ä»¶å§”æ‰˜åœºæ™¯ä¸­ï¼Œå½“ç‚¹å‡»å­å…ƒç´ æ—¶ï¼Œ`target` æŒ‡å‘è¢«ç‚¹å‡»çš„å­å…ƒç´ ï¼Œè€Œ `currentTarget` æŒ‡å‘ç»‘å®šäº†äº‹ä»¶ç›‘å¬å™¨çš„çˆ¶å…ƒç´ ã€‚è¿™ä¸ªåŒºåˆ«åœ¨äº‹ä»¶å§”æ‰˜ä¸­éå¸¸å…³é”®ï¼Œæˆ‘ä»¬é€šå¸¸é€šè¿‡åˆ¤æ–­ `target` æ¥ç¡®å®šå…·ä½“æ˜¯å“ªä¸ªå­å…ƒç´ è¢«ç‚¹å‡»äº†ã€‚

```javascript
// HTMLç»“æ„
// <div id="parent">
//   <button id="child">ç‚¹å‡»æˆ‘</button>
// </div>

document.getElementById('parent').addEventListener('click', function(e) {
  console.log('target:', e.target.id);             // 'child'ï¼ˆç‚¹å‡»çš„å…ƒç´ ï¼‰
  console.log('currentTarget:', e.currentTarget.id); // 'parent'ï¼ˆç»‘å®šäº‹ä»¶çš„å…ƒç´ ï¼‰
  console.log('this:', this.id);                   // 'parent'ï¼ˆthis === currentTargetï¼‰
});
```

### 4. è‡ªå®šä¹‰äº‹ä»¶
#### çƒ­åº¦ï¼šâ­â­â­â­

#### é¢˜ç›®1ï¼šå¦‚ä½•åˆ›å»ºå’Œè§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
é™¤äº†ç‚¹å‡»ã€è¾“å…¥è¿™äº›æµè§ˆå™¨å†…ç½®çš„äº‹ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„äº‹ä»¶ï¼Œæ¯”å¦‚"ç”¨æˆ·ç™»å½•æˆåŠŸ"ã€"æ•°æ®åŠ è½½å®Œæˆ"ç­‰ã€‚å°±åƒè‡ªå·±å®šä¹‰ä¸€ä¸ªæš—å·ï¼Œå½“æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶å°±"å–Š"è¿™ä¸ªæš—å·ï¼Œå…¶ä»–åœ°æ–¹å¬åˆ°è¿™ä¸ªæš—å·å°±æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™åœ¨ç»„ä»¶é—´é€šä¿¡ä¸­éå¸¸æœ‰ç”¨ã€‚

**ç­”æ¡ˆï¼š**

**æ–¹æ³•1ï¼šä½¿ç”¨ CustomEventï¼ˆæ¨èï¼‰**
- åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡
- `detail` å±æ€§ç”¨æ¥ä¼ é€’è‡ªå®šä¹‰æ•°æ®ï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹
- `bubbles` æ§åˆ¶äº‹ä»¶æ˜¯å¦å†’æ³¡ï¼ˆé»˜è®¤ falseï¼‰
- `cancelable` æ§åˆ¶äº‹ä»¶æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆï¼ˆé»˜è®¤ falseï¼‰
- ä½¿ç”¨ `addEventListener` ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šè¿‡ `e.detail` è·å–ä¼ é€’çš„æ•°æ®
- ä½¿ç”¨ `dispatchEvent` æ–¹æ³•è§¦å‘äº‹ä»¶

```javascript
// æ–¹æ³•1ï¼šä½¿ç”¨CustomEventï¼ˆæ¨èï¼‰
const customEvent = new CustomEvent('myEvent', {
  detail: { message: 'Hello World' }, // è‡ªå®šä¹‰æ•°æ®
  bubbles: true,                      // æ˜¯å¦å†’æ³¡
  cancelable: true                    // æ˜¯å¦å¯å–æ¶ˆ
});

// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶
element.addEventListener('myEvent', function(e) {
  console.log('è‡ªå®šä¹‰äº‹ä»¶è§¦å‘:', e.detail.message);
});

// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
element.dispatchEvent(customEvent);

// æ–¹æ³•2ï¼šä½¿ç”¨Eventæ„é€ å‡½æ•°
const event = new Event('build', { bubbles: true });
element.dispatchEvent(event);

// æ–¹æ³•3ï¼šæ—§ç‰ˆæœ¬å…¼å®¹å†™æ³•
const event = document.createEvent('CustomEvent');
event.initCustomEvent('myEvent', true, true, { message: 'Hello' });
element.dispatchEvent(event);
```

#### é¢˜ç›®2ï¼šå®ç°ä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶å‘å¸ƒè®¢é˜…ç³»ç»Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„è®¾è®¡æ¨¡å¼é¢˜ã€‚å‘å¸ƒè®¢é˜…å°±åƒæ˜¯"å¹¿æ’­ç”µå°"ï¼Œæœ‰äººå¯ä»¥"è®¢é˜…"ï¼ˆç›‘å¬ï¼‰æŸä¸ªé¢‘é“ï¼Œæœ‰äººå¯ä»¥"å‘å¸ƒ"ï¼ˆå¹¿æ’­ï¼‰æ¶ˆæ¯åˆ°è¿™ä¸ªé¢‘é“ã€‚æ‰€æœ‰è®¢é˜…äº†è¿™ä¸ªé¢‘é“çš„äººéƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ã€‚è¿™ä¸ªæ¨¡å¼åœ¨å‰ç«¯å¼€å‘ä¸­éå¸¸å¸¸ç”¨ï¼Œç”¨äºè§£è€¦ä¸åŒæ¨¡å—é—´çš„é€šä¿¡ã€‚

**ç­”æ¡ˆï¼š**

**å£è¿°è¦ç‚¹ï¼š**

å‘å¸ƒè®¢é˜…ç³»ç»Ÿéœ€è¦å®ç°å››ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š

1. **on æ–¹æ³•ï¼ˆè®¢é˜…ï¼‰** - æ¥æ”¶äº‹ä»¶åå’Œå›è°ƒå‡½æ•°ï¼Œå°†å›è°ƒå‡½æ•°å­˜å‚¨åˆ°å¯¹åº”äº‹ä»¶åçš„æ•°ç»„ä¸­ï¼Œå¦‚æœè¯¥äº‹ä»¶åä¸å­˜åœ¨åˆ™å…ˆåˆ›å»ºç©ºæ•°ç»„
2. **emit æ–¹æ³•ï¼ˆå‘å¸ƒï¼‰** - æ¥æ”¶äº‹ä»¶åå’Œå‚æ•°ï¼Œæ‰¾åˆ°è¯¥äº‹ä»¶åå¯¹åº”çš„æ‰€æœ‰å›è°ƒå‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œå¹¶ä¼ å…¥å‚æ•°
3. **off æ–¹æ³•ï¼ˆå–æ¶ˆè®¢é˜…ï¼‰** - æ¥æ”¶äº‹ä»¶åå’Œå›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¼ å›è°ƒå‡½æ•°åˆ™åˆ é™¤è¯¥äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ï¼Œå¦åˆ™åªåˆ é™¤æŒ‡å®šçš„å›è°ƒå‡½æ•°
4. **once æ–¹æ³•ï¼ˆä¸€æ¬¡æ€§è®¢é˜…ï¼‰** - åˆ›å»ºä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œåœ¨æ‰§è¡Œå®ŒåŸå›è°ƒåç«‹å³è°ƒç”¨ off å–æ¶ˆè®¢é˜…

**å®ç°è¦ç‚¹ï¼š**
- ä½¿ç”¨å¯¹è±¡å­˜å‚¨äº‹ä»¶ï¼Œkey ä¸ºäº‹ä»¶åï¼Œvalue ä¸ºå›è°ƒå‡½æ•°æ•°ç»„
- æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¿”å› this
- once æ–¹æ³•çš„å…³é”®æ˜¯åˆ›å»ºåŒ…è£…å‡½æ•°ï¼Œæ‰§è¡Œåè‡ªåŠ¨ç§»é™¤

```javascript
class EventEmitter {
  constructor() {
    this.events = {};
  }

  // è®¢é˜…äº‹ä»¶
  on(eventName, callback) {
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    this.events[eventName].push(callback);
    return this; // æ”¯æŒé“¾å¼è°ƒç”¨
  }

  // è§¦å‘äº‹ä»¶
  emit(eventName, ...args) {
    if (!this.events[eventName]) {
      return this;
    }
    this.events[eventName].forEach(callback => {
      callback.apply(this, args);
    });
    return this;
  }

  // å–æ¶ˆè®¢é˜…
  off(eventName, callback) {
    if (!this.events[eventName]) {
      return this;
    }
    if (!callback) {
      // å¦‚æœæ²¡æœ‰æä¾›callbackï¼Œç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
      delete this.events[eventName];
    } else {
      this.events[eventName] = this.events[eventName].filter(
        cb => cb !== callback
      );
    }
    return this;
  }

  // ä¸€æ¬¡æ€§è®¢é˜…
  once(eventName, callback) {
    const onceWrapper = (...args) => {
      callback.apply(this, args);
      this.off(eventName, onceWrapper);
    };
    this.on(eventName, onceWrapper);
    return this;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const emitter = new EventEmitter();

emitter.on('login', (user) => {
  console.log(`${user} ç™»å½•äº†`);
});

emitter.once('logout', (user) => {
  console.log(`${user} ç™»å‡ºäº†`);
});

emitter.emit('login', 'å¼ ä¸‰'); // å¼ ä¸‰ ç™»å½•äº†
emitter.emit('logout', 'å¼ ä¸‰'); // å¼ ä¸‰ ç™»å‡ºäº†
emitter.emit('logout', 'æå››'); // ä¸ä¼šè¾“å‡ºï¼Œå› ä¸ºæ˜¯once
```

### 5. äº‹ä»¶æ€§èƒ½ä¼˜åŒ–
#### çƒ­åº¦ï¼šâ­â­â­â­

#### é¢˜ç›®1ï¼šå¦‚ä½•ä¼˜åŒ–å¤§é‡äº‹ä»¶ç›‘å¬å™¨çš„æ€§èƒ½ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
å½“é¡µé¢ä¸Šæœ‰å¾ˆå¤šå…ƒç´ éœ€è¦ç»‘å®šäº‹ä»¶æ—¶ï¼Œå¦‚æœæ¯ä¸ªéƒ½å•ç‹¬ç»‘å®šä¼šå¾ˆæ¶ˆè€—å†…å­˜å’Œæ€§èƒ½ã€‚å°±åƒç®¡ç†ä¸€ä¸ªå¤§å…¬å¸ï¼Œä¸èƒ½è€æ¿ç›´æ¥ç®¡æ¯ä¸ªå‘˜å·¥ï¼Œè€Œæ˜¯è¦åˆ†å±‚ç®¡ç†ã€‚ä¼˜åŒ–æ–¹æ³•åŒ…æ‹¬ï¼šäº‹ä»¶å§”æ‰˜ï¼ˆè®©çˆ¶å…ƒç´ ä»£ç†ï¼‰ã€é˜²æŠ–èŠ‚æµï¼ˆæ§åˆ¶è§¦å‘é¢‘ç‡ï¼‰ã€åŠæ—¶æ¸…ç†ä¸ç”¨çš„äº‹ä»¶ç­‰ã€‚

**ç­”æ¡ˆï¼š**

**å£è¿°è¦ç‚¹ï¼š**

ä¼˜åŒ–å¤§é‡äº‹ä»¶ç›‘å¬å™¨æœ‰äº”ç§ä¸»è¦æ–¹æ³•ï¼š

1. **äº‹ä»¶å§”æ‰˜** - å°†äº‹ä»¶ç›‘å¬å™¨ç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šï¼Œé€šè¿‡ `event.target` åˆ¤æ–­å®é™…ç‚¹å‡»çš„å­å…ƒç´ ï¼Œè€Œä¸æ˜¯ç»™æ¯ä¸ªå­å…ƒç´ éƒ½ç»‘å®šç›‘å¬å™¨ï¼Œå¯ä»¥å¤§å¹…å‡å°‘ç›‘å¬å™¨æ•°é‡

2. **é˜²æŠ–ï¼ˆdebounceï¼‰** - åœ¨äº‹ä»¶è¢«è§¦å‘ n ç§’åå†æ‰§è¡Œå›è°ƒï¼Œå¦‚æœ n ç§’å†…åˆè¢«è§¦å‘åˆ™é‡æ–°è®¡æ—¶ã€‚é€‚ç”¨äºæœç´¢æ¡†è¾“å…¥ã€çª—å£ resize ç­‰åœºæ™¯

3. **èŠ‚æµï¼ˆthrottleï¼‰** - è§„å®šæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚é€šè¿‡è®°å½•ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ï¼Œåªæœ‰è¶…è¿‡æŒ‡å®šé—´éš”æ‰æ‰§è¡Œã€‚é€‚ç”¨äºæ»šåŠ¨ã€é¼ æ ‡ç§»åŠ¨ç­‰é«˜é¢‘äº‹ä»¶

4. **ä½¿ç”¨ passive é€‰é¡¹** - åœ¨ addEventListener çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­è®¾ç½® `{ passive: true }`ï¼Œå‘Šè¯‰æµè§ˆå™¨ä¸ä¼šè°ƒç”¨ preventDefaultï¼Œå¯ä»¥ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½

5. **åŠæ—¶ç§»é™¤ç›‘å¬å™¨** - åœ¨ç»„ä»¶é”€æ¯æˆ–ä¸éœ€è¦æ—¶ä½¿ç”¨ removeEventListener ç§»é™¤ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚æ³¨æ„éœ€è¦ä¿å­˜å‡½æ•°å¼•ç”¨æ‰èƒ½æ­£ç¡®ç§»é™¤

**é¢å¤–ä¼˜åŒ–é€‰é¡¹ï¼š**
- `once: true` - ç›‘å¬å™¨åªæ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤
- `capture: false` - æ§åˆ¶åœ¨æ•è·è¿˜æ˜¯å†’æ³¡é˜¶æ®µè§¦å‘

```javascript
// 1. ä½¿ç”¨äº‹ä»¶å§”æ‰˜
// ä¸å¥½çš„åšæ³•
for (let i = 0; i < 1000; i++) {
  document.getElementById(`item-${i}`).addEventListener('click', handleClick);
}

// å¥½çš„åšæ³•
document.getElementById('container').addEventListener('click', (e) => {
  if (e.target.classList.contains('item')) {
    handleClick(e);
  }
});

// 2. ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµ
// é˜²æŠ–
function debounce(fn, delay) {
  let timer = null;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => {
      fn.apply(this, args);
    }, delay);
  };
}

// èŠ‚æµ
function throttle(fn, delay) {
  let lastTime = 0;
  return function(...args) {
    const now = Date.now();
    if (now - lastTime >= delay) {
      fn.apply(this, args);
      lastTime = now;
    }
  };
}

// 3. ä½¿ç”¨passiveé€‰é¡¹ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½
document.addEventListener('scroll', handleScroll, { passive: true });

// 4. åŠæ—¶ç§»é™¤ä¸éœ€è¦çš„äº‹ä»¶ç›‘å¬å™¨
class Component {
  constructor() {
    this.handleClick = this.handleClick.bind(this);
  }

  mount() {
    document.addEventListener('click', this.handleClick);
  }

  unmount() {
    document.removeEventListener('click', this.handleClick);
  }

  handleClick(e) {
    // å¤„ç†ç‚¹å‡»
  }
}

// 5. ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨é€‰é¡¹
element.addEventListener('click', handler, {
  once: true,    // åªè§¦å‘ä¸€æ¬¡
  passive: true, // ä¸ä¼šè°ƒç”¨preventDefault
  capture: false // å†’æ³¡é˜¶æ®µè§¦å‘
});
```

## äºŒã€Vueäº‹ä»¶æœºåˆ¶ â­â­â­â­â­

### 1. Vueäº‹ä»¶åŸºç¡€
#### çƒ­åº¦ï¼šâ­â­â­â­â­

#### é¢˜ç›®1ï¼šVueä¸­çš„äº‹ä»¶ç»‘å®šæ–¹å¼æœ‰å“ªäº›ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Vueæä¾›äº†å¤šç§ç»‘å®šäº‹ä»¶çš„æ–¹å¼ï¼Œæœ€å¸¸ç”¨çš„æ˜¯@clickè¿™ç§è¯­æ³•ç³–ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿é‡Œå†™ç®€å•çš„è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨methodsé‡Œçš„æ–¹æ³•ï¼Œè¿˜å¯ä»¥ä¼ å‚æ•°ã€‚Vueè®©äº‹ä»¶ç»‘å®šå˜å¾—éå¸¸ç›´è§‚å’Œçµæ´»ï¼Œæ¯”åŸç”ŸJavaScriptç®€æ´å¾ˆå¤šã€‚

**ç­”æ¡ˆï¼š**

Vue ä¸­æœ‰äº”ç§ä¸»è¦çš„äº‹ä»¶ç»‘å®šæ–¹å¼ï¼š

ç¬¬ä¸€ç§æ˜¯**å†…è”äº‹ä»¶å¤„ç†å™¨**ï¼Œå¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­å†™ç®€å•çš„ JavaScript è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ `@click="count++"` ç›´æ¥æ”¹å˜æ•°æ®ã€‚

ç¬¬äºŒç§æ˜¯**æ–¹æ³•äº‹ä»¶å¤„ç†å™¨**ï¼Œä½¿ç”¨ `@click="increment"` è¿™ç§æ–¹å¼è°ƒç”¨ methods ä¸­å®šä¹‰çš„æ–¹æ³•ï¼ŒVue ä¼šè‡ªåŠ¨å°†åŸç”Ÿäº‹ä»¶å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ã€‚

ç¬¬ä¸‰ç§æ˜¯**å¸¦å‚æ•°çš„æ–¹æ³•è°ƒç”¨**ï¼Œåƒ `@click="say('hello')"` è¿™æ ·å¯ä»¥åœ¨è°ƒç”¨æ–¹æ³•æ—¶ä¼ å…¥è‡ªå®šä¹‰å‚æ•°ã€‚

ç¬¬å››ç§æ˜¯**è®¿é—®åŸç”Ÿ DOM äº‹ä»¶**ï¼Œå½“éœ€è¦åŒæ—¶ä¼ é€’è‡ªå®šä¹‰å‚æ•°å’ŒåŸç”Ÿäº‹ä»¶å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `$event` å˜é‡ï¼Œæ¯”å¦‚ `@click="warn('è­¦å‘Š', $event)"`ï¼Œè¿™æ ·åœ¨æ–¹æ³•ä¸­å°±èƒ½åŒæ—¶æ¥æ”¶åˆ°è‡ªå®šä¹‰å‚æ•°å’Œäº‹ä»¶å¯¹è±¡ã€‚

ç¬¬äº”ç§æ˜¯**å¤šä¸ªæ–¹æ³•å¤„ç†å™¨**ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­ç”¨é€—å·åˆ†éš”è°ƒç”¨å¤šä¸ªæ–¹æ³•ï¼Œåƒ `@click="one($event), two($event)"` è¿™æ ·ä¾æ¬¡æ‰§è¡Œå¤šä¸ªå¤„ç†å‡½æ•°ã€‚

å¦å¤–ï¼Œ`@click` æ˜¯ `v-on:click` çš„ç¼©å†™å½¢å¼ï¼Œä¸¤è€…å®Œå…¨ç­‰ä»·ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­æ›´æ¨èä½¿ç”¨ `@` è¿™ç§ç®€å†™æ–¹å¼ã€‚

**å®˜æ–¹æ–‡æ¡£ï¼š**
- Vue 3: https://cn.vuejs.org/guide/essentials/event-handling.html
- Vue 2: https://v2.cn.vuejs.org/v2/guide/events.html

```vue
<template>
  <!-- 1. å†…è”äº‹ä»¶å¤„ç†å™¨ -->
  <button @click="count++">å¢åŠ </button>

  <!-- 2. æ–¹æ³•äº‹ä»¶å¤„ç†å™¨ -->
  <button @click="increment">å¢åŠ </button>

  <!-- 3. å¸¦å‚æ•°çš„æ–¹æ³•è°ƒç”¨ -->
  <button @click="say('hello')">æ‰“æ‹›å‘¼</button>

  <!-- 4. è®¿é—®åŸç”ŸDOMäº‹ä»¶ -->
  <button @click="warn('è­¦å‘Š', $event)">è­¦å‘Š</button>

  <!-- 5. å¤šä¸ªæ–¹æ³•å¤„ç†å™¨ -->
  <button @click="one($event), two($event)">å¤šä¸ªå¤„ç†å™¨</button>
</template>

<script>
export default {
  data() {
    return {
      count: 0
    };
  },
  methods: {
    increment() {
      this.count++;
    },
    say(message) {
      alert(message);
    },
    warn(message, event) {
      if (event) {
        event.preventDefault();
      }
      alert(message);
    },
    one(event) {
      console.log('ç¬¬ä¸€ä¸ªå¤„ç†å™¨');
    },
    two(event) {
      console.log('ç¬¬äºŒä¸ªå¤„ç†å™¨');
    }
  }
};
</script>
```

#### é¢˜ç›®2ï¼šVueäº‹ä»¶ä¿®é¥°ç¬¦æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Vueçš„äº‹ä»¶ä¿®é¥°ç¬¦æ˜¯å®ƒçš„ä¸€å¤§ç‰¹è‰²ï¼Œè®©äº‹ä»¶å¤„ç†å˜å¾—è¶…çº§ç®€å•ã€‚æ¯”å¦‚æƒ³é˜»æ­¢å†’æ³¡ï¼Œåªéœ€è¦åŠ ä¸ª.stopï¼›æƒ³é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ŒåŠ ä¸ª.preventã€‚è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥ä¸²è”ä½¿ç”¨ï¼Œè®©ä»£ç å˜å¾—éå¸¸ç®€æ´æ˜“è¯»ï¼Œä¸ç”¨åœ¨æ–¹æ³•é‡Œå†™ä¸€å †preventDefault()è¿™æ ·çš„ä»£ç ã€‚

**ç­”æ¡ˆï¼š**

Vueäº‹ä»¶ä¿®é¥°ç¬¦åˆ†ä¸ºå››ç±»ï¼šäº‹ä»¶ä¿®é¥°ç¬¦ï¼ˆ.stop é˜»æ­¢å†’æ³¡ã€.prevent é˜»æ­¢é»˜è®¤è¡Œä¸ºã€.capture æ•è·é˜¶æ®µè§¦å‘ã€.self åªåœ¨è‡ªèº«è§¦å‘ã€.once åªè§¦å‘ä¸€æ¬¡ã€.passive ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ï¼‰ï¼›æŒ‰é”®ä¿®é¥°ç¬¦ï¼ˆ.enterã€.tabã€.deleteã€.escã€.spaceã€.upã€.downã€.leftã€.rightï¼‰ï¼›ç³»ç»Ÿä¿®é¥°é”®ï¼ˆ.ctrlã€.altã€.shiftã€.metaï¼‰ï¼›é¼ æ ‡æŒ‰é’®ä¿®é¥°ç¬¦ï¼ˆ.leftã€.rightã€.middleï¼‰ã€‚è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥ä¸²è”ä½¿ç”¨ï¼Œæ¯”å¦‚ `@click.stop.prevent` åŒæ—¶é˜»æ­¢å†’æ³¡å’Œé»˜è®¤è¡Œä¸ºï¼Œå¤§å¤§ç®€åŒ–äº†äº‹ä»¶å¤„ç†ä»£ç ã€‚

**å®˜æ–¹æ–‡æ¡£ï¼š**
- Vue 3: https://cn.vuejs.org/guide/essentials/event-handling.html#event-modifiers
- Vue 2: https://v2.cn.vuejs.org/v2/guide/events.html#äº‹ä»¶ä¿®é¥°ç¬¦
```vue
<template>
  <!-- é˜»æ­¢äº‹ä»¶å†’æ³¡ -->
  <div @click.stop="handleClick">é˜»æ­¢å†’æ³¡</div>

  <!-- é˜»æ­¢é»˜è®¤è¡Œä¸º -->
  <form @submit.prevent="handleSubmit">æäº¤</form>

  <!-- äº‹ä»¶æ•è·æ¨¡å¼ -->
  <div @click.capture="handleClick">æ•è·é˜¶æ®µè§¦å‘</div>

  <!-- åªè§¦å‘è‡ªèº«ï¼Œä¸åŒ…æ‹¬å­å…ƒç´  -->
  <div @click.self="handleClick">åªæœ‰ç‚¹å‡»è‡ªèº«æ‰è§¦å‘</div>

  <!-- åªè§¦å‘ä¸€æ¬¡ -->
  <button @click.once="handleClick">åªè§¦å‘ä¸€æ¬¡</button>

  <!-- æ»šåŠ¨äº‹ä»¶çš„passiveæ¨¡å¼ -->
  <div @scroll.passive="handleScroll">ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½</div>

  <!-- ä¿®é¥°ç¬¦å¯ä»¥ä¸²è” -->
  <a @click.stop.prevent="handleClick">é˜»æ­¢å†’æ³¡å’Œé»˜è®¤è¡Œä¸º</a>

  <!-- æŒ‰é”®ä¿®é¥°ç¬¦ -->
  <input @keyup.enter="submit">
  <input @keyup.tab="next">
  <input @keyup.delete="remove">
  <input @keyup.esc="cancel">
  <input @keyup.space="space">
  <input @keyup.up="up">
  <input @keyup.down="down">
  <input @keyup.left="left">
  <input @keyup.right="right">

  <!-- ç³»ç»Ÿä¿®é¥°é”® -->
  <input @keyup.ctrl="handleCtrl">
  <input @keyup.alt="handleAlt">
  <input @keyup.shift="handleShift">
  <input @keyup.meta="handleMeta">

  <!-- ç²¾ç¡®ä¿®é¥°ç¬¦ -->
  <button @click.ctrl.exact="handleCtrlClick">åªæœ‰Ctrl</button>

  <!-- é¼ æ ‡æŒ‰é’®ä¿®é¥°ç¬¦ -->
  <button @click.left="handleLeftClick">å·¦é”®</button>
  <button @click.right="handleRightClick">å³é”®</button>
  <button @click.middle="handleMiddleClick">ä¸­é”®</button>
</template>
```

#### é¢˜ç›®3ï¼šVueä¸­çš„.syncä¿®é¥°ç¬¦æ˜¯ä»€ä¹ˆï¼ŸVue3ä¸­å¦‚ä½•æ›¿ä»£ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
.syncä¿®é¥°ç¬¦æ˜¯Vue2ä¸­çš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œç”¨äºå®ç°çˆ¶å­ç»„ä»¶é—´çš„åŒå‘æ•°æ®ç»‘å®šã€‚å°±åƒæ˜¯çˆ¶å­ä¹‹é—´çš„"å¯¹è®²æœº"ï¼Œå­ç»„ä»¶å¯ä»¥ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®ã€‚Vue3ä¸­ç§»é™¤äº†.syncï¼Œæ”¹ç”¨æ›´å¼ºå¤§çš„v-modelæ¥å®ç°ï¼Œè€Œä¸”å¯ä»¥æœ‰å¤šä¸ªv-modelï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- Vue 3 v-model: https://cn.vuejs.org/guide/components/v-model.html
- Vue 2 .sync: https://v2.cn.vuejs.org/v2/guide/components-custom-events.html#sync-ä¿®é¥°ç¬¦
```vue
<!-- Vue 2.x ä¸­çš„.syncä¿®é¥°ç¬¦ -->
<template>
  <!-- çˆ¶ç»„ä»¶ -->
  <ChildComponent :title.sync="pageTitle" />

  <!-- ç­‰ä»·äº -->
  <ChildComponent
    :title="pageTitle"
    @update:title="pageTitle = $event"
  />
</template>

<script>
// å­ç»„ä»¶
export default {
  props: ['title'],
  methods: {
    updateTitle() {
      this.$emit('update:title', 'æ–°æ ‡é¢˜');
    }
  }
};
</script>

<!-- Vue 3.x ä¸­ä½¿ç”¨v-modelæ›¿ä»£ -->
<template>
  <!-- çˆ¶ç»„ä»¶ -->
  <ChildComponent v-model:title="pageTitle" />

  <!-- å¤šä¸ªv-model -->
  <ChildComponent
    v-model:title="pageTitle"
    v-model:content="pageContent"
  />
</template>

<script>
// Vue 3 å­ç»„ä»¶
export default {
  props: ['title', 'content'],
  emits: ['update:title', 'update:content'],
  methods: {
    updateTitle() {
      this.$emit('update:title', 'æ–°æ ‡é¢˜');
    },
    updateContent() {
      this.$emit('update:content', 'æ–°å†…å®¹');
    }
  }
};
</script>
```

### 2. Vueç»„ä»¶é€šä¿¡

#### é¢˜ç›®1ï¼šVueç»„ä»¶é—´é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Vueç»„ä»¶é—´é€šä¿¡å°±åƒæ˜¯ä¸åŒæˆ¿é—´çš„äººè¦è¯´è¯ï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼šçˆ¶å­ç»„ä»¶ç”¨propså’Œemitï¼ˆåƒçˆ¶æ¯å’Œå­©å­å¯¹è¯ï¼‰ï¼›è·¨çº§ç»„ä»¶ç”¨provide/injectï¼ˆåƒç¥–çˆ¶æ¯ç›´æ¥å’Œå­™å­å¯¹è¯ï¼‰ï¼›ä»»æ„ç»„ä»¶ç”¨EventBusï¼ˆåƒå¹¿æ’­ï¼‰ï¼›å…¨å±€çŠ¶æ€ç”¨Vuex/Piniaï¼ˆåƒå…¬å…±å‘Šç¤ºæ¿ï¼‰ã€‚æ¯ç§æ–¹å¼é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- Props/Emit: https://cn.vuejs.org/guide/components/props.html
- Provide/Inject: https://cn.vuejs.org/guide/components/provide-inject.html
- Pinia: https://pinia.vuejs.org/zh/
- Vuex: https://vuex.vuejs.org/zh/
```javascript
// 1. Propså’Œ$emitï¼ˆçˆ¶å­ç»„ä»¶ï¼‰
// çˆ¶ç»„ä»¶
<ChildComponent :message="parentMsg" @update="handleUpdate" />

// å­ç»„ä»¶
props: ['message'],
methods: {
  sendToParent() {
    this.$emit('update', 'child data');
  }
}

// 2. provide/injectï¼ˆè·¨çº§ç»„ä»¶ï¼‰
// ç¥–å…ˆç»„ä»¶
provide() {
  return {
    theme: this.theme,
    // æä¾›å“åº”å¼æ•°æ®
    user: computed(() => this.user)
  };
}

// åä»£ç»„ä»¶
inject: ['theme', 'user']

// 3. EventBusï¼ˆä»»æ„ç»„ä»¶ï¼‰
// Vue2 - ä½¿ç”¨Vueå®ä¾‹ä½œä¸ºäº‹ä»¶æ€»çº¿
import Vue from 'vue';
export const EventBus = new Vue();

// å‘é€äº‹ä»¶
EventBus.$emit('user-login', userData);

// ç›‘å¬äº‹ä»¶
EventBus.$on('user-login', (data) => {
  console.log('ç”¨æˆ·ç™»å½•:', data);
});

// ç§»é™¤ç›‘å¬ï¼ˆç»„ä»¶é”€æ¯æ—¶è®°å¾—ç§»é™¤ï¼‰
EventBus.$off('user-login');

// Vue3 - éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå·±å®ç°
import mitt from 'mitt';
export const EventBus = mitt();

// 4. Vuex/Piniaï¼ˆå…¨å±€çŠ¶æ€ç®¡ç†ï¼‰
// Vuex
this.$store.dispatch('updateUser', userData);
this.$store.commit('SET_USER', userData);

// Pinia
import { useUserStore } from '@/stores/user';
const userStore = useUserStore();
userStore.updateUser(userData);

// 5. $attrså’Œ$listenersï¼ˆå±æ€§å’Œäº‹ä»¶é€ä¼ ï¼‰- Vue2
// ä¸­é—´ç»„ä»¶
<GrandChild v-bind="$attrs" v-on="$listeners" />

// Vue3ä¸­ä½¿ç”¨$attrsï¼ˆåŒ…å«äº†äº‹ä»¶ï¼‰
<GrandChild v-bind="$attrs" />

// 6. $parent/$childrenï¼ˆç›´æ¥è®¿é—®ï¼‰- ä¸æ¨è
this.$parent.parentMethod();
this.$children[0].childMethod();

// 7. refï¼ˆè·å–ç»„ä»¶å®ä¾‹ï¼‰
<ChildComponent ref="child" />
this.$refs.child.childMethod();

// 8. Vue3 Composition API
// ä½¿ç”¨composableså…±äº«é€»è¾‘
// useUser.js
import { ref, computed } from 'vue';

export function useUser() {
  const user = ref(null);
  const isLoggedIn = computed(() => !!user.value);

  function login(userData) {
    user.value = userData;
  }

  function logout() {
    user.value = null;
  }

  return {
    user,
    isLoggedIn,
    login,
    logout
  };
}
```

#### é¢˜ç›®2ï¼šVue2å’ŒVue3çš„äº‹ä»¶æ€»çº¿å®ç°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Vue2ä¸­å¯ä»¥ç›´æ¥ç”¨Vueå®ä¾‹ä½œä¸ºäº‹ä»¶æ€»çº¿ï¼Œå› ä¸ºVueå®ä¾‹è‡ªå¸¦$onã€$emitç­‰æ–¹æ³•ï¼Œå°±åƒå†…ç½®äº†ä¸€ä¸ª"å¹¿æ’­ç”µå°"ã€‚ä½†Vue3æŠŠè¿™äº›æ–¹æ³•ç§»é™¤äº†ï¼Œéœ€è¦è‡ªå·±å®ç°æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚mittï¼‰ã€‚è¿™æ˜¯Vue3ä¸ºäº†å‡å°ä½“ç§¯å’Œå¤æ‚åº¦åšçš„æ”¹å˜ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- Vue 2 å®ä¾‹æ–¹æ³•: https://v2.cn.vuejs.org/v2/api/#å®ä¾‹æ–¹æ³•-äº‹ä»¶
- Vue 3 è¿ç§»æŒ‡å—: https://v3-migration.vuejs.org/zh/breaking-changes/events-api.html
- mittåº“: https://github.com/developit/mitt

**Vue2å†…ç½®äº‹ä»¶æ€»çº¿ï¼š**
Vue2ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨Vueå®ä¾‹ä½œä¸ºäº‹ä»¶æ€»çº¿ï¼Œå› ä¸ºVue2å®ä¾‹æä¾›äº†`$on`ã€`$emit`ã€`$off`ã€`$once`ç­‰æ–¹æ³•ã€‚

```javascript
// Vue2 - æ–¹æ³•1ï¼šä½¿ç”¨ç©ºçš„Vueå®ä¾‹ä½œä¸ºäº‹ä»¶æ€»çº¿
import Vue from 'vue';
export const EventBus = new Vue();

// å‘é€äº‹ä»¶
EventBus.$emit('user-login', userData);

// ç›‘å¬äº‹ä»¶
EventBus.$on('user-login', (data) => {
  console.log('ç”¨æˆ·ç™»å½•:', data);
});

// ç§»é™¤ç›‘å¬
EventBus.$off('user-login');

// ä¸€æ¬¡æ€§ç›‘å¬
EventBus.$once('user-logout', (data) => {
  console.log('ç”¨æˆ·ç™»å‡º:', data);
});

// Vue2 - æ–¹æ³•2ï¼šæŒ‚è½½åˆ°VueåŸå‹ä¸Šï¼ˆå…¨å±€äº‹ä»¶æ€»çº¿ï¼‰
// main.js
Vue.prototype.$bus = new Vue();

// ç»„ä»¶ä¸­ä½¿ç”¨
this.$bus.$emit('event-name', data);
this.$bus.$on('event-name', callback);

// åœ¨ç»„ä»¶é”€æ¯æ—¶ç§»é™¤ç›‘å¬
beforeDestroy() {
  this.$bus.$off('event-name');
}
```

**Vue3ç§»é™¤äº†äº‹ä»¶APIï¼š**
Vue3ä¸­ç§»é™¤äº†`$on`ã€`$off`ã€`$once`ç­‰å®ä¾‹æ–¹æ³•ï¼Œå› æ­¤éœ€è¦è‡ªå·±å®ç°æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ã€‚

```javascript
// Vue3ä¸­æ²¡æœ‰å†…ç½®çš„äº‹ä»¶æ€»çº¿ï¼Œéœ€è¦è‡ªå·±å®ç°æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“

// æ–¹æ³•1ï¼šä½¿ç”¨mittåº“
import mitt from 'mitt';

const emitter = mitt();

// åœ¨main.jsä¸­å…¨å±€æ³¨å†Œ
app.config.globalProperties.$emitter = emitter;

// æˆ–è€…é€šè¿‡provide/inject
app.provide('emitter', emitter);

// ä½¿ç”¨
// å‘é€äº‹ä»¶
emitter.emit('custom-event', data);

// ç›‘å¬äº‹ä»¶
emitter.on('custom-event', (data) => {
  console.log(data);
});

// ç§»é™¤ç›‘å¬
emitter.off('custom-event');

// æ–¹æ³•2ï¼šè‡ªå®šä¹‰äº‹ä»¶æ€»çº¿
class EventBus {
  constructor() {
    this.events = {};
  }

  on(event, callback) {
    if (!this.events[event]) {
      this.events[event] = [];
    }
    this.events[event].push(callback);
  }

  emit(event, ...args) {
    if (this.events[event]) {
      this.events[event].forEach(callback => {
        callback(...args);
      });
    }
  }

  off(event, callback) {
    if (this.events[event]) {
      this.events[event] = this.events[event].filter(cb => cb !== callback);
    }
  }
}

// åˆ›å»ºå•ä¾‹
export default new EventBus();

// æ–¹æ³•3ï¼šä½¿ç”¨Composition APIå®ç°
import { ref, readonly } from 'vue';

function useEventBus() {
  const events = ref(new Map());

  function on(event, callback) {
    if (!events.value.has(event)) {
      events.value.set(event, []);
    }
    events.value.get(event).push(callback);
  }

  function emit(event, ...args) {
    if (events.value.has(event)) {
      events.value.get(event).forEach(callback => {
        callback(...args);
      });
    }
  }

  function off(event, callback) {
    if (events.value.has(event)) {
      const callbacks = events.value.get(event);
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    }
  }

  return {
    on,
    emit,
    off,
    events: readonly(events)
  };
}

export default useEventBus();
```

### 3. Vueè‡ªå®šä¹‰æŒ‡ä»¤ä¸­çš„äº‹ä»¶

#### é¢è¯•å›ç­”æ€è·¯ï¼š

å½“é¢è¯•å®˜é—®åˆ°Vueè‡ªå®šä¹‰æŒ‡ä»¤æ—¶ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹ç»“æ„å›ç­”ï¼š

**ç¬¬ä¸€æ­¥ï¼šæ¦‚å¿µç†è§£ï¼ˆè¯´æ˜ä½ æ‡‚æ˜¯ä»€ä¹ˆï¼‰**
- è‡ªå®šä¹‰æŒ‡ä»¤æ˜¯Vueæä¾›çš„ä¸€ç§å°è£…DOMæ“ä½œçš„æœºåˆ¶
- ç”¨äºç›´æ¥æ“ä½œDOMå…ƒç´ ï¼Œå®ç°å¯å¤ç”¨çš„DOMè¡Œä¸º
- æœ¬è´¨æ˜¯åœ¨å…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­æ‰§è¡Œç‰¹å®šé€»è¾‘

**ç¬¬äºŒæ­¥ï¼šä½¿ç”¨åœºæ™¯ï¼ˆè¯´æ˜ä½ çŸ¥é“ä½•æ—¶ç”¨ï¼‰**
- éœ€è¦ç›´æ¥æ“ä½œDOMæ—¶ï¼ˆå¦‚èšç„¦ã€æ‹–æ‹½ã€æ‡’åŠ è½½ï¼‰
- å°è£…é€šç”¨çš„DOMè¡Œä¸ºï¼ˆå¦‚æƒé™æ§åˆ¶ã€åŸ‹ç‚¹ç»Ÿè®¡ï¼‰
- ç¬¬ä¸‰æ–¹åº“é›†æˆï¼ˆå¦‚å›¾è¡¨åˆå§‹åŒ–ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰
- æ€§èƒ½ä¼˜åŒ–åœºæ™¯ï¼ˆå¦‚å›¾ç‰‡æ‡’åŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨ï¼‰

**ç¬¬ä¸‰æ­¥ï¼šç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆè¯´æ˜ä½ æŒæ¡æ ¸å¿ƒAPIï¼‰**
Vue2å’ŒVue3çš„é’©å­ä¸åŒï¼Œéœ€è¦åŒºåˆ†ï¼š

| Vue2 | Vue3 | è¯´æ˜ |
|------|------|------|
| bind | beforeMount | æŒ‡ä»¤ç»‘å®šåˆ°å…ƒç´ æ—¶ |
| inserted | mounted | å…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶ |
| update | beforeUpdate | ç»„ä»¶æ›´æ–°å‰ |
| componentUpdated | updated | ç»„ä»¶æ›´æ–°å |
| unbind | beforeUnmount/unmounted | æŒ‡ä»¤è§£ç»‘æ—¶ |

**ç¬¬å››æ­¥ï¼šå®é™…æ¡ˆä¾‹ï¼ˆè¯´æ˜ä½ ä¼šç”¨ï¼‰**
å‡†å¤‡2-3ä¸ªå¸¸è§æ¡ˆä¾‹ï¼Œèƒ½å¤Ÿç°åœºæ‰‹å†™ä»£ç ã€‚

---

#### é¢˜ç›®1ï¼šå¦‚ä½•åœ¨è‡ªå®šä¹‰æŒ‡ä»¤ä¸­å¤„ç†äº‹ä»¶ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
è‡ªå®šä¹‰æŒ‡ä»¤å°±åƒæ˜¯ç»™HTMLå…ƒç´ æ·»åŠ "è¶…èƒ½åŠ›"çš„å·¥å…·ã€‚åœ¨æŒ‡ä»¤ä¸­å¤„ç†äº‹ä»¶å¾ˆå¸¸è§ï¼Œæ¯”å¦‚å®ç°"ç‚¹å‡»å¤–éƒ¨å…³é—­"ã€"é•¿æŒ‰è§¦å‘"ç­‰åŠŸèƒ½ã€‚å…³é”®æ˜¯åœ¨æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ç»‘å®šå’Œè§£ç»‘äº‹ä»¶ï¼Œç¡®ä¿ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚

**é¢è¯•æ ‡å‡†å›ç­”ï¼š**

æˆ‘ä¼šä»ä¸‰ä¸ªæ–¹é¢æ¥è¯´æ˜å¦‚ä½•åœ¨è‡ªå®šä¹‰æŒ‡ä»¤ä¸­å¤„ç†äº‹ä»¶ï¼š

**1. äº‹ä»¶ç»‘å®šæ—¶æœº**
- åœ¨ `mounted`/`inserted` é’©å­ä¸­ç»‘å®šäº‹ä»¶
- åœ¨ `unmounted`/`unbind` é’©å­ä¸­è§£ç»‘äº‹ä»¶
- ç¡®ä¿äº‹ä»¶å¼•ç”¨å¯ä»¥è¢«æ­£ç¡®ç§»é™¤ï¼ˆå­˜å‚¨åœ¨å…ƒç´ ä¸Šï¼‰

**2. äº‹ä»¶å¤„ç†æ³¨æ„äº‹é¡¹**
- å°†äº‹ä»¶å¤„ç†å‡½æ•°å­˜å‚¨åœ¨å…ƒç´ è‡ªèº«ï¼ˆ`el._clickHandler`ï¼‰
- ä½¿ç”¨é—­åŒ…ä¿å­˜æŒ‡ä»¤å‚æ•°å’Œä¿®é¥°ç¬¦
- é¿å…é‡å¤ç»‘å®šï¼ˆåœ¨updateæ—¶åˆ¤æ–­ï¼‰
- åŠæ—¶æ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

**3. å®é™…ä»£ç å®ç°**

**å®˜æ–¹æ–‡æ¡£ï¼š**
- Vue 3: https://cn.vuejs.org/guide/reusability/custom-directives.html
- Vue 2: https://v2.cn.vuejs.org/v2/guide/custom-directive.html

```javascript
// ========== Vue2 è‡ªå®šä¹‰æŒ‡ä»¤ ==========
Vue.directive('click-outside', {
  bind(el, binding, vnode) {
    el.clickOutsideEvent = function(event) {
      // æ£€æŸ¥ç‚¹å‡»æ˜¯å¦åœ¨å…ƒç´ å¤–éƒ¨
      if (!(el === event.target || el.contains(event.target))) {
        binding.value(event);
      }
    };
    document.body.addEventListener('click', el.clickOutsideEvent);
  },
  unbind(el) {
    document.body.removeEventListener('click', el.clickOutsideEvent);
  }
});

// ========== Vue3 è‡ªå®šä¹‰æŒ‡ä»¤ ==========
app.directive('click-outside', {
  mounted(el, binding) {
    el.clickOutsideEvent = function(event) {
      if (!(el === event.target || el.contains(event.target))) {
        binding.value(event);
      }
    };
    document.addEventListener('click', el.clickOutsideEvent);
  },
  unmounted(el) {
    document.removeEventListener('click', el.clickOutsideEvent);
  }
});

// ä½¿ç”¨ç¤ºä¾‹
<template>
  <div v-click-outside="handleClose">
    å¼¹çª—å†…å®¹
  </div>
</template>

<script>
export default {
  methods: {
    handleClose() {
      console.log('ç‚¹å‡»äº†å¤–éƒ¨åŒºåŸŸ');
    }
  }
}
</script>
```

---

#### é¢˜ç›®2ï¼šå¸¸è§è‡ªå®šä¹‰æŒ‡ä»¤æ¡ˆä¾‹å®ç°ï¼ˆå¿…èƒŒï¼‰

**é¢è¯•æ—¶å»ºè®®å‡†å¤‡ä»¥ä¸‹å‡ ä¸ªç»å…¸æ¡ˆä¾‹ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰‹å†™ï¼š**

**æ¡ˆä¾‹1ï¼šv-focus è‡ªåŠ¨èšç„¦æŒ‡ä»¤**
```javascript
// Vue3 ç‰ˆæœ¬
app.directive('focus', {
  mounted(el) {
    el.focus();
  }
});

// ä½¿ç”¨
<input v-focus />
```

**æ¡ˆä¾‹2ï¼šv-debounce é˜²æŠ–æŒ‡ä»¤**
```javascript
// Vue3 ç‰ˆæœ¬
app.directive('debounce', {
  mounted(el, binding) {
    const { value, arg } = binding;
    const delay = parseInt(arg) || 300;
    let timer = null;

    el._debounceHandler = function(...args) {
      if (timer) clearTimeout(timer);
      timer = setTimeout(() => {
        value.apply(this, args);
      }, delay);
    };

    el.addEventListener('click', el._debounceHandler);
  },
  unmounted(el) {
    el.removeEventListener('click', el._debounceHandler);
  }
});

// ä½¿ç”¨ï¼š300ms é˜²æŠ–
<button v-debounce:300="handleClick">æäº¤</button>
```

**æ¡ˆä¾‹3ï¼šv-lazy å›¾ç‰‡æ‡’åŠ è½½æŒ‡ä»¤**
```javascript
// Vue3 ç‰ˆæœ¬
app.directive('lazy', {
  mounted(el, binding) {
    // åˆ›å»º IntersectionObserver
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // å›¾ç‰‡è¿›å…¥è§†å£
          el.src = binding.value;
          observer.unobserve(el);
        }
      });
    }, {
      rootMargin: '0px 0px 200px 0px' // æå‰200pxåŠ è½½
    });

    // å¼€å§‹è§‚å¯Ÿ
    observer.observe(el);

    // ä¿å­˜observerä»¥ä¾¿æ¸…ç†
    el._lazyObserver = observer;
  },
  unmounted(el) {
    if (el._lazyObserver) {
      el._lazyObserver.disconnect();
    }
  }
});

// ä½¿ç”¨
<img v-lazy="imageUrl" />
```

**æ¡ˆä¾‹4ï¼šv-longpress é•¿æŒ‰æŒ‡ä»¤**
```javascript
// Vue3 ç‰ˆæœ¬
app.directive('longpress', {
  mounted(el, binding) {
    const { value, arg } = binding;
    const duration = parseInt(arg) || 1000;
    let timer = null;

    const startHandler = () => {
      timer = setTimeout(() => {
        value();
      }, duration);
    };

    const cancelHandler = () => {
      if (timer) {
        clearTimeout(timer);
        timer = null;
      }
    };

    el._longpressHandlers = { startHandler, cancelHandler };

    el.addEventListener('mousedown', startHandler);
    el.addEventListener('mouseup', cancelHandler);
    el.addEventListener('mouseleave', cancelHandler);
    // ç§»åŠ¨ç«¯
    el.addEventListener('touchstart', startHandler);
    el.addEventListener('touchend', cancelHandler);
    el.addEventListener('touchcancel', cancelHandler);
  },
  unmounted(el) {
    const { startHandler, cancelHandler } = el._longpressHandlers || {};
    if (startHandler && cancelHandler) {
      el.removeEventListener('mousedown', startHandler);
      el.removeEventListener('mouseup', cancelHandler);
      el.removeEventListener('mouseleave', cancelHandler);
      el.removeEventListener('touchstart', startHandler);
      el.removeEventListener('touchend', cancelHandler);
      el.removeEventListener('touchcancel', cancelHandler);
    }
  }
});

// ä½¿ç”¨ï¼šé•¿æŒ‰1500msè§¦å‘
<button v-longpress:1500="handleLongPress">é•¿æŒ‰æˆ‘</button>
```

**æ¡ˆä¾‹5ï¼šv-permission æƒé™æ§åˆ¶æŒ‡ä»¤**
```javascript
// Vue3 ç‰ˆæœ¬
app.directive('permission', {
  mounted(el, binding) {
    const { value } = binding;
    const permissions = store.getters.permissions; // å‡è®¾ä»storeè·å–æƒé™

    if (!permissions.includes(value)) {
      // æ— æƒé™ï¼šç§»é™¤å…ƒç´ 
      el.parentNode?.removeChild(el);
      // æˆ–è€…ç¦ç”¨å…ƒç´ 
      // el.disabled = true;
      // el.style.display = 'none';
    }
  }
});

// ä½¿ç”¨
<button v-permission="'admin:delete'">åˆ é™¤</button>
```

---

#### é¢˜ç›®3ï¼šè‡ªå®šä¹‰æŒ‡ä»¤çš„å‚æ•°å’Œä¿®é¥°ç¬¦å¦‚ä½•ä½¿ç”¨ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
æŒ‡ä»¤å¯ä»¥æ¥æ”¶åŠ¨æ€å‚æ•°ã€é™æ€å€¼å’Œä¿®é¥°ç¬¦ï¼Œå°±åƒ `v-on:click.prevent="handler"` ä¸€æ ·ã€‚ç†è§£å¦‚ä½•è·å–å’Œä½¿ç”¨è¿™äº›å‚æ•°ï¼Œèƒ½è®©æŒ‡ä»¤æ›´åŠ çµæ´»å¼ºå¤§ã€‚

**ç­”æ¡ˆï¼š**

**binding å¯¹è±¡åŒ…å«çš„å±æ€§ï¼š**
```javascript
app.directive('demo', {
  mounted(el, binding, vnode) {
    console.log(binding);
    // {
    //   value: æŒ‡ä»¤ç»‘å®šçš„å€¼,
    //   oldValue: ä¸Šä¸€ä¸ªå€¼ï¼ˆä»…updateå¯ç”¨ï¼‰,
    //   arg: æŒ‡ä»¤å‚æ•°,
    //   modifiers: ä¿®é¥°ç¬¦å¯¹è±¡,
    //   instance: ç»„ä»¶å®ä¾‹,
    //   dir: æŒ‡ä»¤å®šä¹‰å¯¹è±¡
    // }
  }
});
```

**å®æˆ˜æ¡ˆä¾‹ï¼šå¸¦å‚æ•°å’Œä¿®é¥°ç¬¦çš„æŒ‡ä»¤**
```javascript
// v-scroll:[direction].throttle.immediate="handler"
app.directive('scroll', {
  mounted(el, binding) {
    const { value, arg, modifiers } = binding;

    // è·å–å‚æ•°ï¼šdirection
    const direction = arg || 'vertical'; // 'horizontal' æˆ– 'vertical'

    // è·å–ä¿®é¥°ç¬¦
    const useThrottle = modifiers.throttle;
    const immediate = modifiers.immediate;

    let handler = value;

    // æ ¹æ®ä¿®é¥°ç¬¦å¤„ç†é€»è¾‘
    if (useThrottle) {
      handler = throttle(value, 300);
    }

    if (immediate) {
      handler(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
    }

    // æ ¹æ®å‚æ•°é€‰æ‹©ç›‘å¬ç›®æ ‡
    const target = direction === 'horizontal'
      ? el.querySelector('.scroll-x')
      : el.querySelector('.scroll-y');

    el._scrollHandler = handler;
    target.addEventListener('scroll', handler);
  },
  unmounted(el) {
    const target = el.querySelector('.scroll-x, .scroll-y');
    target?.removeEventListener('scroll', el._scrollHandler);
  }
});

// ä½¿ç”¨
<div v-scroll:vertical.throttle.immediate="onScroll">
  æ»šåŠ¨å®¹å™¨
</div>
```

**åŠ¨æ€æŒ‡ä»¤å€¼æ›´æ–°å¤„ç†ï¼š**
```javascript
app.directive('color', {
  mounted(el, binding) {
    el.style.color = binding.value;
  },
  updated(el, binding) {
    // åªåœ¨å€¼å˜åŒ–æ—¶æ›´æ–°
    if (binding.value !== binding.oldValue) {
      el.style.color = binding.value;
    }
  }
});

// ä½¿ç”¨
<p v-color="currentColor">æ–‡æœ¬</p>
```

---

#### é¢˜ç›®4ï¼šè‡ªå®šä¹‰æŒ‡ä»¤ä¸ç»„ä»¶çš„åŒºåˆ«å’Œé€‰æ‹©ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
æ–°æ‰‹å¸¸å›°æƒ‘ä»€ä¹ˆæ—¶å€™ç”¨æŒ‡ä»¤ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ç»„ä»¶ã€‚ç®€å•æ¥è¯´ï¼šæŒ‡ä»¤ç”¨äºDOMæ“ä½œï¼Œç»„ä»¶ç”¨äºUIå°è£…ã€‚

**ç­”æ¡ˆï¼š**

**æ ¸å¿ƒåŒºåˆ«ï¼š**

| ç‰¹æ€§ | è‡ªå®šä¹‰æŒ‡ä»¤ | ç»„ä»¶ |
|-----|----------|------|
| **ä¸»è¦ç”¨é€”** | DOM æ“ä½œ | UI é€»è¾‘å°è£… |
| **æ¨¡æ¿** | æ—  | æœ‰ |
| **æ•°æ®é©±åŠ¨** | æ‰‹åŠ¨æ“ä½œ DOM | å“åº”å¼è‡ªåŠ¨æ›´æ–° |
| **æ ·å¼** | éœ€æ‰‹åŠ¨æ·»åŠ  | å¯åŒ…å«æ ·å¼ |
| **å¤æ‚åº¦** | ç®€å•è¡Œä¸º | å¤æ‚ UI |
| **ç”Ÿå‘½å‘¨æœŸ** | æŒ‡ä»¤é’©å­ | ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ |

**é€‰æ‹©åŸåˆ™ï¼š**

```javascript
// âœ… ä½¿ç”¨æŒ‡ä»¤çš„åœºæ™¯
// 1. çº¯ DOM æ“ä½œï¼ˆèšç„¦ã€æ‹–æ‹½ã€æ»šåŠ¨ç›‘å¬ï¼‰
<input v-focus />

// 2. ä¸éœ€è¦æ¨¡æ¿çš„ç®€å•è¡Œä¸º
<div v-loading="isLoading"></div>

// 3. å…¨å±€é€šç”¨çš„ DOM å¢å¼º
<img v-lazy="src" />

// 4. ç¬¬ä¸‰æ–¹åº“é›†æˆ
<div v-chart="chartOptions"></div>


// âœ… ä½¿ç”¨ç»„ä»¶çš„åœºæ™¯
// 1. æœ‰ UI ç»“æ„å’Œäº¤äº’
<Modal v-model="visible">
  <template #header>æ ‡é¢˜</template>
  <p>å†…å®¹</p>
</Modal>

// 2. éœ€è¦ç®¡ç†å†…éƒ¨çŠ¶æ€
<Pagination :total="100" @change="handleChange" />

// 3. éœ€è¦æ’æ§½å’Œæ ·å¼
<Card>
  <template #header>å¡ç‰‡å¤´éƒ¨</template>
  å¡ç‰‡å†…å®¹
</Card>
```

**å®é™…æ¡ˆä¾‹å¯¹æ¯”ï¼š**
```javascript
// âŒ é”™è¯¯ï¼šç”¨æŒ‡ä»¤å®ç°å¤æ‚ UI
app.directive('modal', {
  mounted(el, binding) {
    // å°è¯•ç”¨æŒ‡ä»¤åˆ›å»ºå¼¹çª—... ä»£ç ä¼šå¾ˆå¤æ‚ä¸”éš¾ç»´æŠ¤
  }
});

// âœ… æ­£ç¡®ï¼šç”¨ç»„ä»¶å®ç°
const Modal = {
  template: `
    <div class="modal" v-if="visible">
      <div class="modal-content">
        <slot></slot>
      </div>
    </div>
  `,
  props: ['visible']
};

// âœ… æ­£ç¡®ï¼šç”¨æŒ‡ä»¤åšç®€å• DOM æ“ä½œ
app.directive('click-outside', {
  mounted(el, binding) {
    // ç®€æ´æ¸…æ™°
    el._handler = (e) => {
      if (!el.contains(e.target)) binding.value();
    };
    document.addEventListener('click', el._handler);
  },
  unmounted(el) {
    document.removeEventListener('click', el._handler);
  }
});
```

---

#### é¢˜ç›®5ï¼šè‡ªå®šä¹‰æŒ‡ä»¤çš„å¸¸è§å‘å’Œæœ€ä½³å®è·µï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
å†™æŒ‡ä»¤å®¹æ˜“ï¼Œå†™å¥½æŒ‡ä»¤éš¾ã€‚éœ€è¦æ³¨æ„å†…å­˜æ³„æ¼ã€æ€§èƒ½é—®é¢˜ã€äº‹ä»¶å§”æ‰˜ç­‰ç»†èŠ‚ã€‚

**ç­”æ¡ˆï¼š**

**å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š**

**1. å†…å­˜æ³„æ¼é—®é¢˜**
```javascript
// âŒ é”™è¯¯ï¼šæœªæ¸…ç†äº‹ä»¶ç›‘å¬
app.directive('bad-scroll', {
  mounted(el, binding) {
    window.addEventListener('scroll', binding.value);
    // å¿˜è®°ä¿å­˜å¼•ç”¨ï¼Œæ— æ³•åœ¨ unmounted ä¸­ç§»é™¤
  }
});

// âœ… æ­£ç¡®ï¼šä¿å­˜å¼•ç”¨å¹¶æ¸…ç†
app.directive('good-scroll', {
  mounted(el, binding) {
    el._scrollHandler = binding.value;
    window.addEventListener('scroll', el._scrollHandler);
  },
  unmounted(el) {
    window.removeEventListener('scroll', el._scrollHandler);
    delete el._scrollHandler; // æ¸…ç†å¼•ç”¨
  }
});
```

**2. é‡å¤ç»‘å®šé—®é¢˜**
```javascript
// âŒ é”™è¯¯ï¼šupdated æ—¶é‡å¤ç»‘å®š
app.directive('bad-click', {
  mounted(el, binding) {
    el.addEventListener('click', binding.value);
  },
  updated(el, binding) {
    // æ¯æ¬¡æ›´æ–°éƒ½æ·»åŠ æ–°ç›‘å¬å™¨ï¼å†…å­˜æ³„æ¼ï¼
    el.addEventListener('click', binding.value);
  }
});

// âœ… æ­£ç¡®ï¼šå…ˆç§»é™¤å†æ·»åŠ 
app.directive('good-click', {
  mounted(el, binding) {
    this.bind(el, binding);
  },
  updated(el, binding) {
    if (binding.value !== binding.oldValue) {
      this.unbind(el, binding.oldValue);
      this.bind(el, binding);
    }
  },
  unmounted(el) {
    this.unbind(el);
  },
  bind(el, binding) {
    el._handler = binding.value;
    el.addEventListener('click', el._handler);
  },
  unbind(el) {
    if (el._handler) {
      el.removeEventListener('click', el._handler);
      delete el._handler;
    }
  }
});
```

**3. æ€§èƒ½ä¼˜åŒ–**
```javascript
// âœ… ä½¿ç”¨é˜²æŠ–/èŠ‚æµ
app.directive('scroll', {
  mounted(el, binding) {
    const throttledHandler = throttle(binding.value, 200);
    el._scrollHandler = throttledHandler;
    el.addEventListener('scroll', throttledHandler, { passive: true });
  },
  unmounted(el) {
    el.removeEventListener('scroll', el._scrollHandler);
  }
});

// âœ… ä½¿ç”¨ IntersectionObserver ä»£æ›¿ scroll ç›‘å¬
app.directive('visible', {
  mounted(el, binding) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          binding.value(true);
        } else {
          binding.value(false);
        }
      });
    });
    observer.observe(el);
    el._observer = observer;
  },
  unmounted(el) {
    el._observer?.disconnect();
  }
});
```

**4. SSR å…¼å®¹æ€§**
```javascript
// âœ… æ£€æŸ¥æµè§ˆå™¨ç¯å¢ƒ
app.directive('clipboard', {
  mounted(el, binding) {
    // SSR æ—¶ document ä¸å­˜åœ¨
    if (typeof document === 'undefined') return;

    el._copyHandler = () => {
      navigator.clipboard.writeText(binding.value);
    };
    el.addEventListener('click', el._copyHandler);
  },
  unmounted(el) {
    if (typeof document === 'undefined') return;
    el.removeEventListener('click', el._copyHandler);
  }
});
```

**5. ä½¿ç”¨å‘½åç©ºé—´é¿å…å†²çª**
```javascript
// âœ… ä½¿ç”¨å‘½åç©ºé—´å­˜å‚¨æ•°æ®
app.directive('my-directive', {
  mounted(el, binding) {
    if (!el._myDirective) {
      el._myDirective = {};
    }
    el._myDirective.handler = binding.value;
    el._myDirective.timer = null;
  }
});
```

**æœ€ä½³å®è·µæ€»ç»“ï¼š**
1. âœ… å§‹ç»ˆåœ¨ `unmounted` ä¸­æ¸…ç†èµ„æº
2. âœ… å°†å¤„ç†å‡½æ•°å­˜å‚¨åœ¨å…ƒç´ ä¸Šï¼ˆ`el._handler`ï¼‰
3. âœ… ä½¿ç”¨ `passive: true` ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½
4. âœ… ä½¿ç”¨ IntersectionObserver ä»£æ›¿ scroll äº‹ä»¶
5. âœ… é˜²æŠ–/èŠ‚æµé«˜é¢‘äº‹ä»¶
6. âœ… æ£€æŸ¥ SSR ç¯å¢ƒ
7. âœ… é¿å…åœ¨æŒ‡ä»¤ä¸­ä¿®æ”¹ç»„ä»¶çŠ¶æ€ï¼ˆå•å‘æ•°æ®æµï¼‰
8. âœ… ä½¿ç”¨å‘½åç©ºé—´é¿å…å±æ€§å†²çª

## å…­ã€addEventListener æ·±å…¥è§£æ â­â­â­â­â­

### 1. addEventListener åŸºç¡€ç”¨æ³•

#### é¢˜ç›®1ï¼šaddEventListener çš„åŸºæœ¬è¯­æ³•å’Œå‚æ•°è¯¦è§£ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
addEventListener æ˜¯ç°ä»£ Web å¼€å‘ä¸­ç»‘å®šäº‹ä»¶çš„æ ‡å‡†æ–¹æ³•ï¼Œå–ä»£äº†æ—§çš„ onclick æ–¹å¼ã€‚å®ƒå°±åƒæ˜¯"è®¢é˜…é€šçŸ¥"ï¼Œå¯ä»¥ä¸ºåŒä¸€ä¸ªäº‹ä»¶ç»‘å®šå¤šä¸ªå¤„ç†å‡½æ•°ï¼Œè¿˜å¯ä»¥ç²¾ç¡®æ§åˆ¶äº‹ä»¶æ˜¯åœ¨æ•è·é˜¶æ®µè¿˜æ˜¯å†’æ³¡é˜¶æ®µè§¦å‘ã€‚æŒæ¡å®ƒçš„å‚æ•°éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°çš„å„ç§é€‰é¡¹ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- MDN: https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener

**åŸºæœ¬è¯­æ³•ï¼š**
```javascript
target.addEventListener(type, listener, options);
target.addEventListener(type, listener, useCapture);
```

**å‚æ•°è¯¦è§£ï¼š**

1. **typeï¼ˆäº‹ä»¶ç±»å‹ï¼‰**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç›‘å¬çš„äº‹ä»¶ç±»å‹
```javascript
// å¸¸è§äº‹ä»¶ç±»å‹
element.addEventListener('click', handler);      // ç‚¹å‡»
element.addEventListener('input', handler);      // è¾“å…¥
element.addEventListener('keydown', handler);    // é”®ç›˜æŒ‰ä¸‹
element.addEventListener('scroll', handler);     // æ»šåŠ¨
element.addEventListener('resize', handler);     // çª—å£å¤§å°æ”¹å˜
element.addEventListener('load', handler);       // åŠ è½½å®Œæˆ
element.addEventListener('DOMContentLoaded', handler); // DOM åŠ è½½å®Œæˆ
```

2. **listenerï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼‰**ï¼šå‡½æ•°æˆ–å®ç°äº† EventListener æ¥å£çš„å¯¹è±¡
```javascript
// æ–¹å¼1ï¼šå‡½æ•°å¼•ç”¨
function handleClick(event) {
  console.log('clicked', event);
}
element.addEventListener('click', handleClick);

// æ–¹å¼2ï¼šåŒ¿åå‡½æ•°
element.addEventListener('click', function(event) {
  console.log('clicked', this); // this æŒ‡å‘ element
});

// æ–¹å¼3ï¼šç®­å¤´å‡½æ•°
element.addEventListener('click', (event) => {
  console.log('clicked'); // this ä¸æŒ‡å‘ element
});

// æ–¹å¼4ï¼šå¯¹è±¡å½¢å¼ï¼ˆéœ€è¦å®ç° handleEvent æ–¹æ³•ï¼‰
const handler = {
  handleEvent(event) {
    console.log('clicked from object', this); // this æŒ‡å‘ handler å¯¹è±¡
  }
};
element.addEventListener('click', handler);
```

3. **optionsï¼ˆé€‰é¡¹å¯¹è±¡ï¼‰æˆ– useCaptureï¼ˆå¸ƒå°”å€¼ï¼‰**ï¼š

**useCaptureï¼ˆæ—§ç‰ˆå†™æ³•ï¼‰ï¼š**
```javascript
// å†’æ³¡é˜¶æ®µè§¦å‘ï¼ˆé»˜è®¤ï¼‰
element.addEventListener('click', handler, false);

// æ•è·é˜¶æ®µè§¦å‘
element.addEventListener('click', handler, true);
```

**options å¯¹è±¡ï¼ˆæ¨èå†™æ³•ï¼‰ï¼š**
```javascript
element.addEventListener('click', handler, {
  capture: false,  // æ˜¯å¦åœ¨æ•è·é˜¶æ®µè§¦å‘ï¼Œé»˜è®¤ false
  once: false,     // æ˜¯å¦åªè§¦å‘ä¸€æ¬¡ï¼Œé»˜è®¤ false
  passive: false,  // æ˜¯å¦æ°¸ä¸è°ƒç”¨ preventDefault()ï¼Œé»˜è®¤ false
  signal: null     // AbortSignal å¯¹è±¡ï¼Œç”¨äºç§»é™¤ç›‘å¬å™¨
});
```

#### é¢˜ç›®2ï¼šaddEventListener çš„ options å‚æ•°è¯¦è§£å’Œåº”ç”¨åœºæ™¯ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
options å‚æ•°æ˜¯ addEventListener çš„é«˜çº§åŠŸèƒ½ï¼Œæ¯ä¸ªé€‰é¡¹éƒ½æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼šcapture æ§åˆ¶äº‹ä»¶é˜¶æ®µï¼Œonce ç”¨äºä¸€æ¬¡æ€§äº‹ä»¶ï¼Œpassive ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ï¼Œsignal æä¾›äº†æ–°çš„ç§»é™¤äº‹ä»¶æ–¹å¼ã€‚ç†è§£è¿™äº›é€‰é¡¹èƒ½è®©ä½ çš„äº‹ä»¶å¤„ç†æ›´é«˜æ•ˆã€æ›´ä¼˜é›…ã€‚

**ç­”æ¡ˆï¼š**

**1. capture - æ§åˆ¶äº‹ä»¶è§¦å‘é˜¶æ®µ**
```javascript
// åœºæ™¯ï¼šéœ€è¦åœ¨æ•è·é˜¶æ®µæ‹¦æˆªäº‹ä»¶
document.addEventListener('click', (e) => {
  console.log('document æ•è·');
  // å¯ä»¥åœ¨è¿™é‡Œåšå…¨å±€çš„æƒé™æ£€æŸ¥ã€åŸ‹ç‚¹ç­‰
  if (!hasPermission()) {
    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­
    e.preventDefault();
    return;
  }
}, { capture: true });

element.addEventListener('click', () => {
  console.log('element å†’æ³¡'); // å¦‚æœä¸Šé¢é˜»æ­¢äº†ï¼Œè¿™é‡Œä¸ä¼šæ‰§è¡Œ
});
```

**2. once - åªè§¦å‘ä¸€æ¬¡**
```javascript
// åœºæ™¯1ï¼šé¦–æ¬¡åŠ è½½æç¤º
window.addEventListener('scroll', () => {
  showTip('ä½ å¯ä»¥æ»šåŠ¨æŸ¥çœ‹æ›´å¤šå†…å®¹');
}, { once: true });

// åœºæ™¯2ï¼šä¸€æ¬¡æ€§æŒ‰é’®ç‚¹å‡»
button.addEventListener('click', async () => {
  await submitForm();
  console.log('è¡¨å•å·²æäº¤ï¼Œæ­¤ç›‘å¬å™¨å·²è‡ªåŠ¨ç§»é™¤');
}, { once: true });

// åœºæ™¯3ï¼šèµ„æºåŠ è½½
image.addEventListener('load', () => {
  console.log('å›¾ç‰‡åŠ è½½å®Œæˆ');
  // è‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨ removeEventListener
}, { once: true });

// ç­‰ä»·äºä¼ ç»Ÿå†™æ³•ï¼ˆæ›´ç®€æ´ï¼‰
function handleLoad() {
  console.log('å›¾ç‰‡åŠ è½½å®Œæˆ');
  image.removeEventListener('load', handleLoad);
}
image.addEventListener('load', handleLoad);
```

**3. passive - æ€§èƒ½ä¼˜åŒ–ï¼ˆé‡è¦ï¼‰**
```javascript
// åœºæ™¯ï¼šä¼˜åŒ–æ»šåŠ¨æ€§èƒ½
// é—®é¢˜ï¼šæ»šåŠ¨äº‹ä»¶ä¸­è°ƒç”¨ preventDefault() ä¼šé˜»å¡æ¸²æŸ“
element.addEventListener('touchstart', (e) => {
  // æµè§ˆå™¨ä¸ç¡®å®šä½ æ˜¯å¦ä¼šè°ƒç”¨ preventDefault()
  // å¿…é¡»ç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆæ‰èƒ½å¼€å§‹æ»šåŠ¨ï¼Œå¯¼è‡´å¡é¡¿
  e.preventDefault(); // å¦‚æœè®¾ç½®äº† passive: trueï¼Œè¿™è¡Œä¼šè¢«å¿½ç•¥å¹¶è­¦å‘Š
});

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ passive: true å‘Šè¯‰æµè§ˆå™¨ä½ ä¸ä¼šé˜»æ­¢é»˜è®¤è¡Œä¸º
element.addEventListener('touchstart', (e) => {
  // æµè§ˆå™¨çŸ¥é“ä½ ä¸ä¼šé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥ç«‹å³å¼€å§‹æ»šåŠ¨
  console.log('è§¦æ‘¸å¼€å§‹', e.touches[0]);
}, { passive: true });

// å®é™…åº”ç”¨ï¼šæ»šåŠ¨ç›‘å¬
window.addEventListener('scroll', () => {
  const scrollTop = window.pageYOffset;
  // åªåšç›‘å¬ï¼Œä¸é˜»æ­¢æ»šåŠ¨
  updateScrollIndicator(scrollTop);
}, { passive: true });

// æ³¨æ„ï¼šå¦‚æœéœ€è¦é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œä¸èƒ½ä½¿ç”¨ passive
element.addEventListener('touchmove', (e) => {
  if (shouldPrevent) {
    e.preventDefault(); // éœ€è¦é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œä¸èƒ½è®¾ç½® passive: true
  }
});

// Chrome é»˜è®¤è¡Œä¸º
// Chrome 56+ é»˜è®¤å°† windowã€documentã€body çš„ touchstart å’Œ touchmove è®¾ç½®ä¸º passive: true
// å¦‚æœè¦æ”¹å˜é»˜è®¤è¡Œä¸ºï¼Œå¿…é¡»æ˜¾å¼è®¾ç½®
document.addEventListener('touchstart', handler, { passive: false });
```

**4. signal - ä½¿ç”¨ AbortController ç§»é™¤ç›‘å¬å™¨**
```javascript
// åœºæ™¯ï¼šæ‰¹é‡ç§»é™¤å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨
const controller = new AbortController();
const { signal } = controller;

// æ·»åŠ å¤šä¸ªç›‘å¬å™¨
element.addEventListener('click', handler1, { signal });
element.addEventListener('mouseover', handler2, { signal });
element.addEventListener('mouseout', handler3, { signal });

// ä¸€æ¬¡æ€§ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
controller.abort();

// å®é™…åº”ç”¨ï¼šç»„ä»¶å¸è½½æ—¶æ¸…ç†
class Component {
  constructor() {
    this.controller = new AbortController();
  }

  mount() {
    const { signal } = this.controller;

    window.addEventListener('resize', this.handleResize, { signal });
    window.addEventListener('scroll', this.handleScroll, { signal });
    document.addEventListener('click', this.handleClick, { signal });
  }

  unmount() {
    // ä¸€è¡Œä»£ç ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
    this.controller.abort();
  }

  handleResize = () => { /* ... */ }
  handleScroll = () => { /* ... */ }
  handleClick = () => { /* ... */ }
}

// åœ¨ React ä¸­ä½¿ç”¨
function MyComponent() {
  useEffect(() => {
    const controller = new AbortController();
    const { signal } = controller;

    window.addEventListener('resize', handleResize, { signal });
    window.addEventListener('keydown', handleKeyDown, { signal });

    return () => {
      controller.abort(); // ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†
    };
  }, []);
}

// åœºæ™¯ï¼šè¶…æ—¶å–æ¶ˆ
const controller = new AbortController();
const { signal } = controller;

element.addEventListener('click', handler, { signal });

// 10ç§’åè‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨
setTimeout(() => {
  controller.abort();
}, 10000);
```

**5. ç»„åˆä½¿ç”¨å¤šä¸ªé€‰é¡¹**
```javascript
// å®é™…æ¡ˆä¾‹ï¼šä¼˜åŒ–çš„æ»šåŠ¨åˆ°åº•éƒ¨åŠ è½½
function setupInfiniteScroll() {
  const controller = new AbortController();

  window.addEventListener('scroll',
    throttle(() => {
      if (isNearBottom()) {
        loadMoreData();
      }
    }, 200),
    {
      passive: true,  // ä¸é˜»æ­¢æ»šåŠ¨ï¼Œæå‡æ€§èƒ½
      signal: controller.signal  // æ”¯æŒå–æ¶ˆ
    }
  );

  return () => controller.abort();
}

// å®é™…æ¡ˆä¾‹ï¼šé¦–æ¬¡äº¤äº’æ£€æµ‹
function detectFirstInteraction() {
  const controller = new AbortController();
  const events = ['click', 'keydown', 'scroll', 'touchstart'];

  events.forEach(eventType => {
    document.addEventListener(
      eventType,
      () => {
        console.log('ç”¨æˆ·é¦–æ¬¡äº¤äº’');
        sendAnalytics('first_interaction');
        controller.abort(); // ç«‹å³ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
      },
      {
        once: true,      // åªè§¦å‘ä¸€æ¬¡
        passive: true,   // æ€§èƒ½ä¼˜åŒ–
        capture: true,   // æ•è·é˜¶æ®µè§¦å‘ï¼Œæ›´æ—©æ£€æµ‹
        signal: controller.signal
      }
    );
  });
}
```

### 2. addEventListener vs å…¶ä»–äº‹ä»¶ç»‘å®šæ–¹å¼

#### é¢˜ç›®1ï¼šaddEventListenerã€onclick å’Œå†…è”äº‹ä»¶çš„åŒºåˆ«ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
äº‹ä»¶ç»‘å®šæœ‰ä¸‰ç§ä¸»è¦æ–¹å¼ï¼šå†…è”äº‹ä»¶ï¼ˆHTML å±æ€§ï¼‰ã€DOM0 çº§ï¼ˆonclickï¼‰å’Œ DOM2 çº§ï¼ˆaddEventListenerï¼‰ã€‚å®ƒä»¬å°±åƒä¸‰ä»£æŠ€æœ¯ï¼šå†…è”æœ€åŸå§‹ä½†æœ€ä¸æ¨èï¼›onclick ç®€å•ä½†æœ‰é™åˆ¶ï¼›addEventListener æœ€ç°ä»£æœ€å¼ºå¤§ã€‚ç°ä»£å¼€å‘å‡ ä¹éƒ½ç”¨ addEventListenerã€‚

**ç­”æ¡ˆï¼š**

**å¯¹æ¯”è¡¨æ ¼ï¼š**

| ç‰¹æ€§ | å†…è”äº‹ä»¶ | onclick (DOM0) | addEventListener (DOM2) |
|------|---------|----------------|------------------------|
| **å†™æ³•** | `<button onclick="fn()">` | `element.onclick = fn` | `element.addEventListener('click', fn)` |
| **å¤šä¸ªå¤„ç†å™¨** | âŒ ä¸æ”¯æŒ | âŒ ä¼šè¢«è¦†ç›– | âœ… æ”¯æŒå¤šä¸ª |
| **ç§»é™¤ç›‘å¬** | ä¿®æ”¹ HTML | `element.onclick = null` | `removeEventListener` |
| **äº‹ä»¶é˜¶æ®µ** | å†’æ³¡ | å†’æ³¡ | å¯é€‰æ•è·/å†’æ³¡ |
| **this æŒ‡å‘** | window | element | element |
| **æ€§èƒ½** | ä¸€èˆ¬ | å¥½ | æœ€å¥½ |
| **ç»´æŠ¤æ€§** | âŒ å·® | ä¸€èˆ¬ | âœ… å¥½ |
| **æ¨èç¨‹åº¦** | âŒ ä¸æ¨è | âš ï¸ ç®€å•åœºæ™¯å¯ç”¨ | âœ… å¼ºçƒˆæ¨è |

**è¯¦ç»†å¯¹æ¯”ï¼š**

```javascript
// 1. å†…è”äº‹ä»¶ï¼ˆä¸æ¨èï¼‰
<button onclick="handleClick()">ç‚¹å‡»æˆ‘</button>

// é—®é¢˜ï¼š
// - HTML å’Œ JS è€¦åˆï¼Œéš¾ä»¥ç»´æŠ¤
// - å…¨å±€ä½œç”¨åŸŸæ±¡æŸ“
// - ä¸èƒ½ç»‘å®šå¤šä¸ªå¤„ç†å™¨
// - CSP ç­–ç•¥å¯èƒ½é˜»æ­¢å†…è”è„šæœ¬

// 2. DOM0 çº§äº‹ä»¶ï¼ˆonclickï¼‰
const button = document.getElementById('btn');

button.onclick = function(e) {
  console.log('ç¬¬ä¸€ä¸ªå¤„ç†å™¨');
};

button.onclick = function(e) {
  console.log('ç¬¬äºŒä¸ªå¤„ç†å™¨'); // ä¼šè¦†ç›–ç¬¬ä¸€ä¸ª
};

// ä¼˜ç‚¹ï¼š
// - ç®€å•ç›´è§‚
// - å…¼å®¹æ€§å¥½ï¼ˆæ‰€æœ‰æµè§ˆå™¨ï¼‰
// - this è‡ªåŠ¨æŒ‡å‘å…ƒç´ 

// ç¼ºç‚¹ï¼š
// - åªèƒ½ç»‘å®šä¸€ä¸ªå¤„ç†å™¨
// - åªèƒ½åœ¨å†’æ³¡é˜¶æ®µè§¦å‘
// - æ— æ³•ä½¿ç”¨ onceã€passive ç­‰é€‰é¡¹

// ç§»é™¤äº‹ä»¶
button.onclick = null;

// 3. DOM2 çº§äº‹ä»¶ï¼ˆaddEventListenerï¼‰- æ¨è
const button = document.getElementById('btn');

button.addEventListener('click', function(e) {
  console.log('ç¬¬ä¸€ä¸ªå¤„ç†å™¨');
});

button.addEventListener('click', function(e) {
  console.log('ç¬¬äºŒä¸ªå¤„ç†å™¨'); // éƒ½ä¼šæ‰§è¡Œ
});

// ä¼˜ç‚¹ï¼š
// - å¯ä»¥ç»‘å®šå¤šä¸ªå¤„ç†å™¨
// - å¯ä»¥é€‰æ‹©æ•è·æˆ–å†’æ³¡é˜¶æ®µ
// - æ”¯æŒ options å‚æ•°ï¼ˆonceã€passive ç­‰ï¼‰
// - æ›´å¥½çš„æ€§èƒ½å’Œå†…å­˜ç®¡ç†
// - ç¬¦åˆ W3C æ ‡å‡†

// ç§»é™¤äº‹ä»¶ï¼ˆéœ€è¦ä¿å­˜å‡½æ•°å¼•ç”¨ï¼‰
const handler = function(e) {
  console.log('clicked');
};
button.addEventListener('click', handler);
button.removeEventListener('click', handler);
```

**å®é™…åœºæ™¯å¯¹æ¯”ï¼š**

```javascript
// åœºæ™¯1ï¼šç®€å•çš„å•æ¬¡ç‚¹å‡»å¤„ç†
// onclick å†™æ³•
button.onclick = () => alert('Hello');

// addEventListener å†™æ³•ï¼ˆæ¨èï¼‰
button.addEventListener('click', () => alert('Hello'));

// åœºæ™¯2ï¼šéœ€è¦ç§»é™¤ç›‘å¬å™¨
// onclick å†™æ³•
function handleClick() {
  console.log('clicked');
  button.onclick = null; // ç§»é™¤
}
button.onclick = handleClick;

// addEventListener å†™æ³•ï¼ˆæ¨èï¼‰
function handleClick() {
  console.log('clicked');
  button.removeEventListener('click', handleClick);
}
button.addEventListener('click', handleClick);

// æˆ–ä½¿ç”¨ once é€‰é¡¹ï¼ˆæ›´ç®€æ´ï¼‰
button.addEventListener('click', () => {
  console.log('clicked');
}, { once: true });

// åœºæ™¯3ï¼šéœ€è¦å¤šä¸ªå¤„ç†å™¨
// onclick æ— æ³•å®ç°ï¼ˆä¼šè¦†ç›–ï¼‰
button.onclick = () => console.log('1');
button.onclick = () => console.log('2'); // åªä¼šæ‰§è¡Œè¿™ä¸ª

// addEventListener å®Œç¾æ”¯æŒ
button.addEventListener('click', () => console.log('1'));
button.addEventListener('click', () => console.log('2'));
button.addEventListener('click', () => console.log('3'));
// ç‚¹å‡»åè¾“å‡ºï¼š1 2 3

// åœºæ™¯4ï¼šéœ€è¦åœ¨æ•è·é˜¶æ®µæ‹¦æˆª
// onclick æ— æ³•å®ç°

// addEventListener æ”¯æŒ
document.addEventListener('click', (e) => {
  console.log('å…¨å±€æ•è·');
  // å¯ä»¥åœ¨è¿™é‡Œåšæƒé™æ£€æŸ¥
  if (!authorized) {
    e.stopPropagation();
  }
}, { capture: true });

// åœºæ™¯5ï¼šæ€§èƒ½ä¼˜åŒ–
// onclick æ— ä¼˜åŒ–é€‰é¡¹

// addEventListener æ”¯æŒ passive ä¼˜åŒ–
window.addEventListener('scroll', handleScroll, { passive: true });
```

### 3. addEventListener å¸¸è§é—®é¢˜å’Œæœ€ä½³å®è·µ

#### é¢˜ç›®1ï¼šaddEventListener ä½¿ç”¨ä¸­çš„å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
addEventListener è™½ç„¶å¼ºå¤§ï¼Œä½†ä½¿ç”¨ä¸å½“ä¹Ÿä¼šè¸©å‘ã€‚æœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼šå¿˜è®°ç§»é™¤ç›‘å¬å™¨å¯¼è‡´å†…å­˜æ³„æ¼ã€åŒ¿åå‡½æ•°æ— æ³•ç§»é™¤ã€this æŒ‡å‘é—®é¢˜ã€é‡å¤ç»‘å®šç›¸åŒäº‹ä»¶ã€‚äº†è§£è¿™äº›é™·é˜±å’Œè§£å†³æ–¹æ¡ˆï¼Œèƒ½è®©ä½ å†™å‡ºæ›´å¥å£®çš„ä»£ç ã€‚

**ç­”æ¡ˆï¼š**

**é—®é¢˜1ï¼šå†…å­˜æ³„æ¼ - å¿˜è®°ç§»é™¤äº‹ä»¶ç›‘å¬å™¨**
```javascript
// âŒ é”™è¯¯å†™æ³•ï¼šç»„ä»¶é”€æ¯æ—¶æœªç§»é™¤ç›‘å¬å™¨
class Component {
  constructor() {
    window.addEventListener('resize', () => {
      this.handleResize();
    });
  }

  destroy() {
    // å¿˜è®°ç§»é™¤ç›‘å¬å™¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼
  }
}

// âœ… æ­£ç¡®å†™æ³•1ï¼šä¿å­˜å‡½æ•°å¼•ç”¨å¹¶ç§»é™¤
class Component {
  constructor() {
    this.handleResize = this.handleResize.bind(this);
    window.addEventListener('resize', this.handleResize);
  }

  destroy() {
    window.removeEventListener('resize', this.handleResize);
  }

  handleResize() {
    // å¤„ç†é€»è¾‘
  }
}

// âœ… æ­£ç¡®å†™æ³•2ï¼šä½¿ç”¨ AbortController
class Component {
  constructor() {
    this.controller = new AbortController();
    window.addEventListener('resize', () => {
      this.handleResize();
    }, { signal: this.controller.signal });
  }

  destroy() {
    this.controller.abort(); // è‡ªåŠ¨ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
  }
}

// âœ… æ­£ç¡®å†™æ³•3ï¼šReact ä¸­çš„æœ€ä½³å®è·µ
function MyComponent() {
  useEffect(() => {
    const handleResize = () => {
      console.log('resized');
    };

    window.addEventListener('resize', handleResize);

    // æ¸…ç†å‡½æ•°
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);
}
```

**é—®é¢˜2ï¼šåŒ¿åå‡½æ•°æ— æ³•ç§»é™¤**
```javascript
// âŒ é”™è¯¯å†™æ³•ï¼šåŒ¿åå‡½æ•°æ— æ³•ç§»é™¤
element.addEventListener('click', () => {
  console.log('clicked');
});

// æ— æ³•ç§»é™¤ï¼Œå› ä¸ºæ¯æ¬¡éƒ½æ˜¯æ–°çš„å‡½æ•°
element.removeEventListener('click', () => {
  console.log('clicked');
});

// âœ… æ­£ç¡®å†™æ³•1ï¼šä½¿ç”¨å‘½åå‡½æ•°
function handleClick() {
  console.log('clicked');
}
element.addEventListener('click', handleClick);
element.removeEventListener('click', handleClick); // å¯ä»¥ç§»é™¤

// âœ… æ­£ç¡®å†™æ³•2ï¼šä¿å­˜å‡½æ•°å¼•ç”¨
const handleClick = () => {
  console.log('clicked');
};
element.addEventListener('click', handleClick);
element.removeEventListener('click', handleClick); // å¯ä»¥ç§»é™¤

// âœ… æ­£ç¡®å†™æ³•3ï¼šä½¿ç”¨ once é€‰é¡¹ï¼ˆä¸éœ€è¦æ‰‹åŠ¨ç§»é™¤ï¼‰
element.addEventListener('click', () => {
  console.log('clicked');
}, { once: true });

// âœ… æ­£ç¡®å†™æ³•4ï¼šä½¿ç”¨ signal
const controller = new AbortController();
element.addEventListener('click', () => {
  console.log('clicked');
}, { signal: controller.signal });
controller.abort(); // ç§»é™¤ç›‘å¬å™¨
```

**é—®é¢˜3ï¼šthis æŒ‡å‘é—®é¢˜**
```javascript
class MyClass {
  constructor() {
    this.value = 42;

    // âŒ é”™è¯¯å†™æ³•1ï¼šæ™®é€šå‡½æ•°ï¼Œthis æŒ‡å‘ element
    element.addEventListener('click', function() {
      console.log(this.value); // undefinedï¼ˆthis æ˜¯ elementï¼‰
    });

    // âŒ é”™è¯¯å†™æ³•2ï¼šç®­å¤´å‡½æ•°æ— æ³•ç§»é™¤
    element.addEventListener('click', () => {
      console.log(this.value); // 42ï¼ˆæ­£ç¡®ï¼‰
      // ä½†æ— æ³•ç§»é™¤ï¼Œå› ä¸ºæ˜¯åŒ¿åå‡½æ•°
    });

    // âœ… æ­£ç¡®å†™æ³•1ï¼šbind
    this.handleClick = this.handleClick.bind(this);
    element.addEventListener('click', this.handleClick);

    // âœ… æ­£ç¡®å†™æ³•2ï¼šç®­å¤´å‡½æ•°å±æ€§
    element.addEventListener('click', this.handleClickArrow);
  }

  handleClick() {
    console.log(this.value); // 42
  }

  handleClickArrow = () => {
    console.log(this.value); // 42
  }

  destroy() {
    element.removeEventListener('click', this.handleClick);
    element.removeEventListener('click', this.handleClickArrow);
  }
}

// React ä¸­çš„æœ€ä½³å®è·µ
function MyComponent() {
  const [count, setCount] = useState(0);

  // âœ… ä½¿ç”¨ useCallback é¿å…é‡å¤åˆ›å»ºå‡½æ•°
  const handleClick = useCallback(() => {
    setCount(c => c + 1);
  }, []);

  return <button onClick={handleClick}>Count: {count}</button>;
}
```

**é—®é¢˜4ï¼šé‡å¤ç»‘å®šç›¸åŒçš„ç›‘å¬å™¨**
```javascript
// âŒ é”™è¯¯å†™æ³•ï¼šé‡å¤ç»‘å®š
for (let i = 0; i < 5; i++) {
  element.addEventListener('click', handleClick);
}
// ç‚¹å‡»æ—¶ handleClick ä¼šæ‰§è¡Œ 5 æ¬¡

// âœ… æ­£ç¡®å†™æ³•1ï¼šæ£€æŸ¥æ˜¯å¦å·²ç»‘å®š
const boundListeners = new WeakMap();

function addListener(element, type, listener) {
  if (!boundListeners.has(element)) {
    boundListeners.set(element, new Set());
  }

  const listeners = boundListeners.get(element);
  const key = `${type}_${listener.name}`;

  if (!listeners.has(key)) {
    element.addEventListener(type, listener);
    listeners.add(key);
  }
}

// âœ… æ­£ç¡®å†™æ³•2ï¼šç§»é™¤æ—§çš„å†æ·»åŠ æ–°çš„
element.removeEventListener('click', handleClick);
element.addEventListener('click', handleClick);

// âœ… æ­£ç¡®å†™æ³•3ï¼šä½¿ç”¨æ ‡å¿—ä½
if (!element._hasClickListener) {
  element.addEventListener('click', handleClick);
  element._hasClickListener = true;
}
```

**é—®é¢˜5ï¼šäº‹ä»¶ç›‘å¬å™¨ä¸­çš„é—­åŒ…é™·é˜±**
```javascript
// âŒ é”™è¯¯å†™æ³•ï¼šå¾ªç¯ä¸­çš„é—­åŒ…é—®é¢˜
for (var i = 0; i < 3; i++) {
  buttons[i].addEventListener('click', function() {
    console.log(i); // éƒ½è¾“å‡º 3
  });
}

// âœ… æ­£ç¡®å†™æ³•1ï¼šä½¿ç”¨ let
for (let i = 0; i < 3; i++) {
  buttons[i].addEventListener('click', function() {
    console.log(i); // è¾“å‡º 0, 1, 2
  });
}

// âœ… æ­£ç¡®å†™æ³•2ï¼šä½¿ç”¨ IIFE
for (var i = 0; i < 3; i++) {
  (function(index) {
    buttons[index].addEventListener('click', function() {
      console.log(index); // è¾“å‡º 0, 1, 2
    });
  })(i);
}

// âœ… æ­£ç¡®å†™æ³•3ï¼šä½¿ç”¨ data å±æ€§
for (var i = 0; i < 3; i++) {
  buttons[i].dataset.index = i;
  buttons[i].addEventListener('click', function() {
    console.log(this.dataset.index); // è¾“å‡º 0, 1, 2
  });
}

// âœ… æ­£ç¡®å†™æ³•4ï¼šäº‹ä»¶å§”æ‰˜
container.addEventListener('click', function(e) {
  if (e.target.matches('button')) {
    const index = Array.from(buttons).indexOf(e.target);
    console.log(index);
  }
});
```

**é—®é¢˜6ï¼šå¼‚æ­¥æ“ä½œä¸­çš„äº‹ä»¶å¯¹è±¡**
```javascript
// âŒ é”™è¯¯å†™æ³•ï¼šå¼‚æ­¥ä¸­è®¿é—®äº‹ä»¶å¯¹è±¡ï¼ˆReact 16 åŠä¹‹å‰ï¼‰
element.addEventListener('click', (e) => {
  setTimeout(() => {
    console.log(e.target); // å¯èƒ½å·²è¢«å›æ”¶
    e.preventDefault(); // å¯èƒ½æŠ¥é”™
  }, 1000);
});

// âœ… æ­£ç¡®å†™æ³•1ï¼šæå‰ä¿å­˜éœ€è¦çš„å±æ€§
element.addEventListener('click', (e) => {
  const target = e.target;
  const value = e.target.value;

  setTimeout(() => {
    console.log(target, value); // å®‰å…¨
  }, 1000);
});

// âœ… æ­£ç¡®å†™æ³•2ï¼šç«‹å³è°ƒç”¨ preventDefault
element.addEventListener('click', (e) => {
  e.preventDefault(); // ç«‹å³è°ƒç”¨

  setTimeout(() => {
    // å¼‚æ­¥æ“ä½œ
  }, 1000);
});
```

**æœ€ä½³å®è·µæ€»ç»“ï¼š**
```javascript
// å®Œæ•´çš„äº‹ä»¶ç›‘å¬å™¨ç®¡ç†ç±»
class EventManager {
  constructor() {
    this.listeners = new Map();
    this.controller = new AbortController();
  }

  // æ·»åŠ ç›‘å¬å™¨
  addEventListener(element, type, listener, options = {}) {
    // åˆå¹¶ signal
    const mergedOptions = {
      ...options,
      signal: this.controller.signal
    };

    element.addEventListener(type, listener, mergedOptions);

    // è®°å½•ç›‘å¬å™¨ï¼ˆç”¨äºè°ƒè¯•ï¼‰
    const key = `${element}_${type}`;
    if (!this.listeners.has(key)) {
      this.listeners.set(key, []);
    }
    this.listeners.get(key).push(listener);
  }

  // ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
  removeAllListeners() {
    this.controller.abort();
    this.listeners.clear();
  }

  // è·å–ç›‘å¬å™¨æ•°é‡ï¼ˆè°ƒè¯•ç”¨ï¼‰
  getListenerCount() {
    let count = 0;
    for (const listeners of this.listeners.values()) {
      count += listeners.length;
    }
    return count;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const eventManager = new EventManager();

// æ·»åŠ ç›‘å¬å™¨
eventManager.addEventListener(button, 'click', handleClick);
eventManager.addEventListener(window, 'resize', handleResize, { passive: true });
eventManager.addEventListener(input, 'input', handleInput, { once: true });

// ç»„ä»¶å¸è½½æ—¶
eventManager.removeAllListeners();
```

// ä½¿ç”¨
<div v-click-outside="handleClickOutside">
  ç‚¹å‡»å¤–éƒ¨å…³é—­
</div>

// å¤æ‚ç¤ºä¾‹ï¼šé•¿æŒ‰æŒ‡ä»¤
app.directive('longpress', {
  mounted(el, binding) {
    if (typeof binding.value !== 'function') {
      throw 'callback must be a function';
    }

    let pressTimer = null;
    const duration = binding.arg || 500; // é»˜è®¤500ms

    const start = (e) => {
      if (e.type === 'click' && e.button !== 0) {
        return;
      }
      if (pressTimer === null) {
        pressTimer = setTimeout(() => {
          handler(e);
        }, duration);
      }
    };

    const cancel = () => {
      if (pressTimer !== null) {
        clearTimeout(pressTimer);
        pressTimer = null;
      }
    };

    const handler = (e) => {
      binding.value(e);
    };

    el.addEventListener('mousedown', start);
    el.addEventListener('touchstart', start);
    el.addEventListener('click', cancel);
    el.addEventListener('mouseout', cancel);
    el.addEventListener('touchend', cancel);
    el.addEventListener('touchcancel', cancel);

    // ä¿å­˜äº‹ä»¶å¤„ç†å™¨ä»¥ä¾¿å¸è½½
    el._longpress = { start, cancel };
  },
  unmounted(el) {
    const { start, cancel } = el._longpress;
    el.removeEventListener('mousedown', start);
    el.removeEventListener('touchstart', start);
    el.removeEventListener('click', cancel);
    el.removeEventListener('mouseout', cancel);
    el.removeEventListener('touchend', cancel);
    el.removeEventListener('touchcancel', cancel);
  }
});

// ä½¿ç”¨
<button v-longpress:1000="handleLongPress">é•¿æŒ‰æˆ‘</button>
```

### 4. Vueäº‹ä»¶ç›¸å…³åŸç†

#### é¢˜ç›®1ï¼šVueæ˜¯å¦‚ä½•å®ç°äº‹ä»¶ç»‘å®šçš„ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Vueåœ¨ç¼–è¯‘æ¨¡æ¿æ—¶ä¼šæŠŠ@clickè¿™æ ·çš„äº‹ä»¶ç»‘å®šè½¬æ¢æˆåŸç”Ÿçš„addEventListenerã€‚å°±åƒæ˜¯ä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼ŒæŠŠVueçš„è¯­æ³•ç³–ç¿»è¯‘æˆæµè§ˆå™¨èƒ½ç†è§£çš„åŸç”Ÿä»£ç ã€‚Vueè¿˜ä¼šåšä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚äº‹ä»¶ä»£ç†ï¼Œè®©æ€§èƒ½æ›´å¥½ã€‚

**ç­”æ¡ˆï¼š**

Vueäº‹ä»¶ç»‘å®šçš„å®ç°åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šé¦–å…ˆåœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ¨¡æ¿ç¼–è¯‘å™¨ä¼šå°† `@click` ç­‰æŒ‡ä»¤è§£æä¸ºäº‹ä»¶å¤„ç†å™¨å¹¶å­˜å‚¨åœ¨ VNode çš„ props ä¸­ï¼›ç„¶ååœ¨åˆ›å»º VNode æ—¶ï¼Œå°†äº‹ä»¶ä¿¡æ¯ä¿å­˜åˆ°è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼›æœ€ååœ¨ patch è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ `addEventListener` å°†äº‹ä»¶çœŸæ­£ç»‘å®šåˆ° DOM å…ƒç´ ä¸Šã€‚Vue2 ä½¿ç”¨ WeakMap ç®¡ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œåœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒVue ä¼šå¤„ç†äº‹ä»¶ä¿®é¥°ç¬¦å¹¶ç»Ÿä¸€äº‹ä»¶çš„ç®¡ç†ã€‚

```javascript
// Vueåœ¨ç¼–è¯‘æ¨¡æ¿æ—¶ï¼Œä¼šå°†@clickç­‰äº‹ä»¶ç»‘å®šè½¬æ¢ä¸ºäº‹ä»¶å¤„ç†å™¨

// æ¨¡æ¿
<button @click="handleClick">ç‚¹å‡»</button>

// ç¼–è¯‘åï¼ˆç®€åŒ–ç‰ˆï¼‰
function render() {
  return h('button', {
    onClick: handleClick
  }, 'ç‚¹å‡»');
}

// Vueå†…éƒ¨å¤„ç†æµç¨‹
// 1. ç¼–è¯‘é˜¶æ®µï¼šå°†@clickè½¬æ¢ä¸ºonClick
// 2. åˆ›å»ºVNodeæ—¶ï¼Œå°†äº‹ä»¶å­˜å‚¨åœ¨VNodeçš„propsä¸­
// 3. patchè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨åŸç”ŸaddEventListenerç»‘å®šäº‹ä»¶

// äº‹ä»¶ä»£ç†å®ç°ï¼ˆVue2ï¼‰
// Vue2ä½¿ç”¨äº‹ä»¶ä»£ç†ä¼˜åŒ–æ€§èƒ½
class EventManager {
  constructor() {
    this.events = {};
  }

  add(el, event, handler) {
    if (!this.events[event]) {
      this.events[event] = new WeakMap();
    }
    this.events[event].set(el, handler);
    el.addEventListener(event, handler);
  }

  remove(el, event) {
    if (this.events[event]) {
      const handler = this.events[event].get(el);
      if (handler) {
        el.removeEventListener(event, handler);
        this.events[event].delete(el);
      }
    }
  }
}
```

#### é¢˜ç›®2ï¼šVueçš„v-modelåŸç†æ˜¯ä»€ä¹ˆï¼ŸVue2å’ŒVue3çš„v-modelæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
v-modelæ˜¯Vueä¸­å®ç°åŒå‘æ•°æ®ç»‘å®šçš„è¯­æ³•ç³–ï¼Œæœ¬è´¨ä¸Šæ˜¯å±æ€§ç»‘å®š+äº‹ä»¶ç›‘å¬çš„ç»„åˆã€‚å°±åƒæ˜¯"è‡ªåŠ¨åŒæ­¥å™¨"ï¼Œå½“è¾“å…¥æ¡†çš„å€¼å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°æ•°æ®ï¼Œå½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°è¾“å…¥æ¡†ã€‚Vue3å¯¹v-modelåšäº†å¢å¼ºï¼Œæ”¯æŒå¤šä¸ªv-modelï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚

**ç®€æ´ç­”æ¡ˆï¼ˆé¢è¯•ç”¨ï¼‰ï¼š**

**v-modelåŸç†ï¼š**
v-modelæ˜¯è¯­æ³•ç³–ï¼Œåœ¨åŸç”Ÿå…ƒç´ ä¸Šç­‰ä»·äº`:value`ç»‘å®šåŠ `@input`äº‹ä»¶ã€‚åœ¨Vue2ç»„ä»¶ä¸Šæ˜¯`:value`+`@input`ï¼Œåœ¨Vue3ç»„ä»¶ä¸Šæ˜¯`:modelValue`+`@update:modelValue`ã€‚

**Vue2å’ŒVue3çš„ä¸»è¦åŒºåˆ«ï¼š**
1. **propå’Œäº‹ä»¶åä¸åŒ**ï¼šVue2ç”¨`value`å’Œ`input`ï¼ŒVue3æ”¹ä¸º`modelValue`å’Œ`update:modelValue`
2. **å¤šä¸ªv-model**ï¼šVue2åªæ”¯æŒä¸€ä¸ªv-modelï¼ˆå…¶ä»–éœ€è¦ç”¨`.sync`ï¼‰ï¼ŒVue3åŸç”Ÿæ”¯æŒå¤šä¸ªï¼ˆå¦‚`v-model:title`ã€`v-model:content`ï¼‰
3. **è‡ªå®šä¹‰æ–¹å¼**ï¼šVue2éœ€è¦é…ç½®`model`é€‰é¡¹ï¼ŒVue3ç›´æ¥ä½¿ç”¨`v-model:å‚æ•°å`çš„å½¢å¼
4. **ä¿®é¥°ç¬¦**ï¼šVue3æ–°å¢æ”¯æŒè‡ªå®šä¹‰ä¿®é¥°ç¬¦ï¼Œå¯é€šè¿‡`modelModifiers` propæ¥æ”¶å¹¶å¤„ç†

---

**è¯¦ç»†ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- Vue 3: https://cn.vuejs.org/guide/components/v-model.html
- Vue 2: https://v2.cn.vuejs.org/v2/guide/components.html#åœ¨ç»„ä»¶ä¸Šä½¿ç”¨-v-model
- è¿ç§»æŒ‡å—: https://v3-migration.vuejs.org/zh/breaking-changes/v-model.html

**v-modelçš„åŸºæœ¬åŸç†ï¼š**
v-modelæ˜¯è¯­æ³•ç³–ï¼Œæœ¬è´¨æ˜¯å±æ€§ç»‘å®šå’Œäº‹ä»¶ç›‘å¬çš„ç»“åˆã€‚

```javascript
// åŸå§‹å†™æ³•
<input :value="message" @input="message = $event.target.value">

// v-modelå†™æ³•
<input v-model="message">
```

**Vue2å’ŒVue3çš„v-modelåŒºåˆ«ï¼š**

**1. ç»„ä»¶ä¸Šçš„é»˜è®¤propå’Œäº‹ä»¶åç§°ä¸åŒ**
```javascript
// Vue2
<CustomInput v-model="searchText" />
// ç­‰ä»·äº
<CustomInput :value="searchText" @input="searchText = $event" />

// Vue3
<CustomInput v-model="searchText" />
// ç­‰ä»·äº
<CustomInput :modelValue="searchText" @update:modelValue="searchText = $event" />
```

**2. æ”¯æŒå¤šä¸ªv-modelç»‘å®š**
```vue
<!-- Vue2ï¼šåªèƒ½æœ‰ä¸€ä¸ªv-modelï¼Œéœ€è¦ç”¨.syncå®ç°å¤šä¸ªåŒå‘ç»‘å®š -->
<UserForm
  v-model="name"
  :age.sync="age"
  :email.sync="email"
/>

<!-- Vue3ï¼šæ”¯æŒå¤šä¸ªv-model -->
<UserForm
  v-model:name="name"
  v-model:age="age"
  v-model:email="email"
/>
```

**3. è‡ªå®šä¹‰v-modelçš„å®ç°æ–¹å¼**
```javascript
// Vue2 - éœ€è¦é…ç½®modelé€‰é¡¹
export default {
  model: {
    prop: 'checked',  // è‡ªå®šä¹‰propåç§°
    event: 'change'   // è‡ªå®šä¹‰äº‹ä»¶åç§°
  },
  props: {
    checked: Boolean
  },
  methods: {
    handleChange(e) {
      this.$emit('change', e.target.checked);
    }
  }
};

// Vue3 - ç›´æ¥ä½¿ç”¨v-model:propName
export default {
  props: {
    modelValue: String,  // é»˜è®¤
    title: String,       // è‡ªå®šä¹‰
    content: String      // è‡ªå®šä¹‰
  },
  emits: ['update:modelValue', 'update:title', 'update:content'],
  methods: {
    updateValue(value) {
      this.$emit('update:modelValue', value);
    },
    updateTitle(value) {
      this.$emit('update:title', value);
    },
    updateContent(value) {
      this.$emit('update:content', value);
    }
  }
};

// ä½¿ç”¨
<MyComponent
  v-model="value"          // é»˜è®¤çš„modelValue
  v-model:title="title"    // è‡ªå®šä¹‰çš„title
  v-model:content="content" // è‡ªå®šä¹‰çš„content
/>
```

**4. v-modelä¿®é¥°ç¬¦çš„å˜åŒ–**
```javascript
// Vue2ï¼šå†…ç½®ä¿®é¥°ç¬¦
<input v-model.trim="text">
<input v-model.number="age">
<input v-model.lazy="msg">

// Vue3ï¼šé™¤äº†å†…ç½®ä¿®é¥°ç¬¦ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ä¿®é¥°ç¬¦
<input v-model.trim="text">
<input v-model.number="age">
<input v-model.lazy="msg">
<CustomInput v-model.capitalize="text" />  // è‡ªå®šä¹‰ä¿®é¥°ç¬¦

// ç»„ä»¶å†…å¤„ç†è‡ªå®šä¹‰ä¿®é¥°ç¬¦ï¼ˆVue3æ–°ç‰¹æ€§ï¼‰
export default {
  props: {
    modelValue: String,
    modelModifiers: {  // æ¥æ”¶ä¿®é¥°ç¬¦
      default: () => ({})
    }
  },
  emits: ['update:modelValue'],
  methods: {
    emitValue(value) {
      if (this.modelModifiers.capitalize) {
        value = value.charAt(0).toUpperCase() + value.slice(1);
      }
      if (this.modelModifiers.lowercase) {
        value = value.toLowerCase();
      }
      this.$emit('update:modelValue', value);
    }
  }
};
```

**5. å®Œæ•´å¯¹æ¯”ç¤ºä¾‹**
```javascript
// === Vue2å®ç° ===
// çˆ¶ç»„ä»¶
<template>
  <CustomInput v-model="text" :age.sync="age" />
</template>

// å­ç»„ä»¶
export default {
  model: {
    prop: 'value',
    event: 'change'
  },
  props: {
    value: String,
    age: Number
  },
  methods: {
    updateValue(val) {
      this.$emit('change', val);  // å¯¹åº”v-model
    },
    updateAge(val) {
      this.$emit('update:age', val);  // å¯¹åº”.sync
    }
  }
};

// === Vue3å®ç° ===
// çˆ¶ç»„ä»¶
<template>
  <CustomInput v-model="text" v-model:age="age" />
</template>

// å­ç»„ä»¶
export default {
  props: {
    modelValue: String,
    age: Number
  },
  emits: ['update:modelValue', 'update:age'],
  methods: {
    updateValue(val) {
      this.$emit('update:modelValue', val);
    },
    updateAge(val) {
      this.$emit('update:age', val);
    }
  }
};
```

**æ€»ç»“ä¸»è¦åŒºåˆ«ï¼š**
1. **é»˜è®¤propåç§°**ï¼šVue2ä½¿ç”¨`value`ï¼ŒVue3ä½¿ç”¨`modelValue`
2. **é»˜è®¤äº‹ä»¶åç§°**ï¼šVue2ä½¿ç”¨`input`ï¼ŒVue3ä½¿ç”¨`update:modelValue`
3. **å¤šä¸ªåŒå‘ç»‘å®š**ï¼šVue2éœ€è¦v-model + .syncï¼ŒVue3ç»Ÿä¸€ä½¿ç”¨v-model:xxx
4. **è‡ªå®šä¹‰ä¿®é¥°ç¬¦**ï¼šVue3æ–°å¢æ”¯æŒè‡ªå®šä¹‰ä¿®é¥°ç¬¦
5. **.syncä¿®é¥°ç¬¦**ï¼šVue3ä¸­è¢«ç§»é™¤ï¼ŒåŠŸèƒ½ç”±v-model:xxxæ›¿ä»£

## ä¸‰ã€Reactäº‹ä»¶æœºåˆ¶ â­â­â­â­

### 1. Reactäº‹ä»¶åŸºç¡€
#### çƒ­åº¦ï¼šâ­â­â­â­

#### é¢˜ç›®1ï¼šReactçš„åˆæˆäº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆæˆäº‹ä»¶ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Reactçš„åˆæˆäº‹ä»¶å°±åƒæ˜¯ç»™åŸç”Ÿäº‹ä»¶ç©¿äº†ä¸€ä»¶"æ ‡å‡†åŒ–å¤–å¥—"ï¼Œè®©æ‰€æœ‰æµè§ˆå™¨çš„äº‹ä»¶è¡Œä¸ºéƒ½å˜å¾—ä¸€è‡´ã€‚å°±åƒä¸åŒå“ç‰Œçš„æ‰‹æœºéƒ½ç”¨åŒä¸€ä¸ªå……ç”µæ¥å£ä¸€æ ·ï¼ŒReactæŠŠä¸åŒæµè§ˆå™¨çš„äº‹ä»¶å·®å¼‚æŠ¹å¹³äº†ï¼Œè¿˜åšäº†æ€§èƒ½ä¼˜åŒ–ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½ç»Ÿä¸€ç®¡ç†ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- Reactäº‹ä»¶å¤„ç†: https://zh-hans.react.dev/learn/responding-to-events
- åˆæˆäº‹ä»¶: https://zh-hans.react.dev/reference/react-dom/components/common#react-event-object
Reactçš„åˆæˆäº‹ä»¶ï¼ˆSyntheticEventï¼‰æ˜¯Reactè‡ªå·±å®ç°çš„ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯åŸç”ŸDOMäº‹ä»¶çš„è·¨æµè§ˆå™¨å°è£…ã€‚

**ä¸ºä»€ä¹ˆä½¿ç”¨åˆæˆäº‹ä»¶ï¼š**
1. **è·¨æµè§ˆå™¨å…¼å®¹æ€§**ï¼šæŠ¹å¹³ä¸åŒæµè§ˆå™¨çš„å·®å¼‚
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡äº‹ä»¶å§”æ‰˜ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½ç»‘å®šåˆ°documentä¸Š
3. **äº‹ä»¶æ± **ï¼šReact16åŠä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨äº‹ä»¶æ± å¤ç”¨äº‹ä»¶å¯¹è±¡
4. **æ›´å¥½çš„æ§åˆ¶**ï¼šå¯ä»¥æ§åˆ¶äº‹ä»¶çš„è§¦å‘é¡ºåºå’Œè¡Œä¸º

```javascript
class Component extends React.Component {
  handleClick = (e) => {
    // eæ˜¯åˆæˆäº‹ä»¶å¯¹è±¡
    console.log(e); // SyntheticEvent
    console.log(e.nativeEvent); // åŸç”Ÿäº‹ä»¶å¯¹è±¡

    // åˆæˆäº‹ä»¶çš„å±æ€§å’Œæ–¹æ³•
    e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
    e.stopPropagation(); // é˜»æ­¢å†’æ³¡
    e.persist(); // React16åŠä¹‹å‰ï¼Œä¿æŒäº‹ä»¶å¼•ç”¨

    // å¼‚æ­¥è®¿é—®äº‹ä»¶å¯¹è±¡ï¼ˆReact16åŠä¹‹å‰éœ€è¦persistï¼‰
    setTimeout(() => {
      console.log(e.type); // React17+å¯ä»¥ç›´æ¥è®¿é—®
    }, 1000);
  };

  render() {
    return <button onClick={this.handleClick}>ç‚¹å‡»</button>;
  }
}
```

#### é¢˜ç›®2ï¼šReactäº‹ä»¶ç»‘å®šçš„å‡ ç§æ–¹å¼ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Reactä¸­ç»‘å®šäº‹ä»¶æœ‰å¥½å‡ ç§å†™æ³•ï¼Œä¸»è¦åŒºåˆ«åœ¨äºthisæŒ‡å‘å’Œæ€§èƒ½ã€‚ç±»ç»„ä»¶ä¸­æ¨èç”¨ç®­å¤´å‡½æ•°æˆ–åœ¨constructorä¸­ç»‘å®šï¼Œé¿å…åœ¨renderä¸­ç»‘å®šï¼ˆä¼šå½±å“æ€§èƒ½ï¼‰ã€‚å‡½æ•°ç»„ä»¶ä¸­å°±ç®€å•å¤šäº†ï¼Œç›´æ¥å®šä¹‰å‡½æ•°å³å¯ï¼Œé…åˆuseCallbackè¿˜èƒ½ä¼˜åŒ–æ€§èƒ½ã€‚

**ç­”æ¡ˆï¼š**

Reactäº‹ä»¶ç»‘å®šä¸»è¦æœ‰å››ç§æ–¹å¼ã€‚ç±»ç»„ä»¶ä¸­ï¼šç¬¬ä¸€ç§æ˜¯åœ¨ constructor ä¸­ç”¨ bind ç»‘å®š thisï¼Œæ€§èƒ½æœ€å¥½ï¼›ç¬¬äºŒç§æ˜¯ä½¿ç”¨ç®­å¤´å‡½æ•°å®šä¹‰æ–¹æ³•ï¼Œè‡ªåŠ¨ç»‘å®š thisï¼Œæ¨èä½¿ç”¨ï¼›ç¬¬ä¸‰ç§æ˜¯åœ¨ JSX ä¸­ä½¿ç”¨ bindï¼Œä½†æ¯æ¬¡ render éƒ½ä¼šåˆ›å»ºæ–°å‡½æ•°ï¼Œä¸æ¨èï¼›ç¬¬å››ç§æ˜¯åœ¨ JSX ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ŒåŒæ ·æ¯æ¬¡åˆ›å»ºæ–°å‡½æ•°ï¼Œä¸æ¨èã€‚å‡½æ•°ç»„ä»¶ä¸­æ›´ç®€å•ï¼Œç›´æ¥å®šä¹‰å‡½æ•°æˆ–ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°å¼•ç”¨å³å¯ï¼Œé…åˆ React.memo å¯ä»¥é¿å…å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚

**å®˜æ–¹æ–‡æ¡£ï¼š**
- äº‹ä»¶å¤„ç†: https://zh-hans.react.dev/learn/responding-to-events
- Hookæ–‡æ¡£: https://zh-hans.react.dev/reference/react/hooks
```javascript
class EventBinding extends React.Component {
  constructor(props) {
    super(props);
    this.state = { count: 0 };

    // æ–¹å¼1ï¼šæ„é€ å‡½æ•°ä¸­ç»‘å®š
    this.handleClick1 = this.handleClick1.bind(this);
  }

  // æ–¹å¼1ï¼šæ™®é€šæ–¹æ³• + constructorç»‘å®š
  handleClick1() {
    this.setState({ count: this.state.count + 1 });
  }

  // æ–¹å¼2ï¼šç®­å¤´å‡½æ•°å®šä¹‰æ–¹æ³•
  handleClick2 = () => {
    this.setState({ count: this.state.count + 1 });
  }

  // æ–¹å¼3ï¼šæ™®é€šæ–¹æ³•
  handleClick3() {
    this.setState({ count: this.state.count + 1 });
  }

  // æ–¹å¼4ï¼šå¸¦å‚æ•°çš„æ–¹æ³•
  handleClick4(param, e) {
    console.log(param, e);
    this.setState({ count: this.state.count + 1 });
  }

  render() {
    return (
      <div>
        {/* æ–¹å¼1ï¼šconstructorä¸­ç»‘å®š */}
        <button onClick={this.handleClick1}>æ–¹å¼1</button>

        {/* æ–¹å¼2ï¼šç®­å¤´å‡½æ•°æ–¹æ³• */}
        <button onClick={this.handleClick2}>æ–¹å¼2</button>

        {/* æ–¹å¼3ï¼šrenderä¸­bindï¼ˆä¸æ¨èï¼Œæ¯æ¬¡renderåˆ›å»ºæ–°å‡½æ•°ï¼‰ */}
        <button onClick={this.handleClick3.bind(this)}>æ–¹å¼3</button>

        {/* æ–¹å¼4ï¼šrenderä¸­ç®­å¤´å‡½æ•°ï¼ˆä¸æ¨èï¼Œæ¯æ¬¡renderåˆ›å»ºæ–°å‡½æ•°ï¼‰ */}
        <button onClick={() => this.handleClick3()}>æ–¹å¼4</button>

        {/* æ–¹å¼5ï¼šä¼ å‚ - ä½¿ç”¨ç®­å¤´å‡½æ•° */}
        <button onClick={(e) => this.handleClick4('å‚æ•°', e)}>æ–¹å¼5</button>

        {/* æ–¹å¼6ï¼šä¼ å‚ - ä½¿ç”¨bind */}
        <button onClick={this.handleClick4.bind(this, 'å‚æ•°')}>æ–¹å¼6</button>
      </div>
    );
  }
}

// å‡½æ•°ç»„ä»¶ä¸­çš„äº‹ä»¶ç»‘å®š
function FunctionComponent() {
  const [count, setCount] = useState(0);

  // ç›´æ¥å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°
  const handleClick = () => {
    setCount(count + 1);
  };

  // ä½¿ç”¨useCallbackä¼˜åŒ–
  const handleClickMemo = useCallback(() => {
    setCount(prev => prev + 1);
  }, []);

  // å¸¦å‚æ•°çš„äº‹ä»¶å¤„ç†
  const handleClickWithParam = (param) => {
    console.log(param);
    setCount(count + 1);
  };

  return (
    <div>
      <button onClick={handleClick}>ç‚¹å‡»</button>
      <button onClick={handleClickMemo}>ä¼˜åŒ–çš„ç‚¹å‡»</button>
      <button onClick={() => handleClickWithParam('å‚æ•°')}>å¸¦å‚æ•°</button>
    </div>
  );
}
```

#### é¢˜ç›®3ï¼šReactäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶çš„æ‰§è¡Œé¡ºåºï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„é¢è¯•é¢˜ã€‚Reactäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶æ··åˆä½¿ç”¨æ—¶ï¼Œæ‰§è¡Œé¡ºåºä¼šè®©äººå›°æƒ‘ã€‚ç®€å•è®°ä½ï¼šReact17ä¹‹å‰ï¼ŒåŸç”Ÿäº‹ä»¶å…ˆæ‰§è¡Œï¼Œç„¶åæ‰æ˜¯Reactäº‹ä»¶ï¼›React17ä¹‹åï¼Œé¡ºåºæ›´æ¥è¿‘åŸç”Ÿäº‹ä»¶æµã€‚è¿™ä¸ªå˜åŒ–æ˜¯ä¸ºäº†è®©Reactäº‹ä»¶è¡Œä¸ºæ›´ç¬¦åˆé¢„æœŸã€‚

**ç­”æ¡ˆï¼š**

Reactäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶çš„æ‰§è¡Œé¡ºåºåœ¨ä¸åŒç‰ˆæœ¬æœ‰æ‰€ä¸åŒã€‚React17 åŠä»¥åç‰ˆæœ¬ï¼Œæ‰§è¡Œé¡ºåºéµå¾ªåŸç”Ÿäº‹ä»¶æµï¼šå…ˆæ•è·é˜¶æ®µçš„åŸç”Ÿäº‹ä»¶ï¼Œç„¶å React æ•è·äº‹ä»¶ï¼Œæ¥ç€ React å†’æ³¡äº‹ä»¶ï¼Œå†æ˜¯å†’æ³¡é˜¶æ®µçš„åŸç”Ÿäº‹ä»¶ï¼Œæœ€åæ˜¯ document ä¸Šçš„åŸç”Ÿäº‹ä»¶ã€‚è€Œ React16 åŠä¹‹å‰ç‰ˆæœ¬ï¼Œç”±äºæ‰€æœ‰äº‹ä»¶éƒ½ç»‘å®šåœ¨ document ä¸Šï¼Œæ‰€ä»¥æ‰§è¡Œé¡ºåºæ˜¯ï¼šå…ƒç´ ä¸Šçš„åŸç”Ÿäº‹ä»¶å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œ React åˆæˆäº‹ä»¶ã€‚è¿™ä¸ªæ”¹å˜è®© React17+ çš„äº‹ä»¶è¡Œä¸ºæ›´æ¥è¿‘åŸç”Ÿï¼Œä¹Ÿè§£å†³äº†å¤šç‰ˆæœ¬ React å…±å­˜æ—¶çš„å†²çªé—®é¢˜ã€‚

```javascript
class EventOrder extends React.Component {
  componentDidMount() {
    // åŸç”Ÿäº‹ä»¶ç»‘å®š
    document.getElementById('native-btn').addEventListener('click', () => {
      console.log('åŸç”Ÿäº‹ä»¶ï¼ˆå†’æ³¡ï¼‰');
    });

    document.getElementById('native-btn').addEventListener('click', () => {
      console.log('åŸç”Ÿäº‹ä»¶ï¼ˆæ•è·ï¼‰');
    }, true);

    document.addEventListener('click', () => {
      console.log('documentåŸç”Ÿäº‹ä»¶');
    });
  }

  handleReactClick = () => {
    console.log('Reactåˆæˆäº‹ä»¶');
  };

  handleReactClickCapture = () => {
    console.log('Reactåˆæˆäº‹ä»¶ï¼ˆæ•è·ï¼‰');
  };

  render() {
    return (
      <button
        id="native-btn"
        onClick={this.handleReactClick}
        onClickCapture={this.handleReactClickCapture}
      >
        ç‚¹å‡»æµ‹è¯•é¡ºåº
      </button>
    );
  }
}

// ç‚¹å‡»æŒ‰é’®åçš„æ‰§è¡Œé¡ºåºï¼ˆReact 17+ï¼‰ï¼š
// 1. åŸç”Ÿäº‹ä»¶ï¼ˆæ•è·ï¼‰
// 2. Reactåˆæˆäº‹ä»¶ï¼ˆæ•è·ï¼‰
// 3. Reactåˆæˆäº‹ä»¶
// 4. åŸç”Ÿäº‹ä»¶ï¼ˆå†’æ³¡ï¼‰
// 5. documentåŸç”Ÿäº‹ä»¶

// React 16åŠä¹‹å‰çš„æ‰§è¡Œé¡ºåºï¼š
// 1. åŸç”Ÿäº‹ä»¶ï¼ˆæ•è·ï¼‰
// 2. åŸç”Ÿäº‹ä»¶ï¼ˆå†’æ³¡ï¼‰
// 3. Reactåˆæˆäº‹ä»¶ï¼ˆæ•è·ï¼‰
// 4. Reactåˆæˆäº‹ä»¶
// 5. documentåŸç”Ÿäº‹ä»¶
```

### 2. Reactäº‹ä»¶ç³»ç»ŸåŸç†

#### é¢˜ç›®1ï¼šReact17å¯¹äº‹ä»¶ç³»ç»Ÿåšäº†å“ªäº›æ”¹å˜ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
React17å¯¹äº‹ä»¶ç³»ç»Ÿåšäº†é‡è¦å‡çº§ï¼šæŠŠäº‹ä»¶ç»‘å®šä»documentæ”¹åˆ°äº†æ ¹å®¹å™¨ä¸Šï¼Œè¿™æ ·å¤šä¸ªReactç‰ˆæœ¬å¯ä»¥å…±å­˜ä¸å†²çªï¼›ç§»é™¤äº†äº‹ä»¶æ± ï¼Œäº‹ä»¶å¯¹è±¡ä¸å†å¤ç”¨ï¼Œä½¿ç”¨èµ·æ¥æ›´ç›´è§‚ã€‚è¿™äº›æ”¹å˜è®©Reactæ›´å¥½åœ°ä¸å…¶ä»–åº“é›†æˆï¼Œè¡Œä¸ºä¹Ÿæ›´æ¥è¿‘åŸç”Ÿäº‹ä»¶ã€‚

**ç­”æ¡ˆï¼š**

React17 å¯¹äº‹ä»¶ç³»ç»Ÿåšäº†ä¸¤ä¸ªé‡å¤§æ”¹å˜ï¼šç¬¬ä¸€ï¼Œäº‹ä»¶å§”æ‰˜çš„ä½ç½®ä» document æ”¹åˆ°äº† ReactDOM.render çš„æ ¹å®¹å™¨èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å¯ä»¥è®©å¤šä¸ªä¸åŒç‰ˆæœ¬çš„ React åº”ç”¨å…±å­˜è€Œä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œä¹Ÿæ›´å®¹æ˜“ä¸å…¶ä»–æ¡†æ¶é›†æˆï¼›ç¬¬äºŒï¼Œç§»é™¤äº†äº‹ä»¶æ± æœºåˆ¶ï¼Œä¸å†å¤ç”¨äº‹ä»¶å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥åœ¨å¼‚æ­¥ä»£ç ä¸­ç›´æ¥è®¿é—®äº‹ä»¶å¯¹è±¡å±æ€§ï¼Œä¸éœ€è¦è°ƒç”¨ `event.persist()` æ–¹æ³•ã€‚è¿™äº›æ”¹å˜è®© React äº‹ä»¶è¡Œä¸ºæ›´æ¥è¿‘åŸç”Ÿ DOM äº‹ä»¶ï¼Œé™ä½äº†å¼€å‘è€…çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚

**å®˜æ–¹æ–‡æ¡£ï¼š**
- React 17å‘å¸ƒè¯´æ˜: https://zh-hans.react.dev/blog/2020/10/20/react-v17
- React 18å‡çº§æŒ‡å—: https://zh-hans.react.dev/blog/2022/03/08/react-18-upgrade-guide
```javascript
// React 16åŠä¹‹å‰
// 1. æ‰€æœ‰äº‹ä»¶éƒ½ç»‘å®šåœ¨documentä¸Š
// 2. ä½¿ç”¨äº‹ä»¶æ± å¤ç”¨äº‹ä»¶å¯¹è±¡

// React 17+çš„æ”¹å˜
// 1. äº‹ä»¶ç»‘å®šåœ¨æ ¹å®¹å™¨ä¸Šï¼ˆReactDOM.renderçš„å®¹å™¨ï¼‰
// 2. ç§»é™¤äº‹ä»¶æ± ï¼Œäº‹ä»¶å¯¹è±¡ä¸å†å¤ç”¨
// 3. æ›´æ¥è¿‘åŸç”Ÿäº‹ä»¶è¡Œä¸º

// ç¤ºä¾‹ï¼šå¤šä¸ªReactç‰ˆæœ¬å…±å­˜
// React 16
ReactDOM.render(<App16 />, document.getElementById('root16'));
// äº‹ä»¶ç»‘å®šåœ¨documentä¸Š

// React 17+
ReactDOM.render(<App17 />, document.getElementById('root17'));
// äº‹ä»¶ç»‘å®šåœ¨#root17ä¸Š

// å¥½å¤„ï¼š
// 1. å¤šç‰ˆæœ¬Reactå…±å­˜ä¸ä¼šå†²çª
// 2. æ›´å¥½çš„ä¸ç¬¬ä¸‰æ–¹åº“é›†æˆ
// 3. äº‹ä»¶å¤„ç†æ›´æ¥è¿‘åŸç”Ÿè¡Œä¸º

// äº‹ä»¶å§”æ‰˜ç¤ºä¾‹
function EventDelegation() {
  useEffect(() => {
    // React 17+ä¸­ï¼Œè¿™ä¸ªåŸç”Ÿäº‹ä»¶å¯èƒ½å…ˆäºReactäº‹ä»¶æ‰§è¡Œ
    document.addEventListener('click', (e) => {
      // å¯ä»¥é˜»æ­¢Reactäº‹ä»¶
      e.stopPropagation();
    });
  }, []);

  return (
    <div onClick={() => console.log('Reactäº‹ä»¶')}>
      ç‚¹å‡»æµ‹è¯•
    </div>
  );
}
```

#### é¢˜ç›®2ï¼šReactäº‹ä»¶æ± æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆReact17ç§»é™¤äº†äº‹ä»¶æ± ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
äº‹ä»¶æ± æ˜¯React16åŠä¹‹å‰ç‰ˆæœ¬çš„ä¸€ä¸ªä¼˜åŒ–æœºåˆ¶ï¼Œå°±åƒ"å…±äº«å•è½¦"ä¸€æ ·ï¼Œäº‹ä»¶å¯¹è±¡ç”¨å®Œåä¼šè¢«å›æ”¶å†åˆ©ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€‚ä½†è¿™å¯¼è‡´å¼‚æ­¥è®¿é—®äº‹ä»¶å¯¹è±¡æ—¶ä¼šå‡ºé—®é¢˜ï¼Œéœ€è¦è°ƒç”¨persist()ä¿æŒå¼•ç”¨ã€‚React17ç§»é™¤äº†äº‹ä»¶æ± ï¼Œå› ä¸ºç°ä»£æµè§ˆå™¨æ€§èƒ½æå‡äº†ï¼Œè¿™ä¸ªä¼˜åŒ–çš„æ”¶ç›Šä¸å¤§ï¼Œåè€Œå¢åŠ äº†å¤æ‚åº¦ã€‚

**ç­”æ¡ˆï¼š**

äº‹ä»¶æ± æ˜¯ React16 åŠä¹‹å‰ç‰ˆæœ¬çš„æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ï¼Œåˆæˆäº‹ä»¶å¯¹è±¡åœ¨äº‹ä»¶å›è°ƒæ‰§è¡Œå®Œåä¼šè¢«æ¸…ç©ºå¹¶æ”¾å›äº‹ä»¶æ± å¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚ä½†è¿™å¯¼è‡´åœ¨å¼‚æ­¥ä»£ç ï¼ˆå¦‚ setTimeoutã€Promiseï¼‰ä¸­è®¿é—®äº‹ä»¶å¯¹è±¡æ—¶ï¼Œå±æ€§éƒ½ä¼šå˜æˆ nullï¼Œå¿…é¡»è°ƒç”¨ `event.persist()` ä¿æŒå¼•ç”¨ã€‚React17 ç§»é™¤äº‹ä»¶æ± çš„åŸå› æœ‰å››ç‚¹ï¼šä¸€æ˜¯ç°ä»£æµè§ˆå™¨åƒåœ¾å›æ”¶æ€§èƒ½å¤§å¹…æå‡ï¼Œåˆ›å»ºäº‹ä»¶å¯¹è±¡çš„æˆæœ¬é™ä½ï¼›äºŒæ˜¯ç®€åŒ–äº†å¼€å‘è€…çš„å¿ƒæ™ºæ¨¡å‹ï¼Œä¸ç”¨è€ƒè™‘å¼‚æ­¥è®¿é—®çš„é—®é¢˜ï¼›ä¸‰æ˜¯å‡å°‘äº†å› è¯¯ç”¨å¯¼è‡´çš„ bugï¼›å››æ˜¯è®©è¡Œä¸ºæ›´ç¬¦åˆåŸç”Ÿäº‹ä»¶çš„é¢„æœŸã€‚

```javascript
// React 16åŠä¹‹å‰çš„äº‹ä»¶æ± æœºåˆ¶
class EventPoolExample extends React.Component {
  handleClick = (e) => {
    // eæ˜¯ä»äº‹ä»¶æ± ä¸­å–å‡ºçš„åˆæˆäº‹ä»¶å¯¹è±¡
    console.log(e.type); // 'click'

    // å¼‚æ­¥è®¿é—®ä¼šå¤±è´¥ï¼ˆäº‹ä»¶å¯¹è±¡è¢«é‡ç½®ï¼‰
    setTimeout(() => {
      console.log(e.type); // nullï¼ˆReact16ï¼‰
    }, 1000);

    // éœ€è¦ä½¿ç”¨persistä¿æŒå¼•ç”¨
    e.persist();
    setTimeout(() => {
      console.log(e.type); // 'click'
    }, 1000);
  };

  render() {
    return <button onClick={this.handleClick}>ç‚¹å‡»</button>;
  }
}

// React 17+ç§»é™¤äº‹ä»¶æ± 
function ModernEventExample() {
  const handleClick = (e) => {
    // ä¸éœ€è¦persistï¼Œå¯ä»¥ç›´æ¥å¼‚æ­¥è®¿é—®
    setTimeout(() => {
      console.log(e.type); // 'click'
    }, 1000);

    // å¯ä»¥ä¿å­˜äº‹ä»¶å¯¹è±¡å¼•ç”¨
    const eventType = e.type;
    fetchData().then(() => {
      console.log(eventType); // 'click'
    });
  };

  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// ä¸ºä»€ä¹ˆç§»é™¤äº‹ä»¶æ± ï¼š
// 1. ç°ä»£æµè§ˆå™¨æ€§èƒ½æå‡ï¼Œåˆ›å»ºäº‹ä»¶å¯¹è±¡æˆæœ¬é™ä½
// 2. ç®€åŒ–å¿ƒæ™ºæ¨¡å‹ï¼Œé¿å…persistçš„å›°æƒ‘
// 3. æ›´ç¬¦åˆå¼€å‘è€…é¢„æœŸï¼Œå‡å°‘bug
// 4. ä¸åŸç”Ÿäº‹ä»¶è¡Œä¸ºä¸€è‡´
```

### 3. Reactäº‹ä»¶ä¼˜åŒ–

#### é¢˜ç›®1ï¼šå¦‚ä½•ä¼˜åŒ–Reactä¸­çš„äº‹ä»¶å¤„ç†æ€§èƒ½ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
Reactä¸­äº‹ä»¶å¤„ç†çš„æ€§èƒ½ä¼˜åŒ–ä¸»è¦å›´ç»•"é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“"ã€‚å°±åƒé¿å…é‡å¤åšåŒæ ·çš„å·¥ä½œä¸€æ ·ï¼šç”¨useCallbackç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç”¨React.memoé¿å…å­ç»„ä»¶æ— æ„ä¹‰çš„é‡æ¸²æŸ“ï¼Œç”¨äº‹ä»¶å§”æ‰˜å¤„ç†å¤§é‡å…ƒç´ ï¼Œç”¨é˜²æŠ–èŠ‚æµæ§åˆ¶è§¦å‘é¢‘ç‡ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- useCallback: https://zh-hans.react.dev/reference/react/useCallback
- React.memo: https://zh-hans.react.dev/reference/react/memo
- useMemo: https://zh-hans.react.dev/reference/react/useMemo
```javascript
// 1. ä½¿ç”¨useCallbackç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
function OptimizedComponent() {
  const [count, setCount] = useState(0);
  const [text, setText] = useState('');

  // æ²¡æœ‰ä¼˜åŒ–ï¼šæ¯æ¬¡renderåˆ›å»ºæ–°å‡½æ•°
  const handleClick = () => {
    setCount(count + 1);
  };

  // ä½¿ç”¨useCallbackä¼˜åŒ–
  const handleClickOptimized = useCallback(() => {
    setCount(prev => prev + 1);
  }, []); // ä¾èµ–é¡¹ä¸ºç©ºï¼Œå‡½æ•°æ°¸ä¸æ”¹å˜

  // ä¾èµ–ç‰¹å®šå€¼çš„å¤„ç†å‡½æ•°
  const handleTextChange = useCallback((e) => {
    setText(e.target.value);
    // å¤„ç†ä¾èµ–textçš„é€»è¾‘
  }, [text]);

  return (
    <div>
      <ExpensiveChild onClick={handleClickOptimized} />
      <input value={text} onChange={handleTextChange} />
    </div>
  );
}

// 2. ä½¿ç”¨React.memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const ExpensiveChild = React.memo(({ onClick }) => {
  console.log('ExpensiveChild render');
  return <button onClick={onClick}>ç‚¹å‡»</button>;
});

// 3. äº‹ä»¶å§”æ‰˜ä¼˜åŒ–å¤§é‡å…ƒç´ 
function ListWithDelegation() {
  const [items, setItems] = useState(Array.from({ length: 1000 }, (_, i) => ({
    id: i,
    text: `Item ${i}`
  })));

  // ä½¿ç”¨äº‹ä»¶å§”æ‰˜è€Œä¸æ˜¯ä¸ºæ¯ä¸ªitemç»‘å®šäº‹ä»¶
  const handleClick = useCallback((e) => {
    const id = e.target.dataset.id;
    if (id) {
      console.log('Clicked item:', id);
    }
  }, []);

  return (
    <ul onClick={handleClick}>
      {items.map(item => (
        <li key={item.id} data-id={item.id}>
          {item.text}
        </li>
      ))}
    </ul>
  );
}

// 4. é˜²æŠ–å’ŒèŠ‚æµ
function SearchComponent() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);

  // ä½¿ç”¨useMemoåˆ›å»ºé˜²æŠ–å‡½æ•°
  const debouncedSearch = useMemo(
    () => debounce((searchQuery) => {
      // æ‰§è¡Œæœç´¢
      fetchResults(searchQuery).then(setResults);
    }, 500),
    []
  );

  const handleSearch = useCallback((e) => {
    const value = e.target.value;
    setQuery(value);
    debouncedSearch(value);
  }, [debouncedSearch]);

  return (
    <div>
      <input value={query} onChange={handleSearch} placeholder="æœç´¢..." />
      <ResultsList results={results} />
    </div>
  );
}

// 5. ä½¿ç”¨refé¿å…é—­åŒ…é™·é˜±
function TimerComponent() {
  const [count, setCount] = useState(0);
  const countRef = useRef(count);

  useEffect(() => {
    countRef.current = count;
  }, [count]);

  const handleClick = useCallback(() => {
    setTimeout(() => {
      // ä½¿ç”¨refè·å–æœ€æ–°å€¼ï¼Œé¿å…é—­åŒ…é™·é˜±
      console.log('Current count:', countRef.current);
      setCount(countRef.current + 1);
    }, 3000);
  }, []); // ä¾èµ–é¡¹ä¸ºç©ºï¼Œä½†ä»èƒ½è·å–æœ€æ–°çš„count

  return (
    <button onClick={handleClick}>Count: {count}</button>
  );
}
```

### 4. Reactäº‹ä»¶ç›¸å…³Hooks

#### é¢˜ç›®1ï¼šå¦‚ä½•ä½¿ç”¨Hookså¤„ç†å¤æ‚çš„äº‹ä»¶é€»è¾‘ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
è‡ªå®šä¹‰Hookæ˜¯å°è£…å¤æ‚äº‹ä»¶é€»è¾‘çš„æœ€ä½³æ–¹å¼ï¼Œå°±åƒæŠŠå¸¸ç”¨çš„åŠŸèƒ½æ‰“åŒ…æˆ"å·¥å…·ç®±"ã€‚æ¯”å¦‚ç›‘å¬é¼ æ ‡ç§»åŠ¨ã€ç‚¹å‡»å¤–éƒ¨å…³é—­ã€æŒ‰é”®ç›‘å¬ç­‰ï¼Œéƒ½å¯ä»¥å°è£…æˆHookï¼Œåœ¨ä¸åŒç»„ä»¶ä¸­å¤ç”¨ã€‚å…³é”®æ˜¯è¦æ­£ç¡®å¤„ç†äº‹ä»¶çš„ç»‘å®šå’Œæ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

**ç­”æ¡ˆï¼š**
**å®˜æ–¹æ–‡æ¡£ï¼š**
- è‡ªå®šä¹‰Hook: https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks
- useEffect: https://zh-hans.react.dev/reference/react/useEffect
- useRef: https://zh-hans.react.dev/reference/react/useRef
```javascript
// 1. è‡ªå®šä¹‰Hookå°è£…äº‹ä»¶é€»è¾‘
function useEventListener(eventName, handler, element = window) {
  const savedHandler = useRef();

  useEffect(() => {
    savedHandler.current = handler;
  }, [handler]);

  useEffect(() => {
    const isSupported = element && element.addEventListener;
    if (!isSupported) return;

    const eventListener = (event) => savedHandler.current(event);
    element.addEventListener(eventName, eventListener);

    return () => {
      element.removeEventListener(eventName, eventListener);
    };
  }, [eventName, element]);
}

// ä½¿ç”¨ç¤ºä¾‹
function Component() {
  const [coords, setCoords] = useState({ x: 0, y: 0 });

  useEventListener('mousemove', (e) => {
    setCoords({ x: e.clientX, y: e.clientY });
  });

  return <div>é¼ æ ‡ä½ç½®: {coords.x}, {coords.y}</div>;
}

// 2. useClickOutside Hook
function useClickOutside(ref, callback) {
  useEffect(() => {
    function handleClickOutside(event) {
      if (ref.current && !ref.current.contains(event.target)) {
        callback();
      }
    }

    document.addEventListener('mousedown', handleClickOutside);
    document.addEventListener('touchstart', handleClickOutside);

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
      document.removeEventListener('touchstart', handleClickOutside);
    };
  }, [ref, callback]);
}

// ä½¿ç”¨ç¤ºä¾‹
function Dropdown() {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef();

  useClickOutside(dropdownRef, () => {
    setIsOpen(false);
  });

  return (
    <div ref={dropdownRef}>
      <button onClick={() => setIsOpen(!isOpen)}>
        Toggle Dropdown
      </button>
      {isOpen && <div>Dropdown Content</div>}
    </div>
  );
}

// 3. useKeyPress Hook
function useKeyPress(targetKey, callback) {
  const [keyPressed, setKeyPressed] = useState(false);

  useEffect(() => {
    function downHandler({ key }) {
      if (key === targetKey) {
        setKeyPressed(true);
        callback && callback();
      }
    }

    function upHandler({ key }) {
      if (key === targetKey) {
        setKeyPressed(false);
      }
    }

    window.addEventListener('keydown', downHandler);
    window.addEventListener('keyup', upHandler);

    return () => {
      window.removeEventListener('keydown', downHandler);
      window.removeEventListener('keyup', upHandler);
    };
  }, [targetKey, callback]);

  return keyPressed;
}

// ä½¿ç”¨ç¤ºä¾‹
function Game() {
  const arrowUpPressed = useKeyPress('ArrowUp', () => {
    console.log('å‘ä¸Šç§»åŠ¨');
  });

  return (
    <div>
      {arrowUpPressed && <div>æ­£åœ¨æŒ‰ä¸Šç®­å¤´</div>}
    </div>
  );
}

// 4. useLongPress Hook
function useLongPress(callback, delay = 500) {
  const [startLongPress, setStartLongPress] = useState(false);
  const timeout = useRef();

  useEffect(() => {
    if (startLongPress) {
      timeout.current = setTimeout(callback, delay);
    } else {
      timeout.current && clearTimeout(timeout.current);
    }

    return () => {
      timeout.current && clearTimeout(timeout.current);
    };
  }, [startLongPress, callback, delay]);

  return {
    onMouseDown: () => setStartLongPress(true),
    onMouseUp: () => setStartLongPress(false),
    onMouseLeave: () => setStartLongPress(false),
    onTouchStart: () => setStartLongPress(true),
    onTouchEnd: () => setStartLongPress(false),
  };
}

// ä½¿ç”¨ç¤ºä¾‹
function LongPressButton() {
  const longPressProps = useLongPress(() => {
    alert('é•¿æŒ‰è§¦å‘ï¼');
  }, 1000);

  return (
    <button {...longPressProps}>
      é•¿æŒ‰æˆ‘
    </button>
  );
}
```

## å››ã€æ¡†æ¶äº‹ä»¶æœºåˆ¶å¯¹æ¯” â­â­â­

### 1. ä¸‰å¤§æ¡†æ¶äº‹ä»¶æœºåˆ¶å¯¹æ¯”
#### çƒ­åº¦ï¼šâ­â­â­

#### é¢˜ç›®1ï¼šVueã€Reactã€åŸç”ŸJavaScriptäº‹ä»¶æœºåˆ¶çš„åŒºåˆ«ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å¯¹æ¯”é¢˜ã€‚ç®€å•è¯´ï¼šåŸç”ŸJavaScriptæœ€åŸºç¡€ä½†æœ€çµæ´»ï¼›Vueæä¾›äº†ä¸°å¯Œçš„äº‹ä»¶ä¿®é¥°ç¬¦ï¼Œå†™èµ·æ¥å¾ˆç®€æ´ï¼›Reactç”¨åˆæˆäº‹ä»¶ç»Ÿä¸€äº†æµè§ˆå™¨å·®å¼‚ï¼Œä½†è¯­æ³•ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ç‰¹è‰²ï¼Œé€‰æ‹©å“ªä¸ªä¸»è¦çœ‹é¡¹ç›®éœ€æ±‚å’Œå›¢é˜Ÿåå¥½ã€‚

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§ | åŸç”ŸJavaScript | Vue | React |
|------|---------------|-----|-------|
| **äº‹ä»¶ç³»ç»Ÿ** | åŸç”ŸDOMäº‹ä»¶ | åŸç”ŸDOMäº‹ä»¶ + è‡ªå®šä¹‰äº‹ä»¶ | åˆæˆäº‹ä»¶ç³»ç»Ÿ |
| **äº‹ä»¶ç»‘å®š** | addEventListener | @äº‹ä»¶å æˆ– v-on | onäº‹ä»¶åï¼ˆé©¼å³°ï¼‰ |
| **äº‹ä»¶å§”æ‰˜** | æ‰‹åŠ¨å®ç° | è‡ªåŠ¨ï¼ˆç»„ä»¶çº§ï¼‰ | è‡ªåŠ¨ï¼ˆæ ¹å®¹å™¨çº§ï¼‰ |
| **äº‹ä»¶å¯¹è±¡** | åŸç”ŸEvent | åŸç”ŸEvent | SyntheticEvent |
| **é˜»æ­¢å†’æ³¡** | stopPropagation() | .stopä¿®é¥°ç¬¦ | stopPropagation() |
| **é˜»æ­¢é»˜è®¤** | preventDefault() | .preventä¿®é¥°ç¬¦ | preventDefault() |
| **äº‹ä»¶ä¿®é¥°ç¬¦** | æ—  | ä¸°å¯Œçš„ä¿®é¥°ç¬¦ | æ—  |
| **è‡ªå®šä¹‰äº‹ä»¶** | CustomEvent | $emit | é€šè¿‡propså›è°ƒ |

```javascript
// åŸç”ŸJavaScript
element.addEventListener('click', (e) => {
  e.stopPropagation();
  e.preventDefault();
});

// Vue
<button @click.stop.prevent="handleClick">ç‚¹å‡»</button>

// React
<button onClick={(e) => {
  e.stopPropagation();
  e.preventDefault();
}}>ç‚¹å‡»</button>
```

#### é¢˜ç›®2ï¼šä¸åŒæ¡†æ¶ä¸­å®ç°ç›¸åŒåŠŸèƒ½çš„å¯¹æ¯”

**é€šä¿—æ¦‚è¿°ï¼š**
é€šè¿‡å®é™…ä¾‹å­æ¥å¯¹æ¯”ä¸åŒæ¡†æ¶çš„å†™æ³•å·®å¼‚ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ªåˆ é™¤ç¡®è®¤åŠŸèƒ½ã€‚å¯ä»¥çœ‹å‡ºï¼šåŸç”ŸJavaScriptä»£ç æœ€å¤šä½†æœ€ç›´æ¥ï¼›Vueçš„æ¨¡æ¿è¯­æ³•å¾ˆç›´è§‚ï¼›Reactçš„å‡½æ•°å¼å†™æ³•å¾ˆç°ä»£ã€‚æ¯ç§å†™æ³•éƒ½æœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼Œå…³é”®æ˜¯è¦ç†è§£å„è‡ªçš„è®¾è®¡æ€è·¯ã€‚

**ç­”æ¡ˆï¼š**
```javascript
// åŠŸèƒ½ï¼šå®ç°ä¸€ä¸ªå¸¦ç¡®è®¤çš„åˆ é™¤æŒ‰é’®

// åŸç”ŸJavaScript
document.getElementById('deleteBtn').addEventListener('click', function(e) {
  e.preventDefault();
  if (confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
    deleteItem(this.dataset.id);
  }
});

// Vue 3
<template>
  <button @click="handleDelete" :data-id="item.id">
    åˆ é™¤
  </button>
</template>

<script>
export default {
  methods: {
    handleDelete(e) {
      if (confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
        this.deleteItem(e.target.dataset.id);
      }
    }
  }
};
</script>

// React
function DeleteButton({ itemId, onDelete }) {
  const handleClick = useCallback(() => {
    if (confirm('ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ')) {
      onDelete(itemId);
    }
  }, [itemId, onDelete]);

  return (
    <button onClick={handleClick}>
      åˆ é™¤
    </button>
  );
}

// åŠŸèƒ½ï¼šå®ç°è¾“å…¥æ¡†å®æ—¶æœç´¢ï¼ˆå¸¦é˜²æŠ–ï¼‰

// åŸç”ŸJavaScript
let timer = null;
const input = document.getElementById('search');
input.addEventListener('input', function(e) {
  clearTimeout(timer);
  timer = setTimeout(() => {
    search(e.target.value);
  }, 500);
});

// Vue 3 Composition API
<template>
  <input v-model="searchQuery" @input="debouncedSearch">
</template>

<script>
import { ref } from 'vue';
import { debounce } from 'lodash';

export default {
  setup() {
    const searchQuery = ref('');

    const debouncedSearch = debounce((e) => {
      search(e.target.value);
    }, 500);

    return {
      searchQuery,
      debouncedSearch
    };
  }
};
</script>

// React
function SearchInput() {
  const [query, setQuery] = useState('');

  const debouncedSearch = useMemo(
    () => debounce((value) => {
      search(value);
    }, 500),
    []
  );

  const handleChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    debouncedSearch(value);
  };

  return (
    <input value={query} onChange={handleChange} />
  );
}
```

### 2. é¢è¯•é«˜é¢‘é—®é¢˜æ€»ç»“

#### é¢˜ç›®1ï¼šäº‹ä»¶å¤„ç†ç›¸å…³çš„å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
äº‹ä»¶å¤„ç†ä¸­æœ€å¸¸è§çš„æ€§èƒ½é—®é¢˜å°±æ˜¯"å¤ªå¤š"å’Œ"å¤ªé¢‘ç¹"ï¼šå¤ªå¤šäº‹ä»¶ç›‘å¬å™¨ä¼šå ç”¨å†…å­˜ï¼Œå¤ªé¢‘ç¹çš„äº‹ä»¶è§¦å‘ä¼šå¡é¡¿é¡µé¢ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯"åˆå¹¶"å’Œ"æ§åˆ¶"ï¼šç”¨äº‹ä»¶å§”æ‰˜åˆå¹¶å¤šä¸ªç›‘å¬å™¨ï¼Œç”¨é˜²æŠ–èŠ‚æµæ§åˆ¶è§¦å‘é¢‘ç‡ï¼ŒåŠæ—¶æ¸…ç†ä¸ç”¨çš„ç›‘å¬å™¨é¿å…å†…å­˜æ³„æ¼ã€‚

**ç­”æ¡ˆï¼š**
```javascript
// 1. å¤§é‡äº‹ä»¶ç›‘å¬å™¨é—®é¢˜
// é—®é¢˜ï¼šä¸º1000ä¸ªæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
// è§£å†³ï¼šä½¿ç”¨äº‹ä»¶å§”æ‰˜

// ä¸å¥½
for (let i = 0; i < 1000; i++) {
  document.getElementById(`btn-${i}`).addEventListener('click', handleClick);
}

// å¥½
document.getElementById('container').addEventListener('click', (e) => {
  if (e.target.matches('.btn')) {
    handleClick(e);
  }
});

// 2. é¢‘ç¹è§¦å‘çš„äº‹ä»¶
// é—®é¢˜ï¼šscrollã€resizeã€mousemoveç­‰äº‹ä»¶è§¦å‘é¢‘ç‡è¿‡é«˜
// è§£å†³ï¼šé˜²æŠ–æˆ–èŠ‚æµ

// é˜²æŠ– - é€‚åˆè¾“å…¥æ¡†æœç´¢
const debounce = (fn, delay) => {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn(...args), delay);
  };
};

// èŠ‚æµ - é€‚åˆæ»šåŠ¨ã€æ‹–æ‹½
const throttle = (fn, delay) => {
  let last = 0;
  return (...args) => {
    const now = Date.now();
    if (now - last >= delay) {
      fn(...args);
      last = now;
    }
  };
};

// 3. å†…å­˜æ³„æ¼é—®é¢˜
// é—®é¢˜ï¼šæœªåŠæ—¶ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
// è§£å†³ï¼šç»„ä»¶å¸è½½æ—¶æ¸…ç†

// React
useEffect(() => {
  const handler = () => {};
  window.addEventListener('resize', handler);
  return () => {
    window.removeEventListener('resize', handler);
  };
}, []);

// Vue
export default {
  mounted() {
    window.addEventListener('resize', this.handleResize);
  },
  beforeUnmount() {
    window.removeEventListener('resize', this.handleResize);
  }
};

// 4. äº‹ä»¶å¤„ç†å‡½æ•°é‡å¤åˆ›å»º
// é—®é¢˜ï¼šæ¯æ¬¡renderåˆ›å»ºæ–°å‡½æ•°
// è§£å†³ï¼šä½¿ç”¨useCallbackæˆ–å°†å‡½æ•°å®šä¹‰åœ¨ç»„ä»¶å¤–

// React - ä½¿ç”¨useCallback
const handleClick = useCallback(() => {
  // å¤„ç†é€»è¾‘
}, [dependencies]);

// Vue - æ–¹æ³•è‡ªåŠ¨ç¼“å­˜
methods: {
  handleClick() {
    // å¤„ç†é€»è¾‘
  }
}
```

#### é¢˜ç›®2ï¼šè·¨æ¡†æ¶çš„äº‹ä»¶é€šä¿¡å¦‚ä½•å®ç°ï¼Ÿ

**é€šä¿—æ¦‚è¿°ï¼š**
å½“ä¸€ä¸ªé¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨å¤šä¸ªæ¡†æ¶æ—¶ï¼ˆæ¯”å¦‚Vueå’ŒReactå…±å­˜ï¼‰ï¼Œå®ƒä»¬ä¹‹é—´çš„é€šä¿¡å°±éœ€è¦ç”¨åˆ°"ä¸­é—´äºº"ã€‚æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨åŸç”Ÿçš„CustomEventæˆ–è€…å…¨å±€äº‹ä»¶æ€»çº¿ï¼Œå°±åƒä¸åŒè¯­è¨€çš„äººé€šè¿‡ç¿»è¯‘å®˜äº¤æµä¸€æ ·ã€‚è¿˜å¯ä»¥ç”¨PostMessageè¿›è¡Œiframeé—´çš„é€šä¿¡ã€‚

**ç­”æ¡ˆï¼š**
```javascript
// ä½¿ç”¨åŸç”ŸCustomEventå®ç°è·¨æ¡†æ¶é€šä¿¡

// äº‹ä»¶æ€»çº¿
class CrossFrameworkEventBus {
  constructor() {
    this.element = document.createElement('div');
    document.body.appendChild(this.element);
  }

  emit(eventName, data) {
    const event = new CustomEvent(eventName, {
      detail: data,
      bubbles: true,
      cancelable: true
    });
    this.element.dispatchEvent(event);
  }

  on(eventName, callback) {
    this.element.addEventListener(eventName, (e) => {
      callback(e.detail);
    });
  }

  off(eventName, callback) {
    this.element.removeEventListener(eventName, callback);
  }
}

const globalBus = new CrossFrameworkEventBus();

// Reactç»„ä»¶ä¸­ä½¿ç”¨
function ReactComponent() {
  useEffect(() => {
    const handler = (data) => {
      console.log('React received:', data);
    };

    globalBus.on('vue-message', handler);

    return () => {
      globalBus.off('vue-message', handler);
    };
  }, []);

  const sendMessage = () => {
    globalBus.emit('react-message', { from: 'React' });
  };

  return <button onClick={sendMessage}>Send from React</button>;
}

// Vueç»„ä»¶ä¸­ä½¿ç”¨
export default {
  mounted() {
    globalBus.on('react-message', this.handleReactMessage);
  },
  beforeUnmount() {
    globalBus.off('react-message', this.handleReactMessage);
  },
  methods: {
    handleReactMessage(data) {
      console.log('Vue received:', data);
    },
    sendMessage() {
      globalBus.emit('vue-message', { from: 'Vue' });
    }
  }
};

// ä½¿ç”¨PostMessageè¿›è¡Œiframeé€šä¿¡
// çˆ¶çª—å£
window.addEventListener('message', (e) => {
  if (e.origin !== 'https://trusted-origin.com') return;
  console.log('Received:', e.data);
});

iframe.contentWindow.postMessage({ type: 'HELLO' }, '*');

// å­çª—å£ï¼ˆiframeï¼‰
window.addEventListener('message', (e) => {
  if (e.data.type === 'HELLO') {
    e.source.postMessage({ type: 'RESPONSE' }, e.origin);
  }
});
```

## äº”ã€ç»å…¸é¢è¯•é¢˜å®æˆ˜ â­â­â­â­â­

### é¢˜ç›®1ï¼šå®ç°ä¸€ä¸ªå®Œæ•´çš„æ‹–æ‹½åŠŸèƒ½ â­â­â­â­â­

**é€šä¿—æ¦‚è¿°ï¼š**
æ‹–æ‹½åŠŸèƒ½æ˜¯å‰ç«¯å¼€å‘ä¸­çš„ç»å…¸éœ€æ±‚ï¼Œè€ƒæŸ¥å¯¹é¼ æ ‡äº‹ä»¶ã€åæ ‡è®¡ç®—ã€çŠ¶æ€ç®¡ç†çš„ç»¼åˆè¿ç”¨ã€‚å…³é”®ç‚¹æ˜¯ï¼šç›‘å¬mousedownå¼€å§‹æ‹–æ‹½ï¼Œmousemoveæ›´æ–°ä½ç½®ï¼Œmouseupç»“æŸæ‹–æ‹½ã€‚è¿˜è¦è€ƒè™‘è§¦æ‘¸è®¾å¤‡çš„å…¼å®¹æ€§ã€‚Reactä¸­å¯ä»¥å°è£…æˆè‡ªå®šä¹‰Hookï¼Œè®©é€»è¾‘æ›´æ¸…æ™°ã€‚

**ç­”æ¡ˆï¼š**
```javascript
// åŸç”ŸJavaScriptå®ç°
class Draggable {
  constructor(element) {
    this.element = element;
    this.isDragging = false;
    this.currentX = 0;
    this.currentY = 0;
    this.initialX = 0;
    this.initialY = 0;
    this.xOffset = 0;
    this.yOffset = 0;

    this.init();
  }

  init() {
    this.element.addEventListener('mousedown', this.dragStart.bind(this));
    document.addEventListener('mousemove', this.drag.bind(this));
    document.addEventListener('mouseup', this.dragEnd.bind(this));

    // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
    this.element.addEventListener('touchstart', this.dragStart.bind(this));
    document.addEventListener('touchmove', this.drag.bind(this));
    document.addEventListener('touchend', this.dragEnd.bind(this));
  }

  dragStart(e) {
    e.preventDefault();

    if (e.type === 'touchstart') {
      this.initialX = e.touches[0].clientX - this.xOffset;
      this.initialY = e.touches[0].clientY - this.yOffset;
    } else {
      this.initialX = e.clientX - this.xOffset;
      this.initialY = e.clientY - this.yOffset;
    }

    if (e.target === this.element) {
      this.isDragging = true;
      this.element.classList.add('dragging');
    }
  }

  drag(e) {
    if (!this.isDragging) return;

    e.preventDefault();

    if (e.type === 'touchmove') {
      this.currentX = e.touches[0].clientX - this.initialX;
      this.currentY = e.touches[0].clientY - this.initialY;
    } else {
      this.currentX = e.clientX - this.initialX;
      this.currentY = e.clientY - this.initialY;
    }

    this.xOffset = this.currentX;
    this.yOffset = this.currentY;

    this.setTranslate(this.currentX, this.currentY);
  }

  dragEnd(e) {
    this.initialX = this.currentX;
    this.initialY = this.currentY;
    this.isDragging = false;
    this.element.classList.remove('dragging');
  }

  setTranslate(xPos, yPos) {
    this.element.style.transform = `translate(${xPos}px, ${yPos}px)`;
  }
}

// React Hookå®ç°
function useDraggable() {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [isDragging, setIsDragging] = useState(false);
  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });

  const handleMouseDown = useCallback((e) => {
    setIsDragging(true);
    setDragStart({
      x: e.clientX - position.x,
      y: e.clientY - position.y
    });
  }, [position]);

  useEffect(() => {
    if (!isDragging) return;

    const handleMouseMove = (e) => {
      setPosition({
        x: e.clientX - dragStart.x,
        y: e.clientY - dragStart.y
      });
    };

    const handleMouseUp = () => {
      setIsDragging(false);
    };

    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);

    return () => {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
    };
  }, [isDragging, dragStart]);

  return {
    position,
    isDragging,
    handleMouseDown,
    style: {
      transform: `translate(${position.x}px, ${position.y}px)`,
      cursor: isDragging ? 'grabbing' : 'grab'
    }
  };
}

// ä½¿ç”¨
function DraggableComponent() {
  const { position, isDragging, handleMouseDown, style } = useDraggable();

  return (
    <div
      onMouseDown={handleMouseDown}
      style={style}
      className={isDragging ? 'dragging' : ''}
    >
      æ‹–æ‹½æˆ‘
    </div>
  );
}
```

### é¢˜ç›®2ï¼šå®ç°ä¸€ä¸ªå›¾ç‰‡æ‡’åŠ è½½åŠŸèƒ½

**é€šä¿—æ¦‚è¿°ï¼š**
å›¾ç‰‡æ‡’åŠ è½½æ˜¯ä¼˜åŒ–é¡µé¢æ€§èƒ½çš„é‡è¦æ‰‹æ®µï¼Œåªæœ‰å½“å›¾ç‰‡è¿›å…¥è§†å£æ—¶æ‰å¼€å§‹åŠ è½½ã€‚ç°ä»£åšæ³•æ˜¯ä½¿ç”¨IntersectionObserver APIï¼Œæ¯”ä¼ ç»Ÿçš„scrolläº‹ä»¶ç›‘å¬æ€§èƒ½æ›´å¥½ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼šè§‚å¯Ÿå›¾ç‰‡å…ƒç´ ï¼Œå½“è¿›å…¥å¯è§†åŒºåŸŸæ—¶ï¼Œå°†data-srcèµ‹å€¼ç»™srcå±æ€§å¼€å§‹åŠ è½½ã€‚

**ç­”æ¡ˆï¼š**
```javascript
// ä½¿ç”¨IntersectionObserverå®ç°
class LazyLoad {
  constructor(options = {}) {
    this.options = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1,
      ...options
    };

    this.observer = null;
    this.init();
  }

  init() {
    if (!('IntersectionObserver' in window)) {
      // é™çº§å¤„ç†
      this.loadAllImages();
      return;
    }

    this.observer = new IntersectionObserver(
      this.handleIntersection.bind(this),
      this.options
    );

    this.observeImages();
  }

  observeImages() {
    const images = document.querySelectorAll('[data-src]');
    images.forEach(img => this.observer.observe(img));
  }

  handleIntersection(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        this.loadImage(entry.target);
        this.observer.unobserve(entry.target);
      }
    });
  }

  loadImage(img) {
    const src = img.dataset.src;
    if (!src) return;

    // åˆ›å»ºæ–°å›¾ç‰‡å¯¹è±¡é¢„åŠ è½½
    const tempImg = new Image();
    tempImg.onload = () => {
      img.src = src;
      img.classList.add('loaded');
      delete img.dataset.src;
    };
    tempImg.onerror = () => {
      img.classList.add('error');
    };
    tempImg.src = src;
  }

  loadAllImages() {
    const images = document.querySelectorAll('[data-src]');
    images.forEach(img => this.loadImage(img));
  }

  destroy() {
    if (this.observer) {
      this.observer.disconnect();
    }
  }
}

// Reactç»„ä»¶å®ç°
function LazyImage({ src, placeholder, alt, ...props }) {
  const [imageSrc, setImageSrc] = useState(placeholder);
  const [isLoading, setIsLoading] = useState(true);
  const imgRef = useRef(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = new Image();
            img.onload = () => {
              setImageSrc(src);
              setIsLoading(false);
            };
            img.src = src;
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1 }
    );

    if (imgRef.current) {
      observer.observe(imgRef.current);
    }

    return () => {
      if (imgRef.current) {
        observer.unobserve(imgRef.current);
      }
    };
  }, [src]);

  return (
    <img
      ref={imgRef}
      src={imageSrc}
      alt={alt}
      className={isLoading ? 'loading' : 'loaded'}
      {...props}
    />
  );
}

// Vue 3æŒ‡ä»¤å®ç°
app.directive('lazy', {
  mounted(el, binding) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = binding.value;
          img.classList.add('loaded');
          observer.unobserve(img);
        }
      });
    });

    observer.observe(el);
    el._observer = observer;
  },
  unmounted(el) {
    if (el._observer) {
      el._observer.disconnect();
      delete el._observer;
    }
  }
});

// ä½¿ç”¨
<img v-lazy="imageSrc" alt="Lazy loaded image">
```

### é¢˜ç›®3ï¼šå®ç°ä¸€ä¸ªè™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨

**é€šä¿—æ¦‚è¿°ï¼š**
è™šæ‹Ÿæ»šåŠ¨æ˜¯å¤„ç†å¤§é‡æ•°æ®åˆ—è¡¨çš„ç»å…¸æ–¹æ¡ˆï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯"åªæ¸²æŸ“å¯è§çš„éƒ¨åˆ†"ã€‚å°±åƒçœ‹ä¹¦ä¸€æ ·ï¼Œä½ åªéœ€è¦çœ‹å½“å‰è¿™ä¸€é¡µï¼Œä¸éœ€è¦æŠŠæ•´æœ¬ä¹¦éƒ½æ‘Šå¼€ã€‚é€šè¿‡ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼ŒåŠ¨æ€è®¡ç®—å“ªäº›é¡¹ç›®åº”è¯¥æ˜¾ç¤ºï¼Œå¤§å¤§æå‡äº†æ€§èƒ½ã€‚

**ç­”æ¡ˆï¼š**
```javascript
// Reactå®ç°è™šæ‹Ÿæ»šåŠ¨
function VirtualList({ items, itemHeight, containerHeight, renderItem }) {
  const [scrollTop, setScrollTop] = useState(0);
  const containerRef = useRef(null);

  // è®¡ç®—å¯è§åŒºåŸŸçš„èµ·å§‹å’Œç»“æŸç´¢å¼•
  const startIndex = Math.floor(scrollTop / itemHeight);
  const endIndex = Math.min(
    items.length - 1,
    Math.floor((scrollTop + containerHeight) / itemHeight)
  );

  // å¯è§é¡¹
  const visibleItems = items.slice(startIndex, endIndex + 1);

  // æ€»é«˜åº¦
  const totalHeight = items.length * itemHeight;

  // åç§»é‡
  const offsetY = startIndex * itemHeight;

  const handleScroll = (e) => {
    setScrollTop(e.target.scrollTop);
  };

  return (
    <div
      ref={containerRef}
      style={{
        height: containerHeight,
        overflow: 'auto',
        position: 'relative'
      }}
      onScroll={handleScroll}
    >
      <div style={{ height: totalHeight, position: 'relative' }}>
        <div
          style={{
            transform: `translateY(${offsetY}px)`,
            position: 'absolute',
            top: 0,
            left: 0,
            right: 0
          }}
        >
          {visibleItems.map((item, index) => (
            <div
              key={startIndex + index}
              style={{ height: itemHeight }}
            >
              {renderItem(item, startIndex + index)}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// ä½¿ç”¨ç¤ºä¾‹
function App() {
  const items = Array.from({ length: 10000 }, (_, i) => ({
    id: i,
    text: `Item ${i}`
  }));

  return (
    <VirtualList
      items={items}
      itemHeight={50}
      containerHeight={500}
      renderItem={(item) => (
        <div style={{ padding: '10px', borderBottom: '1px solid #ccc' }}>
          {item.text}
        </div>
      )}
    />
  );
}
```

---

## ğŸ“š æ ¸å¿ƒçŸ¥è¯†ç‚¹é€Ÿè®°ï¼ˆ10åˆ†é’Ÿå¤ä¹ ç‰ˆï¼‰

### 1. äº‹ä»¶æµï¼ˆå¿…èƒŒï¼‰â­â­â­â­â­
```
âœ… ä¸‰ä¸ªé˜¶æ®µï¼šæ•è·é˜¶æ®µ â†’ ç›®æ ‡é˜¶æ®µ â†’ å†’æ³¡é˜¶æ®µ
âœ… ä¼ æ’­è·¯å¾„ï¼šwindow â†’ document â†’ html â†’ body â†’ ... â†’ ç›®æ ‡å…ƒç´  â†’ ... â†’ body â†’ html â†’ document â†’ window
âœ… é»˜è®¤é˜¶æ®µï¼šaddEventListener é»˜è®¤åœ¨å†’æ³¡é˜¶æ®µï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°falseï¼‰
âœ… è®°å¿†å£è¯€ï¼šå¤–åˆ°å†…ï¼ˆæ•è·ï¼‰â†’ åˆ°è¾¾ç›®æ ‡ â†’ å†…åˆ°å¤–ï¼ˆå†’æ³¡ï¼‰
```

### 2. äº‹ä»¶å§”æ‰˜ï¼ˆå¿…èƒŒï¼‰â­â­â­â­â­
```
âœ… å®šä¹‰ï¼šå°†äº‹ä»¶ç›‘å¬å™¨ç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šï¼Œåˆ©ç”¨äº‹ä»¶å†’æ³¡å¤„ç†å­å…ƒç´ äº‹ä»¶
âœ… åŸç†ï¼šäº‹ä»¶å†’æ³¡ + event.targetåˆ¤æ–­
âœ… ä¼˜ç‚¹ï¼šçˆ¶ä»£å­ã€å‡å†…å­˜ã€åŠ¨æ€ç»‘ï¼ˆæ–°å¢å­å…ƒç´ è‡ªåŠ¨æœ‰äº‹ä»¶ï¼‰
âœ… ç¼ºç‚¹ï¼šä¸æ”¯æŒä¸å†’æ³¡äº‹ä»¶ï¼ˆfocusã€blurã€loadã€scrollç­‰ï¼‰
âœ… å®ç°ï¼šparent.addEventListener â†’ åˆ¤æ–­e.target â†’ æ‰§è¡Œå¯¹åº”é€»è¾‘
```

### 3. äº‹ä»¶å¯¹è±¡å…³é”®å±æ€§ï¼ˆå¿…èƒŒï¼‰â­â­â­â­â­
```
âœ… targetï¼šè§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼ˆçœŸæ­£è¢«ç‚¹å‡»çš„ï¼‰
âœ… currentTargetï¼šç»‘å®šç›‘å¬å™¨çš„å…ƒç´ ï¼ˆthisæŒ‡å‘å®ƒï¼‰
âœ… typeï¼šäº‹ä»¶ç±»å‹ï¼ˆ'click'ã€'input'ç­‰ï¼‰
âœ… preventDefault()ï¼šé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆå¦‚é“¾æ¥è·³è½¬ï¼‰
âœ… stopPropagation()ï¼šé˜»æ­¢å†’æ³¡
âœ… stopImmediatePropagation()ï¼šç«‹å³åœæ­¢ä¼ æ’­ï¼ˆåŒçº§ç›‘å¬å™¨ä¹Ÿä¸æ‰§è¡Œï¼‰
```

### 4. addEventListener æ ¸å¿ƒå‚æ•°ï¼ˆå¿…èƒŒï¼‰â­â­â­â­â­
```
âœ… è¯­æ³•ï¼šaddEventListener(type, listener, options)
âœ… captureï¼šfalseå†’æ³¡ï¼ˆé»˜è®¤ï¼‰ã€trueæ•è·
âœ… onceï¼štrueåªè§¦å‘ä¸€æ¬¡ï¼ˆè‡ªåŠ¨ç§»é™¤ï¼‰
âœ… passiveï¼štrueä¸è°ƒç”¨preventDefaultï¼ˆä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ï¼‰
âœ… signalï¼šAbortSignalå¯¹è±¡ï¼ˆæ‰¹é‡ç§»é™¤äº‹ä»¶ï¼‰
```

### 5. è‡ªå®šä¹‰äº‹ä»¶ï¼ˆé‡è¦ï¼‰â­â­â­â­
```
âœ… åˆ›å»ºï¼šnew CustomEvent('äº‹ä»¶å', { detail: æ•°æ®, bubbles: true })
âœ… ç›‘å¬ï¼šaddEventListener('äº‹ä»¶å', handler)
âœ… è§¦å‘ï¼šdispatchEvent(äº‹ä»¶å¯¹è±¡)
âœ… è®°å¿†ï¼šåˆ›å»ºâ†’ç›‘å¬â†’è§¦å‘ï¼ˆä¸‰æ­¥èµ°ï¼‰
```

### 6. Vueäº‹ä»¶ä¿®é¥°ç¬¦ï¼ˆå¿…èƒŒï¼‰â­â­â­â­â­
```
âœ… .stopï¼šé˜»æ­¢å†’æ³¡
âœ… .preventï¼šé˜»æ­¢é»˜è®¤è¡Œä¸º
âœ… .captureï¼šæ•è·é˜¶æ®µè§¦å‘
âœ… .selfï¼šåªåœ¨è‡ªèº«è§¦å‘ï¼ˆä¸åŒ…æ‹¬å­å…ƒç´ ï¼‰
âœ… .onceï¼šåªè§¦å‘ä¸€æ¬¡
âœ… .passiveï¼šä¼˜åŒ–æ»šåŠ¨æ€§èƒ½
âœ… æŒ‰é”®ä¿®é¥°ç¬¦ï¼š.enterã€.tabã€.deleteã€.escã€.spaceç­‰
âœ… ç³»ç»Ÿä¿®é¥°ç¬¦ï¼š.ctrlã€.altã€.shiftã€.meta
```

### 7. Reactäº‹ä»¶ç‰¹ç‚¹ï¼ˆé‡è¦ï¼‰â­â­â­â­
```
âœ… åˆæˆäº‹ä»¶ï¼šç»Ÿä¸€åŒ…è£…åŸç”Ÿäº‹ä»¶ï¼ŒæŠ¹å¹³æµè§ˆå™¨å·®å¼‚
âœ… é©¼å³°å‘½åï¼šonClickã€onChangeï¼ˆåŸç”Ÿæ˜¯onclickã€onchangeï¼‰
âœ… äº‹ä»¶å§”æ‰˜ï¼šReact 17å‰ç»‘å®šåˆ°documentï¼ŒReact 17+ç»‘å®šåˆ°rootå®¹å™¨
âœ… äº‹ä»¶æ± ï¼šReact 16åŠä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨äº‹ä»¶æ± ï¼ˆ17+ç§»é™¤ï¼‰
âœ… thisç»‘å®šï¼šç±»ç»„ä»¶éœ€è¦æ‰‹åŠ¨ç»‘å®šthisï¼ˆä½¿ç”¨ç®­å¤´å‡½æ•°æˆ–bindï¼‰
```

### 8. æ€§èƒ½ä¼˜åŒ–ï¼ˆé‡è¦ï¼‰â­â­â­â­
```
âœ… äº‹ä»¶å§”æ‰˜ï¼šå‡å°‘ç›‘å¬å™¨æ•°é‡
âœ… é˜²æŠ–ï¼ˆdebounceï¼‰ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œé€‚åˆinputæœç´¢
âœ… èŠ‚æµï¼ˆthrottleï¼‰ï¼šå›ºå®šé¢‘ç‡æ‰§è¡Œï¼Œé€‚åˆscrollã€resize
âœ… passive: trueï¼šä¼˜åŒ–æ»šåŠ¨ã€è§¦æ‘¸äº‹ä»¶
âœ… åŠæ—¶ç§»é™¤ï¼šç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
```

---

## ğŸ”¥ é«˜é¢‘é¢è¯•é¢˜ TOP 15

### ç¬¬1é¢˜ï¼šä»€ä¹ˆæ˜¯äº‹ä»¶æµï¼Ÿäº‹ä»¶æµçš„ä¸‰ä¸ªé˜¶æ®µï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- äº‹ä»¶æµæ˜¯äº‹ä»¶åœ¨DOMæ ‘ä¸­çš„ä¼ æ’­é¡ºåº
- ä¸‰ä¸ªé˜¶æ®µï¼šæ•è·é˜¶æ®µï¼ˆå¤–â†’å†…ï¼‰ã€ç›®æ ‡é˜¶æ®µï¼ˆåˆ°è¾¾ç›®æ ‡ï¼‰ã€å†’æ³¡é˜¶æ®µï¼ˆå†…â†’å¤–ï¼‰
- å£è¯€ï¼š**æ•è·ç›®æ ‡å†’æ³¡**

### ç¬¬2é¢˜ï¼šä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- å°†äº‹ä»¶ç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šï¼Œåˆ©ç”¨äº‹ä»¶å†’æ³¡å¤„ç†å­å…ƒç´ äº‹ä»¶
- ä¼˜ç‚¹ï¼šçˆ¶ä»£å­ã€å‡å†…å­˜ã€åŠ¨æ€ç»‘
- ç¼ºç‚¹ï¼šä¸æ”¯æŒä¸å†’æ³¡äº‹ä»¶ã€å¯èƒ½è¯¯è§¦å‘
- åŸç†ï¼šäº‹ä»¶å†’æ³¡ + event.targetåˆ¤æ–­

### ç¬¬3é¢˜ï¼ševent.target å’Œ event.currentTarget çš„åŒºåˆ«ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- targetï¼šè§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼ˆçœŸæ­£è¢«ç‚¹å‡»çš„ï¼‰
- currentTargetï¼šç»‘å®šç›‘å¬å™¨çš„å…ƒç´ ï¼ˆthisæŒ‡å‘å®ƒï¼‰
- å£è¯€ï¼š**targetæ˜¯æºã€currentTargetæ˜¯ç»‘å®šè€…**

### ç¬¬4é¢˜ï¼šaddEventListener çš„ç¬¬ä¸‰ä¸ªå‚æ•°æœ‰å“ªäº›é€‰é¡¹ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- optionså¯¹è±¡ï¼š{ capture, once, passive, signal }
- captureï¼šfalseå†’æ³¡ï¼ˆé»˜è®¤ï¼‰ã€trueæ•è·
- onceï¼štrueåªè§¦å‘ä¸€æ¬¡
- passiveï¼štrueä¸è°ƒç”¨preventDefaultï¼ˆä¼˜åŒ–æ»šåŠ¨ï¼‰
- signalï¼šAbortSignalï¼ˆæ‰¹é‡ç§»é™¤ï¼‰

### ç¬¬5é¢˜ï¼šå¦‚ä½•é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸ºï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
```javascript
e.stopPropagation();           // é˜»æ­¢å†’æ³¡
e.preventDefault();            // é˜»æ­¢é»˜è®¤è¡Œä¸º
e.stopImmediatePropagation();  // ç«‹å³åœæ­¢ï¼ˆåŒçº§ä¹Ÿä¸æ‰§è¡Œï¼‰
return false;                  // onclickä¸­æœ‰æ•ˆï¼ŒaddEventListenerä¸­æ— æ•ˆ
```

### ç¬¬6é¢˜ï¼šVueäº‹ä»¶ä¿®é¥°ç¬¦æœ‰å“ªäº›ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- .stopï¼ˆé˜»æ­¢å†’æ³¡ï¼‰ã€.preventï¼ˆé˜»æ­¢é»˜è®¤ï¼‰ã€.captureï¼ˆæ•è·é˜¶æ®µï¼‰
- .selfï¼ˆåªè‡ªèº«è§¦å‘ï¼‰ã€.onceï¼ˆåªä¸€æ¬¡ï¼‰ã€.passiveï¼ˆä¼˜åŒ–æ»šåŠ¨ï¼‰
- æŒ‰é”®ï¼š.enterã€.tabã€.deleteã€.escã€.space
- ç³»ç»Ÿï¼š.ctrlã€.altã€.shiftã€.meta

### ç¬¬7é¢˜ï¼šReactåˆæˆäº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿâ­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- åˆæˆäº‹ä»¶æ˜¯Reactå¯¹åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨å°è£…
- ä¼˜ç‚¹ï¼šè·¨æµè§ˆå™¨å…¼å®¹ã€æ€§èƒ½ä¼˜åŒ–ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ã€äº‹ä»¶æ± å¤ç”¨
- React 17å‰ç»‘å®šåˆ°documentï¼Œ17+ç»‘å®šåˆ°rootå®¹å™¨

### ç¬¬8é¢˜ï¼šå¦‚ä½•å®ç°è‡ªå®šä¹‰äº‹ä»¶ï¼Ÿâ­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
```javascript
// åˆ›å»º
const event = new CustomEvent('myEvent', { detail: { data } });
// ç›‘å¬
element.addEventListener('myEvent', handler);
// è§¦å‘
element.dispatchEvent(event);
```

### ç¬¬9é¢˜ï¼šé˜²æŠ–å’ŒèŠ‚æµçš„åŒºåˆ«ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- é˜²æŠ–ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œé¢‘ç¹è§¦å‘åªæ‰§è¡Œæœ€åä¸€æ¬¡ï¼ˆinputæœç´¢ï¼‰
- èŠ‚æµï¼šå›ºå®šé¢‘ç‡æ‰§è¡Œï¼ˆscrollã€resizeï¼‰
- å£è¯€ï¼š**é˜²æŠ–ç­‰å¾…ã€èŠ‚æµé—´éš”**

### ç¬¬10é¢˜ï¼šaddEventListener å’Œ onclick çš„åŒºåˆ«ï¼Ÿâ­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- addEventListenerï¼šå¯ç»‘å®šå¤šä¸ªã€æ”¯æŒæ•è·/å†’æ³¡ã€æ”¯æŒoptions
- onclickï¼šåªèƒ½ç»‘å®šä¸€ä¸ªã€åªæ”¯æŒå†’æ³¡ã€ä¼šè¢«è¦†ç›–
- æ¨èï¼š**ç°ä»£å¼€å‘ç»Ÿä¸€ä½¿ç”¨addEventListener**

### ç¬¬11é¢˜ï¼šå“ªäº›äº‹ä»¶ä¸æ”¯æŒå†’æ³¡ï¼Ÿâ­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- focusã€blurï¼ˆä½¿ç”¨focusinã€focusoutä»£æ›¿ï¼‰
- loadã€unloadã€error
- mouseenterã€mouseleaveï¼ˆä½¿ç”¨mouseoverã€mouseoutä»£æ›¿ï¼‰
- scrollã€resizeï¼ˆè™½ç„¶æœ‰å†’æ³¡è¡Œä¸ºä½†ä¸å¸¸ç”¨ï¼‰

### ç¬¬12é¢˜ï¼šå¦‚ä½•å®ç°äº‹ä»¶å§”æ‰˜ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
```javascript
parent.addEventListener('click', (e) => {
  if (e.target.matches('.item')) {
    // å¤„ç†.itemçš„ç‚¹å‡»
  }
});
```

### ç¬¬13é¢˜ï¼šVueç»„ä»¶é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿâ­â­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- çˆ¶â†’å­ï¼šprops
- å­â†’çˆ¶ï¼š$emit
- è·¨çº§ï¼šprovide/injectã€Vuexã€Pinia
- å…„å¼Ÿï¼šäº‹ä»¶æ€»çº¿ã€Vuex

### ç¬¬14é¢˜ï¼šReactå¦‚ä½•è§£å†³äº‹ä»¶ä¸­thisæŒ‡å‘é—®é¢˜ï¼Ÿâ­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
```javascript
// æ–¹æ³•1ï¼šç®­å¤´å‡½æ•°ï¼ˆæ¨èï¼‰
handleClick = () => {}

// æ–¹æ³•2ï¼šbindç»‘å®š
constructor() { this.handleClick = this.handleClick.bind(this); }

// æ–¹æ³•3ï¼šç®­å¤´å‡½æ•°è°ƒç”¨
<button onClick={(e) => this.handleClick(e)}>
```

### ç¬¬15é¢˜ï¼špassiveé€‰é¡¹æœ‰ä»€ä¹ˆç”¨ï¼Ÿâ­â­â­â­
**å¿«é€Ÿç­”æ¡ˆï¼š**
- å‘Šè¯‰æµè§ˆå™¨ä¸ä¼šè°ƒç”¨preventDefault()ï¼Œå¯ç«‹å³æ»šåŠ¨
- ä¼˜åŒ–æ»šåŠ¨ã€è§¦æ‘¸äº‹ä»¶æ€§èƒ½ï¼Œé¿å…å¡é¡¿
- Chromeé»˜è®¤å°†touchstart/touchmoveè®¾ä¸ºpassive: true
- å¦‚éœ€é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¿…é¡»è®¾ç½®passive: false

---

## ğŸ’¡ ç­”é¢˜æ¨¡æ¿å’ŒæŠ€å·§

### ç­”é¢˜ç»“æ„ï¼ˆæ¨èï¼‰
```
1. ç®€çŸ­å®šä¹‰ï¼ˆä¸€å¥è¯è¯´æ¸…æ¥šæ˜¯ä»€ä¹ˆï¼‰
2. æ ¸å¿ƒåŸç†ï¼ˆæ€ä¹ˆå®ç°çš„ï¼‰
3. ä½¿ç”¨åœºæ™¯ï¼ˆä»€ä¹ˆæ—¶å€™ç”¨ï¼‰
4. ä¼˜ç¼ºç‚¹ï¼ˆå¦‚æœæœ‰ï¼‰
5. ä»£ç ç¤ºä¾‹ï¼ˆç®€æ´æ¸…æ™°ï¼‰
6. æ³¨æ„äº‹é¡¹ï¼ˆå‘ç‚¹ï¼‰
```

### é«˜åˆ†ç­”é¢˜æŠ€å·§

#### æŠ€å·§1ï¼šä½¿ç”¨è®°å¿†å£è¯€å¿«é€Ÿå›ç­”
```
âŒ å•Š...äº‹ä»¶æµ...å°±æ˜¯...äº‹ä»¶ä¼ æ’­...ç„¶å...
âœ… äº‹ä»¶æµæœ‰ä¸‰ä¸ªé˜¶æ®µï¼šæ•è·ã€ç›®æ ‡ã€å†’æ³¡ã€‚è®°ä½å£è¯€"å¤–åˆ°å†…å†åˆ°å¤–"ã€‚
   æ•è·ä»windowåˆ°ç›®æ ‡ï¼Œå†’æ³¡ä»ç›®æ ‡åˆ°windowã€‚
```

#### æŠ€å·§2ï¼šå¯¹æ¯”å›ç­”æ›´æ¸…æ™°
```
é—®ï¼šaddEventListener å’Œ onclick çš„åŒºåˆ«ï¼Ÿ
âœ… addEventListeneræ”¯æŒç»‘å®šå¤šä¸ªå¤„ç†å™¨ï¼Œonclickä¼šè¢«è¦†ç›–ï¼›
   addEventListenerå¯é€‰æ‹©æ•è·æˆ–å†’æ³¡é˜¶æ®µï¼Œonclickåªèƒ½å†’æ³¡ï¼›
   addEventListeneræ”¯æŒonceã€passiveç­‰é€‰é¡¹ï¼Œæ›´å¼ºå¤§ã€‚
   æ‰€ä»¥ç°ä»£å¼€å‘æ¨èç»Ÿä¸€ä½¿ç”¨addEventListenerã€‚
```

#### æŠ€å·§3ï¼šè”ç³»å®é™…é¡¹ç›®
```
é—®ï¼šäº‹ä»¶å§”æ‰˜çš„åº”ç”¨åœºæ™¯ï¼Ÿ
âœ… æˆ‘åœ¨é¡¹ç›®ä¸­ç”¨äº‹ä»¶å§”æ‰˜åšè¿‡å¾…åŠåˆ—è¡¨ï¼šæœ‰ä¸Šåƒä¸ªä»»åŠ¡é¡¹ï¼Œæ¯ä¸ªéƒ½æœ‰åˆ é™¤ã€ç¼–è¾‘æŒ‰é’®ã€‚
   å¦‚æœç»™æ¯ä¸ªæŒ‰é’®ç»‘å®šäº‹ä»¶ï¼Œå†…å­˜æ¶ˆè€—å¤§ã€‚
   æˆ‘åœ¨çˆ¶å®¹å™¨ç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œé€šè¿‡event.targetåˆ¤æ–­ç‚¹å‡»çš„æŒ‰é’®ç±»å‹ï¼Œ
   è¿™æ ·åªæœ‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ–°å¢ä»»åŠ¡ä¹Ÿè‡ªåŠ¨æœ‰äº‹ä»¶ã€‚
```

#### æŠ€å·§4ï¼šè¯´å‡ºåº•å±‚åŸç†
```
é—®ï¼šä¸ºä»€ä¹ˆpassiveå¯ä»¥ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ï¼Ÿ
âœ… æµè§ˆå™¨åœ¨å¤„ç†æ»šåŠ¨äº‹ä»¶æ—¶ï¼Œä¸ç¡®å®šæ˜¯å¦ä¼šè°ƒç”¨preventDefault()é˜»æ­¢æ»šåŠ¨ï¼Œ
   å¿…é¡»ç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆæ‰èƒ½å¼€å§‹æ»šåŠ¨ï¼Œå¯¼è‡´å¡é¡¿ã€‚
   è®¾ç½®passive: trueå‘Šè¯‰æµè§ˆå™¨ä¸ä¼šé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥ç«‹å³å¼€å§‹æ»šåŠ¨ï¼Œ
   ä»è€Œæå‡æ€§èƒ½ã€‚Chromeé»˜è®¤å°†touchstart/touchmoveè®¾ä¸ºpassive: trueã€‚
```

#### æŠ€å·§5ï¼šé¿å…å¸¸è§é”™è¯¯
```
âŒ return falseå¯ä»¥é˜»æ­¢å†’æ³¡
âœ… return falseåœ¨onclickä¸­æœ‰æ•ˆï¼Œä½†åœ¨addEventListenerä¸­æ— æ•ˆã€‚
   æ­£ç¡®åšæ³•æ˜¯ç”¨e.stopPropagation()ã€‚

âŒ æ‰€æœ‰äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡
âœ… focusã€blurã€loadç­‰äº‹ä»¶ä¸æ”¯æŒå†’æ³¡ã€‚
   å¯ä»¥ç”¨focusinã€focusoutæ›¿ä»£focusã€blurã€‚

âŒ targetå’ŒcurrentTargetæ˜¯ä¸€æ ·çš„
âœ… targetæ˜¯è§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼ŒcurrentTargetæ˜¯ç»‘å®šç›‘å¬å™¨çš„å…ƒç´ ã€‚
   åœ¨äº‹ä»¶å§”æ‰˜ä¸­ï¼Œtargetæ˜¯å­å…ƒç´ ï¼ŒcurrentTargetæ˜¯çˆ¶å…ƒç´ ã€‚
```

---

## ğŸ¯ è®°å¿†å£è¯€æ±‡æ€»

### äº‹ä»¶æµå£è¯€
```
æ•è·ç›®æ ‡å†’æ³¡ï¼ˆä¸‰é˜¶æ®µï¼‰
å¤–åˆ°å†…å†åˆ°å¤–ï¼ˆä¼ æ’­æ–¹å‘ï¼‰
æ•è·å°‘ç”¨ã€å†’æ³¡å¸¸ç”¨ï¼ˆå®é™…åº”ç”¨ï¼‰
```

### äº‹ä»¶å§”æ‰˜å£è¯€
```
çˆ¶ä»£å­ï¼ˆçˆ¶å…ƒç´ ä»£ç†å­å…ƒç´ ï¼‰
å‡å†…å­˜ï¼ˆåªéœ€ä¸€ä¸ªç›‘å¬å™¨ï¼‰
åŠ¨æ€ç»‘ï¼ˆæ–°å¢å…ƒç´ è‡ªåŠ¨æœ‰äº‹ä»¶ï¼‰
ç²¾ç¡®åˆ¤ï¼ˆevent.targetåˆ¤æ–­ç‚¹å‡»æºï¼‰
```

### é˜»æ­¢ä¼ æ’­å£è¯€
```
stopPropagationé˜»å†’æ³¡
preventDefaulté˜»é»˜è®¤
stopImmediatePropagationç«‹å³åœ
return falseçœ‹æƒ…å†µï¼ˆonclickæœ‰æ•ˆã€addEventListeneræ— æ•ˆï¼‰
```

### addEventListenerå£è¯€
```
ä¸‰å‚æ•°ï¼štypeã€listenerã€options
captureæ§åˆ¶é˜¶æ®µï¼ˆfalseå†’æ³¡ã€trueæ•è·ï¼‰
onceåªè§¦å‘ä¸€æ¬¡ï¼ˆè‡ªåŠ¨ç§»é™¤ï¼‰
passiveä¼˜åŒ–æ»šåŠ¨ï¼ˆä¸é˜»æ­¢é»˜è®¤ï¼‰
signalæ‰¹é‡ç§»é™¤ï¼ˆAbortControllerï¼‰
```

### äº‹ä»¶å¯¹è±¡å£è¯€
```
targetæ˜¯æºï¼ˆçœŸæ­£ç‚¹å‡»çš„ï¼‰
currentTargetæ˜¯ç»‘å®šè€…ï¼ˆthisæŒ‡å‘å®ƒï¼‰
typeæ˜¯ç±»å‹ï¼ˆclickã€inputç­‰ï¼‰
preventDefaulté˜»é»˜è®¤
stopPropagationé˜»å†’æ³¡
```

### è‡ªå®šä¹‰äº‹ä»¶å£è¯€
```
new CustomEventåˆ›å»º
addEventListenerç›‘å¬
dispatchEventè§¦å‘
è®°ä½ï¼šåˆ›å»ºâ†’ç›‘å¬â†’è§¦å‘ï¼ˆä¸‰æ­¥èµ°ï¼‰
```

### Vueäº‹ä»¶å£è¯€
```
@clickç»‘å®šã€.stopé˜»å†’æ³¡ã€.preventé˜»é»˜è®¤
.onceåªä¸€æ¬¡ã€.captureæ•è·ã€.selfåªè‡ªå·±
.enterå›è½¦ã€.escå–æ¶ˆã€.ctrlåŠ Ctrl
$emitå­ä¼ çˆ¶ã€propsçˆ¶ä¼ å­ã€provide/injectè·¨çº§ä¼ 
```

### Reactäº‹ä»¶å£è¯€
```
åˆæˆäº‹ä»¶ç»Ÿä¸€ç®¡ç†ï¼ˆSyntheticEventï¼‰
é©¼å³°å‘½åè¦è®°æ¸…ï¼ˆonClickã€onChangeï¼‰
thisç»‘å®šç”¨ç®­å¤´ï¼ˆæˆ–è€…constructorä¸­bindï¼‰
äº‹ä»¶æ± å·²ç§»é™¤ï¼ˆReact 17+ï¼‰
nativeEventè®¿é—®åŸç”Ÿï¼ˆe.nativeEventï¼‰
```

### æ€§èƒ½ä¼˜åŒ–å£è¯€
```
äº‹ä»¶å§”æ‰˜å‡ç›‘å¬
é˜²æŠ–ç­‰å¾…èŠ‚æµé—´éš”
passiveä¼˜åŒ–æ»šåŠ¨
åŠæ—¶ç§»é™¤é¿å…æ³„æ¼
```

---

## ğŸ“– æ€»ç»“

ä»¥ä¸Šå°±æ˜¯å‰ç«¯äº‹ä»¶æœºåˆ¶çš„é«˜é¢‘é¢è¯•é¢˜æ±‡æ€»ï¼Œæ¶µç›–äº†JavaScriptåŸç”Ÿäº‹ä»¶ã€Vueäº‹ä»¶ç³»ç»Ÿã€Reactäº‹ä»¶ç³»ç»Ÿç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚æŒæ¡è¿™äº›å†…å®¹å¯¹äºå‰ç«¯å¼€å‘å’Œé¢è¯•éƒ½éå¸¸é‡è¦ã€‚

### é‡ç‚¹æŒæ¡ï¼š
1. â­â­â­â­â­ **äº‹ä»¶æµçš„ä¸‰ä¸ªé˜¶æ®µå’Œäº‹ä»¶å§”æ‰˜åŸç†**ï¼ˆæœ€é«˜é¢‘ï¼‰
2. â­â­â­â­â­ **addEventListenerçš„å‚æ•°å’Œoptionsè¯¦è§£**ï¼ˆå¿…è€ƒï¼‰
3. â­â­â­â­â­ **äº‹ä»¶å¯¹è±¡çš„å¸¸ç”¨å±æ€§å’Œæ–¹æ³•**ï¼ˆåŸºç¡€ï¼‰
4. â­â­â­â­â­ **Vueçš„äº‹ä»¶ä¿®é¥°ç¬¦å’Œç»„ä»¶é€šä¿¡**ï¼ˆVueé¡¹ç›®å¿…å¤‡ï¼‰
5. â­â­â­â­ **Reactçš„åˆæˆäº‹ä»¶ç³»ç»Ÿ**ï¼ˆReacté¡¹ç›®å¿…å¤‡ï¼‰
6. â­â­â­â­ **è‡ªå®šä¹‰äº‹ä»¶å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼**ï¼ˆæ¶æ„è®¾è®¡ï¼‰
7. â­â­â­â­ **äº‹ä»¶æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼ˆé˜²æŠ–èŠ‚æµã€passiveï¼‰
8. â­â­â­ **è·¨æ¡†æ¶äº‹ä»¶é€šä¿¡æ–¹æ¡ˆ**ï¼ˆç»¼åˆåº”ç”¨ï¼‰

### å¤ä¹ å»ºè®®ï¼š
1. **ç¬¬1é**ï¼šé€šè¯»å…¨æ–‡ï¼Œç†è§£æ¦‚å¿µï¼ŒèƒŒè¯µè®°å¿†å£è¯€
2. **ç¬¬2é**ï¼šé‡ç‚¹æ”»å…‹é«˜é¢‘é¢˜TOP 15ï¼Œæ‰‹å†™ä»£ç å®ç°
3. **ç¬¬3é**ï¼šçœ‹æ ¸å¿ƒçŸ¥è¯†ç‚¹é€Ÿè®°ï¼Œ10åˆ†é’Ÿå¿«é€Ÿå¤ä¹ 
4. **é¢è¯•å‰**ï¼šçœ‹è®°å¿†å£è¯€æ±‡æ€»ï¼Œå¿«é€Ÿå”¤é†’è®°å¿†

### å­¦ä¹ è·¯å¾„ï¼š
```
åŸºç¡€ â†’ åŸç”Ÿäº‹ä»¶æœºåˆ¶ï¼ˆäº‹ä»¶æµã€äº‹ä»¶å§”æ‰˜ã€äº‹ä»¶å¯¹è±¡ï¼‰
    â†“
è¿›é˜¶ â†’ addEventListeneræ·±å…¥ï¼ˆoptionså‚æ•°è¯¦è§£ï¼‰
    â†“
æ¡†æ¶ â†’ Vueäº‹ä»¶æœºåˆ¶ï¼ˆä¿®é¥°ç¬¦ã€ç»„ä»¶é€šä¿¡ï¼‰
    â†“
æ¡†æ¶ â†’ Reactäº‹ä»¶æœºåˆ¶ï¼ˆåˆæˆäº‹ä»¶ã€thisç»‘å®šï¼‰
    â†“
å®æˆ˜ â†’ ç»å…¸é¢è¯•é¢˜ï¼ˆæ‹–æ‹½ã€é˜²æŠ–èŠ‚æµã€è™šæ‹Ÿæ»šåŠ¨ï¼‰
    â†“
æ€»ç»“ â†’ æ ¸å¿ƒçŸ¥è¯†ç‚¹é€Ÿè®° + é«˜é¢‘é¢˜TOP 15
```

**ç¥ä½ é¢è¯•é¡ºåˆ©ï¼åŠ æ²¹ï¼ğŸ’ª**
```