# å‰ç«¯æ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜ç²¾ç®€ç‰ˆ â­â­â­â­â­

> ğŸ’¡ **é‡è¦ç¨‹åº¦**: é«˜é¢‘å¿…è€ƒ | ğŸ“Œ **å­¦ä¹ æ—¶é•¿**: 2-3å°æ—¶
> ğŸ”¥ **çƒ­åº¦æŒ‡æ•°**: â­â­â­â­â­ (å‡ ä¹æ¯ä¸ªé¢è¯•éƒ½ä¼šé—®)

---

## ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€

### æ€§èƒ½ä¼˜åŒ–å…­å¤§æ–¹å‘
```
å‡å°‘è¯·æ±‚ã€å‡å°ä½“ç§¯ã€æé«˜é€Ÿåº¦
ç¼“å­˜åˆ©ç”¨ã€å¼‚æ­¥åŠ è½½ã€ä½“éªŒä¼˜åŒ–
```

### æ€§èƒ½æŒ‡æ ‡å£è¯€
```
FCPé¦–æ¬¡ç»˜åˆ¶ã€LCPæœ€å¤§å†…å®¹ã€FIDé¦–æ¬¡äº¤äº’
CLSå¸ƒå±€åç§»ã€TTFBé¦–å­—èŠ‚
```

### å›¾ç‰‡ä¼˜åŒ–å£è¯€
```
å°å›¾Base64ã€å¤§å›¾æ‡’åŠ è½½
WebPæ ¼å¼ã€é›ªç¢§å›¾åˆå¹¶
å“åº”å¼å›¾ç‰‡ã€CDNåŠ é€Ÿ
```

---

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

| ç« èŠ‚ | é‡è¦çº§åˆ« | æ ¸å¿ƒå†…å®¹ | é¢„è®¡é˜…è¯»æ—¶é—´ |
|------|---------|---------|------------|
| [ä¸€ã€èµ„æºåŠ è½½ä¼˜åŒ–](#ä¸€èµ„æºåŠ è½½ä¼˜åŒ–) | â­â­â­â­â­ | å‡å°‘è¯·æ±‚ã€å‹ç¼©èµ„æº | 20åˆ†é’Ÿ |
| [äºŒã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–](#äºŒæ¸²æŸ“æ€§èƒ½ä¼˜åŒ–) | â­â­â­â­â­ | é‡æ’é‡ç»˜ã€CSSä¼˜åŒ– | 20åˆ†é’Ÿ |
| [ä¸‰ã€JavaScriptä¼˜åŒ–](#ä¸‰javascriptä¼˜åŒ–) | â­â­â­â­â­ | é˜²æŠ–èŠ‚æµã€ä»£ç åˆ†å‰² | 20åˆ†é’Ÿ |
| [å››ã€ç½‘ç»œä¼˜åŒ–](#å››ç½‘ç»œä¼˜åŒ–) | â­â­â­â­â­ | CDNã€HTTPç¼“å­˜ | 15åˆ†é’Ÿ |
| [äº”ã€å›¾ç‰‡ä¼˜åŒ–](#äº”å›¾ç‰‡ä¼˜åŒ–) | â­â­â­â­â­ | æ‡’åŠ è½½ã€æ ¼å¼é€‰æ‹© | 15åˆ†é’Ÿ |
| [å…­ã€Vue/Reactä¼˜åŒ–](#å…­vuereactä¼˜åŒ–) | â­â­â­â­â­ | ç»„ä»¶ä¼˜åŒ–ã€è™šæ‹Ÿæ»šåŠ¨ | 20åˆ†é’Ÿ |
| [ä¸ƒã€Webpack/Viteä¼˜åŒ–](#ä¸ƒwebpackviteä¼˜åŒ–) | â­â­â­â­â­ | æ„å»ºä¼˜åŒ–ã€æ‰“åŒ…ä¼˜åŒ– | 25åˆ†é’Ÿ |
| [å…«ã€æ€§èƒ½ç›‘æ§](#å…«æ€§èƒ½ç›‘æ§) | â­â­â­â­ | æ€§èƒ½æŒ‡æ ‡ã€ç›‘æ§å·¥å…· | 15åˆ†é’Ÿ |
| [ä¹ã€é¢è¯•ç­”é¢˜æ¨¡æ¿](#ä¹é¢è¯•ç­”é¢˜æ¨¡æ¿) | â­â­â­â­â­ | ç­”é¢˜æŠ€å·§ | 10åˆ†é’Ÿ |

---

# ä¸€ã€èµ„æºåŠ è½½ä¼˜åŒ–

## ğŸ¤ é¢è¯•èƒŒè¯µè¯æœ¯

**å½“é¢è¯•å®˜é—®ï¼š"å¦‚ä½•è¿›è¡Œèµ„æºåŠ è½½ä¼˜åŒ–ï¼Ÿ"**

**ä½ å¯ä»¥è¿™æ ·å›ç­”ï¼š**

> èµ„æºåŠ è½½ä¼˜åŒ–ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢å…¥æ‰‹ï¼š**å‡å°‘è¯·æ±‚æ¬¡æ•°ã€å‡å°èµ„æºä½“ç§¯ã€æŒ‰éœ€åŠ è½½èµ„æº**ã€‚
>
> **ç¬¬ä¸€ï¼Œå‡å°‘HTTPè¯·æ±‚ã€‚**æˆ‘ä¼šé‡‡ç”¨CSSé›ªç¢§å›¾å°†å¤šä¸ªå°å›¾æ ‡åˆå¹¶æˆä¸€å¼ å¤§å›¾ï¼Œå°†10ä¸ªè¯·æ±‚é™ä¸º1ä¸ªï¼›å¯¹äºå°äº10KBçš„å›¾ç‰‡ï¼Œä½¿ç”¨Base64ç¼–ç å†…è”åˆ°CSSä¸­ï¼Œç›´æ¥å‡å°‘è¯·æ±‚ï¼›è¿˜ä¼šåˆå¹¶CSSå’ŒJSæ–‡ä»¶ï¼Œé¿å…å¤šæ¬¡è¯·æ±‚ã€‚
>
> **ç¬¬äºŒï¼Œèµ„æºå‹ç¼©ã€‚**åœ¨æœåŠ¡å™¨ç«¯å¼€å¯Gzipæˆ–Brotliå‹ç¼©ï¼Œå¯ä»¥å°†æ–‡ä»¶ä½“ç§¯å‡å°‘70-90%ï¼Œæ¯”å¦‚100KBçš„æ–‡ä»¶å‹ç¼©ååªæœ‰20-30KBï¼›ä½¿ç”¨Webpackæˆ–Viteè¿›è¡Œä»£ç å‹ç¼©å’Œæ··æ·†ï¼›é…åˆTree Shakingåˆ é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œæ¯”å¦‚åªå¼•å…¥lodashçš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¸ä¼šæŠŠæ•´ä¸ª70KBçš„åº“æ‰“åŒ…è¿›æ¥ã€‚
>
> **ç¬¬ä¸‰ï¼ŒæŒ‰éœ€åŠ è½½ã€‚**é‡‡ç”¨è·¯ç”±æ‡’åŠ è½½ï¼Œç”¨åŠ¨æ€importå°†é¡µé¢ç»„ä»¶åˆ†å‰²æˆç‹¬ç«‹çš„chunkï¼Œç”¨æˆ·è®¿é—®å“ªä¸ªé¡µé¢æ‰åŠ è½½å“ªä¸ªï¼›å¯¹äºå¤§ç»„ä»¶ä¹Ÿä½¿ç”¨å¼‚æ­¥ç»„ä»¶æ‡’åŠ è½½ï¼›ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¼•å…¥ï¼Œæ¯”å¦‚Element Plusåªå¼•å…¥éœ€è¦çš„ç»„ä»¶ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåº“ã€‚
>
> **è¿™æ ·ä¼˜åŒ–ä¸‹æ¥ï¼Œé¦–å±èµ„æºä½“ç§¯å¯ä»¥ä»1MBé™åˆ°300KBå·¦å³ï¼Œé¦–å±åŠ è½½æ—¶é—´ä»5ç§’é™åˆ°1.5ç§’ï¼Œæå‡éå¸¸æ˜æ˜¾ã€‚**

---

**è¿½é—®1ï¼š"ä½ æåˆ°çš„Tree Shakingå…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"**

**å›ç­”ï¼š**

> Tree Shakingçš„åŸç†æ˜¯åŸºäºES6 Moduleçš„é™æ€åˆ†æã€‚å› ä¸ºES6çš„importå’Œexportæ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥æ‰“åŒ…å·¥å…·å¯ä»¥åˆ†æå‡ºå“ªäº›ä»£ç è¢«ä½¿ç”¨äº†ï¼Œå“ªäº›æ²¡æœ‰è¢«ä½¿ç”¨ã€‚
>
> å…·ä½“å·¥ä½œæµç¨‹æ˜¯ï¼šå…ˆæ ‡è®°æ‰€æœ‰ä½¿ç”¨çš„å¯¼å‡ºï¼Œç„¶ååˆ é™¤æœªä½¿ç”¨çš„å¯¼å‡ºã€‚ä½†å®ƒæœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯**å¿…é¡»ä½¿ç”¨ES6 Moduleè¯­æ³•**ï¼Œä¸èƒ½ç”¨CommonJSçš„requireï¼Œå› ä¸ºrequireæ˜¯åŠ¨æ€çš„ï¼Œç¼–è¯‘æ—¶æ— æ³•ç¡®å®šã€‚
>
> åœ¨Webpackä¸­ï¼Œç”Ÿäº§æ¨¡å¼ä¼šè‡ªåŠ¨å¼€å¯Tree Shakingï¼Œé…åˆè®¾ç½®optimization.usedExportsä¸ºtrueï¼Œä»¥åŠåœ¨package.jsonä¸­é…ç½®sideEffectsæ¥æ ‡è®°å“ªäº›æ–‡ä»¶æœ‰å‰¯ä½œç”¨ã€‚è¿™æ ·ä¼˜åŒ–æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œæ¯”å¦‚æ•´ä¸ªlodashæ˜¯70KBï¼Œä½†æˆ‘åªç”¨äº†ä¸€ä¸ªdebounceå‡½æ•°ï¼ŒTree Shakingååªæ‰“åŒ…äº†2KBã€‚

---

**è¿½é—®2ï¼š"CSSé›ªç¢§å›¾å’ŒBase64å†…è”ï¼Œä½ ä¼šæ€ä¹ˆé€‰æ‹©ï¼Ÿ"**

**å›ç­”ï¼š**

> æˆ‘ä¼šæ ¹æ®å›¾ç‰‡çš„å¤§å°ã€ä½¿ç”¨é¢‘ç‡å’Œç¼“å­˜éœ€æ±‚æ¥é€‰æ‹©ã€‚
>
> **CSSé›ªç¢§å›¾é€‚åˆï¼š**å¤šä¸ªå°å›¾æ ‡ã€å›ºå®šçš„UIå…ƒç´ ï¼Œæ¯”å¦‚å¯¼èˆªå›¾æ ‡ã€çŠ¶æ€å›¾æ ‡ã€‚ä¼˜ç‚¹æ˜¯å‡å°‘HTTPè¯·æ±‚ï¼Œè€Œä¸”å›¾ç‰‡å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œæ›´æ–°æŸä¸ªå›¾æ ‡åªéœ€è¦æ”¹CSSåæ ‡ã€‚ç¼ºç‚¹æ˜¯ç»´æŠ¤æˆæœ¬é«˜ï¼Œéœ€è¦å·¥å…·æ¥ç”Ÿæˆã€‚
>
> **Base64å†…è”é€‚åˆï¼š**éå¸¸å°çš„å›¾ç‰‡ï¼ˆå°äº10KBï¼‰ã€é¦–å±å¿…éœ€çš„å›¾ç‰‡ã€‚ä¼˜ç‚¹æ˜¯å½»åº•æ¶ˆé™¤HTTPè¯·æ±‚ï¼Œé¦–å±æ¸²æŸ“æ›´å¿«ã€‚ç¼ºç‚¹æ˜¯ä¼šå¢å¤§CSSä½“ç§¯ï¼Œè€Œä¸”å›¾ç‰‡ä¸èƒ½å•ç‹¬ç¼“å­˜ï¼Œæ¯æ¬¡CSSå˜åŒ–éƒ½è¦é‡æ–°ä¸‹è½½ã€‚
>
> **æˆ‘çš„ç»éªŒæ˜¯ï¼š**å°äº5KBçš„é¦–å±å¿…éœ€å›¾æ ‡ç”¨Base64ï¼Œ5-20KBçš„å¤šä¸ªå›¾æ ‡ç”¨é›ªç¢§å›¾ï¼Œå¤§äº20KBçš„å›¾ç‰‡ç‹¬ç«‹åŠ è½½å¹¶é…åˆæ‡’åŠ è½½å’ŒCDNã€‚

---

**è¿½é—®3ï¼š"Gzipå‹ç¼©ä½ æ˜¯åœ¨æœåŠ¡å™¨é…ç½®è¿˜æ˜¯æ„å»ºæ—¶é…ç½®ï¼Ÿ"**

**å›ç­”ï¼š**

> æˆ‘ä¸€èˆ¬**ä¸¤è¾¹éƒ½é…**ï¼Œä»¥è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚
>
> **æœåŠ¡å™¨ç«¯é…ç½®Gzipï¼š**è¿™æ˜¯ä¸»è¦çš„å‹ç¼©æ–¹å¼ï¼Œåœ¨Nginxä¸­è®¾ç½®gzip onï¼ŒæŒ‡å®šè¦å‹ç¼©çš„æ–‡ä»¶ç±»å‹ï¼Œè®¾ç½®å‹ç¼©çº§åˆ«ä¸º6ï¼ˆå¹³è¡¡å‹ç¼©ç‡å’ŒCPUæ¶ˆè€—ï¼‰ï¼Œåªå¯¹å¤§äº1KBçš„æ–‡ä»¶å‹ç¼©ã€‚è¿™æ ·å¯¹æ‰€æœ‰åŠ¨æ€å’Œé™æ€èµ„æºéƒ½èƒ½ç”Ÿæ•ˆã€‚
>
> **æ„å»ºæ—¶é¢„å‹ç¼©ï¼š**ä½¿ç”¨vite-plugin-compressionæˆ–compression-webpack-pluginï¼Œåœ¨æ„å»ºæ—¶å°±ç”Ÿæˆ.gzæ–‡ä»¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ç›´æ¥è¿”å›é¢„å‹ç¼©çš„æ–‡ä»¶ï¼Œçœå»äº†è¿è¡Œæ—¶å‹ç¼©çš„CPUå¼€é”€ï¼Œå“åº”æ›´å¿«ã€‚
>
> **æœ€ä½³å®è·µæ˜¯ï¼š**é™æ€èµ„æºç”¨é¢„å‹ç¼©ï¼ŒåŠ¨æ€å†…å®¹ç”¨æœåŠ¡å™¨å®æ—¶å‹ç¼©ã€‚å¦‚æœæœåŠ¡å™¨æ”¯æŒï¼ŒBrotliå‹ç¼©æ•ˆæœæ¯”Gzipæ›´å¥½ï¼Œå¯ä»¥å†å‡å°‘15-25%çš„ä½“ç§¯ã€‚

---

**è¿½é—®4ï¼š"ä½ æåˆ°çš„æŒ‰éœ€åŠ è½½ï¼Œå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"**

**å›ç­”ï¼š**

> æŒ‰éœ€åŠ è½½ä¸»è¦é€šè¿‡åŠ¨æ€importæ¥å®ç°ã€‚
>
> **åœ¨Vue Routerä¸­ï¼š**ä¸ç›´æ¥importç»„ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ç®­å¤´å‡½æ•°è¿”å›importï¼Œæ¯”å¦‚`const Home = () => import('./Home.vue')`ã€‚è¿™æ ·Webpackæˆ–Viteä¼šæŠŠè¿™ä¸ªç»„ä»¶æ‰“åŒ…æˆå•ç‹¬çš„chunkï¼Œåªæœ‰è®¿é—®è¯¥è·¯ç”±æ—¶æ‰ä¼šåŠ è½½ã€‚
>
> **åœ¨ç»„ä»¶å±‚é¢ï¼š**å¯¹äºå¤§å‹å›¾è¡¨ç»„ä»¶ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è¿™ç±»ä½“ç§¯å¤§ä½†ä¸æ˜¯é¦–å±å¿…éœ€çš„ç»„ä»¶ï¼Œä½¿ç”¨Vueçš„defineAsyncComponentæˆ–Reactçš„lazyæ¥å¼‚æ­¥åŠ è½½ï¼Œé…åˆSuspenseæ˜¾ç¤ºloadingçŠ¶æ€ã€‚
>
> **åœ¨ç¬¬ä¸‰æ–¹åº“å±‚é¢ï¼š**é¿å…`import _ from 'lodash'`è¿™ç§å¯¼å…¥æ•´ä¸ªåº“çš„æ–¹å¼ï¼Œæ”¹ç”¨`import debounce from 'lodash/debounce'`åªå¯¼å…¥éœ€è¦çš„å‡½æ•°ã€‚UIåº“ä¹Ÿé…ç½®æŒ‰éœ€å¼•å…¥æ’ä»¶ï¼Œæ¯”å¦‚ç”¨unplugin-vue-componentsè‡ªåŠ¨æŒ‰éœ€å¯¼å…¥Element Plusç»„ä»¶ã€‚
>
> **å®é™…æ•ˆæœï¼š**æˆ‘ä¹‹å‰ä¸€ä¸ªé¡¹ç›®é¦–å±ä½“ç§¯1.2MBï¼Œåº”ç”¨è·¯ç”±æ‡’åŠ è½½åé™åˆ°350KBï¼Œé¦–å±åŠ è½½æ—¶é—´ä»6ç§’é™åˆ°2ç§’ä»¥å†…ï¼Œç”¨æˆ·ä½“éªŒæå‡éå¸¸æ˜æ˜¾ã€‚

---

## 1. å‡å°‘HTTPè¯·æ±‚ â­â­â­â­â­

**å£è¯€ï¼šåˆå¹¶å‹ç¼©ã€é›ªç¢§å›¾ã€å†…è”å°èµ„æº**

### 1) CSSé›ªç¢§å›¾ï¼ˆSpriteï¼‰
```css
/* å°†å¤šä¸ªå°å›¾æ ‡åˆå¹¶æˆä¸€å¼ å¤§å›¾ */
.icon-home {
  background: url('sprites.png') 0 0;
  width: 20px;
  height: 20px;
}

.icon-user {
  background: url('sprites.png') -20px 0;
  width: 20px;
  height: 20px;
}
```

**ä¼˜ç‚¹ï¼š** 10ä¸ªå°å›¾æ ‡ä»10ä¸ªè¯·æ±‚å˜æˆ1ä¸ªè¯·æ±‚
**é€‚ç”¨ï¼š** å°å›¾æ ‡ã€å›ºå®šUIå…ƒç´ 

### 2) å°å›¾ç‰‡Base64å†…è”
```css
/* å°äº10KBçš„å›¾ç‰‡è½¬ä¸ºBase64 */
.logo {
  background: url('data:image/png;base64,iVBORw0KG...');
}
```

**ä¼˜ç‚¹ï¼š** å‡å°‘è¯·æ±‚ï¼Œé¦–å±æ›´å¿«
**ç¼ºç‚¹ï¼š** å¢å¤§CSSä½“ç§¯ï¼Œä¸èƒ½ç¼“å­˜
**å»ºè®®ï¼š** åªå¯¹<10KBçš„å›¾ç‰‡ä½¿ç”¨

### 3) åˆå¹¶CSS/JSæ–‡ä»¶
```javascript
// âŒ ä¸å¥½ï¼šå¤šä¸ªè¯·æ±‚
<link rel="stylesheet" href="a.css">
<link rel="stylesheet" href="b.css">
<link rel="stylesheet" href="c.css">

// âœ… å¥½ï¼šåˆå¹¶ä¸ºä¸€ä¸ª
<link rel="stylesheet" href="bundle.css">
```

---

## 2. èµ„æºå‹ç¼© â­â­â­â­â­

**å£è¯€ï¼šGzipå‹ç¼©ã€ä»£ç æ··æ·†ã€Tree Shaking**

### 1) Gzip/Brotliå‹ç¼©
```javascript
// æœåŠ¡å™¨ç«¯å¼€å¯Gzip
// Nginxé…ç½®
gzip on;
gzip_types text/css application/javascript image/svg+xml;
gzip_min_length 1024;  // å¤§äº1KBæ‰å‹ç¼©
gzip_comp_level 6;     // å‹ç¼©çº§åˆ«1-9

// æ•ˆæœï¼šæ–‡ä»¶ä½“ç§¯å‡å°‘70-90%
```

**å¯¹æ¯”ï¼š**
- åŸå§‹å¤§å°ï¼š100KB
- Gzipåï¼š20-30KB
- Brotliåï¼š15-25KBï¼ˆæ›´ä¼˜ï¼‰

### 2) ä»£ç å‹ç¼©ï¼ˆMinifyï¼‰
```javascript
// å‹ç¼©å‰
function calculateTotal(price, quantity) {
  const tax = 0.1;
  return price * quantity * (1 + tax);
}

// å‹ç¼©å
function calculateTotal(e,t){return e*t*1.1}
```

**å·¥å…·ï¼š** Webpackã€Viteã€Terser

### 3) Tree Shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰
```javascript
// utils.js
export function add(a, b) { return a + b; }
export function subtract(a, b) { return a - b; }
export function multiply(a, b) { return a * b; }

// main.js
import { add } from './utils.js';  // åªå¯¼å…¥add

// æ‰“åŒ…åï¼šsubtractå’Œmultiplyä¸ä¼šè¢«æ‰“åŒ…
```

**è¦æ±‚ï¼š** ä½¿ç”¨ES6 Moduleï¼Œä¸è¦ç”¨CommonJS

---

## 3. æŒ‰éœ€åŠ è½½ â­â­â­â­â­

**å£è¯€ï¼šæ‡’åŠ è½½ã€åŠ¨æ€å¯¼å…¥ã€è·¯ç”±åˆ†å‰²**

### 1) è·¯ç”±æ‡’åŠ è½½
```javascript
// âŒ ä¸å¥½ï¼šæ‰€æœ‰é¡µé¢ä¸€æ¬¡åŠ è½½
import Home from './Home.vue';
import About from './About.vue';

// âœ… å¥½ï¼šæŒ‰éœ€åŠ è½½
const Home = () => import('./Home.vue');
const About = () => import('./About.vue');

const routes = [
  { path: '/', component: Home },
  { path: '/about', component: About }
];
```

**æ•ˆæœï¼š** é¦–å±ä½“ç§¯ä»1MBé™åˆ°300KB

### 2) ç»„ä»¶æ‡’åŠ è½½
```vue
<!-- å¼‚æ­¥ç»„ä»¶ -->
<script setup>
import { defineAsyncComponent } from 'vue';

// å¤§ç»„ä»¶æ‡’åŠ è½½
const HeavyChart = defineAsyncComponent(() =>
  import('./HeavyChart.vue')
);
</script>

<template>
  <HeavyChart v-if="showChart" />
</template>
```

### 3) ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¼•å…¥
```javascript
// âŒ ä¸å¥½ï¼šå¼•å…¥æ•´ä¸ªlodashï¼ˆ70KBï¼‰
import _ from 'lodash';
_.debounce(fn, 300);

// âœ… å¥½ï¼šåªå¼•å…¥éœ€è¦çš„ï¼ˆ2KBï¼‰
import debounce from 'lodash/debounce';
debounce(fn, 300);

// Element PlusæŒ‰éœ€å¼•å…¥
import { ElButton, ElInput } from 'element-plus';
```

**è®°å¿†å£è¯€ï¼š**
```
èµ„æºåŠ è½½ä¸‰å¤§æ‹›ï¼šå‡å°‘è¯·æ±‚ã€å‹ç¼©ä½“ç§¯ã€æŒ‰éœ€åŠ è½½
åˆå¹¶é›ªç¢§Base64ã€Gzipå‹ç¼©Tree Shakingã€æ‡’åŠ è½½åŠ¨æ€å¯¼å…¥
```

---

# äºŒã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

## ğŸ¤ é¢è¯•èƒŒè¯µè¯æœ¯

**å½“é¢è¯•å®˜é—®ï¼š"å¦‚ä½•è¿›è¡Œæ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼Ÿ"**

**ä½ å¯ä»¥è¿™æ ·å›ç­”ï¼š**

> æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ä¸»è¦ä»ä¸‰ä¸ªæ ¸å¿ƒæ–¹å‘å…¥æ‰‹ï¼š**é¿å…é‡æ’é‡ç»˜ã€CSSæ€§èƒ½ä¼˜åŒ–ã€DOMæ“ä½œä¼˜åŒ–**ã€‚
>
> **ç¬¬ä¸€ï¼Œé¿å…é‡æ’å’Œé‡ç»˜ã€‚**é‡æ’æ˜¯æœ€è€—æ€§èƒ½çš„ï¼Œå› ä¸ºå®ƒéœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„ä½ç½®å’Œå¤§å°ï¼Œå½±å“æ•´ä¸ªé¡µé¢å¸ƒå±€ã€‚æˆ‘ä¼šé‡‡ç”¨æ‰¹é‡ä¿®æ”¹DOMçš„æ–¹å¼ï¼Œæ¯”å¦‚ä¿®æ”¹å¤šä¸ªæ ·å¼æ—¶ï¼Œä¸æ˜¯ä¸€ä¸ªä¸ªæ”¹ï¼Œè€Œæ˜¯ç”¨cssTextä¸€æ¬¡æ€§ä¿®æ”¹ï¼Œæˆ–è€…ç›´æ¥åˆ‡æ¢classï¼Œè¿™æ ·3æ¬¡é‡æ’é™ä¸º1æ¬¡ã€‚è¿˜æœ‰è¯»å†™åˆ†ç¦»ï¼Œå…ˆæŠŠæ‰€æœ‰offsetHeightè¿™ç±»è¯»æ“ä½œé›†ä¸­æ‰§è¡Œï¼Œå†æ‰§è¡Œå†™æ“ä½œï¼Œé¿å…æµè§ˆå™¨å¼ºåˆ¶åŒæ­¥å¸ƒå±€ã€‚å¯¹äºå¤§é‡DOMæ“ä½œï¼Œä¼šå…ˆè®¾ç½®displayä¸ºnoneï¼Œæ“ä½œå®Œå†æ˜¾ç¤ºï¼Œæˆ–è€…ç”¨DocumentFragmentï¼Œè¿™æ ·100æ¬¡DOMæ“ä½œåªè§¦å‘1æ¬¡é‡æ’ã€‚
>
> **ç¬¬äºŒï¼ŒCSSæ€§èƒ½ä¼˜åŒ–ã€‚**é€‰æ‹©å™¨è¦ç®€åŒ–ï¼Œé¿å…å±‚çº§è¿‡æ·±ï¼Œå› ä¸ºCSSé€‰æ‹©å™¨æ˜¯ä»å³å‘å·¦åŒ¹é…çš„ï¼Œ`.header .nav .menu .item`è¿™ç§6å±‚é€‰æ‹©å™¨æ¯”`.nav-item`æ…¢å¾ˆå¤šã€‚åŠ¨ç”»ä¼˜å…ˆä½¿ç”¨transformå’Œopacityï¼Œå› ä¸ºå®ƒä»¬åªè§¦å‘GPUåˆæˆï¼Œä¸ä¼šè§¦å‘é‡æ’é‡ç»˜ã€‚æˆ‘ä¹‹å‰åšè¿‡ä¸€ä¸ªæ»‘åŠ¨åŠ¨ç”»ï¼Œç”¨leftå®ç°æ—¶å¸§ç‡åªæœ‰30fpså¾ˆå¡ï¼Œæ”¹æˆtransformåç›´æ¥60fpsä¸æ»‘æµç•…ã€‚è¿˜ä¼šé¿å…ç”¨@importåŠ è½½CSSï¼Œå› ä¸ºå®ƒæ˜¯ä¸²è¡Œçš„ï¼Œæ”¹ç”¨linkæ ‡ç­¾å¹¶è¡ŒåŠ è½½å¿«3-5å€ã€‚
>
> **ç¬¬ä¸‰ï¼Œå…³é”®CSSå†…è”å’Œé•¿åˆ—è¡¨ä¼˜åŒ–ã€‚**é¦–å±å…³é”®CSSç›´æ¥å†…è”åˆ°HTMLçš„headæ ‡ç­¾é‡Œï¼Œå¤§æ¦‚2-3KBï¼Œéå…³é”®CSSå¼‚æ­¥åŠ è½½ï¼Œè¿™æ ·é¦–å±æ¸²æŸ“æå‰500-800msã€‚å¯¹äºé•¿åˆ—è¡¨ï¼Œå¿…é¡»ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼Œ10000æ¡æ•°æ®å¦‚æœå…¨éƒ¨æ¸²æŸ“ä¼šæœ‰10000ä¸ªDOMèŠ‚ç‚¹ï¼Œé¡µé¢ç›´æ¥å¡æ­»ï¼Œè™šæ‹Ÿæ»šåŠ¨åªæ¸²æŸ“å¯è§çš„20ä¸ªï¼Œæ»šåŠ¨æ—¶åŠ¨æ€æ›´æ–°ï¼Œæ€§èƒ½æå‡å‡ ç™¾å€ã€‚
>
> **è¿™æ ·ä¼˜åŒ–ä¸‹æ¥ï¼Œé¡µé¢çš„FPSä»30å¸§æå‡åˆ°60å¸§ï¼Œç”¨æˆ·æ»‘åŠ¨å’Œäº¤äº’éå¸¸æµç•…ï¼ŒFIDé¦–æ¬¡è¾“å…¥å»¶è¿Ÿä»300msé™åˆ°50msä»¥å†…ï¼Œä½“éªŒæå‡éå¸¸æ˜æ˜¾ã€‚**

---

**è¿½é—®1ï¼š"é‡æ’å’Œé‡ç»˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½å½±å“æ›´å¤§ï¼Ÿ"**

**å›ç­”ï¼š**

> **é‡æ’ï¼ˆReflowï¼‰å’Œé‡ç»˜ï¼ˆRepaintï¼‰çš„åŒºåˆ«ä¸»è¦åœ¨äºæ˜¯å¦å½±å“å¸ƒå±€ã€‚**
>
> **é‡æ’**ä¼šè§¦å‘å‡ ä½•å±æ€§çš„å˜åŒ–ï¼Œæ¯”å¦‚ä¿®æ”¹widthã€heightã€marginã€paddingã€displayã€positionè¿™äº›ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„ä½ç½®å’Œå¤§å°ï¼Œç„¶åé‡æ–°å¸ƒå±€æ•´ä¸ªé¡µé¢æˆ–éƒ¨åˆ†é¡µé¢ï¼Œæœ€åå†é‡ç»˜ã€‚æ€§èƒ½å¼€é”€éå¸¸å¤§ï¼Œå› ä¸ºå¯èƒ½å½±å“åˆ°çˆ¶å…ƒç´ ã€å…„å¼Ÿå…ƒç´ ã€å­å…ƒç´ çš„å¸ƒå±€ã€‚
>
> **é‡ç»˜**åªæ˜¯è§†è§‰æ•ˆæœå˜åŒ–ï¼Œæ¯”å¦‚ä¿®æ”¹colorã€backgroundã€border-colorã€visibilityï¼Œå…ƒç´ çš„ä½ç½®å’Œå¤§å°æ²¡å˜ï¼Œæµè§ˆå™¨åªéœ€è¦é‡æ–°ç»˜åˆ¶è¿™ä¸ªå…ƒç´ çš„å¤–è§‚å°±è¡Œï¼Œä¸æ¶‰åŠå¸ƒå±€è®¡ç®—ã€‚æ€§èƒ½å¼€é”€ç›¸å¯¹å°å¾ˆå¤šã€‚
>
> **é‡æ’ä¸€å®šä¼šè§¦å‘é‡ç»˜ï¼Œä½†é‡ç»˜ä¸ä¸€å®šè§¦å‘é‡æ’ã€‚**æ‰€ä»¥é‡æ’çš„æ€§èƒ½å½±å“æ›´å¤§ï¼Œæ˜¯é‡ç»˜çš„å‡ åå€åˆ°ä¸Šç™¾å€ã€‚
>
> **æœ€ä¼˜çš„æ˜¯åªè§¦å‘åˆæˆå±‚ï¼Œ**æ¯”å¦‚ç”¨transformã€opacityåšåŠ¨ç”»ï¼Œè¿™ä¸¤ä¸ªå±æ€§æµè§ˆå™¨ä¼šå•ç‹¬æå‡åˆ°åˆæˆå±‚ï¼ŒGPUç›´æ¥å¤„ç†ï¼Œä¸è§¦å‘é‡æ’ä¹Ÿä¸è§¦å‘é‡ç»˜ï¼Œæ€§èƒ½æœ€å¥½ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åšåŠ¨ç”»ä¸€å®šç”¨transformè€Œä¸æ˜¯left/topã€‚

---

**è¿½é—®2ï¼š"ä»€ä¹ˆæ“ä½œä¼šè§¦å‘å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"**

**å›ç­”ï¼š**

> å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼ˆForced Synchronous Layoutï¼‰æ˜¯æŒ‡åœ¨JavaScriptä¿®æ”¹äº†æ ·å¼åï¼Œç«‹å³è¯»å–å¸ƒå±€ä¿¡æ¯ï¼Œæµè§ˆå™¨å¿…é¡»ç«‹å³è¿›è¡Œé‡æ’æ¥è®¡ç®—æœ€æ–°å€¼ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚
>
> **å…¸å‹çš„è§¦å‘åœºæ™¯ï¼š**è¯»å†™äº¤æ›¿æ“ä½œï¼Œæ¯”å¦‚å…ˆä¿®æ”¹äº†å…ƒç´ çš„widthï¼Œç„¶åç«‹å³è¯»å–offsetHeightï¼Œæµè§ˆå™¨å¿…é¡»ç«‹å³é‡æ’æ‰èƒ½ç»™ä½ å‡†ç¡®çš„å€¼ã€‚å¦‚æœå¾ªç¯é‡Œæœ‰è¿™ç§æ“ä½œï¼Œå°±ä¼šè§¦å‘å¤šæ¬¡å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼Œæ€§èƒ½æå·®ã€‚
>
> **å…·ä½“ä¾‹å­ï¼š**`div.style.width = '100px'; let height = div.offsetHeight;`è¿™ä¸¤è¡Œä»£ç ï¼Œç¬¬äºŒè¡Œè¯»å–offsetHeightæ—¶æµè§ˆå™¨å¿…é¡»ç«‹å³é‡æ’ã€‚å¦‚æœåœ¨å¾ªç¯é‡Œå¯¹100ä¸ªå…ƒç´ è¿™æ ·æ“ä½œï¼Œå°±è§¦å‘100æ¬¡é‡æ’ã€‚
>
> **å¦‚ä½•é¿å…ï¼šè¯»å†™åˆ†ç¦»ã€‚**æŠŠæ‰€æœ‰è¯»æ“ä½œé›†ä¸­åœ¨ä¸€èµ·ï¼ŒæŠŠæ‰€æœ‰å†™æ“ä½œä¹Ÿé›†ä¸­åœ¨ä¸€èµ·ã€‚å…ˆä¸€æ¬¡æ€§è¯»å–10ä¸ªå…ƒç´ çš„offsetHeightå­˜åˆ°æ•°ç»„ï¼Œç„¶åå†ç»Ÿä¸€ä¿®æ”¹è¿™10ä¸ªå…ƒç´ çš„æ ·å¼ï¼Œè¿™æ ·åªè§¦å‘1æ¬¡é‡æ’ã€‚
>
> **æˆ‘çš„ç»éªŒæ˜¯ï¼š**æ“ä½œDOMå‰å…ˆç”¨å˜é‡ç¼“å­˜éœ€è¦è¯»å–çš„å€¼ï¼Œä¿®æ”¹æ ·å¼æ—¶ç”¨requestAnimationFrameåŒ…è£¹ï¼Œæˆ–è€…ç”¨CSSå˜é‡é…åˆtransformï¼Œå®Œå…¨é¿å…JavaScriptè¯»å–å¸ƒå±€ä¿¡æ¯ã€‚

---

**è¿½é—®3ï¼š"è™šæ‹Ÿæ»šåŠ¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ"**

**å›ç­”ï¼š**

> è™šæ‹Ÿæ»šåŠ¨çš„æ ¸å¿ƒæ€æƒ³æ˜¯**åªæ¸²æŸ“å¯è§†åŒºåŸŸçš„DOMèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯å…¨éƒ¨æ¸²æŸ“ï¼Œ**å¤§å¹…å‡å°‘DOMæ•°é‡æ¥æå‡æ€§èƒ½ã€‚
>
> **å®ç°åŸç†åˆ†å››æ­¥ï¼š**
>
> **ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—å¯è§åŒºåŸŸã€‚**æ ¹æ®å®¹å™¨çš„scrollTopå’Œå®¹å™¨é«˜åº¦ï¼Œè®¡ç®—å‡ºå½“å‰å¯è§çš„æ˜¯ç¬¬å‡ æ¡åˆ°ç¬¬å‡ æ¡æ•°æ®ã€‚æ¯”å¦‚å®¹å™¨é«˜åº¦500pxï¼Œæ¯é¡¹é«˜åº¦50pxï¼Œèƒ½çœ‹åˆ°10æ¡ï¼ŒscrollTopæ˜¯200ï¼Œé‚£å°±æ˜¯ç¬¬5æ¡åˆ°ç¬¬15æ¡å¯è§ã€‚
>
> **ç¬¬äºŒæ­¥ï¼Œåªæ¸²æŸ“å¯è§æ•°æ®ã€‚**10000æ¡æ•°æ®ï¼ŒåªæŠŠå¯è§çš„è¿™10-20æ¡æ¸²æŸ“æˆçœŸå®DOMï¼Œå…¶ä»–çš„ä¸æ¸²æŸ“ã€‚è¿™æ ·10000ä¸ªèŠ‚ç‚¹é™åˆ°20ä¸ªï¼ŒDOMæ•°é‡å‡å°‘äº†99.8%ã€‚
>
> **ç¬¬ä¸‰æ­¥ï¼Œæ’‘èµ·æ€»é«˜åº¦ã€‚**ç”¨ä¸€ä¸ªphantomå ä½å…ƒç´ ï¼Œé«˜åº¦è®¾ä¸ºæ€»æ•°æ®é‡ä¹˜ä»¥å•é¡¹é«˜åº¦ï¼Œæ¯”å¦‚10000*50px=500000pxï¼Œè®©æ»šåŠ¨æ¡çœ‹èµ·æ¥æ˜¯æ­£å¸¸çš„é•¿åº¦ã€‚
>
> **ç¬¬å››æ­¥ï¼ŒåŠ¨æ€æ›´æ–°ã€‚**ç›‘å¬scrolläº‹ä»¶ï¼Œæ»šåŠ¨æ—¶é‡æ–°è®¡ç®—å¯è§åŒºåŸŸï¼Œç”¨transform translateYæ¥åç§»å¯è§å†…å®¹çš„ä½ç½®ï¼Œç„¶åæ›´æ–°è¿™20ä¸ªDOMèŠ‚ç‚¹æ˜¾ç¤ºçš„æ•°æ®ã€‚
>
> **å…³é”®ç‚¹æ˜¯ï¼š**æ¯é¡¹é«˜åº¦å¿…é¡»å›ºå®šæˆ–è€…å¯é¢„æµ‹ï¼Œè¿™æ ·æ‰èƒ½å‡†ç¡®è®¡ç®—ã€‚è¿˜è¦åŠ ä¸Šç¼“å†²åŒºï¼Œå¯è§10æ¡å°±æ¸²æŸ“15-20æ¡ï¼Œä¸Šä¸‹å„ç•™å‡ æ¡ï¼Œæ»šåŠ¨æ›´æµç•…ä¸ä¼šå‡ºç°ç™½å±ã€‚
>
> **æˆ‘ä¹‹å‰åšè¿‡ä¸€ä¸ª1ä¸‡æ¡æ•°æ®çš„è¡¨æ ¼ï¼Œ**å…¨éƒ¨æ¸²æŸ“é¡µé¢å®Œå…¨å¡æ­»ï¼ŒåŠ è½½è¦10ç§’ï¼Œæ»‘åŠ¨FPSåªæœ‰5å¸§ã€‚ç”¨è™šæ‹Ÿæ»šåŠ¨åç§’å¼€ï¼Œæ»‘åŠ¨60å¸§ä¸æ»‘ï¼Œå†…å­˜å ç”¨ä»500MBé™åˆ°50MBï¼Œæ•ˆæœéå¸¸æ˜æ˜¾ã€‚

---

**è¿½é—®4ï¼š"transformä¸ºä»€ä¹ˆæ¯”left/topæ€§èƒ½å¥½ï¼Ÿ"**

**å›ç­”ï¼š**

> è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°æµè§ˆå™¨çš„æ¸²æŸ“æµç¨‹å’Œåˆæˆå±‚æœºåˆ¶ã€‚
>
> **ä¿®æ”¹left/topçš„è¿‡ç¨‹ï¼š**æ”¹å˜leftä¼šè§¦å‘é‡æ’ï¼Œå› ä¸ºå…ƒç´ ä½ç½®å˜äº†ï¼Œæµè§ˆå™¨è¦é‡æ–°è®¡ç®—å¸ƒå±€ï¼Œç„¶åé‡ç»˜ï¼Œæœ€ååˆæˆã€‚æ•´ä¸ªæµç¨‹æ˜¯ï¼šJavaScript â†’ æ ·å¼è®¡ç®— â†’ å¸ƒå±€(Layout) â†’ ç»˜åˆ¶(Paint) â†’ åˆæˆ(Composite)ï¼Œæ€§èƒ½å¼€é”€å¤§ã€‚
>
> **ä½¿ç”¨transformçš„è¿‡ç¨‹ï¼š**transformä¸ä¼šè§¦å‘é‡æ’å’Œé‡ç»˜ï¼Œæµè§ˆå™¨ä¼šæŠŠè¿™ä¸ªå…ƒç´ æå‡åˆ°ç‹¬ç«‹çš„åˆæˆå±‚ï¼Œç”±GPUç›´æ¥å¤„ç†ï¼Œåªæ¶‰åŠåˆæˆè¿™ä¸€æ­¥ã€‚æµç¨‹æ˜¯ï¼šJavaScript â†’ æ ·å¼è®¡ç®— â†’ åˆæˆ(Composite)ï¼Œè·³è¿‡äº†æœ€è€—æ—¶çš„å¸ƒå±€å’Œç»˜åˆ¶ã€‚
>
> **åˆæˆå±‚çš„ä¼˜åŠ¿ï¼š**GPUæ¸²æŸ“ï¼Œé€Ÿåº¦å¿«ï¼›ä¸å½±å“å…¶ä»–å…ƒç´ ï¼›å¯ä»¥åšäºšåƒç´ çº§çš„å¹³æ»‘åŠ¨ç”»ã€‚è€Œleft/topæ˜¯CPUæ¸²æŸ“ï¼Œè¿˜ä¼šè§¦å‘æ•´ä¸ªé¡µé¢çš„é‡æ’é‡ç»˜ã€‚
>
> **å…·ä½“æ€§èƒ½å¯¹æ¯”ï¼š**æˆ‘æµ‹è¯•è¿‡ä¸€ä¸ªä»0ç§»åŠ¨åˆ°100pxçš„åŠ¨ç”»ï¼Œç”¨leftå®ç°FPSåªæœ‰30å¸§ï¼Œå¡é¡¿æ˜æ˜¾ï¼›ç”¨transformå®ç°ç¨³å®š60å¸§ï¼Œéå¸¸æµç•…ã€‚è€Œä¸”transformçš„CPUå ç”¨åªæœ‰leftçš„20%ã€‚
>
> **åŒç†opacityä¹Ÿä¸€æ ·ï¼Œ**å®ƒä¹Ÿä¼šæå‡åˆ°åˆæˆå±‚ï¼Œåªæ¶‰åŠé€æ˜åº¦åˆæˆï¼Œä¸è§¦å‘é‡æ’é‡ç»˜ã€‚æ‰€ä»¥åšåŠ¨ç”»æˆ‘æ°¸è¿œä¼˜å…ˆç”¨transformå’Œopacityè¿™ä¸¤ä¸ªå±æ€§ã€‚

---

**è¿½é—®5ï¼š"å…³é”®CSSå†…è”å…·ä½“æ€ä¹ˆåšï¼Ÿå¦‚ä½•ç¡®å®šå“ªäº›æ˜¯å…³é”®CSSï¼Ÿ"**

**å›ç­”ï¼š**

> å…³é”®CSSï¼ˆCritical CSSï¼‰æ˜¯æŒ‡é¦–å±æ¸²æŸ“å¿…éœ€çš„CSSï¼Œå†…è”åˆ°HTMLé‡Œå¯ä»¥é¿å…é˜»å¡æ¸²æŸ“ï¼Œæå‡é¦–å±é€Ÿåº¦ã€‚
>
> **å¦‚ä½•ç¡®å®šå…³é”®CSSï¼š**
>
> **ç¬¬ä¸€ï¼Œæ‰‹åŠ¨åˆ†æã€‚**æ‰“å¼€é¡µé¢ï¼ŒæŸ¥çœ‹é¦–å±ï¼ˆviewportç¬¬ä¸€å±ï¼‰åŒ…å«å“ªäº›å…ƒç´ ï¼Œæ¯”å¦‚headerã€heroåŒºã€å¯¼èˆªã€‚åªæŠŠè¿™äº›å…ƒç´ çš„æ ·å¼æå–å‡ºæ¥ï¼Œä¸€èˆ¬2-5KBã€‚
>
> **ç¬¬äºŒï¼Œå·¥å…·æå–ã€‚**ç”¨Chrome DevToolsçš„Coverageå·¥å…·ï¼Œå½•åˆ¶é¦–å±åŠ è½½ï¼Œå®ƒä¼šæ ‡è®°å‡ºå“ªäº›CSSè¢«ä½¿ç”¨äº†ï¼Œå“ªäº›æ²¡ç”¨åˆ°ã€‚æˆ–è€…ç”¨criticalã€crittersè¿™äº›è‡ªåŠ¨åŒ–å·¥å…·ï¼Œæ‰«æHTMLç”Ÿæˆå…³é”®CSSã€‚
>
> **ç¬¬ä¸‰ï¼Œç»éªŒæ³•åˆ™ã€‚**é€šå¸¸åŒ…æ‹¬ï¼šå¸ƒå±€ç›¸å…³çš„ï¼ˆwidthã€heightã€displayã€positionï¼‰ã€å¯è§å†…å®¹çš„ï¼ˆbackgroundã€colorã€fontï¼‰ã€é¦–å±å›¾ç‰‡çš„ã€‚åŠ¨ç”»ã€hoverçŠ¶æ€ã€å¼¹çª—è¿™äº›éé¦–å±å¿…éœ€çš„ä¸ç®—å…³é”®CSSã€‚
>
> **å…·ä½“å®ç°ï¼š**
> ```html
> <head>
>   <style>
>     /* å…³é”®CSSå†…è”ï¼Œ2-3KB */
>     .header { height: 60px; background: #fff; }
>     .hero { height: 400px; background: url('hero.jpg'); }
>   </style>
>   <!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ -->
>   <link rel="preload" href="main.css" as="style" onload="this.rel='stylesheet'">
> </head>
> ```
>
> **æ•ˆæœï¼š**å†…è”å…³é”®CSSåï¼Œé¦–å±FCPä»2.5sé™åˆ°1.2sï¼Œå› ä¸ºä¸éœ€è¦ç­‰å¾…CSSæ–‡ä»¶ä¸‹è½½å’Œè§£æå°±èƒ½å¼€å§‹æ¸²æŸ“ã€‚ä½†è¦æ³¨æ„å…³é”®CSSä¸èƒ½å¤ªå¤§ï¼Œè¶…è¿‡14KBå°±å¾—åˆ†åŒ…ï¼Œå¦åˆ™åè€Œå½±å“HTMLä¸‹è½½é€Ÿåº¦ã€‚

---

## 1. é¿å…é‡æ’ï¼ˆReflowï¼‰å’Œé‡ç»˜ï¼ˆRepaintï¼‰â­â­â­â­â­

**å£è¯€ï¼šè¯»å†™åˆ†ç¦»ã€æ‰¹é‡ä¿®æ”¹ã€è„±ç¦»æ–‡æ¡£æµ**

### é‡æ’vsé‡ç»˜å¯¹æ¯”

| æ“ä½œ | é‡æ’(Reflow) | é‡ç»˜(Repaint) | æ€§èƒ½å½±å“ |
|------|-------------|--------------|---------|
| ä¿®æ”¹width/height | âœ… | âœ… | æœ€æ…¢ |
| ä¿®æ”¹color/background | âŒ | âœ… | è¾ƒå¿« |
| ä¿®æ”¹transform/opacity | âŒ | âŒ | æœ€å¿« |

### 1) æ‰¹é‡ä¿®æ”¹DOM
```javascript
// âŒ ä¸å¥½ï¼šè§¦å‘3æ¬¡é‡æ’
element.style.width = '100px';
element.style.height = '100px';
element.style.margin = '10px';

// âœ… å¥½ï¼šåªè§¦å‘1æ¬¡é‡æ’
element.style.cssText = 'width:100px;height:100px;margin:10px';

// âœ… æ›´å¥½ï¼šä½¿ç”¨class
element.classList.add('optimized-style');
```

### 2) è¯»å†™åˆ†ç¦»
```javascript
// âŒ ä¸å¥½ï¼šè¯»å†™äº¤æ›¿ï¼Œè§¦å‘å¤šæ¬¡é‡æ’
div1.style.height = div1.offsetHeight + 10 + 'px'; // å†™-è¯»-å†™
div2.style.height = div2.offsetHeight + 10 + 'px';

// âœ… å¥½ï¼šå…ˆè¯»åå†™
const height1 = div1.offsetHeight;  // è¯»
const height2 = div2.offsetHeight;  // è¯»
div1.style.height = height1 + 10 + 'px'; // å†™
div2.style.height = height2 + 10 + 'px'; // å†™
```

### 3) è„±ç¦»æ–‡æ¡£æµ
```javascript
// å¤§é‡DOMæ“ä½œæ—¶ï¼Œå…ˆè„±ç¦»æ–‡æ¡£æµ
const container = document.getElementById('container');

// æ–¹å¼1ï¼šdisplay: none
container.style.display = 'none';
// ... è¿›è¡Œ100æ¬¡DOMæ“ä½œ
container.style.display = 'block';  // åªè§¦å‘1æ¬¡é‡æ’

// æ–¹å¼2ï¼šDocumentFragment
const fragment = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
  const li = document.createElement('li');
  li.textContent = `Item ${i}`;
  fragment.appendChild(li);
}
ul.appendChild(fragment);  // åªè§¦å‘1æ¬¡é‡æ’
```

### 4) ä½¿ç”¨transformä»£æ›¿top/left
```css
/* âŒ ä¸å¥½ï¼šè§¦å‘é‡æ’ */
.box {
  position: absolute;
  left: 100px;
  transition: left 0.3s;
}
.box:hover {
  left: 200px;
}

/* âœ… å¥½ï¼šåªè§¦å‘åˆæˆï¼Œä¸é‡æ’ */
.box {
  transform: translateX(0);
  transition: transform 0.3s;
}
.box:hover {
  transform: translateX(100px);
}
```

---

## 2. CSSä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šé€‰æ‹©å™¨ç®€åŒ–ã€é¿å…@importã€å…³é”®CSSå†…è”**

### 1) ç®€åŒ–CSSé€‰æ‹©å™¨
```css
/* âŒ ä¸å¥½ï¼šé€‰æ‹©å™¨è¿‡æ·± */
.header .nav .menu .item .link .icon {
  color: red;
}

/* âœ… å¥½ï¼šæ‰å¹³åŒ– */
.nav-link-icon {
  color: red;
}
```

**åŸå› ï¼š** CSSé€‰æ‹©å™¨ä»å³å‘å·¦åŒ¹é…ï¼Œè¶ŠçŸ­è¶Šå¿«

### 2) é¿å…ä½¿ç”¨@import
```css
/* âŒ ä¸å¥½ï¼šä¸²è¡ŒåŠ è½½ */
@import url('a.css');
@import url('b.css');

/* âœ… å¥½ï¼šå¹¶è¡ŒåŠ è½½ */
<link rel="stylesheet" href="a.css">
<link rel="stylesheet" href="b.css">
```

### 3) å…³é”®CSSå†…è”
```html
<!-- é¦–å±å…³é”®CSSç›´æ¥å†™åœ¨<head>é‡Œ -->
<head>
  <style>
    /* å…³é”®CSSï¼šé¦–å±å¿…éœ€çš„æ ·å¼ */
    .header { height: 60px; background: #fff; }
    .hero { height: 400px; }
  </style>

  <!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ -->
  <link rel="preload" href="main.css" as="style" onload="this.rel='stylesheet'">
</head>
```

**è®°å¿†å£è¯€ï¼š**
```
æ¸²æŸ“ä¼˜åŒ–è®°å››ç‚¹ï¼šé¿å…é‡æ’ã€æ‰¹é‡ä¿®æ”¹ã€transformåŠ¨ç”»ã€CSSç®€åŒ–
è¯»å†™åˆ†ç¦»è„±æ–‡æ¡£ã€transformä»£æ›¿leftã€å…³é”®CSSå†…è”
```

---

# ä¸‰ã€JavaScriptä¼˜åŒ–

## 1. é˜²æŠ–å’ŒèŠ‚æµ â­â­â­â­â­

**å£è¯€ï¼šé˜²æŠ–ç­‰åœæ­¢ã€èŠ‚æµå›ºå®šé—´éš”**

### é˜²æŠ–ï¼ˆDebounceï¼‰
```javascript
// åº”ç”¨åœºæ™¯ï¼šæœç´¢æ¡†è¾“å…¥ã€çª—å£resize
function debounce(fn, delay) {
  let timer = null;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
}

// ä½¿ç”¨
const search = debounce((keyword) => {
  console.log('æœç´¢:', keyword);
}, 300);

input.addEventListener('input', (e) => search(e.target.value));
```

### èŠ‚æµï¼ˆThrottleï¼‰
```javascript
// åº”ç”¨åœºæ™¯ï¼šæ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨
function throttle(fn, delay) {
  let lastTime = 0;
  return function(...args) {
    const now = Date.now();
    if (now - lastTime >= delay) {
      fn.apply(this, args);
      lastTime = now;
    }
  };
}

// ä½¿ç”¨
const handleScroll = throttle(() => {
  console.log('æ»šåŠ¨ä½ç½®:', window.scrollY);
}, 200);

window.addEventListener('scroll', handleScroll);
```

### å¯¹æ¯”è¡¨æ ¼

| ç‰¹æ€§ | é˜²æŠ– | èŠ‚æµ |
|------|------|------|
| **æ‰§è¡Œæ—¶æœº** | åœæ­¢è§¦å‘åæ‰§è¡Œ | å›ºå®šé—´éš”æ‰§è¡Œ |
| **æ‰§è¡Œæ¬¡æ•°** | 1æ¬¡ | å¤šæ¬¡ |
| **é€‚ç”¨åœºæ™¯** | æœç´¢ã€resize | æ»šåŠ¨ã€mousemove |
| **å®é™…ä¾‹å­** | è¾“å…¥åœæ­¢300msåæœç´¢ | æ»šåŠ¨æ—¶æ¯200msæ‰§è¡Œä¸€æ¬¡ |

---

## 2. é•¿åˆ—è¡¨ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šè™šæ‹Ÿæ»šåŠ¨ã€åˆ†é¡µåŠ è½½ã€æ—¶é—´åˆ†ç‰‡**

### 1) è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollï¼‰
```vue
<!-- åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å…ƒç´  -->
<template>
  <div class="virtual-list" @scroll="handleScroll" ref="container">
    <div class="phantom" :style="{ height: totalHeight + 'px' }"></div>
    <div class="content" :style="{ transform: `translateY(${offset}px)` }">
      <div v-for="item in visibleData" :key="item.id" class="item">
        {{ item.text }}
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';

const data = ref(Array.from({ length: 10000 }, (_, i) => ({
  id: i,
  text: `Item ${i}`
})));

const itemHeight = 50;      // æ¯é¡¹é«˜åº¦
const visibleCount = 20;    // å¯è§æ•°é‡
const scrollTop = ref(0);

const startIndex = computed(() => Math.floor(scrollTop.value / itemHeight));
const endIndex = computed(() => startIndex.value + visibleCount);
const visibleData = computed(() => data.value.slice(startIndex.value, endIndex.value));
const offset = computed(() => startIndex.value * itemHeight);
const totalHeight = computed(() => data.value.length * itemHeight);

function handleScroll(e) {
  scrollTop.value = e.target.scrollTop;
}
</script>
```

**æ•ˆæœï¼š** 10000æ¡æ•°æ®ï¼Œåªæ¸²æŸ“20ä¸ªDOMèŠ‚ç‚¹

### 2) æ—¶é—´åˆ†ç‰‡ï¼ˆTime Slicingï¼‰
```javascript
// å¤§é‡æ•°æ®åˆ†æ‰¹æ¸²æŸ“
function timeSlice(data, batchSize = 100) {
  let index = 0;

  function render() {
    const batch = data.slice(index, index + batchSize);
    batch.forEach(item => {
      const div = document.createElement('div');
      div.textContent = item;
      container.appendChild(div);
    });

    index += batchSize;

    if (index < data.length) {
      requestAnimationFrame(render);  // ä¸‹ä¸€å¸§ç»§ç»­
    }
  }

  render();
}

// ä½¿ç”¨
const data = Array.from({ length: 10000 }, (_, i) => `Item ${i}`);
timeSlice(data, 100);  // æ¯æ¬¡æ¸²æŸ“100æ¡
```

---

## 3. Web Worker â­â­â­â­

**å£è¯€ï¼šè®¡ç®—å¯†é›†ã€åå°å¤„ç†ã€ä¸é˜»å¡UI**

```javascript
// worker.js
self.addEventListener('message', (e) => {
  const { data } = e;

  // è€—æ—¶è®¡ç®—
  const result = heavyComputation(data);

  // è¿”å›ç»“æœ
  self.postMessage(result);
});

function heavyComputation(data) {
  // å¤æ‚è®¡ç®—é€»è¾‘
  let sum = 0;
  for (let i = 0; i < 1000000000; i++) {
    sum += i;
  }
  return sum;
}

// main.js
const worker = new Worker('worker.js');

worker.postMessage({ data: [1, 2, 3] });

worker.addEventListener('message', (e) => {
  console.log('è®¡ç®—ç»“æœ:', e.data);
});
```

**é€‚ç”¨åœºæ™¯ï¼š**
- å¤§æ•°æ®å¤„ç†
- å›¾åƒå¤„ç†
- å¤æ‚è®¡ç®—
- æ•°æ®åŠ å¯†/è§£å¯†

---

## 4. å†…å­˜æ³„æ¼ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šé—­åŒ…æœªæ¸…ã€å®šæ—¶å™¨å¿˜åœã€äº‹ä»¶æœªç§»é™¤ã€DOMå¼•ç”¨æ®‹ç•™**

### ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ

**å®šä¹‰ï¼š** ä¸å†éœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜å ç”¨æŒç»­å¢é•¿

**å½±å“ï¼š**
- é¡µé¢å¡é¡¿ã€å“åº”å˜æ…¢
- å†…å­˜å ç”¨è¿‡é«˜ï¼Œæµè§ˆå™¨å´©æºƒ
- ç§»åŠ¨ç«¯æ›´ä¸¥é‡ï¼ˆå†…å­˜æœ‰é™ï¼‰

---

### å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯ â­â­â­â­â­

#### 1) æœªæ¸…é™¤çš„å®šæ—¶å™¨
```javascript
// âŒ ä¸å¥½ï¼šç»„ä»¶é”€æ¯äº†ï¼Œå®šæ—¶å™¨è¿˜åœ¨è¿è¡Œ
export default {
  mounted() {
    setInterval(() => {
      console.log('æ‰§è¡Œä¸­...');
    }, 1000);
  }
}

// âœ… å¥½ï¼šç»„ä»¶é”€æ¯æ—¶æ¸…é™¤å®šæ—¶å™¨
export default {
  data() {
    return {
      timer: null
    }
  },
  mounted() {
    this.timer = setInterval(() => {
      console.log('æ‰§è¡Œä¸­...');
    }, 1000);
  },
  beforeUnmount() {
    if (this.timer) {
      clearInterval(this.timer);
      this.timer = null;
    }
  }
}
```

#### 2) æœªç§»é™¤çš„äº‹ä»¶ç›‘å¬å™¨
```javascript
// âŒ ä¸å¥½ï¼šäº‹ä»¶ç›‘å¬å™¨æ²¡æœ‰ç§»é™¤
export default {
  mounted() {
    window.addEventListener('resize', this.handleResize);
    document.addEventListener('scroll', this.handleScroll);
  }
  // ç»„ä»¶é”€æ¯ï¼Œç›‘å¬å™¨è¿˜åœ¨
}

// âœ… å¥½ï¼šç»„ä»¶é”€æ¯æ—¶ç§»é™¤ç›‘å¬å™¨
export default {
  mounted() {
    window.addEventListener('resize', this.handleResize);
    document.addEventListener('scroll', this.handleScroll);
  },
  beforeUnmount() {
    window.removeEventListener('resize', this.handleResize);
    document.removeEventListener('scroll', this.handleScroll);
  }
}
```

#### 3) é—­åŒ…å¼•ç”¨
```javascript
// âŒ ä¸å¥½ï¼šé—­åŒ…æŒæœ‰å¤§å¯¹è±¡å¼•ç”¨
function createLeak() {
  const largeData = new Array(1000000).fill('leak');

  return function() {
    console.log(largeData[0]);  // é—­åŒ…æŒæœ‰largeData
  };
}

const fn = createLeak();  // largeDataæ— æ³•è¢«å›æ”¶

// âœ… å¥½ï¼šæ‰‹åŠ¨é‡Šæ”¾å¼•ç”¨
function createNoLeak() {
  let largeData = new Array(1000000).fill('no leak');

  return function() {
    console.log(largeData[0]);
    largeData = null;  // ä½¿ç”¨åé‡Šæ”¾
  };
}
```

#### 4) DOMå¼•ç”¨æ®‹ç•™
```javascript
// âŒ ä¸å¥½ï¼šåˆ é™¤DOMåä»æŒæœ‰å¼•ç”¨
const button = document.getElementById('btn');
const data = {
  element: button,  // æŒæœ‰DOMå¼•ç”¨
  text: 'Click me'
};

button.remove();  // DOMåˆ é™¤äº†
// ä½†data.elementä»ç„¶å¼•ç”¨ç€ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼

// âœ… å¥½ï¼šæ¸…é™¤å¼•ç”¨
data.element = null;
```

#### 5) Vue/Reactç»„ä»¶æœªæ¸…ç†
```javascript
// âŒ Vueä¸å¥½çš„ä¾‹å­
export default {
  data() {
    return {
      subscription: null
    }
  },
  mounted() {
    // ç¬¬ä¸‰æ–¹åº“è®¢é˜…
    this.subscription = EventBus.subscribe('event', () => {});
  }
  // ç»„ä»¶é”€æ¯ï¼Œè®¢é˜…è¿˜åœ¨
}

// âœ… Vueå¥½çš„ä¾‹å­
export default {
  data() {
    return {
      subscription: null
    }
  },
  mounted() {
    this.subscription = EventBus.subscribe('event', () => {});
  },
  beforeUnmount() {
    if (this.subscription) {
      this.subscription.unsubscribe();
      this.subscription = null;
    }
  }
}
```

```javascript
// âŒ Reactä¸å¥½çš„ä¾‹å­
function Component() {
  useEffect(() => {
    const subscription = EventBus.subscribe('event', () => {});
    // æ²¡æœ‰æ¸…ç†
  }, []);

  return <div>Component</div>;
}

// âœ… Reactå¥½çš„ä¾‹å­
function Component() {
  useEffect(() => {
    const subscription = EventBus.subscribe('event', () => {});

    // è¿”å›æ¸…ç†å‡½æ•°
    return () => {
      subscription.unsubscribe();
    };
  }, []);

  return <div>Component</div>;
}
```

#### 6) å…¨å±€å˜é‡å’Œæ„å¤–çš„å…¨å±€å˜é‡
```javascript
// âŒ ä¸å¥½ï¼šæ„å¤–çš„å…¨å±€å˜é‡
function createLeak() {
  // å¿˜è®°å†™var/let/constï¼Œå˜æˆå…¨å±€å˜é‡
  leakedVar = 'This is leaked';
}

// âœ… å¥½ï¼šä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
'use strict';
function noLeak() {
  const localVar = 'This is local';
}
```

#### 7) å¾ªç¯å¼•ç”¨ï¼ˆè¾ƒå°‘è§ï¼‰
```javascript
// âŒ ä¸å¥½ï¼šå¾ªç¯å¼•ç”¨
function createCircular() {
  const obj1 = {};
  const obj2 = {};

  obj1.ref = obj2;  // obj1å¼•ç”¨obj2
  obj2.ref = obj1;  // obj2å¼•ç”¨obj1

  return { obj1, obj2 };
}

// ç°ä»£æµè§ˆå™¨çš„æ ‡è®°æ¸…é™¤ç®—æ³•å¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨
// ä½†è€æ—§æµè§ˆå™¨å¯èƒ½æœ‰é—®é¢˜
```

---

### å¦‚ä½•æ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿâ­â­â­â­â­

#### æ–¹æ³•1ï¼šChrome DevTools Memoryå·¥å…·ï¼ˆæœ€é‡è¦ï¼‰

**æ­¥éª¤ï¼š**
```
1. æ‰“å¼€Chrome DevTools â†’ Memory
2. é€‰æ‹© "Heap snapshot"ï¼ˆå †å¿«ç…§ï¼‰
3. ç‚¹å‡» "Take snapshot" æ‹æ‘„å¿«ç…§1
4. æ‰§è¡Œå¯èƒ½æ³„æ¼çš„æ“ä½œï¼ˆå¦‚æ‰“å¼€å…³é—­å¼¹çª—10æ¬¡ï¼‰
5. å†æ¬¡ç‚¹å‡» "Take snapshot" æ‹æ‘„å¿«ç…§2
6. é€‰æ‹©å¿«ç…§2ï¼Œé€‰æ‹© "Comparison"ï¼ˆå¯¹æ¯”ï¼‰æ¨¡å¼
7. å¯¹æ¯”å¿«ç…§1å’Œå¿«ç…§2ï¼ŒæŸ¥çœ‹å†…å­˜å¢é•¿
```

**å…³é”®æŒ‡æ ‡ï¼š**
- **Deltaï¼ˆå¢é‡ï¼‰**ï¼šæ–°å¢/åˆ é™¤çš„å¯¹è±¡æ•°é‡
- **Alloc. Sizeï¼ˆåˆ†é…å¤§å°ï¼‰**ï¼šæ–°å¢çš„å†…å­˜å¤§å°
- **Freed Sizeï¼ˆé‡Šæ”¾å¤§å°ï¼‰**ï¼šé‡Šæ”¾çš„å†…å­˜å¤§å°

**åˆ¤æ–­æ³„æ¼ï¼š**
- å¦‚æœDeltaæŒç»­å¢é•¿ï¼Œå¯èƒ½å­˜åœ¨æ³„æ¼
- å¦‚æœFreed Sizeå¾ˆå°‘ï¼Œå¯èƒ½æ²¡æœ‰æ­£å¸¸å›æ”¶

---

#### æ–¹æ³•2ï¼šPerformance Monitorå®æ—¶ç›‘æ§

**æ­¥éª¤ï¼š**
```
1. æ‰“å¼€DevTools â†’ More tools â†’ Performance monitor
2. æŸ¥çœ‹æŒ‡æ ‡ï¼š
   - JS heap sizeï¼ˆJSå †å¤§å°ï¼‰
   - DOM Nodesï¼ˆDOMèŠ‚ç‚¹æ•°ï¼‰
   - JS event listenersï¼ˆäº‹ä»¶ç›‘å¬å™¨æ•°ï¼‰
3. æ‰§è¡Œæ“ä½œï¼Œè§‚å¯Ÿè¿™äº›æŒ‡æ ‡æ˜¯å¦æŒç»­å¢é•¿
```

**åˆ¤æ–­æ ‡å‡†ï¼š**
- JS heap sizeæŒç»­ä¸Šå‡ â†’ å¯èƒ½å†…å­˜æ³„æ¼
- DOM NodesæŒç»­å¢é•¿ â†’ å¯èƒ½DOMæœªæ¸…ç†
- Event listenerså¢é•¿ä¸å›è½ â†’ äº‹ä»¶ç›‘å¬å™¨æœªç§»é™¤

---

#### æ–¹æ³•3ï¼šPerformanceå½•åˆ¶åˆ†æ

**æ­¥éª¤ï¼š**
```
1. æ‰“å¼€DevTools â†’ Performance
2. å‹¾é€‰ "Memory"
3. ç‚¹å‡»Recordï¼Œæ‰§è¡Œæ“ä½œï¼ˆå¦‚æ‰“å¼€å…³é—­å¼¹çª—20æ¬¡ï¼‰
4. åœæ­¢å½•åˆ¶
5. æŸ¥çœ‹Memoryæ›²çº¿
```

**åˆ¤æ–­æ ‡å‡†ï¼š**
- é”¯é½¿çŠ¶æ­£å¸¸ï¼ˆGCå›æ”¶ï¼‰
- æŒç»­ä¸Šå‡ä¸ä¸‹é™ â†’ å†…å­˜æ³„æ¼
- çªç„¶æ‰è½æ˜¯GCå·¥ä½œ

---

#### æ–¹æ³•4ï¼šä»£ç æ£€æŸ¥æ³•

**ä½¿ç”¨ESLintæ’ä»¶ï¼š**
```javascript
// .eslintrc.js
module.exports = {
  plugins: ['react-hooks', 'vue'],
  rules: {
    'react-hooks/exhaustive-deps': 'warn',  // æ£€æŸ¥useEffectä¾èµ–
    'vue/no-lifecycle-after-await': 'error'  // æ£€æŸ¥Vueç”Ÿå‘½å‘¨æœŸ
  }
};
```

---

### å†…å­˜æ³„æ¼ä¼˜åŒ–æ–¹æ¡ˆ â­â­â­â­â­

#### ä¼˜åŒ–æ–¹æ¡ˆæ€»ç»“è¡¨

| åœºæ™¯ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | ä»£ç ç¤ºä¾‹ |
|------|------|---------|---------|
| **å®šæ—¶å™¨** | ç»„ä»¶é”€æ¯å®šæ—¶å™¨æœªæ¸…é™¤ | beforeUnmountæ¸…é™¤ | `clearInterval(timer)` |
| **äº‹ä»¶ç›‘å¬** | äº‹ä»¶ç›‘å¬å™¨æœªç§»é™¤ | removeEventListener | `window.removeEventListener('resize', fn)` |
| **é—­åŒ…** | é—­åŒ…æŒæœ‰å¤§å¯¹è±¡ | æ‰‹åŠ¨é‡Šæ”¾å¼•ç”¨ | `largeData = null` |
| **DOMå¼•ç”¨** | åˆ é™¤DOMåä»å¼•ç”¨ | æ¸…ç©ºå¼•ç”¨ | `element = null` |
| **è®¢é˜…** | ç¬¬ä¸‰æ–¹åº“è®¢é˜…æœªå–æ¶ˆ | å–æ¶ˆè®¢é˜… | `subscription.unsubscribe()` |
| **å…¨å±€å˜é‡** | æ„å¤–å…¨å±€å˜é‡ | ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ | `'use strict'` |
| **WeakMap** | å¼ºå¼•ç”¨å¯¼è‡´æ— æ³•GC | ä½¿ç”¨WeakMap | `new WeakMap()` |

---

#### ä¼˜åŒ–æŠ€å·§1ï¼šä½¿ç”¨WeakMap/WeakSet

```javascript
// âŒ ä¸å¥½ï¼šMapå¼ºå¼•ç”¨ï¼Œå³ä½¿DOMåˆ é™¤ä¹Ÿä¸ä¼šGC
const cache = new Map();
const element = document.getElementById('btn');
cache.set(element, { data: 'some data' });

element.remove();  // DOMåˆ é™¤
// ä½†cacheä»ç„¶æŒæœ‰elementå¼•ç”¨ï¼Œå†…å­˜æ³„æ¼

// âœ… å¥½ï¼šWeakMapå¼±å¼•ç”¨ï¼ŒDOMåˆ é™¤åè‡ªåŠ¨GC
const cache = new WeakMap();
const element = document.getElementById('btn');
cache.set(element, { data: 'some data' });

element.remove();  // DOMåˆ é™¤
// WeakMapä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸ä¼šæ³„æ¼
```

---

#### ä¼˜åŒ–æŠ€å·§2ï¼šVue3ç»„åˆå¼APIè‡ªåŠ¨æ¸…ç†

```javascript
// Vue3çš„onUnmountedä¼šè‡ªåŠ¨æ¸…ç†
import { onMounted, onUnmounted } from 'vue';

export default {
  setup() {
    let timer = null;

    onMounted(() => {
      timer = setInterval(() => {
        console.log('tick');
      }, 1000);
    });

    // è‡ªåŠ¨æ¸…ç†
    onUnmounted(() => {
      if (timer) {
        clearInterval(timer);
      }
    });
  }
}
```

---

#### ä¼˜åŒ–æŠ€å·§3ï¼šReactè‡ªå®šä¹‰Hookå°è£…

```javascript
// å°è£…é€šç”¨æ¸…ç†Hook
function useCleanup(callback) {
  const savedCallback = useRef();

  useEffect(() => {
    savedCallback.current = callback;
  }, [callback]);

  useEffect(() => {
    return () => {
      if (savedCallback.current) {
        savedCallback.current();
      }
    };
  }, []);
}

// ä½¿ç”¨
function Component() {
  const timer = useRef();

  useEffect(() => {
    timer.current = setInterval(() => {
      console.log('tick');
    }, 1000);
  }, []);

  // è‡ªåŠ¨æ¸…ç†
  useCleanup(() => {
    if (timer.current) {
      clearInterval(timer.current);
    }
  });
}
```

---

### å®æˆ˜æ¡ˆä¾‹ï¼šçœŸå®é¡¹ç›®å†…å­˜æ³„æ¼ä¼˜åŒ– â­â­â­â­â­

#### æ¡ˆä¾‹1ï¼šåœ°å›¾ç»„ä»¶å†…å­˜æ³„æ¼

**é—®é¢˜ï¼š** ä½¿ç”¨é«˜å¾·åœ°å›¾ï¼Œåˆ‡æ¢è·¯ç”±åå†…å­˜æŒç»­å¢é•¿

**åˆ†æï¼š**
```javascript
// âŒ é—®é¢˜ä»£ç 
export default {
  mounted() {
    this.map = new AMap.Map('container', {
      zoom: 11,
      center: [116.397428, 39.90923]
    });
  }
  // ç»„ä»¶é”€æ¯ï¼Œåœ°å›¾å®ä¾‹æ²¡æœ‰é”€æ¯
}
```

**è§£å†³ï¼š**
```javascript
// âœ… ä¼˜åŒ–ä»£ç 
export default {
  data() {
    return {
      map: null
    }
  },
  mounted() {
    this.map = new AMap.Map('container', {
      zoom: 11,
      center: [116.397428, 39.90923]
    });
  },
  beforeUnmount() {
    if (this.map) {
      this.map.destroy();  // é”€æ¯åœ°å›¾å®ä¾‹
      this.map = null;
    }
  }
}
```

**æ•ˆæœï¼š** å†…å­˜å ç”¨ä»500MBé™åˆ°80MB

---

#### æ¡ˆä¾‹2ï¼šå›¾è¡¨ç»„ä»¶å†…å­˜æ³„æ¼

**é—®é¢˜ï¼š** ä½¿ç”¨EChartsï¼Œåˆ‡æ¢è·¯ç”±10æ¬¡åæµè§ˆå™¨å´©æºƒ

**åˆ†æï¼š**
```javascript
// âŒ é—®é¢˜ä»£ç 
export default {
  mounted() {
    this.chart = echarts.init(this.$refs.chart);
    this.chart.setOption(this.options);

    window.addEventListener('resize', this.handleResize);
  },
  methods: {
    handleResize() {
      this.chart.resize();
    }
  }
  // chartå®ä¾‹å’Œresizeç›‘å¬å™¨éƒ½æ²¡æ¸…ç†
}
```

**è§£å†³ï¼š**
```javascript
// âœ… ä¼˜åŒ–ä»£ç 
export default {
  data() {
    return {
      chart: null
    }
  },
  mounted() {
    this.initChart();
    window.addEventListener('resize', this.handleResize);
  },
  methods: {
    initChart() {
      this.chart = echarts.init(this.$refs.chart);
      this.chart.setOption(this.options);
    },
    handleResize() {
      if (this.chart) {
        this.chart.resize();
      }
    }
  },
  beforeUnmount() {
    // æ¸…ç†å›¾è¡¨
    if (this.chart) {
      this.chart.dispose();
      this.chart = null;
    }
    // ç§»é™¤ç›‘å¬å™¨
    window.removeEventListener('resize', this.handleResize);
  }
}
```

**æ•ˆæœï¼š** åˆ‡æ¢100æ¬¡è·¯ç”±ï¼Œå†…å­˜ç¨³å®šåœ¨150MBä»¥å†…

---

#### æ¡ˆä¾‹3ï¼šWebSocketè¿æ¥æ³„æ¼

**é—®é¢˜ï¼š** å®æ—¶èŠå¤©åº”ç”¨ï¼Œåˆ‡æ¢é¡µé¢åè¿æ¥æœªæ–­å¼€

**åˆ†æï¼š**
```javascript
// âŒ é—®é¢˜ä»£ç 
export default {
  mounted() {
    this.ws = new WebSocket('ws://localhost:8080');

    this.ws.onmessage = (e) => {
      console.log('æ”¶åˆ°æ¶ˆæ¯:', e.data);
    };
  }
  // ç»„ä»¶é”€æ¯ï¼ŒWebSocketè¿æ¥è¿˜åœ¨
}
```

**è§£å†³ï¼š**
```javascript
// âœ… ä¼˜åŒ–ä»£ç 
export default {
  data() {
    return {
      ws: null
    }
  },
  mounted() {
    this.connectWebSocket();
  },
  methods: {
    connectWebSocket() {
      this.ws = new WebSocket('ws://localhost:8080');

      this.ws.onmessage = (e) => {
        console.log('æ”¶åˆ°æ¶ˆæ¯:', e.data);
      };
    }
  },
  beforeUnmount() {
    if (this.ws) {
      this.ws.close();  // å…³é—­è¿æ¥
      this.ws = null;
    }
  }
}
```

---

### é¢è¯•é«˜é¢‘é—®ç­” â­â­â­â­â­

#### Q1: å¦‚ä½•æ£€æµ‹å’Œä¼˜åŒ–å†…å­˜æ³„æ¼ï¼Ÿ

**ç­”é¢˜ç»“æ„ï¼ˆæ¨èï¼‰ï¼š**

> **æ£€æµ‹æ–¹æ³•æˆ‘ä¸»è¦ç”¨ä¸‰ç§ï¼š**
>
> **ç¬¬ä¸€ï¼ŒChrome DevToolsçš„Memoryå·¥å…·ã€‚**å…·ä½“æ“ä½œæ˜¯å…ˆæ‹ä¸€ä¸ªå †å¿«ç…§ï¼Œç„¶åæ‰§è¡Œå¯èƒ½æ³„æ¼çš„æ“ä½œï¼Œæ¯”å¦‚æ‰“å¼€å…³é—­å¼¹çª—10æ¬¡ï¼Œå†æ‹ä¸€ä¸ªå¿«ç…§ï¼Œç”¨Comparisonæ¨¡å¼å¯¹æ¯”ä¸¤ä¸ªå¿«ç…§ã€‚å¦‚æœDeltaæŒç»­å¢é•¿ï¼ŒFreed Sizeå¾ˆå°‘ï¼Œè¯´æ˜æœ‰å†…å­˜æ³„æ¼ã€‚æˆ‘ä¹‹å‰å°±æ˜¯ç”¨è¿™ä¸ªæ–¹æ³•å‘ç°äº†ä¸€ä¸ªåœ°å›¾ç»„ä»¶æ³„æ¼ï¼Œæ¯æ¬¡åˆ‡æ¢è·¯ç”±å¢é•¿50MBï¼Œæœ€åå®šä½åˆ°æ˜¯mapå®ä¾‹æ²¡æœ‰destroyã€‚
>
> **ç¬¬äºŒï¼ŒPerformance Monitorå®æ—¶ç›‘æ§ã€‚**æ‰“å¼€Performance monitorï¼Œè§‚å¯ŸJS heap sizeã€DOM Nodesã€Event listenersè¿™ä¸‰ä¸ªæŒ‡æ ‡ã€‚å¦‚æœæ‰§è¡Œæ“ä½œåè¿™äº›æ•°å€¼æŒç»­ä¸Šå‡ä¸å›è½ï¼Œå°±å¯èƒ½å­˜åœ¨æ³„æ¼ã€‚æˆ‘ç”¨è¿™ä¸ªæ–¹æ³•å‘ç°è¿‡EChartså›¾è¡¨ç»„ä»¶çš„æ³„æ¼ï¼Œåˆ‡æ¢10æ¬¡è·¯ç”±åevent listenersä»100æ¶¨åˆ°500ã€‚
>
> **ç¬¬ä¸‰ï¼ŒPerformanceå½•åˆ¶åˆ†æã€‚**å½•åˆ¶ä¸€æ®µæ—¶é—´çš„æ€§èƒ½ï¼ŒæŸ¥çœ‹Memoryæ›²çº¿ã€‚æ­£å¸¸æƒ…å†µåº”è¯¥æ˜¯é”¯é½¿çŠ¶ï¼Œæœ‰å‡æœ‰é™ï¼Œå¦‚æœæŒç»­ä¸Šå‡ä¸ä¸‹é™å°±æœ‰é—®é¢˜ã€‚
>
> **å¸¸è§çš„ä¼˜åŒ–æ–¹æ¡ˆåŒ…æ‹¬ï¼š**
> 1. ç»„ä»¶é”€æ¯æ—¶æ¸…é™¤å®šæ—¶å™¨ï¼šbeforeUnmounté‡ŒclearInterval
> 2. ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼šremoveEventListener
> 3. é”€æ¯ç¬¬ä¸‰æ–¹å®ä¾‹ï¼šmap.destroy()ã€chart.dispose()
> 4. å…³é—­è¿æ¥ï¼šws.close()
> 5. å–æ¶ˆè®¢é˜…ï¼šsubscription.unsubscribe()
> 6. ä½¿ç”¨WeakMapä»£æ›¿Mapï¼Œé¿å…å¼ºå¼•ç”¨
>
> **æˆ‘ä¹‹å‰ä¼˜åŒ–è¿‡ä¸€ä¸ªçœŸå®é¡¹ç›®ï¼Œ**ç”¨æˆ·åé¦ˆåˆ‡æ¢é¡µé¢å‡ æ¬¡åå°±å¾ˆå¡ã€‚æˆ‘ç”¨Memoryå·¥å…·åˆ†æï¼Œå‘ç°æ¯æ¬¡åˆ‡æ¢å¢é•¿300MBï¼Œå®šä½åˆ°æ˜¯é«˜å¾·åœ°å›¾å’ŒEChartså®ä¾‹æ²¡æœ‰é”€æ¯ã€‚åŠ ä¸Šdestroy()å’Œdispose()åï¼Œå†…å­˜ä»å³°å€¼800MBé™åˆ°ç¨³å®š150MBï¼Œç”¨æˆ·ä½“éªŒæ˜æ˜¾æ”¹å–„ã€‚

---

#### Q2: Vue/Reactä¸­å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ï¼Ÿ

**Vueé¿å…å†…å­˜æ³„æ¼ï¼š**
```javascript
export default {
  data() {
    return {
      timer: null,
      observer: null,
      chart: null
    }
  },
  mounted() {
    // 1. å®šæ—¶å™¨
    this.timer = setInterval(() => {}, 1000);

    // 2. äº‹ä»¶ç›‘å¬
    window.addEventListener('resize', this.handleResize);

    // 3. IntersectionObserver
    this.observer = new IntersectionObserver(() => {});

    // 4. ç¬¬ä¸‰æ–¹åº“
    this.chart = echarts.init(this.$refs.chart);
  },
  beforeUnmount() {
    // æ¸…ç†æ‰€æœ‰èµ„æº
    if (this.timer) clearInterval(this.timer);
    window.removeEventListener('resize', this.handleResize);
    if (this.observer) this.observer.disconnect();
    if (this.chart) this.chart.dispose();
  }
}
```

**Reacté¿å…å†…å­˜æ³„æ¼ï¼š**
```javascript
function Component() {
  useEffect(() => {
    const timer = setInterval(() => {}, 1000);
    const handleResize = () => {};

    window.addEventListener('resize', handleResize);

    // è¿”å›æ¸…ç†å‡½æ•°
    return () => {
      clearInterval(timer);
      window.removeEventListener('resize', handleResize);
    };
  }, []);
}
```

---

**è®°å¿†å£è¯€ï¼š**
```
å†…å­˜æ³„æ¼å››å¤§å‡¶ï¼šå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ã€é—­åŒ…å¼•ç”¨ã€DOMæ®‹ç•™
æ£€æµ‹ä¸‰æ³•å®ï¼šHeap snapshotã€Performance Monitorã€Memoryæ›²çº¿
ä¼˜åŒ–è®°æ¸…ç†ï¼šbeforeUnmounté”€æ¯ã€removeEventListenerã€å®ä¾‹destroy
```

---

## 5. ç™½å±é—®é¢˜ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šç™½å±åŸå› è¦æ‰¾å‡†ã€SSRéª¨æ¶åŠ è½½å¿«ã€èµ„æºä¼˜åŒ–ä¸èƒ½å°‘**

### ä»€ä¹ˆæ˜¯ç™½å±é—®é¢˜ï¼Ÿ

**å®šä¹‰ï¼š** ç”¨æˆ·æ‰“å¼€é¡µé¢åï¼Œé•¿æ—¶é—´çœ‹åˆ°ç©ºç™½é¡µé¢ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹æ˜¾ç¤º

**å½±å“ï¼š**
- ç”¨æˆ·ä½“éªŒæå·®ï¼Œè·³å‡ºç‡é«˜
- é¦–å±FCP/LCPæŒ‡æ ‡å·®
- SEOä¸å‹å¥½ï¼ˆæœç´¢å¼•æ“æŠ“ä¸åˆ°å†…å®¹ï¼‰

---

### ç™½å±äº§ç”Ÿçš„åŸå›  â­â­â­â­â­

#### åŸå› 1ï¼šJavaScriptæ–‡ä»¶è¿‡å¤§ï¼ŒåŠ è½½æ…¢
```html
<!-- âŒ é—®é¢˜ï¼šå•ä¸ªbundleå¤ªå¤§ -->
<script src="app.js"></script>  <!-- 3MBï¼ŒåŠ è½½5ç§’ -->

<!-- é¡µé¢ç»“æ„ -->
<div id="app"></div>
<!-- åœ¨JSåŠ è½½å®Œä¹‹å‰ï¼Œdivæ˜¯ç©ºçš„ï¼Œç™½å± -->
```

**è¡¨ç°ï¼š** ç½‘ç»œæ…¢æˆ–JSæ–‡ä»¶å¤§ï¼ŒåŠ è½½æ—¶é—´é•¿ï¼Œç™½å±æ—¶é—´é•¿

---

#### åŸå› 2ï¼šJavaScriptæ‰§è¡Œæ—¶é—´é•¿
```javascript
// âŒ é—®é¢˜ï¼šé¦–å±æ‰§è¡Œå¤§é‡åŒæ­¥è®¡ç®—
function App() {
  // é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œè€—æ—¶è®¡ç®—
  const data = heavyComputation();  // è€—æ—¶3ç§’

  return <div>{data}</div>;
}

// 3ç§’å†…é¡µé¢ä¸€ç‰‡ç©ºç™½
```

**è¡¨ç°ï¼š** JSåŠ è½½å®Œäº†ï¼Œä½†æ‰§è¡Œè€—æ—¶ï¼Œç™½å±

---

#### åŸå› 3ï¼šCSSæ–‡ä»¶é˜»å¡æ¸²æŸ“
```html
<!-- âŒ é—®é¢˜ï¼šCSSæ–‡ä»¶è¿‡å¤§æˆ–åŠ è½½æ…¢ -->
<head>
  <link rel="stylesheet" href="large-style.css">  <!-- 1MB CSS -->
</head>
<body>
  <div id="app">é¦–é¡µå†…å®¹</div>
</body>

<!-- CSSæœªåŠ è½½å®Œï¼Œé¡µé¢ä¸æ¸²æŸ“ï¼Œç™½å± -->
```

**è¡¨ç°ï¼š** CSSåŠ è½½æ…¢ï¼Œé˜»å¡é¡µé¢æ¸²æŸ“ï¼Œç™½å±

---

#### åŸå› 4ï¼šé¦–å±ä¾èµ–æ¥å£æ•°æ®
```javascript
// âŒ é—®é¢˜ï¼šé¦–å±ä¾èµ–å¼‚æ­¥æ•°æ®
export default {
  data() {
    return {
      list: []
    }
  },
  async mounted() {
    this.list = await fetchData();  // æ¥å£è€—æ—¶2ç§’
  }
}

// æ¥å£è¿”å›å‰ï¼Œé¡µé¢å†…å®¹ä¸ºç©ºï¼Œç™½å±
```

**è¡¨ç°ï¼š** æ¥å£æ…¢ï¼Œé¦–å±æ— å†…å®¹ï¼Œç™½å±

---

#### åŸå› 5ï¼šä»£ç æŠ¥é”™å¯¼è‡´é¡µé¢å´©æºƒ
```javascript
// âŒ é—®é¢˜ï¼šä»£ç æŠ¥é”™ï¼Œé¡µé¢æ¸²æŸ“å¤±è´¥
export default {
  mounted() {
    this.undefined.method();  // æŠ¥é”™
  }
}

// ä»£ç æŠ¥é”™ï¼Œç™½å±
```

**è¡¨ç°ï¼š** JSæŠ¥é”™ï¼Œé¡µé¢æ— æ³•æ¸²æŸ“ï¼Œç™½å±

---

### ç™½å±é—®é¢˜æ’æŸ¥æ–¹æ³• â­â­â­â­â­

#### æ–¹æ³•1ï¼šChrome DevToolsæ’æŸ¥

**æ­¥éª¤ï¼š**
```
1. æ‰“å¼€DevTools â†’ Network
   - æŸ¥çœ‹èµ„æºåŠ è½½æ—¶é—´
   - æ‰¾å‡ºåŠ è½½æ…¢çš„èµ„æºï¼ˆçº¢è‰²æˆ–é•¿æ¡ï¼‰

2. æ‰“å¼€DevTools â†’ Performance
   - å½•åˆ¶é¦–å±åŠ è½½
   - æŸ¥çœ‹Parse HTMLã€Evaluate Scriptæ—¶é—´
   - æ‰¾å‡ºè€—æ—¶æ“ä½œ

3. æ‰“å¼€DevTools â†’ Console
   - æŸ¥çœ‹æ˜¯å¦æœ‰JSæŠ¥é”™
   - æŸ¥çœ‹warningä¿¡æ¯

4. æ‰“å¼€DevTools â†’ Coverage
   - æŸ¥çœ‹é¦–å±CSS/JSä½¿ç”¨ç‡
   - æ‰¾å‡ºæœªä½¿ç”¨çš„ä»£ç 
```

---

#### æ–¹æ³•2ï¼šLighthouseåˆ†æ

**æ­¥éª¤ï¼š**
```
1. æ‰“å¼€DevTools â†’ Lighthouse
2. é€‰æ‹© "Performance" + "Desktop/Mobile"
3. ç‚¹å‡» "Analyze page load"
4. æŸ¥çœ‹è¯Šæ–­ç»“æœï¼š
   - FCPï¼ˆé¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼‰
   - LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰
   - TTIï¼ˆå¯äº¤äº’æ—¶é—´ï¼‰
   - Blocking Timeï¼ˆé˜»å¡æ—¶é—´ï¼‰
```

**å…³é”®æŒ‡æ ‡ï¼š**
- FCP > 3s â†’ ç™½å±é—®é¢˜ä¸¥é‡
- LCP > 4s â†’ é¦–å±åŠ è½½æ…¢
- TTI > 7s â†’ å¯äº¤äº’å»¶è¿Ÿé«˜

---

#### æ–¹æ³•3ï¼šçœŸæœºæµ‹è¯•

```javascript
// æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œ
// Chrome DevTools â†’ Network â†’ Throttling

- Fast 3Gï¼šä¸‹è½½1.6Mbpsï¼Œä¸Šä¼ 750Kbps
- Slow 3Gï¼šä¸‹è½½400Kbpsï¼Œä¸Šä¼ 400Kbps
- Offlineï¼šç¦»çº¿æ¨¡å¼

// åœ¨æ…¢ç½‘ç¯å¢ƒä¸‹æµ‹è¯•ç™½å±æ—¶é—´
```

---

### ç™½å±é—®é¢˜è§£å†³æ–¹æ¡ˆ â­â­â­â­â­

#### æ–¹æ¡ˆ1ï¼šéª¨æ¶å±ï¼ˆæ¨èï¼‰â­â­â­â­â­

**å®šä¹‰ï¼š** åœ¨å†…å®¹åŠ è½½å‰ï¼Œæ˜¾ç¤ºé¡µé¢çš„å¤§è‡´ç»“æ„ï¼Œé¿å…å®Œå…¨ç™½å±

**å®ç°æ–¹å¼ï¼š**

**1) æ‰‹åŠ¨ç¼–å†™éª¨æ¶å±**
```vue
<template>
  <div class="page">
    <!-- éª¨æ¶å± -->
    <div v-if="loading" class="skeleton">
      <div class="skeleton-header"></div>
      <div class="skeleton-item" v-for="i in 5" :key="i"></div>
    </div>

    <!-- çœŸå®å†…å®¹ -->
    <div v-else class="content">
      <div class="header">{{ title }}</div>
      <div class="item" v-for="item in list" :key="item.id">
        {{ item.name }}
      </div>
    </div>
  </div>
</template>

<style>
.skeleton-header {
  width: 100%;
  height: 60px;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

.skeleton-item {
  width: 100%;
  height: 80px;
  margin-top: 10px;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
</style>
```

**2) ä½¿ç”¨æ’ä»¶è‡ªåŠ¨ç”Ÿæˆï¼ˆæ¨èï¼‰**
```javascript
// Vueé¡¹ç›®ï¼šä½¿ç”¨vue-skeleton-webpack-plugin
// å®‰è£…
npm install vue-skeleton-webpack-plugin

// webpacké…ç½®
const SkeletonWebpackPlugin = require('vue-skeleton-webpack-plugin');

module.exports = {
  plugins: [
    new SkeletonWebpackPlugin({
      webpackConfig: require('./webpack.skeleton.conf'),
      quiet: true
    })
  ]
};
```

**3) æœåŠ¡ç«¯ç›´å‡ºéª¨æ¶å±ï¼ˆæœ€ä½³ï¼‰**
```html
<!-- index.htmlç›´æ¥å†™éª¨æ¶å± -->
<!DOCTYPE html>
<html>
<head>
  <style>
    .skeleton { /* éª¨æ¶å±æ ·å¼ */ }
  </style>
</head>
<body>
  <div id="app">
    <!-- éª¨æ¶å±HTMLï¼Œé¦–å±ç›´æ¥æ˜¾ç¤º -->
    <div class="skeleton">
      <div class="skeleton-header"></div>
      <div class="skeleton-item"></div>
      <div class="skeleton-item"></div>
    </div>
  </div>
  <script src="app.js"></script>
  <!-- JSåŠ è½½åï¼ŒVue/Reactä¼šæ›¿æ¢æ‰éª¨æ¶å± -->
</body>
</html>
```

**æ•ˆæœï¼š** ç™½å±æ—¶é—´ä»3ç§’é™åˆ°0ç§’ï¼ˆç«‹å³æ˜¾ç¤ºéª¨æ¶å±ï¼‰

---

#### æ–¹æ¡ˆ2ï¼šLoadingåŠ è½½åŠ¨ç”» â­â­â­â­

```html
<!DOCTYPE html>
<html>
<head>
  <style>
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- é¦–å±Loading -->
    <div id="loading">
      <div class="spinner"></div>
      <p>åŠ è½½ä¸­...</p>
    </div>
  </div>

  <script>
    // Vue/ReactæŒ‚è½½åï¼Œéšè—Loading
    window.addEventListener('load', () => {
      const loading = document.getElementById('loading');
      if (loading) {
        loading.style.display = 'none';
      }
    });
  </script>
  <script src="app.js"></script>
</body>
</html>
```

---

#### æ–¹æ¡ˆ3ï¼šSSRæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆæœ€ä½³æ–¹æ¡ˆï¼‰â­â­â­â­â­

**å®šä¹‰ï¼š** æœåŠ¡ç«¯æ¸²æŸ“å¥½HTMLï¼Œç›´æ¥è¿”å›å®Œæ•´é¡µé¢ï¼Œæ— ç™½å±

**å¯¹æ¯”ï¼š**

| æ¨¡å¼ | é¦–å±æ¸²æŸ“ | ç™½å±æ—¶é—´ | SEO | æœåŠ¡å™¨å‹åŠ› |
|------|---------|---------|-----|----------|
| **CSR**ï¼ˆå®¢æˆ·ç«¯æ¸²æŸ“ï¼‰ | JSæ¸²æŸ“ | é•¿ï¼ˆ3-5sï¼‰ | å·® | å° |
| **SSR**ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ | æœåŠ¡ç«¯æ¸²æŸ“ | çŸ­ï¼ˆ<1sï¼‰ | å¥½ | å¤§ |

**å®ç°ï¼š**

**Vue SSRï¼ˆNuxt.jsï¼‰**
```javascript
// nuxt.config.js
export default {
  ssr: true,  // å¼€å¯SSR
  target: 'server'
}

// pages/index.vue
export default {
  async asyncData({ $axios }) {
    const data = await $axios.$get('/api/data');
    return { data };
  }
}

// æœåŠ¡ç«¯ç›´æ¥æ¸²æŸ“å¥½HTMLè¿”å›ï¼Œæ— ç™½å±
```

**React SSRï¼ˆNext.jsï¼‰**
```javascript
// pages/index.js
export default function Home({ data }) {
  return <div>{data}</div>;
}

export async function getServerSideProps() {
  const res = await fetch('https://api.example.com/data');
  const data = await res.json();

  return {
    props: { data }
  };
}

// æœåŠ¡ç«¯æ¸²æŸ“ï¼Œé¦–å±ç›´æ¥æœ‰å†…å®¹
```

**æ•ˆæœï¼š** ç™½å±æ—¶é—´ä»3ç§’é™åˆ°0.5ç§’ä»¥å†…

---

#### æ–¹æ¡ˆ4ï¼šèµ„æºä¼˜åŒ–ï¼ˆå¿…åšï¼‰â­â­â­â­â­

**1) ä»£ç åˆ†å‰²ï¼Œå‡å°é¦–å±bundle**
```javascript
// è·¯ç”±æ‡’åŠ è½½
const Home = () => import('./Home.vue');
const About = () => import('./About.vue');

// ç»„ä»¶æ‡’åŠ è½½
const HeavyChart = defineAsyncComponent(() => import('./Chart.vue'));
```

**æ•ˆæœï¼š** é¦–å±JSä»2MBé™åˆ°500KB

---

**2) å…³é”®CSSå†…è”**
```html
<head>
  <style>
    /* å…³é”®CSSå†…è”ï¼Œé¦–å±ç«‹å³æ¸²æŸ“ */
    body { margin: 0; font-family: Arial; }
    .header { height: 60px; background: #fff; }
  </style>

  <!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ -->
  <link rel="preload" href="main.css" as="style" onload="this.rel='stylesheet'">
</head>
```

**æ•ˆæœï¼š** FCPä»2.5sé™åˆ°1.2s

---

**3) é¢„åŠ è½½å…³é”®èµ„æº**
```html
<head>
  <!-- DNSé¢„è§£æ -->
  <link rel="dns-prefetch" href="https://api.example.com">

  <!-- é¢„è¿æ¥ -->
  <link rel="preconnect" href="https://cdn.example.com">

  <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
  <link rel="preload" href="main.js" as="script">
  <link rel="preload" href="logo.png" as="image">
</head>
```

---

**4) å¼€å¯Gzip/Brotliå‹ç¼©**
```nginx
# Nginxé…ç½®
gzip on;
gzip_types text/css application/javascript image/svg+xml;
gzip_min_length 1024;
gzip_comp_level 6;
```

**æ•ˆæœï¼š** æ–‡ä»¶ä½“ç§¯å‡å°‘70%

---

#### æ–¹æ¡ˆ5ï¼šæ¥å£ä¼˜åŒ– â­â­â­â­

**1) é¦–å±æ•°æ®é¢„å–ï¼ˆSSRï¼‰**
```javascript
// æœåŠ¡ç«¯é¢„å–æ•°æ®ï¼Œç›´æ¥è¿”å›
export async function getServerSideProps() {
  const data = await fetchData();
  return { props: { data } };
}

// å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ç­‰å¾…æ¥å£
```

---

**2) æ¥å£å¹¶è¡Œè¯·æ±‚**
```javascript
// âŒ ä¸å¥½ï¼šä¸²è¡Œè¯·æ±‚ï¼Œè€—æ—¶6ç§’
const user = await fetchUser();      // 2ç§’
const orders = await fetchOrders();  // 2ç§’
const products = await fetchProducts();  // 2ç§’

// âœ… å¥½ï¼šå¹¶è¡Œè¯·æ±‚ï¼Œè€—æ—¶2ç§’
const [user, orders, products] = await Promise.all([
  fetchUser(),
  fetchOrders(),
  fetchProducts()
]);
```

---

**3) æ¥å£æ•°æ®ç¼“å­˜**
```javascript
// ä½¿ç”¨localStorageç¼“å­˜é¦–å±æ•°æ®
const cache = localStorage.getItem('homeData');
if (cache) {
  this.data = JSON.parse(cache);  // å…ˆæ˜¾ç¤ºç¼“å­˜æ•°æ®
}

// å¼‚æ­¥æ›´æ–°
fetchData().then(newData => {
  this.data = newData;
  localStorage.setItem('homeData', JSON.stringify(newData));
});
```

---

#### æ–¹æ¡ˆ6ï¼šé”™è¯¯ç›‘æ§å’Œé™çº§ï¼ˆå¿…åšï¼‰â­â­â­â­

**1) é”™è¯¯è¾¹ç•Œï¼ˆReactï¼‰**
```javascript
class ErrorBoundary extends React.Component {
  state = { hasError: false };

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('é¡µé¢é”™è¯¯:', error, errorInfo);
    // ä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§å¹³å°
  }

  render() {
    if (this.state.hasError) {
      // é™çº§å±•ç¤º
      return <div>é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>;
    }

    return this.props.children;
  }
}

// ä½¿ç”¨
<ErrorBoundary>
  <App />
</ErrorBoundary>
```

---

**2) å…¨å±€é”™è¯¯ç›‘å¬**
```javascript
// ç›‘å¬JSé”™è¯¯
window.addEventListener('error', (event) => {
  console.error('é¡µé¢é”™è¯¯:', event.error);

  // ä¸ŠæŠ¥é”™è¯¯
  reportError({
    message: event.message,
    filename: event.filename,
    line: event.lineno,
    col: event.colno,
    stack: event.error?.stack
  });

  // æ˜¾ç¤ºé™çº§é¡µé¢
  document.getElementById('app').innerHTML = `
    <div style="padding: 20px; text-align: center;">
      <h2>é¡µé¢åŠ è½½å¤±è´¥</h2>
      <button onclick="location.reload()">åˆ·æ–°é‡è¯•</button>
    </div>
  `;
});

// ç›‘å¬Promiseæœªæ•è·é”™è¯¯
window.addEventListener('unhandledrejection', (event) => {
  console.error('Promiseé”™è¯¯:', event.reason);
  reportError({ message: event.reason });
});
```

---

### ç™½å±ä¼˜åŒ–æ•ˆæœå¯¹æ¯” â­â­â­â­

| ä¼˜åŒ–æ–¹æ¡ˆ | ç™½å±æ—¶é—´ï¼ˆä¼˜åŒ–å‰ï¼‰ | ç™½å±æ—¶é—´ï¼ˆä¼˜åŒ–åï¼‰ | æå‡ |
|---------|----------------|----------------|------|
| **éª¨æ¶å±** | 3ç§’ | 0ç§’ï¼ˆç«‹å³æ˜¾ç¤ºï¼‰ | 100% |
| **LoadingåŠ¨ç”»** | 3ç§’ | 0ç§’ï¼ˆç«‹å³æ˜¾ç¤ºï¼‰ | 100% |
| **SSR** | 3-5ç§’ | 0.5-1ç§’ | 80% |
| **ä»£ç åˆ†å‰²** | 5ç§’ | 1.5ç§’ | 70% |
| **å…³é”®CSSå†…è”** | 2.5ç§’ | 1.2ç§’ | 52% |
| **Gzipå‹ç¼©** | 3ç§’ | 1ç§’ | 67% |
| **ç»¼åˆä¼˜åŒ–** | 5ç§’ | 0.5ç§’ | 90% |

---

### é¢è¯•é«˜é¢‘é—®ç­” â­â­â­â­â­

#### Q1: ç™½å±é—®é¢˜å¦‚ä½•æ’æŸ¥å’Œä¼˜åŒ–ï¼Ÿ

**ç­”é¢˜ç»“æ„ï¼ˆæ¨è2åˆ†é’Ÿç‰ˆæœ¬ï¼‰ï¼š**

> **ç™½å±é—®é¢˜æˆ‘é‡åˆ°è¿‡å¾ˆå¤šæ¬¡ï¼Œä¸»è¦ä»æ’æŸ¥å’Œä¼˜åŒ–ä¸¤æ–¹é¢æ¥è¯´ã€‚**
>
> **æ’æŸ¥æ–¹æ³•ä¸»è¦ä¸‰ç§ï¼š**
>
> **ç¬¬ä¸€ï¼ŒChrome DevToolsã€‚**æ‰“å¼€NetworkæŸ¥çœ‹èµ„æºåŠ è½½æ—¶é—´ï¼Œæ‰¾å‡ºåŠ è½½æ…¢çš„æ–‡ä»¶ã€‚æ‰“å¼€Performanceå½•åˆ¶é¦–å±åŠ è½½ï¼ŒæŸ¥çœ‹Parse HTMLå’ŒEvaluate Scriptçš„è€—æ—¶ï¼Œæ‰¾å‡ºé˜»å¡æ¸²æŸ“çš„æ“ä½œã€‚æ‰“å¼€ConsoleæŸ¥çœ‹æ˜¯å¦æœ‰JSæŠ¥é”™å¯¼è‡´é¡µé¢å´©æºƒã€‚æˆ‘ä¹‹å‰å°±æ˜¯ç”¨è¿™ä¸ªæ–¹æ³•å‘ç°ä¸€ä¸ª3MBçš„bundleå¯¼è‡´é¦–å±ç™½å±5ç§’ã€‚
>
> **ç¬¬äºŒï¼ŒLighthouseåˆ†æã€‚**è¿è¡ŒLighthouseå¾—åˆ†ï¼Œé‡ç‚¹çœ‹FCPã€LCPã€TTIä¸‰ä¸ªæŒ‡æ ‡ã€‚å¦‚æœFCPå¤§äº3ç§’ï¼Œè¯´æ˜é¦–å±ç™½å±é—®é¢˜ä¸¥é‡ã€‚Lighthouseè¿˜ä¼šç»™å‡ºå…·ä½“ä¼˜åŒ–å»ºè®®ï¼Œæ¯”å¦‚å‡å°‘é˜»å¡èµ„æºã€å¯ç”¨æ–‡æœ¬å‹ç¼©ç­‰ã€‚
>
> **ç¬¬ä¸‰ï¼ŒçœŸæœºæµ‹è¯•ã€‚**åœ¨æ…¢é€Ÿ3Gç½‘ç»œä¸‹æµ‹è¯•ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·ç¯å¢ƒã€‚å¾ˆå¤šé—®é¢˜åœ¨å¿«ç½‘ä¸‹ä¸æ˜æ˜¾ï¼Œæ…¢ç½‘ä¸‹å°±æš´éœ²äº†ã€‚
>
> **ä¼˜åŒ–æ–¹æ¡ˆæˆ‘ä¸»è¦ç”¨äº”ç§ï¼š**
>
> **1. éª¨æ¶å±ï¼ˆæœ€æ¨èï¼‰ã€‚**åœ¨é¦–å±å†…å®¹åŠ è½½å‰ï¼Œå…ˆæ˜¾ç¤ºé¡µé¢çš„éª¨æ¶ç»“æ„ï¼Œç»™ç”¨æˆ·æ˜ç¡®çš„åŠ è½½åé¦ˆã€‚æˆ‘ä¼šåœ¨index.htmlé‡Œç›´æ¥å†™éª¨æ¶å±çš„HTMLå’ŒCSSï¼ŒJSåŠ è½½åVueæˆ–Reactä¼šè‡ªåŠ¨æ›¿æ¢æ‰ï¼Œè¿™æ ·ç™½å±æ—¶é—´ç›´æ¥é™åˆ°0ç§’ã€‚
>
> **2. SSRæœåŠ¡ç«¯æ¸²æŸ“ã€‚**ä½¿ç”¨Nuxtæˆ–Next.jsï¼ŒæœåŠ¡ç«¯ç›´æ¥æ¸²æŸ“å¥½HTMLè¿”å›ï¼Œé¦–å±ç›´æ¥æœ‰å†…å®¹ã€‚å¯¹æ¯”CSRå®¢æˆ·ç«¯æ¸²æŸ“ï¼Œç™½å±æ—¶é—´ä»3-5ç§’é™åˆ°0.5ç§’ä»¥å†…ï¼Œè€Œä¸”SEOå‹å¥½ã€‚
>
> **3. èµ„æºä¼˜åŒ–ã€‚**è·¯ç”±æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²ï¼ŒæŠŠé¦–å±bundleä»2MBé™åˆ°500KBã€‚å…³é”®CSSå†…è”ï¼Œéå…³é”®CSSå¼‚æ­¥åŠ è½½ã€‚å¼€å¯Gzipå‹ç¼©ï¼Œæ–‡ä»¶ä½“ç§¯å‡å°‘70%ã€‚ä½¿ç”¨preloadé¢„åŠ è½½å…³é”®èµ„æºã€‚
>
> **4. æ¥å£ä¼˜åŒ–ã€‚**é¦–å±æ¥å£å¹¶è¡Œè¯·æ±‚ï¼Œä¸è¦ä¸²è¡Œã€‚ä½¿ç”¨localStorageç¼“å­˜é¦–å±æ•°æ®ï¼Œå…ˆå±•ç¤ºç¼“å­˜ï¼Œå†å¼‚æ­¥æ›´æ–°ã€‚å¦‚æœæœ‰SSRï¼ŒæœåŠ¡ç«¯é¢„å–æ•°æ®ã€‚
>
> **5. é”™è¯¯ç›‘æ§ã€‚**å…¨å±€ç›‘å¬JSé”™è¯¯å’ŒPromiseé”™è¯¯ï¼Œä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œæ˜¾ç¤ºå‹å¥½çš„é™çº§é¡µé¢ï¼Œè€Œä¸æ˜¯ç™½å±ã€‚åŒæ—¶ä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§å¹³å°ï¼ŒåŠæ—¶ä¿®å¤ã€‚
>
> **æˆ‘ä¹‹å‰ä¼˜åŒ–è¿‡ä¸€ä¸ªçœŸå®é¡¹ç›®ï¼Œ**ç”¨æˆ·åé¦ˆé¦–å±ç™½å±å¾ˆä¹…ã€‚æˆ‘ç”¨Performanceåˆ†æï¼Œå‘ç°é¦–å±bundle 3MBï¼ŒåŠ ä¸Šæ¥å£ä¸²è¡Œè¯·æ±‚ï¼Œç™½å±é•¿è¾¾6ç§’ã€‚æˆ‘åŠ äº†éª¨æ¶å±ã€åšäº†ä»£ç åˆ†å‰²ã€æ¥å£æ”¹å¹¶è¡Œï¼Œå¼€å¯Gzipï¼Œæœ€ç»ˆç™½å±æ—¶é—´é™åˆ°0.5ç§’ï¼ˆéª¨æ¶å±ç«‹å³æ˜¾ç¤ºï¼‰ï¼Œç”¨æˆ·æ»¡æ„åº¦å¤§å¹…æå‡ã€‚

---

#### Q2: éª¨æ¶å±ã€Loadingã€SSRæ€ä¹ˆé€‰ï¼Ÿ

**ç­”æ¡ˆï¼š**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|------|------|---------|--------|
| **éª¨æ¶å±** | ç”¨æˆ·ä½“éªŒå¥½ï¼Œé¡µé¢ç»“æ„æ¸…æ™° | éœ€è¦ç»´æŠ¤éª¨æ¶å±ä»£ç  | æ‰€æœ‰é¡µé¢ | â­â­â­â­â­ |
| **Loading** | å®ç°ç®€å• | ç”¨æˆ·ä½“éªŒä¸€èˆ¬ | ç®€å•é¡µé¢ | â­â­â­ |
| **SSR** | é¦–å±å¿«ï¼ŒSEOå¥½ | æœåŠ¡å™¨å‹åŠ›å¤§ï¼Œå¼€å‘æˆæœ¬é«˜ | ToCäº§å“ã€éœ€è¦SEO | â­â­â­â­â­ |

**æˆ‘çš„é€‰æ‹©å»ºè®®ï¼š**
- **ToCäº§å“ã€å†…å®¹ç½‘ç«™**ï¼šSSR + éª¨æ¶å±ï¼ˆæœ€ä½³ï¼‰
- **ToBåå°ç³»ç»Ÿ**ï¼šéª¨æ¶å± + èµ„æºä¼˜åŒ–
- **ç®€å•é¡µé¢**ï¼šLoading + èµ„æºä¼˜åŒ–

---

**è®°å¿†å£è¯€ï¼š**
```
ç™½å±é—®é¢˜äº”å¤§æ‹›ï¼šéª¨æ¶å±ã€Loadingã€SSRã€èµ„æºä¼˜åŒ–ã€æ¥å£ä¼˜åŒ–
æ’æŸ¥ç”¨DevToolsã€Lighthouseã€çœŸæœºæµ‹è¯•
éª¨æ¶å±æœ€ä½³ã€SSRæœ€å¿«ã€èµ„æºä¼˜åŒ–å¿…åšã€é”™è¯¯ç›‘æ§ä¸èƒ½å°‘
```

---

# å››ã€ç½‘ç»œä¼˜åŒ–

## 1. CDNåŠ é€Ÿ â­â­â­â­â­

**å£è¯€ï¼šå°±è¿‘è®¿é—®ã€å¹¶è¡Œä¸‹è½½ã€å‡è½»æœåŠ¡å™¨**

```html
<!-- ä½¿ç”¨CDN -->
<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
<link href="https://cdn.jsdelivr.net/npm/element-plus@2.3.0/dist/index.css">

<!-- å¤šä¸ªCDNåŸŸåï¼Œçªç ´æµè§ˆå™¨å¹¶å‘é™åˆ¶ -->
<link href="https://cdn1.example.com/a.css">
<link href="https://cdn2.example.com/b.css">
<script src="https://cdn3.example.com/c.js"></script>
```

**ä¼˜ç‚¹ï¼š**
- å°±è¿‘è®¿é—®ï¼Œå»¶è¿Ÿä½
- åˆ†æ•£æµé‡ï¼Œå‡è½»æºç«™å‹åŠ›
- å¤šåŸŸåå¹¶è¡Œä¸‹è½½ï¼ˆæµè§ˆå™¨é™åˆ¶ï¼šåŒåŸŸå6ä¸ªå¹¶å‘ï¼‰

---

## 2. HTTPç¼“å­˜ç­–ç•¥ â­â­â­â­â­

**å£è¯€ï¼šå¼ºç¼“å­˜ä¼˜å…ˆã€åå•†ç¼“å­˜å…œåº•**

### ç¼“å­˜é…ç½®æœ€ä½³å®è·µ

```javascript
// HTMLï¼šåå•†ç¼“å­˜ï¼ˆä¿è¯è·å–æœ€æ–°ï¼‰
app.get('/*.html', (req, res) => {
  res.set({
    'Cache-Control': 'no-cache',
    'ETag': calculateETag(content)
  });
});

// CSS/JSï¼ˆå¸¦hashï¼‰ï¼šå¼ºç¼“å­˜1å¹´
// app.abc123.js
app.get('/static/*.js', (req, res) => {
  res.set({
    'Cache-Control': 'public, max-age=31536000, immutable'
  });
});

// å›¾ç‰‡ï¼šå¼ºç¼“å­˜30å¤©
app.get('/images/*', (req, res) => {
  res.set({
    'Cache-Control': 'public, max-age=2592000'
  });
});

// APIï¼šä¸ç¼“å­˜
app.get('/api/*', (req, res) => {
  res.set({
    'Cache-Control': 'no-store'
  });
});
```

---

## 3. DNSé¢„è§£æå’Œé¢„è¿æ¥ â­â­â­â­

```html
<!-- DNSé¢„è§£æ -->
<link rel="dns-prefetch" href="https://api.example.com">

<!-- é¢„è¿æ¥ï¼ˆDNS + TCP + TLSï¼‰ -->
<link rel="preconnect" href="https://cdn.example.com">

<!-- é¢„åŠ è½½å…³é”®èµ„æº -->
<link rel="preload" href="main.css" as="style">
<link rel="preload" href="main.js" as="script">

<!-- é¢„è·å–ä¸‹ä¸€é¡µèµ„æº -->
<link rel="prefetch" href="/page2.html">
```

### å¯¹æ¯”è¡¨æ ¼

| æŒ‡ä»¤ | ä½œç”¨ | æ—¶æœº | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| dns-prefetch | DNSè§£æ | ç©ºé—²æ—¶ | ç¬¬ä¸‰æ–¹åŸŸå |
| preconnect | DNS+TCP+TLS | ç©ºé—²æ—¶ | é‡è¦èµ„æºåŸŸå |
| preload | æå‰ä¸‹è½½ | ç«‹å³ | å…³é”®èµ„æº |
| prefetch | æå‰ç¼“å­˜ | ç©ºé—²æ—¶ | ä¸‹ä¸€é¡µèµ„æº |

**è®°å¿†å£è¯€ï¼š**
```
ç½‘ç»œä¼˜åŒ–å››æ³•å®ï¼šCDNåŠ é€Ÿã€HTTPç¼“å­˜ã€èµ„æºé¢„åŠ è½½
å¼ºç¼“å­˜ä¸€å¹´ã€åå•†ç¼“å­˜éªŒè¯ã€preloadå…³é”®èµ„æº
```

---

# äº”ã€å›¾ç‰‡ä¼˜åŒ–

## 1. å›¾ç‰‡æ ¼å¼é€‰æ‹© â­â­â­â­â­

**å£è¯€ï¼šç…§ç‰‡JPEGã€å›¾æ ‡PNGã€åŠ¨ç”»GIFæ”¹WebP**

### æ ¼å¼å¯¹æ¯”è¡¨

| æ ¼å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä½“ç§¯ | æµè§ˆå™¨æ”¯æŒ |
|------|------|----------|------|-----------|
| **JPEG** | æœ‰æŸå‹ç¼© | ç…§ç‰‡ã€å¤æ‚å›¾åƒ | å° | âœ… æ‰€æœ‰ |
| **PNG** | æ— æŸå‹ç¼©ã€é€æ˜ | Logoã€å›¾æ ‡ | å¤§ | âœ… æ‰€æœ‰ |
| **WebP** | æœ‰æŸ/æ— æŸã€é€æ˜ | æ›¿ä»£JPEG/PNG | æœ€å° | âœ… ç°ä»£æµè§ˆå™¨ |
| **SVG** | çŸ¢é‡å›¾ | å›¾æ ‡ã€ç®€å•å›¾å½¢ | æå° | âœ… æ‰€æœ‰ |
| **AVIF** | æ–°ä¸€ä»£æ ¼å¼ | ç…§ç‰‡ | æå° | âš ï¸ éƒ¨åˆ†æ”¯æŒ |

### WebPå…¼å®¹æ–¹æ¡ˆ
```html
<picture>
  <source srcset="image.avif" type="image/avif">
  <source srcset="image.webp" type="image/webp">
  <img src="image.jpg" alt="fallback">
</picture>
```

---

## 2. å›¾ç‰‡æ‡’åŠ è½½ â­â­â­â­â­

**å£è¯€ï¼šé¦–å±ä¼˜å…ˆã€æ»šåŠ¨åˆ°æ‰åŠ è½½**

### åŸç”Ÿæ‡’åŠ è½½
```html
<!-- ç®€å•æ–¹å¼ï¼šloading="lazy" -->
<img src="image.jpg" loading="lazy" alt="å›¾ç‰‡">
```

### IntersectionObserveræ‡’åŠ è½½
```javascript
// æ›´ç²¾ç»†çš„æ§åˆ¶
const images = document.querySelectorAll('img[data-src]');

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;  // åŠ è½½çœŸå®å›¾ç‰‡
      img.removeAttribute('data-src');
      observer.unobserve(img);
    }
  });
}, {
  rootMargin: '50px'  // æå‰50pxåŠ è½½
});

images.forEach(img => observer.observe(img));
```

```html
<!-- HTML -->
<img data-src="real-image.jpg" src="placeholder.jpg" alt="å›¾ç‰‡">
```

---

## 3. å“åº”å¼å›¾ç‰‡ â­â­â­â­

**å£è¯€ï¼šä¸åŒå°ºå¯¸ã€ä¸åŒåˆ†è¾¨ç‡ã€æŒ‰éœ€åŠ è½½**

```html
<!-- æ ¹æ®å±å¹•å®½åº¦é€‰æ‹©å›¾ç‰‡ -->
<img
  srcset="
    small.jpg 480w,
    medium.jpg 800w,
    large.jpg 1200w
  "
  sizes="
    (max-width: 480px) 100vw,
    (max-width: 800px) 50vw,
    33vw
  "
  src="medium.jpg"
  alt="å“åº”å¼å›¾ç‰‡"
>
```

**è®°å¿†å£è¯€ï¼š**
```
å›¾ç‰‡ä¼˜åŒ–äº”è¦ç‚¹ï¼šæ ¼å¼é€‰æ‹©ã€æ‡’åŠ è½½ã€å“åº”å¼ã€å‹ç¼©ã€CDN
ç…§ç‰‡JPEGã€å›¾æ ‡PNGã€WebPæœ€ä¼˜ã€æ‡’åŠ è½½æé€Ÿ
```

---

# å…­ã€Vue/Reactä¼˜åŒ–

## 1. Vueæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

### 1) v-if vs v-show
```vue
<!-- é¢‘ç¹åˆ‡æ¢ç”¨v-show -->
<div v-show="isVisible">å†…å®¹</div>

<!-- å¾ˆå°‘åˆ‡æ¢ç”¨v-if -->
<div v-if="isLogin">ç”¨æˆ·ä¿¡æ¯</div>
```

### 2) åˆ—è¡¨ä½¿ç”¨key
```vue
<!-- âŒ ä¸å¥½ï¼šç”¨indexä½œkey -->
<li v-for="(item, index) in list" :key="index">

<!-- âœ… å¥½ï¼šç”¨å”¯ä¸€id -->
<li v-for="item in list" :key="item.id">
```

### 3) computedç¼“å­˜
```vue
<script setup>
// âœ… å¥½ï¼šä½¿ç”¨computedï¼Œæœ‰ç¼“å­˜
const total = computed(() => {
  return cart.value.reduce((sum, item) => sum + item.price, 0);
});

// âŒ ä¸å¥½ï¼šä½¿ç”¨æ–¹æ³•ï¼Œæ¯æ¬¡éƒ½è®¡ç®—
function getTotal() {
  return cart.value.reduce((sum, item) => sum + item.price, 0);
}
</script>
```

### 4) keep-aliveç¼“å­˜ç»„ä»¶
```vue
<template>
  <keep-alive :include="['UserList', 'OrderList']">
    <router-view />
  </keep-alive>
</template>
```

---

## 2. Reactæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

### 1) React.memo
```javascript
// é˜²æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
const Child = React.memo(({ name }) => {
  console.log('Childæ¸²æŸ“');
  return <div>{name}</div>;
});
```

### 2) useMemoå’ŒuseCallback
```javascript
// useMemo - ç¼“å­˜è®¡ç®—ç»“æœ
const total = useMemo(() => {
  return cart.reduce((sum, item) => sum + item.price, 0);
}, [cart]);

// useCallback - ç¼“å­˜å‡½æ•°
const handleClick = useCallback(() => {
  console.log('ç‚¹å‡»');
}, []);
```

### 3) è™šæ‹Ÿæ»šåŠ¨
```javascript
// ä½¿ç”¨react-window
import { FixedSizeList } from 'react-window';

<FixedSizeList
  height={500}
  itemCount={10000}
  itemSize={50}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>Item {index}</div>
  )}
</FixedSizeList>
```

**è®°å¿†å£è¯€ï¼š**
```
Vueä¼˜åŒ–ï¼šv-showé¢‘ç¹åˆ‡æ¢ã€keyç”¨idã€computedç¼“å­˜ã€keep-aliveå¤ç”¨
Reactä¼˜åŒ–ï¼šmemoé˜²é‡æ¸²ã€useMemoç¼“å­˜å€¼ã€useCallbackç¼“å­˜å‡½æ•°
```

---

# ä¸ƒã€Webpack/Viteä¼˜åŒ–

## 1. Webpackæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šç¼“å­˜åˆ†å‰²ã€æŒ‰éœ€æ‡’åŠ è½½ã€å¹¶è¡Œå‹ç¼©**

### 1) ç¼“å­˜ä¼˜åŒ–ï¼ˆCacheï¼‰

#### contenthashæ–‡ä»¶æŒ‡çº¹
```javascript
// webpack.config.js
module.exports = {
  output: {
    filename: '[name].[contenthash:8].js',  // å†…å®¹å˜åŒ–æ‰æ”¹å˜hash
    chunkFilename: '[name].[contenthash:8].chunk.js'
  }
};
```

**æ•ˆæœï¼š** æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œhashä¸å˜ï¼Œæµè§ˆå™¨ç›´æ¥ç”¨ç¼“å­˜

#### cacheæŒä¹…åŒ–ç¼“å­˜
```javascript
// webpack.config.js
module.exports = {
  cache: {
    type: 'filesystem',  // æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
    buildDependencies: {
      config: [__filename]  // é…ç½®å˜åŒ–æ—¶é‡æ–°æ„å»º
    }
  }
};
```

**æ•ˆæœï¼š** äºŒæ¬¡æ„å»ºé€Ÿåº¦æå‡90%ï¼ˆ30s â†’ 3sï¼‰

---

### 2) ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰â­â­â­â­â­

#### splitChunksæå–å…¬å…±ä»£ç 
```javascript
// webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // æå–ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10
        },
        // æå–å…¬å…±ä»£ç 
        common: {
          minChunks: 2,
          name: 'common',
          priority: 5,
          reuseExistingChunk: true
        }
      }
    }
  }
};
```

**æ•ˆæœï¼š**
- main.jsï¼š100KB â†’ 30KB
- vendor.jsï¼š70KBï¼ˆå¯é•¿æœŸç¼“å­˜ï¼‰
- common.jsï¼š10KB

#### åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰
```javascript
// âŒ ä¸å¥½ï¼šæ‰“åŒ…åˆ°ä¸€èµ·
import HeavyComponent from './HeavyComponent.vue';

// âœ… å¥½ï¼šæŒ‰éœ€åŠ è½½
const HeavyComponent = () => import(
  /* webpackChunkName: "heavy" */
  './HeavyComponent.vue'
);
```

---

### 3) æ„å»ºé€Ÿåº¦ä¼˜åŒ– â­â­â­â­â­

#### å¤šè¿›ç¨‹æ„å»º
```javascript
// webpack.config.js
const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        parallel: true,  // å¤šè¿›ç¨‹å¹¶è¡Œå‹ç¼©
        terserOptions: {
          compress: {
            drop_console: true  // åˆ é™¤console
          }
        }
      })
    ]
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          {
            loader: 'thread-loader',  // å¤šè¿›ç¨‹loader
            options: { workers: 4 }
          },
          'babel-loader'
        ]
      }
    ]
  }
};
```

**æ•ˆæœï¼š** æ„å»ºæ—¶é—´å‡å°‘40-60%

#### ç¼©å°æ„å»ºèŒƒå›´
```javascript
// webpack.config.js
module.exports = {
  resolve: {
    // æŒ‡å®šæ‰©å±•åï¼Œå‡å°‘æŸ¥æ‰¾
    extensions: ['.js', '.vue', '.json'],
    // åˆ«åï¼Œé¿å…å±‚å±‚æŸ¥æ‰¾
    alias: {
      '@': path.resolve(__dirname, 'src'),
      'vue$': 'vue/dist/vue.runtime.esm.js'
    },
    // æŒ‡å®šæ¨¡å—æŸ¥æ‰¾ç›®å½•
    modules: [path.resolve(__dirname, 'node_modules')]
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'),  // åªå¤„ç†src
        exclude: /node_modules/,  // æ’é™¤node_modules
        use: 'babel-loader'
      }
    ]
  }
};
```

#### noParseè·³è¿‡è§£æ
```javascript
// webpack.config.js
module.exports = {
  module: {
    noParse: /jquery|lodash/,  // ä¸è§£æè¿™äº›åº“ï¼ˆå·²ç»æ‰“åŒ…å¥½ï¼‰
  }
};
```

---

### 4) Tree Shaking â­â­â­â­â­

```javascript
// webpack.config.js
module.exports = {
  mode: 'production',  // ç”Ÿäº§æ¨¡å¼è‡ªåŠ¨å¼€å¯
  optimization: {
    usedExports: true,  // æ ‡è®°æœªä½¿ç”¨çš„å¯¼å‡º
    sideEffects: false  // å¼€å¯å‰¯ä½œç”¨æ£€æµ‹
  }
};

// package.json
{
  "sideEffects": [
    "*.css",
    "*.scss"
  ]
}
```

**è¦æ±‚ï¼š**
- ä½¿ç”¨ES6 Moduleï¼ˆimport/exportï¼‰
- ä¸è¦ç”¨CommonJSï¼ˆrequireï¼‰

---

### 5) DLLåŠ¨æ€é“¾æ¥åº“ï¼ˆå·²è¿‡æ—¶ï¼Œäº†è§£å³å¯ï¼‰

```javascript
// webpack.dll.config.js
const webpack = require('webpack');

module.exports = {
  entry: {
    vendor: ['vue', 'vue-router', 'vuex']
  },
  output: {
    filename: '[name].dll.js',
    library: '[name]_library'
  },
  plugins: [
    new webpack.DllPlugin({
      name: '[name]_library',
      path: path.join(__dirname, '[name]-manifest.json')
    })
  ]
};
```

**æ³¨æ„ï¼š** Webpack 5çš„æŒä¹…åŒ–ç¼“å­˜å·²æ›¿ä»£DLLï¼Œä¸æ¨èä½¿ç”¨

---

## 2. Viteæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šé¢„æ„å»ºã€æŒ‰éœ€ç¼–è¯‘ã€Rollupæ‰“åŒ…**

### 1) Vite vs Webpackå¯¹æ¯”

| å¯¹æ¯”é¡¹ | Webpack | Vite |
|--------|---------|------|
| **å¼€å‘æ¨¡å¼** | Bundleï¼ˆæ‰“åŒ…ï¼‰ | ESMï¼ˆåŸç”Ÿæ¨¡å—ï¼‰ |
| **å†·å¯åŠ¨** | æ…¢ï¼ˆ20-60sï¼‰ | å¿«ï¼ˆ1-3sï¼‰ |
| **çƒ­æ›´æ–°** | æ…¢ï¼ˆéœ€é‡æ–°æ‰“åŒ…ï¼‰ | å¿«ï¼ˆåªç¼–è¯‘æ”¹åŠ¨æ–‡ä»¶ï¼‰ |
| **ç”Ÿäº§æ„å»º** | Webpack | Rollup |
| **é€‚ç”¨åœºæ™¯** | å¤§å‹é¡¹ç›®ã€å¤æ‚é…ç½® | ç°ä»£æµè§ˆå™¨ã€å¿«é€Ÿå¼€å‘ |

### Viteå¿«çš„åŸå› 
1. **å¼€å‘æ—¶**ï¼šä¸æ‰“åŒ…ï¼Œåˆ©ç”¨æµè§ˆå™¨åŸç”ŸESM
2. **æŒ‰éœ€ç¼–è¯‘**ï¼šåªç¼–è¯‘å½“å‰é¡µé¢éœ€è¦çš„æ¨¡å—
3. **é¢„æ„å»º**ï¼šä¾èµ–é¢„æ„å»ºï¼ˆesbuildï¼Œæ¯”Webpackå¿«10-100å€ï¼‰

---

### 2) Viteä¼˜åŒ–é…ç½®

#### ä¾èµ–é¢„æ„å»ºä¼˜åŒ–
```javascript
// vite.config.js
export default {
  optimizeDeps: {
    // å¼ºåˆ¶é¢„æ„å»ºçš„ä¾èµ–
    include: [
      'vue',
      'vue-router',
      'pinia',
      'axios',
      'lodash-es'
    ],
    // æ’é™¤é¢„æ„å»º
    exclude: ['your-local-package']
  }
};
```

#### æ„å»ºä¼˜åŒ–
```javascript
// vite.config.js
export default {
  build: {
    // ä»£ç åˆ†å‰²
    rollupOptions: {
      output: {
        manualChunks: {
          // æå–Vueå…¨å®¶æ¡¶
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          // æå–UIåº“
          'ui-vendor': ['element-plus'],
          // æå–å·¥å…·åº“
          'utils': ['axios', 'dayjs', 'lodash-es']
        }
      }
    },
    // å‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    },
    // chunkå¤§å°è­¦å‘Š
    chunkSizeWarningLimit: 1000,
    // å°äº4KBçš„å›¾ç‰‡è½¬base64
    assetsInlineLimit: 4096
  }
};
```

#### å¼€å‘æœåŠ¡å™¨ä¼˜åŒ–
```javascript
// vite.config.js
export default {
  server: {
    // é¢„çƒ­å¸¸ç”¨æ–‡ä»¶
    warmup: {
      clientFiles: [
        './src/components/**/*.vue',
        './src/views/**/*.vue'
      ]
    },
    // æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
    fs: {
      cachedChecks: true
    }
  }
};
```

---

### 3) Viteæ’ä»¶ä¼˜åŒ–

#### è‡ªåŠ¨å¯¼å…¥
```javascript
// vite.config.js
import AutoImport from 'unplugin-auto-import/vite';
import Components from 'unplugin-vue-components/vite';
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers';

export default {
  plugins: [
    // è‡ªåŠ¨å¯¼å…¥Vue API
    AutoImport({
      imports: ['vue', 'vue-router', 'pinia'],
      resolvers: [ElementPlusResolver()]
    }),
    // è‡ªåŠ¨å¯¼å…¥ç»„ä»¶
    Components({
      resolvers: [ElementPlusResolver()]
    })
  ]
};
```

**æ•ˆæœï¼š** ä¸éœ€è¦æ‰‹åŠ¨importï¼Œè‡ªåŠ¨æŒ‰éœ€å¼•å…¥

#### å›¾ç‰‡ä¼˜åŒ–æ’ä»¶
```javascript
// vite.config.js
import { ViteImageOptimizer } from 'vite-plugin-image-optimizer';

export default {
  plugins: [
    ViteImageOptimizer({
      // å›¾ç‰‡å‹ç¼©
      png: { quality: 80 },
      jpeg: { quality: 80 },
      webp: { quality: 80 }
    })
  ]
};
```

#### gzipå‹ç¼©æ’ä»¶
```javascript
// vite.config.js
import viteCompression from 'vite-plugin-compression';

export default {
  plugins: [
    viteCompression({
      algorithm: 'gzip',
      ext: '.gz',
      threshold: 10240  // å¤§äº10KBæ‰å‹ç¼©
    })
  ]
};
```

---

### 4) Viteå¸¸è§é—®é¢˜ä¼˜åŒ–

#### é—®é¢˜1ï¼šé¦–æ¬¡å¯åŠ¨æ…¢
**åŸå› ï¼š** ä¾èµ–é¢„æ„å»ºè€—æ—¶

**è§£å†³ï¼š**
```javascript
// vite.config.js
export default {
  optimizeDeps: {
    // å¼ºåˆ¶é¢„æ„å»ºï¼Œé¿å…äºŒæ¬¡é¢„æ„å»º
    include: ['vue', 'vue-router', 'pinia', 'element-plus']
  }
};
```

#### é—®é¢˜2ï¼šçƒ­æ›´æ–°æ…¢
**åŸå› ï¼š** å¤§é‡æ–‡ä»¶ç›‘å¬

**è§£å†³ï¼š**
```javascript
// vite.config.js
export default {
  server: {
    watch: {
      // å¿½ç•¥ä¸éœ€è¦ç›‘å¬çš„æ–‡ä»¶
      ignored: ['**/node_modules/**', '**/.git/**']
    }
  }
};
```

#### é—®é¢˜3ï¼šæ‰“åŒ…ä½“ç§¯å¤§
**åŸå› ï¼š** ç¬¬ä¸‰æ–¹åº“ä½“ç§¯å¤§

**è§£å†³ï¼š**
```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      external: ['vue', 'element-plus'],  // å¤–éƒ¨åŒ–
      output: {
        globals: {
          vue: 'Vue',
          'element-plus': 'ElementPlus'
        }
      }
    }
  }
};

// index.htmlå¼•å…¥CDN
<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4"></script>
```

---

## 3. Webpack vs Viteé€‰æ‹©å»ºè®® â­â­â­â­

### é€‰æ‹©Webpackçš„åœºæ™¯
- âœ… å¤§å‹é¡¹ç›®ï¼ˆ>1000ä¸ªæ¨¡å—ï¼‰
- âœ… éœ€è¦å…¼å®¹IE11
- âœ… å¤æ‚çš„æ„å»ºéœ€æ±‚
- âœ… æˆç†Ÿçš„ç”Ÿæ€å’Œæ’ä»¶

### é€‰æ‹©Viteçš„åœºæ™¯
- âœ… æ–°é¡¹ç›®ï¼ˆæ¨èï¼‰
- âœ… Vue3/Reacté¡¹ç›®
- âœ… ç°ä»£æµè§ˆå™¨ï¼ˆES2015+ï¼‰
- âœ… å¿«é€Ÿå¼€å‘ä½“éªŒ

---

## 4. é¢è¯•é«˜é¢‘é¢˜ â­â­â­â­â­

### Q1: Webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–ï¼Ÿ

**ç­”æ¡ˆï¼ˆ5ä¸ªæ–¹é¢ï¼‰ï¼š**

1. **ç¼“å­˜**
   - cache: 'filesystem'æŒä¹…åŒ–ç¼“å­˜
   - babel-loaderçš„cacheDirectory

2. **å¤šè¿›ç¨‹**
   - thread-loaderå¤šè¿›ç¨‹loader
   - TerserPluginå¹¶è¡Œå‹ç¼©

3. **ç¼©å°èŒƒå›´**
   - include/excludeç²¾ç¡®åŒ¹é…
   - resolve.modulesæŒ‡å®šæŸ¥æ‰¾ç›®å½•

4. **DLLé¢„ç¼–è¯‘**ï¼ˆå·²è¿‡æ—¶ï¼‰
   - ç¬¬ä¸‰æ–¹åº“é¢„ç¼–è¯‘
   - Webpack 5ç”¨cacheæ›¿ä»£

5. **æŒ‰éœ€åŠ è½½**
   - åŠ¨æ€import
   - splitChunksä»£ç åˆ†å‰²

---

### Q2: Viteä¸ºä»€ä¹ˆæ¯”Webpackå¿«ï¼Ÿ

**ç­”æ¡ˆï¼ˆ3ä¸ªæ ¸å¿ƒåŸå› ï¼‰ï¼š**

1. **å¼€å‘æ—¶ä¸æ‰“åŒ…**
   - Webpackï¼šæ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆbundle
   - Viteï¼šåˆ©ç”¨æµè§ˆå™¨åŸç”ŸESM

2. **æŒ‰éœ€ç¼–è¯‘**
   - Webpackï¼šå¯åŠ¨æ—¶å…¨é‡ç¼–è¯‘
   - Viteï¼šåªç¼–è¯‘å½“å‰é¡µé¢éœ€è¦çš„

3. **esbuildé¢„æ„å»º**
   - Webpackï¼šJavaScriptç¼–è¯‘ï¼ˆæ…¢ï¼‰
   - Viteï¼šesbuildç¼–è¯‘ï¼ˆGoè¯­è¨€ï¼Œå¿«10-100å€ï¼‰

**å¯¹æ¯”ï¼š**
- Webpackå†·å¯åŠ¨ï¼š30-60s
- Viteå†·å¯åŠ¨ï¼š1-3s

---

### Q3: Tree ShakingåŸç†ï¼Ÿ

**ç­”æ¡ˆï¼š**

**åŸç†ï¼š** åŸºäºES6 Moduleçš„é™æ€åˆ†æï¼Œåˆ é™¤æœªä½¿ç”¨çš„ä»£ç 

**å·¥ä½œæµç¨‹ï¼š**
1. **æ ‡è®°é˜¶æ®µ**ï¼šæ ‡è®°æ‰€æœ‰ä½¿ç”¨çš„å¯¼å‡º
2. **æ¸…é™¤é˜¶æ®µ**ï¼šåˆ é™¤æœªä½¿ç”¨çš„å¯¼å‡º

**è¦æ±‚ï¼š**
- ä½¿ç”¨ES6 Moduleï¼ˆimport/exportï¼‰
- ä¸è¦ç”¨CommonJSï¼ˆrequire/module.exportsï¼‰
- package.jsonè®¾ç½®sideEffects

**æ•ˆæœï¼š** lodashä»70KBé™åˆ°5KBï¼ˆåªç”¨äº†1ä¸ªå‡½æ•°ï¼‰

---

### Q4: splitChunkså¦‚ä½•é…ç½®ï¼Ÿ

**ç­”æ¡ˆï¼ˆæœ€ä½³å®è·µï¼‰ï¼š**

```javascript
splitChunks: {
  chunks: 'all',
  cacheGroups: {
    // ç¬¬ä¸‰æ–¹åº“
    vendor: {
      test: /[\\/]node_modules[\\/]/,
      name: 'vendors',
      priority: 10
    },
    // å…¬å…±ä»£ç 
    common: {
      minChunks: 2,
      name: 'common',
      priority: 5
    }
  }
}
```

**æ•ˆæœï¼š**
- ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…ï¼Œå¯é•¿æœŸç¼“å­˜
- å…¬å…±ä»£ç æå–ï¼Œé¿å…é‡å¤æ‰“åŒ…
- é¦–å±åŠ è½½æ›´å¿«

---

**è®°å¿†å£è¯€ï¼š**
```
Webpackä¼˜åŒ–ï¼šç¼“å­˜åˆ†å‰²ã€å¤šè¿›ç¨‹å¹¶è¡Œã€ç¼©å°èŒƒå›´
Viteä¼˜åŒ–ï¼šé¢„æ„å»ºä¾èµ–ã€ä»£ç åˆ†å‰²ã€æ’ä»¶è‡ªåŠ¨åŒ–
Viteå¿«ä¸‰ç‚¹ï¼šä¸æ‰“åŒ…ã€æŒ‰éœ€ç¼–è¯‘ã€esbuildé¢„æ„å»º
```

---

# å…«ã€æ€§èƒ½ç›‘æ§

## 1. æ€§èƒ½æŒ‡æ ‡ â­â­â­â­â­

**å£è¯€ï¼šFCPé¦–ç»˜ã€LCPæœ€å¤§ã€FIDäº¤äº’ã€CLSåç§»ã€TTFBé¦–å­—èŠ‚**

### æ ¸å¿ƒWebæŒ‡æ ‡ï¼ˆCore Web Vitalsï¼‰

| æŒ‡æ ‡ | å«ä¹‰ | ç›®æ ‡å€¼ | å½±å“å› ç´  |
|------|------|--------|----------|
| **FCP** | é¦–æ¬¡å†…å®¹ç»˜åˆ¶ | <1.8s | HTMLã€CSSåŠ è½½é€Ÿåº¦ |
| **LCP** | æœ€å¤§å†…å®¹ç»˜åˆ¶ | <2.5s | å›¾ç‰‡ã€è§†é¢‘åŠ è½½ |
| **FID** | é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ | <100ms | JavaScriptæ‰§è¡Œ |
| **CLS** | ç´¯ç§¯å¸ƒå±€åç§» | <0.1 | åŠ¨æ€å†…å®¹åŠ è½½ |
| **TTFB** | é¦–å­—èŠ‚æ—¶é—´ | <600ms | æœåŠ¡å™¨å“åº”é€Ÿåº¦ |

### ä½¿ç”¨Performance APIç›‘æ§
```javascript
// 1. è·å–æ€§èƒ½æŒ‡æ ‡
window.addEventListener('load', () => {
  const perfData = performance.timing;
  const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
  const domReadyTime = perfData.domContentLoadedEventEnd - perfData.navigationStart;
  const ttfb = perfData.responseStart - perfData.navigationStart;

  console.log('é¡µé¢åŠ è½½æ—¶é—´:', pageLoadTime);
  console.log('DOMè§£ææ—¶é—´:', domReadyTime);
  console.log('é¦–å­—èŠ‚æ—¶é—´:', ttfb);
});

// 2. ä½¿ç”¨Web Vitalsåº“
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getFCP(console.log);
getLCP(console.log);
getTTFB(console.log);
```

---

## 2. æ€§èƒ½ç›‘æ§å·¥å…· â­â­â­â­

### 1) Chrome DevTools
```
1. Performanceé¢æ¿ï¼šå½•åˆ¶æ€§èƒ½
2. Lighthouseï¼šæ€§èƒ½è¯„åˆ†
3. Networké¢æ¿ï¼šç½‘ç»œç€‘å¸ƒå›¾
4. Coverageï¼šä»£ç è¦†ç›–ç‡
```

### 2) å‰ç«¯ç›‘æ§å¹³å°
- **Sentry** - é”™è¯¯ç›‘æ§
- **Google Analytics** - ç”¨æˆ·è¡Œä¸º
- **é˜¿é‡Œäº‘ARMS** - æ€§èƒ½ç›‘æ§
- **ç¥ç­–æ•°æ®** - åŸ‹ç‚¹åˆ†æ

**è®°å¿†å£è¯€ï¼š**
```
æ€§èƒ½æŒ‡æ ‡è®°äº”ä¸ªï¼šFCPã€LCPã€FIDã€CLSã€TTFB
é¦–ç»˜æœ€å¤§äº¤äº’åç§»é¦–å­—èŠ‚ã€DevToolså’ŒLighthouseæ˜¯å¥½å·¥å…·
```

---

# ä¹ã€é¢è¯•ç­”é¢˜æ¨¡æ¿

## é¢è¯•é¢˜ï¼šå¦‚ä½•è¿›è¡Œå‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼Ÿâ­â­â­â­â­

### ç­”é¢˜ç»“æ„ï¼ˆæ€»-åˆ†-æ€»ï¼‰

**ç¬¬ä¸€æ­¥ï¼šæ€»è¿°ï¼ˆå…­å¤§æ–¹å‘ï¼‰**
```
å‰ç«¯æ€§èƒ½ä¼˜åŒ–å¯ä»¥ä»6ä¸ªæ–¹å‘å…¥æ‰‹ï¼š
1. èµ„æºåŠ è½½ä¼˜åŒ–
2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–
3. JavaScriptä¼˜åŒ–
4. ç½‘ç»œä¼˜åŒ–
5. å›¾ç‰‡ä¼˜åŒ–
6. æ¡†æ¶å±‚é¢ä¼˜åŒ–
```

**ç¬¬äºŒæ­¥ï¼šåˆ†è¿°ï¼ˆ3-4ä¸ªé‡ç‚¹ï¼Œå¸¦ä»£ç ç¤ºä¾‹ï¼‰**

**1. èµ„æºåŠ è½½ä¼˜åŒ–ï¼ˆå¿…è¯´ï¼‰**
- å‡å°‘HTTPè¯·æ±‚ï¼šåˆå¹¶æ–‡ä»¶ã€CSSé›ªç¢§å›¾
- èµ„æºå‹ç¼©ï¼šGzip/Brotliå‹ç¼©
- æŒ‰éœ€åŠ è½½ï¼šè·¯ç”±æ‡’åŠ è½½ã€ç»„ä»¶å¼‚æ­¥åŠ è½½
- ä»£ç ç¤ºä¾‹ï¼š
```javascript
// è·¯ç”±æ‡’åŠ è½½
const Home = () => import('./Home.vue');
```

**2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼ˆå¿…è¯´ï¼‰**
- é¿å…é‡æ’é‡ç»˜ï¼šæ‰¹é‡ä¿®æ”¹DOMã€è¯»å†™åˆ†ç¦»
- ä½¿ç”¨transformä»£æ›¿top/left
- è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨
- ä»£ç ç¤ºä¾‹ï¼š
```javascript
// transformä»£æ›¿left
transform: translateX(100px);  // ä¸è§¦å‘é‡æ’
```

**3. ç½‘ç»œä¼˜åŒ–ï¼ˆæ¨èè¯´ï¼‰**
- CDNåŠ é€Ÿ
- HTTPç¼“å­˜ç­–ç•¥ï¼šå¼ºç¼“å­˜+åå•†ç¼“å­˜
- DNSé¢„è§£æã€èµ„æºé¢„åŠ è½½
- ä»£ç ç¤ºä¾‹ï¼š
```html
<link rel="preload" href="main.js" as="script">
```

**4. å›¾ç‰‡ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰**
- æ ¼å¼é€‰æ‹©ï¼šWebPä¼˜å…ˆ
- å›¾ç‰‡æ‡’åŠ è½½ï¼šIntersectionObserver
- å“åº”å¼å›¾ç‰‡ï¼šsrcset

**ç¬¬ä¸‰æ­¥ï¼šæ€»ç»“ï¼ˆç›‘æ§å’Œåº¦é‡ï¼‰**
```
æœ€åï¼Œæ€§èƒ½ä¼˜åŒ–è¦æœ‰æ•°æ®æ”¯æ’‘ï¼Œé€šè¿‡ï¼š
1. Chrome DevToolsã€Lighthouseè¯„ä¼°
2. ç›‘æ§FCPã€LCPã€FIDç­‰æ ¸å¿ƒæŒ‡æ ‡
3. å»ºç«‹æ€§èƒ½ç›‘æ§å¹³å°ï¼ŒæŒç»­ä¼˜åŒ–
```

---

## å…¶ä»–å¸¸è§è¿½é—®

### Q1: é‡æ’å’Œé‡ç»˜çš„åŒºåˆ«ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼š**
- **é‡æ’ï¼ˆReflowï¼‰**ï¼šå…ƒç´ ä½ç½®ã€å¤§å°å˜åŒ–ï¼Œéœ€é‡æ–°è®¡ç®—å¸ƒå±€ï¼Œ**å½±å“æ€§èƒ½**
  - è§¦å‘ï¼šä¿®æ”¹width/heightã€æ·»åŠ åˆ é™¤å…ƒç´ ã€æ”¹å˜å­—ä½“å¤§å°
- **é‡ç»˜ï¼ˆRepaintï¼‰**ï¼šå…ƒç´ å¤–è§‚å˜åŒ–ï¼Œ**ä¸å½±å“å¸ƒå±€**ï¼Œæ€§èƒ½å½±å“è¾ƒå°
  - è§¦å‘ï¼šä¿®æ”¹colorã€backgroundã€visibility

**ä¼˜åŒ–ï¼š**
- æ‰¹é‡ä¿®æ”¹DOM
- ä½¿ç”¨transform/opacityï¼ˆåªè§¦å‘åˆæˆå±‚ï¼Œä¸é‡æ’ä¸é‡ç»˜ï¼‰
- è¯»å†™åˆ†ç¦»

---

### Q2: è™šæ‹Ÿæ»šåŠ¨åŸç†ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼š**
åªæ¸²æŸ“å¯è§†åŒºåŸŸçš„å…ƒç´ ï¼Œå¤§å¹…å‡å°‘DOMæ•°é‡

**æ ¸å¿ƒæ­¥éª¤ï¼š**
1. è®¡ç®—å¯è§åŒºåŸŸï¼šæ ¹æ®scrollTopå’Œå®¹å™¨é«˜åº¦
2. åªæ¸²æŸ“å¯è§å…ƒç´ ï¼šå¦‚10000æ¡æ•°æ®åªæ¸²æŸ“20ä¸ª
3. ç”¨padding/transformæ’‘èµ·æ€»é«˜åº¦
4. ç›‘å¬scrolläº‹ä»¶æ›´æ–°å¯è§åŒºåŸŸ

**æ•ˆæœï¼š** 10000æ¡æ•°æ®ä»æ¸²æŸ“10000ä¸ªDOMé™åˆ°20ä¸ª

---

### Q3: é˜²æŠ–å’ŒèŠ‚æµçš„åŒºåˆ«ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§ | é˜²æŠ– | èŠ‚æµ |
|------|------|------|
| **åŸç†** | ç­‰å¾…åœæ­¢è§¦å‘åæ‰§è¡Œ | å›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œ |
| **æ‰§è¡Œæ¬¡æ•°** | 1æ¬¡ | å¤šæ¬¡ |
| **åœºæ™¯** | æœç´¢æ¡†ã€resize | æ»šåŠ¨ã€mousemove |
| **æ¯”å–»** | ç”µæ¢¯ç­‰äººé½äº†å†èµ° | åœ°é“å›ºå®šæ—¶é—´å‘è½¦ |

---

### Q4: å¦‚ä½•ä¼˜åŒ–é¦–å±åŠ è½½é€Ÿåº¦ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼ˆ5ä¸ªæ–¹é¢ï¼‰ï¼š**

1. **èµ„æºä¼˜åŒ–**
   - è·¯ç”±æ‡’åŠ è½½ã€ä»£ç åˆ†å‰²
   - å›¾ç‰‡æ‡’åŠ è½½ã€WebPæ ¼å¼
   - Gzipå‹ç¼©ã€Tree Shaking

2. **åŠ è½½ç­–ç•¥**
   - å…³é”®CSSå†…è”
   - å¼‚æ­¥åŠ è½½éå…³é”®èµ„æº
   - preload/prefetch

3. **æ¸²æŸ“ä¼˜åŒ–**
   - SSRæœåŠ¡ç«¯æ¸²æŸ“
   - éª¨æ¶å±ã€Loadingä¼˜åŒ–

4. **ç½‘ç»œä¼˜åŒ–**
   - CDNåŠ é€Ÿ
   - HTTP/2å¤šè·¯å¤ç”¨
   - å¼ºç¼“å­˜é™æ€èµ„æº

5. **ç›‘æ§ä¼˜åŒ–**
   - ç›‘æ§FCPã€LCPæŒ‡æ ‡
   - Lighthouseè¯„åˆ†ä¼˜åŒ–

---

## ğŸ¯ å¿…èƒŒé‡‘å¥

```
1. "æ€§èƒ½ä¼˜åŒ–éµå¾ª2-8åŸåˆ™ï¼š20%çš„ä¼˜åŒ–å¸¦æ¥80%çš„æå‡"
2. "ä¼˜å…ˆä¼˜åŒ–é¦–å±ï¼Œæ‡’åŠ è½½å…¶ä»–èµ„æº"
3. "é¿å…è¿‡æ—©ä¼˜åŒ–ï¼Œå…ˆæµ‹é‡å†ä¼˜åŒ–"
4. "æ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­è¿‡ç¨‹ï¼Œéœ€è¦ç›‘æ§å’Œè¿­ä»£"
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| é¦–å±åŠ è½½æ—¶é—´ | 5s | 1.5s | 70% |
| é¦–å±èµ„æºå¤§å° | 2MB | 500KB | 75% |
| é¦–å±è¯·æ±‚æ•° | 50ä¸ª | 15ä¸ª | 70% |
| LCP | 4s | 2s | 50% |
| Lighthouseåˆ†æ•° | 60åˆ† | 95åˆ† | +35åˆ† |

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

### å¿…é¡»æŒæ¡ï¼ˆé¢è¯•å¿…è€ƒï¼‰
1. âœ… é‡æ’é‡ç»˜åŸç†å’Œä¼˜åŒ–
2. âœ… é˜²æŠ–èŠ‚æµå®ç°
3. âœ… è™šæ‹Ÿæ»šåŠ¨åŸç†
4. âœ… å›¾ç‰‡æ‡’åŠ è½½å®ç°
5. âœ… HTTPç¼“å­˜ç­–ç•¥

### åŠ åˆ†é¡¹
1. â­ Web Workerä½¿ç”¨
2. â­ SSRæœåŠ¡ç«¯æ¸²æŸ“
3. â­ PWAæ€§èƒ½ä¼˜åŒ–
4. â­ æ€§èƒ½ç›‘æ§å¹³å°æ­å»º

### å®æˆ˜ç»ƒä¹ 
1. ç”¨Lighthouseåˆ†æçœŸå®é¡¹ç›®
2. å®ç°ä¸€ä¸ªè™šæ‹Ÿæ»šåŠ¨ç»„ä»¶
3. ä¼˜åŒ–ä¸€ä¸ªçœŸå®é¡µé¢ï¼Œå¯¹æ¯”ä¼˜åŒ–å‰åæ•°æ®

---

**ğŸ‰ æŒæ¡è¿™ä»½æ–‡æ¡£ï¼Œæ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜è½»æ¾æ‹¿ä¸‹ï¼è®°å¾—ç»“åˆå®é™…é¡¹ç›®ç»éªŒå›ç­”ï¼Œæ›´æœ‰è¯´æœåŠ›ï¼ğŸ’ª**
