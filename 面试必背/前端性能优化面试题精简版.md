# å‰ç«¯æ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜ç²¾ç®€ç‰ˆ â­â­â­â­â­

> ğŸ’¡ **é‡è¦ç¨‹åº¦**: é«˜é¢‘å¿…è€ƒ | ğŸ“Œ **å­¦ä¹ æ—¶é•¿**: 2-3å°æ—¶
> ğŸ”¥ **çƒ­åº¦æŒ‡æ•°**: â­â­â­â­â­ (å‡ ä¹æ¯ä¸ªé¢è¯•éƒ½ä¼šé—®)

---

## ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€

### æ€§èƒ½ä¼˜åŒ–å…­å¤§æ–¹å‘
```
å‡å°‘è¯·æ±‚ã€å‡å°ä½“ç§¯ã€æé«˜é€Ÿåº¦
ç¼“å­˜åˆ©ç”¨ã€å¼‚æ­¥åŠ è½½ã€ä½“éªŒä¼˜åŒ–
```

### æ€§èƒ½æŒ‡æ ‡å£è¯€
```
FCPé¦–æ¬¡ç»˜åˆ¶ã€LCPæœ€å¤§å†…å®¹ã€FIDé¦–æ¬¡äº¤äº’
CLSå¸ƒå±€åç§»ã€TTFBé¦–å­—èŠ‚
```

### å›¾ç‰‡ä¼˜åŒ–å£è¯€
```
å°å›¾Base64ã€å¤§å›¾æ‡’åŠ è½½
WebPæ ¼å¼ã€é›ªç¢§å›¾åˆå¹¶
å“åº”å¼å›¾ç‰‡ã€CDNåŠ é€Ÿ
```

---

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

| ç« èŠ‚ | é‡è¦çº§åˆ« | æ ¸å¿ƒå†…å®¹ | é¢„è®¡é˜…è¯»æ—¶é—´ |
|------|---------|---------|------------|
| [ä¸€ã€èµ„æºåŠ è½½ä¼˜åŒ–](#ä¸€èµ„æºåŠ è½½ä¼˜åŒ–) | â­â­â­â­â­ | å‡å°‘è¯·æ±‚ã€å‹ç¼©èµ„æº | 20åˆ†é’Ÿ |
| [äºŒã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–](#äºŒæ¸²æŸ“æ€§èƒ½ä¼˜åŒ–) | â­â­â­â­â­ | é‡æ’é‡ç»˜ã€CSSä¼˜åŒ– | 20åˆ†é’Ÿ |
| [ä¸‰ã€JavaScriptä¼˜åŒ–](#ä¸‰javascriptä¼˜åŒ–) | â­â­â­â­â­ | é˜²æŠ–èŠ‚æµã€ä»£ç åˆ†å‰² | 20åˆ†é’Ÿ |
| [å››ã€ç½‘ç»œä¼˜åŒ–](#å››ç½‘ç»œä¼˜åŒ–) | â­â­â­â­â­ | CDNã€HTTPç¼“å­˜ | 15åˆ†é’Ÿ |
| [äº”ã€å›¾ç‰‡ä¼˜åŒ–](#äº”å›¾ç‰‡ä¼˜åŒ–) | â­â­â­â­â­ | æ‡’åŠ è½½ã€æ ¼å¼é€‰æ‹© | 15åˆ†é’Ÿ |
| [å…­ã€Vue/Reactä¼˜åŒ–](#å…­vuereactä¼˜åŒ–) | â­â­â­â­â­ | ç»„ä»¶ä¼˜åŒ–ã€è™šæ‹Ÿæ»šåŠ¨ | 20åˆ†é’Ÿ |
| [ä¸ƒã€Webpack/Viteä¼˜åŒ–](#ä¸ƒwebpackviteä¼˜åŒ–) | â­â­â­â­â­ | æ„å»ºä¼˜åŒ–ã€æ‰“åŒ…ä¼˜åŒ– | 25åˆ†é’Ÿ |
| [å…«ã€æ€§èƒ½ç›‘æ§](#å…«æ€§èƒ½ç›‘æ§) | â­â­â­â­ | æ€§èƒ½æŒ‡æ ‡ã€ç›‘æ§å·¥å…· | 15åˆ†é’Ÿ |
| [ä¹ã€é¢è¯•ç­”é¢˜æ¨¡æ¿](#ä¹é¢è¯•ç­”é¢˜æ¨¡æ¿) | â­â­â­â­â­ | ç­”é¢˜æŠ€å·§ | 10åˆ†é’Ÿ |

---

# ä¸€ã€èµ„æºåŠ è½½ä¼˜åŒ–

## 1. å‡å°‘HTTPè¯·æ±‚ â­â­â­â­â­

**å£è¯€ï¼šåˆå¹¶å‹ç¼©ã€é›ªç¢§å›¾ã€å†…è”å°èµ„æº**

### 1) CSSé›ªç¢§å›¾ï¼ˆSpriteï¼‰
```css
/* å°†å¤šä¸ªå°å›¾æ ‡åˆå¹¶æˆä¸€å¼ å¤§å›¾ */
.icon-home {
  background: url('sprites.png') 0 0;
  width: 20px;
  height: 20px;
}

.icon-user {
  background: url('sprites.png') -20px 0;
  width: 20px;
  height: 20px;
}
```

**ä¼˜ç‚¹ï¼š** 10ä¸ªå°å›¾æ ‡ä»10ä¸ªè¯·æ±‚å˜æˆ1ä¸ªè¯·æ±‚
**é€‚ç”¨ï¼š** å°å›¾æ ‡ã€å›ºå®šUIå…ƒç´ 

### 2) å°å›¾ç‰‡Base64å†…è”
```css
/* å°äº10KBçš„å›¾ç‰‡è½¬ä¸ºBase64 */
.logo {
  background: url('data:image/png;base64,iVBORw0KG...');
}
```

**ä¼˜ç‚¹ï¼š** å‡å°‘è¯·æ±‚ï¼Œé¦–å±æ›´å¿«
**ç¼ºç‚¹ï¼š** å¢å¤§CSSä½“ç§¯ï¼Œä¸èƒ½ç¼“å­˜
**å»ºè®®ï¼š** åªå¯¹<10KBçš„å›¾ç‰‡ä½¿ç”¨

### 3) åˆå¹¶CSS/JSæ–‡ä»¶
```javascript
// âŒ ä¸å¥½ï¼šå¤šä¸ªè¯·æ±‚
<link rel="stylesheet" href="a.css">
<link rel="stylesheet" href="b.css">
<link rel="stylesheet" href="c.css">

// âœ… å¥½ï¼šåˆå¹¶ä¸ºä¸€ä¸ª
<link rel="stylesheet" href="bundle.css">
```

---

## 2. èµ„æºå‹ç¼© â­â­â­â­â­

**å£è¯€ï¼šGzipå‹ç¼©ã€ä»£ç æ··æ·†ã€Tree Shaking**

### 1) Gzip/Brotliå‹ç¼©
```javascript
// æœåŠ¡å™¨ç«¯å¼€å¯Gzip
// Nginxé…ç½®
gzip on;
gzip_types text/css application/javascript image/svg+xml;
gzip_min_length 1024;  // å¤§äº1KBæ‰å‹ç¼©
gzip_comp_level 6;     // å‹ç¼©çº§åˆ«1-9

// æ•ˆæœï¼šæ–‡ä»¶ä½“ç§¯å‡å°‘70-90%
```

**å¯¹æ¯”ï¼š**
- åŸå§‹å¤§å°ï¼š100KB
- Gzipåï¼š20-30KB
- Brotliåï¼š15-25KBï¼ˆæ›´ä¼˜ï¼‰

### 2) ä»£ç å‹ç¼©ï¼ˆMinifyï¼‰
```javascript
// å‹ç¼©å‰
function calculateTotal(price, quantity) {
  const tax = 0.1;
  return price * quantity * (1 + tax);
}

// å‹ç¼©å
function calculateTotal(e,t){return e*t*1.1}
```

**å·¥å…·ï¼š** Webpackã€Viteã€Terser

### 3) Tree Shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰
```javascript
// utils.js
export function add(a, b) { return a + b; }
export function subtract(a, b) { return a - b; }
export function multiply(a, b) { return a * b; }

// main.js
import { add } from './utils.js';  // åªå¯¼å…¥add

// æ‰“åŒ…åï¼šsubtractå’Œmultiplyä¸ä¼šè¢«æ‰“åŒ…
```

**è¦æ±‚ï¼š** ä½¿ç”¨ES6 Moduleï¼Œä¸è¦ç”¨CommonJS

---

## 3. æŒ‰éœ€åŠ è½½ â­â­â­â­â­

**å£è¯€ï¼šæ‡’åŠ è½½ã€åŠ¨æ€å¯¼å…¥ã€è·¯ç”±åˆ†å‰²**

### 1) è·¯ç”±æ‡’åŠ è½½
```javascript
// âŒ ä¸å¥½ï¼šæ‰€æœ‰é¡µé¢ä¸€æ¬¡åŠ è½½
import Home from './Home.vue';
import About from './About.vue';

// âœ… å¥½ï¼šæŒ‰éœ€åŠ è½½
const Home = () => import('./Home.vue');
const About = () => import('./About.vue');

const routes = [
  { path: '/', component: Home },
  { path: '/about', component: About }
];
```

**æ•ˆæœï¼š** é¦–å±ä½“ç§¯ä»1MBé™åˆ°300KB

### 2) ç»„ä»¶æ‡’åŠ è½½
```vue
<!-- å¼‚æ­¥ç»„ä»¶ -->
<script setup>
import { defineAsyncComponent } from 'vue';

// å¤§ç»„ä»¶æ‡’åŠ è½½
const HeavyChart = defineAsyncComponent(() =>
  import('./HeavyChart.vue')
);
</script>

<template>
  <HeavyChart v-if="showChart" />
</template>
```

### 3) ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¼•å…¥
```javascript
// âŒ ä¸å¥½ï¼šå¼•å…¥æ•´ä¸ªlodashï¼ˆ70KBï¼‰
import _ from 'lodash';
_.debounce(fn, 300);

// âœ… å¥½ï¼šåªå¼•å…¥éœ€è¦çš„ï¼ˆ2KBï¼‰
import debounce from 'lodash/debounce';
debounce(fn, 300);

// Element PlusæŒ‰éœ€å¼•å…¥
import { ElButton, ElInput } from 'element-plus';
```

**è®°å¿†å£è¯€ï¼š**
```
èµ„æºåŠ è½½ä¸‰å¤§æ‹›ï¼šå‡å°‘è¯·æ±‚ã€å‹ç¼©ä½“ç§¯ã€æŒ‰éœ€åŠ è½½
åˆå¹¶é›ªç¢§Base64ã€Gzipå‹ç¼©Tree Shakingã€æ‡’åŠ è½½åŠ¨æ€å¯¼å…¥
```

---

# äºŒã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

## 1. é¿å…é‡æ’ï¼ˆReflowï¼‰å’Œé‡ç»˜ï¼ˆRepaintï¼‰â­â­â­â­â­

**å£è¯€ï¼šè¯»å†™åˆ†ç¦»ã€æ‰¹é‡ä¿®æ”¹ã€è„±ç¦»æ–‡æ¡£æµ**

### é‡æ’vsé‡ç»˜å¯¹æ¯”

| æ“ä½œ | é‡æ’(Reflow) | é‡ç»˜(Repaint) | æ€§èƒ½å½±å“ |
|------|-------------|--------------|---------|
| ä¿®æ”¹width/height | âœ… | âœ… | æœ€æ…¢ |
| ä¿®æ”¹color/background | âŒ | âœ… | è¾ƒå¿« |
| ä¿®æ”¹transform/opacity | âŒ | âŒ | æœ€å¿« |

### 1) æ‰¹é‡ä¿®æ”¹DOM
```javascript
// âŒ ä¸å¥½ï¼šè§¦å‘3æ¬¡é‡æ’
element.style.width = '100px';
element.style.height = '100px';
element.style.margin = '10px';

// âœ… å¥½ï¼šåªè§¦å‘1æ¬¡é‡æ’
element.style.cssText = 'width:100px;height:100px;margin:10px';

// âœ… æ›´å¥½ï¼šä½¿ç”¨class
element.classList.add('optimized-style');
```

### 2) è¯»å†™åˆ†ç¦»
```javascript
// âŒ ä¸å¥½ï¼šè¯»å†™äº¤æ›¿ï¼Œè§¦å‘å¤šæ¬¡é‡æ’
div1.style.height = div1.offsetHeight + 10 + 'px'; // å†™-è¯»-å†™
div2.style.height = div2.offsetHeight + 10 + 'px';

// âœ… å¥½ï¼šå…ˆè¯»åå†™
const height1 = div1.offsetHeight;  // è¯»
const height2 = div2.offsetHeight;  // è¯»
div1.style.height = height1 + 10 + 'px'; // å†™
div2.style.height = height2 + 10 + 'px'; // å†™
```

### 3) è„±ç¦»æ–‡æ¡£æµ
```javascript
// å¤§é‡DOMæ“ä½œæ—¶ï¼Œå…ˆè„±ç¦»æ–‡æ¡£æµ
const container = document.getElementById('container');

// æ–¹å¼1ï¼šdisplay: none
container.style.display = 'none';
// ... è¿›è¡Œ100æ¬¡DOMæ“ä½œ
container.style.display = 'block';  // åªè§¦å‘1æ¬¡é‡æ’

// æ–¹å¼2ï¼šDocumentFragment
const fragment = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
  const li = document.createElement('li');
  li.textContent = `Item ${i}`;
  fragment.appendChild(li);
}
ul.appendChild(fragment);  // åªè§¦å‘1æ¬¡é‡æ’
```

### 4) ä½¿ç”¨transformä»£æ›¿top/left
```css
/* âŒ ä¸å¥½ï¼šè§¦å‘é‡æ’ */
.box {
  position: absolute;
  left: 100px;
  transition: left 0.3s;
}
.box:hover {
  left: 200px;
}

/* âœ… å¥½ï¼šåªè§¦å‘åˆæˆï¼Œä¸é‡æ’ */
.box {
  transform: translateX(0);
  transition: transform 0.3s;
}
.box:hover {
  transform: translateX(100px);
}
```

---

## 2. CSSä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šé€‰æ‹©å™¨ç®€åŒ–ã€é¿å…@importã€å…³é”®CSSå†…è”**

### 1) ç®€åŒ–CSSé€‰æ‹©å™¨
```css
/* âŒ ä¸å¥½ï¼šé€‰æ‹©å™¨è¿‡æ·± */
.header .nav .menu .item .link .icon {
  color: red;
}

/* âœ… å¥½ï¼šæ‰å¹³åŒ– */
.nav-link-icon {
  color: red;
}
```

**åŸå› ï¼š** CSSé€‰æ‹©å™¨ä»å³å‘å·¦åŒ¹é…ï¼Œè¶ŠçŸ­è¶Šå¿«

### 2) é¿å…ä½¿ç”¨@import
```css
/* âŒ ä¸å¥½ï¼šä¸²è¡ŒåŠ è½½ */
@import url('a.css');
@import url('b.css');

/* âœ… å¥½ï¼šå¹¶è¡ŒåŠ è½½ */
<link rel="stylesheet" href="a.css">
<link rel="stylesheet" href="b.css">
```

### 3) å…³é”®CSSå†…è”
```html
<!-- é¦–å±å…³é”®CSSç›´æ¥å†™åœ¨<head>é‡Œ -->
<head>
  <style>
    /* å…³é”®CSSï¼šé¦–å±å¿…éœ€çš„æ ·å¼ */
    .header { height: 60px; background: #fff; }
    .hero { height: 400px; }
  </style>

  <!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ -->
  <link rel="preload" href="main.css" as="style" onload="this.rel='stylesheet'">
</head>
```

**è®°å¿†å£è¯€ï¼š**
```
æ¸²æŸ“ä¼˜åŒ–è®°å››ç‚¹ï¼šé¿å…é‡æ’ã€æ‰¹é‡ä¿®æ”¹ã€transformåŠ¨ç”»ã€CSSç®€åŒ–
è¯»å†™åˆ†ç¦»è„±æ–‡æ¡£ã€transformä»£æ›¿leftã€å…³é”®CSSå†…è”
```

---

# ä¸‰ã€JavaScriptä¼˜åŒ–

## 1. é˜²æŠ–å’ŒèŠ‚æµ â­â­â­â­â­

**å£è¯€ï¼šé˜²æŠ–ç­‰åœæ­¢ã€èŠ‚æµå›ºå®šé—´éš”**

### é˜²æŠ–ï¼ˆDebounceï¼‰
```javascript
// åº”ç”¨åœºæ™¯ï¼šæœç´¢æ¡†è¾“å…¥ã€çª—å£resize
function debounce(fn, delay) {
  let timer = null;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
}

// ä½¿ç”¨
const search = debounce((keyword) => {
  console.log('æœç´¢:', keyword);
}, 300);

input.addEventListener('input', (e) => search(e.target.value));
```

### èŠ‚æµï¼ˆThrottleï¼‰
```javascript
// åº”ç”¨åœºæ™¯ï¼šæ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨
function throttle(fn, delay) {
  let lastTime = 0;
  return function(...args) {
    const now = Date.now();
    if (now - lastTime >= delay) {
      fn.apply(this, args);
      lastTime = now;
    }
  };
}

// ä½¿ç”¨
const handleScroll = throttle(() => {
  console.log('æ»šåŠ¨ä½ç½®:', window.scrollY);
}, 200);

window.addEventListener('scroll', handleScroll);
```

### å¯¹æ¯”è¡¨æ ¼

| ç‰¹æ€§ | é˜²æŠ– | èŠ‚æµ |
|------|------|------|
| **æ‰§è¡Œæ—¶æœº** | åœæ­¢è§¦å‘åæ‰§è¡Œ | å›ºå®šé—´éš”æ‰§è¡Œ |
| **æ‰§è¡Œæ¬¡æ•°** | 1æ¬¡ | å¤šæ¬¡ |
| **é€‚ç”¨åœºæ™¯** | æœç´¢ã€resize | æ»šåŠ¨ã€mousemove |
| **å®é™…ä¾‹å­** | è¾“å…¥åœæ­¢300msåæœç´¢ | æ»šåŠ¨æ—¶æ¯200msæ‰§è¡Œä¸€æ¬¡ |

---

## 2. é•¿åˆ—è¡¨ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šè™šæ‹Ÿæ»šåŠ¨ã€åˆ†é¡µåŠ è½½ã€æ—¶é—´åˆ†ç‰‡**

### 1) è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollï¼‰
```vue
<!-- åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å…ƒç´  -->
<template>
  <div class="virtual-list" @scroll="handleScroll" ref="container">
    <div class="phantom" :style="{ height: totalHeight + 'px' }"></div>
    <div class="content" :style="{ transform: `translateY(${offset}px)` }">
      <div v-for="item in visibleData" :key="item.id" class="item">
        {{ item.text }}
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';

const data = ref(Array.from({ length: 10000 }, (_, i) => ({
  id: i,
  text: `Item ${i}`
})));

const itemHeight = 50;      // æ¯é¡¹é«˜åº¦
const visibleCount = 20;    // å¯è§æ•°é‡
const scrollTop = ref(0);

const startIndex = computed(() => Math.floor(scrollTop.value / itemHeight));
const endIndex = computed(() => startIndex.value + visibleCount);
const visibleData = computed(() => data.value.slice(startIndex.value, endIndex.value));
const offset = computed(() => startIndex.value * itemHeight);
const totalHeight = computed(() => data.value.length * itemHeight);

function handleScroll(e) {
  scrollTop.value = e.target.scrollTop;
}
</script>
```

**æ•ˆæœï¼š** 10000æ¡æ•°æ®ï¼Œåªæ¸²æŸ“20ä¸ªDOMèŠ‚ç‚¹

### 2) æ—¶é—´åˆ†ç‰‡ï¼ˆTime Slicingï¼‰
```javascript
// å¤§é‡æ•°æ®åˆ†æ‰¹æ¸²æŸ“
function timeSlice(data, batchSize = 100) {
  let index = 0;

  function render() {
    const batch = data.slice(index, index + batchSize);
    batch.forEach(item => {
      const div = document.createElement('div');
      div.textContent = item;
      container.appendChild(div);
    });

    index += batchSize;

    if (index < data.length) {
      requestAnimationFrame(render);  // ä¸‹ä¸€å¸§ç»§ç»­
    }
  }

  render();
}

// ä½¿ç”¨
const data = Array.from({ length: 10000 }, (_, i) => `Item ${i}`);
timeSlice(data, 100);  // æ¯æ¬¡æ¸²æŸ“100æ¡
```

---

## 3. Web Worker â­â­â­â­

**å£è¯€ï¼šè®¡ç®—å¯†é›†ã€åå°å¤„ç†ã€ä¸é˜»å¡UI**

```javascript
// worker.js
self.addEventListener('message', (e) => {
  const { data } = e;

  // è€—æ—¶è®¡ç®—
  const result = heavyComputation(data);

  // è¿”å›ç»“æœ
  self.postMessage(result);
});

function heavyComputation(data) {
  // å¤æ‚è®¡ç®—é€»è¾‘
  let sum = 0;
  for (let i = 0; i < 1000000000; i++) {
    sum += i;
  }
  return sum;
}

// main.js
const worker = new Worker('worker.js');

worker.postMessage({ data: [1, 2, 3] });

worker.addEventListener('message', (e) => {
  console.log('è®¡ç®—ç»“æœ:', e.data);
});
```

**é€‚ç”¨åœºæ™¯ï¼š**
- å¤§æ•°æ®å¤„ç†
- å›¾åƒå¤„ç†
- å¤æ‚è®¡ç®—
- æ•°æ®åŠ å¯†/è§£å¯†

**è®°å¿†å£è¯€ï¼š**
```
JSä¼˜åŒ–ä¸‰æ¿æ–§ï¼šé˜²æŠ–èŠ‚æµã€è™šæ‹Ÿæ»šåŠ¨ã€Web Worker
é˜²æŠ–ç­‰åœæ­¢ã€èŠ‚æµå›ºå®šé—´éš”ã€è™šæ‹Ÿæ»šåŠ¨åªæ¸²æŸ“å¯è§
```

---

# å››ã€ç½‘ç»œä¼˜åŒ–

## 1. CDNåŠ é€Ÿ â­â­â­â­â­

**å£è¯€ï¼šå°±è¿‘è®¿é—®ã€å¹¶è¡Œä¸‹è½½ã€å‡è½»æœåŠ¡å™¨**

```html
<!-- ä½¿ç”¨CDN -->
<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
<link href="https://cdn.jsdelivr.net/npm/element-plus@2.3.0/dist/index.css">

<!-- å¤šä¸ªCDNåŸŸåï¼Œçªç ´æµè§ˆå™¨å¹¶å‘é™åˆ¶ -->
<link href="https://cdn1.example.com/a.css">
<link href="https://cdn2.example.com/b.css">
<script src="https://cdn3.example.com/c.js"></script>
```

**ä¼˜ç‚¹ï¼š**
- å°±è¿‘è®¿é—®ï¼Œå»¶è¿Ÿä½
- åˆ†æ•£æµé‡ï¼Œå‡è½»æºç«™å‹åŠ›
- å¤šåŸŸåå¹¶è¡Œä¸‹è½½ï¼ˆæµè§ˆå™¨é™åˆ¶ï¼šåŒåŸŸå6ä¸ªå¹¶å‘ï¼‰

---

## 2. HTTPç¼“å­˜ç­–ç•¥ â­â­â­â­â­

**å£è¯€ï¼šå¼ºç¼“å­˜ä¼˜å…ˆã€åå•†ç¼“å­˜å…œåº•**

### ç¼“å­˜é…ç½®æœ€ä½³å®è·µ

```javascript
// HTMLï¼šåå•†ç¼“å­˜ï¼ˆä¿è¯è·å–æœ€æ–°ï¼‰
app.get('/*.html', (req, res) => {
  res.set({
    'Cache-Control': 'no-cache',
    'ETag': calculateETag(content)
  });
});

// CSS/JSï¼ˆå¸¦hashï¼‰ï¼šå¼ºç¼“å­˜1å¹´
// app.abc123.js
app.get('/static/*.js', (req, res) => {
  res.set({
    'Cache-Control': 'public, max-age=31536000, immutable'
  });
});

// å›¾ç‰‡ï¼šå¼ºç¼“å­˜30å¤©
app.get('/images/*', (req, res) => {
  res.set({
    'Cache-Control': 'public, max-age=2592000'
  });
});

// APIï¼šä¸ç¼“å­˜
app.get('/api/*', (req, res) => {
  res.set({
    'Cache-Control': 'no-store'
  });
});
```

---

## 3. DNSé¢„è§£æå’Œé¢„è¿æ¥ â­â­â­â­

```html
<!-- DNSé¢„è§£æ -->
<link rel="dns-prefetch" href="https://api.example.com">

<!-- é¢„è¿æ¥ï¼ˆDNS + TCP + TLSï¼‰ -->
<link rel="preconnect" href="https://cdn.example.com">

<!-- é¢„åŠ è½½å…³é”®èµ„æº -->
<link rel="preload" href="main.css" as="style">
<link rel="preload" href="main.js" as="script">

<!-- é¢„è·å–ä¸‹ä¸€é¡µèµ„æº -->
<link rel="prefetch" href="/page2.html">
```

### å¯¹æ¯”è¡¨æ ¼

| æŒ‡ä»¤ | ä½œç”¨ | æ—¶æœº | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| dns-prefetch | DNSè§£æ | ç©ºé—²æ—¶ | ç¬¬ä¸‰æ–¹åŸŸå |
| preconnect | DNS+TCP+TLS | ç©ºé—²æ—¶ | é‡è¦èµ„æºåŸŸå |
| preload | æå‰ä¸‹è½½ | ç«‹å³ | å…³é”®èµ„æº |
| prefetch | æå‰ç¼“å­˜ | ç©ºé—²æ—¶ | ä¸‹ä¸€é¡µèµ„æº |

**è®°å¿†å£è¯€ï¼š**
```
ç½‘ç»œä¼˜åŒ–å››æ³•å®ï¼šCDNåŠ é€Ÿã€HTTPç¼“å­˜ã€èµ„æºé¢„åŠ è½½
å¼ºç¼“å­˜ä¸€å¹´ã€åå•†ç¼“å­˜éªŒè¯ã€preloadå…³é”®èµ„æº
```

---

# äº”ã€å›¾ç‰‡ä¼˜åŒ–

## 1. å›¾ç‰‡æ ¼å¼é€‰æ‹© â­â­â­â­â­

**å£è¯€ï¼šç…§ç‰‡JPEGã€å›¾æ ‡PNGã€åŠ¨ç”»GIFæ”¹WebP**

### æ ¼å¼å¯¹æ¯”è¡¨

| æ ¼å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä½“ç§¯ | æµè§ˆå™¨æ”¯æŒ |
|------|------|----------|------|-----------|
| **JPEG** | æœ‰æŸå‹ç¼© | ç…§ç‰‡ã€å¤æ‚å›¾åƒ | å° | âœ… æ‰€æœ‰ |
| **PNG** | æ— æŸå‹ç¼©ã€é€æ˜ | Logoã€å›¾æ ‡ | å¤§ | âœ… æ‰€æœ‰ |
| **WebP** | æœ‰æŸ/æ— æŸã€é€æ˜ | æ›¿ä»£JPEG/PNG | æœ€å° | âœ… ç°ä»£æµè§ˆå™¨ |
| **SVG** | çŸ¢é‡å›¾ | å›¾æ ‡ã€ç®€å•å›¾å½¢ | æå° | âœ… æ‰€æœ‰ |
| **AVIF** | æ–°ä¸€ä»£æ ¼å¼ | ç…§ç‰‡ | æå° | âš ï¸ éƒ¨åˆ†æ”¯æŒ |

### WebPå…¼å®¹æ–¹æ¡ˆ
```html
<picture>
  <source srcset="image.avif" type="image/avif">
  <source srcset="image.webp" type="image/webp">
  <img src="image.jpg" alt="fallback">
</picture>
```

---

## 2. å›¾ç‰‡æ‡’åŠ è½½ â­â­â­â­â­

**å£è¯€ï¼šé¦–å±ä¼˜å…ˆã€æ»šåŠ¨åˆ°æ‰åŠ è½½**

### åŸç”Ÿæ‡’åŠ è½½
```html
<!-- ç®€å•æ–¹å¼ï¼šloading="lazy" -->
<img src="image.jpg" loading="lazy" alt="å›¾ç‰‡">
```

### IntersectionObserveræ‡’åŠ è½½
```javascript
// æ›´ç²¾ç»†çš„æ§åˆ¶
const images = document.querySelectorAll('img[data-src]');

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;  // åŠ è½½çœŸå®å›¾ç‰‡
      img.removeAttribute('data-src');
      observer.unobserve(img);
    }
  });
}, {
  rootMargin: '50px'  // æå‰50pxåŠ è½½
});

images.forEach(img => observer.observe(img));
```

```html
<!-- HTML -->
<img data-src="real-image.jpg" src="placeholder.jpg" alt="å›¾ç‰‡">
```

---

## 3. å“åº”å¼å›¾ç‰‡ â­â­â­â­

**å£è¯€ï¼šä¸åŒå°ºå¯¸ã€ä¸åŒåˆ†è¾¨ç‡ã€æŒ‰éœ€åŠ è½½**

```html
<!-- æ ¹æ®å±å¹•å®½åº¦é€‰æ‹©å›¾ç‰‡ -->
<img
  srcset="
    small.jpg 480w,
    medium.jpg 800w,
    large.jpg 1200w
  "
  sizes="
    (max-width: 480px) 100vw,
    (max-width: 800px) 50vw,
    33vw
  "
  src="medium.jpg"
  alt="å“åº”å¼å›¾ç‰‡"
>
```

**è®°å¿†å£è¯€ï¼š**
```
å›¾ç‰‡ä¼˜åŒ–äº”è¦ç‚¹ï¼šæ ¼å¼é€‰æ‹©ã€æ‡’åŠ è½½ã€å“åº”å¼ã€å‹ç¼©ã€CDN
ç…§ç‰‡JPEGã€å›¾æ ‡PNGã€WebPæœ€ä¼˜ã€æ‡’åŠ è½½æé€Ÿ
```

---

# å…­ã€Vue/Reactä¼˜åŒ–

## 1. Vueæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

### 1) v-if vs v-show
```vue
<!-- é¢‘ç¹åˆ‡æ¢ç”¨v-show -->
<div v-show="isVisible">å†…å®¹</div>

<!-- å¾ˆå°‘åˆ‡æ¢ç”¨v-if -->
<div v-if="isLogin">ç”¨æˆ·ä¿¡æ¯</div>
```

### 2) åˆ—è¡¨ä½¿ç”¨key
```vue
<!-- âŒ ä¸å¥½ï¼šç”¨indexä½œkey -->
<li v-for="(item, index) in list" :key="index">

<!-- âœ… å¥½ï¼šç”¨å”¯ä¸€id -->
<li v-for="item in list" :key="item.id">
```

### 3) computedç¼“å­˜
```vue
<script setup>
// âœ… å¥½ï¼šä½¿ç”¨computedï¼Œæœ‰ç¼“å­˜
const total = computed(() => {
  return cart.value.reduce((sum, item) => sum + item.price, 0);
});

// âŒ ä¸å¥½ï¼šä½¿ç”¨æ–¹æ³•ï¼Œæ¯æ¬¡éƒ½è®¡ç®—
function getTotal() {
  return cart.value.reduce((sum, item) => sum + item.price, 0);
}
</script>
```

### 4) keep-aliveç¼“å­˜ç»„ä»¶
```vue
<template>
  <keep-alive :include="['UserList', 'OrderList']">
    <router-view />
  </keep-alive>
</template>
```

---

## 2. Reactæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

### 1) React.memo
```javascript
// é˜²æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
const Child = React.memo(({ name }) => {
  console.log('Childæ¸²æŸ“');
  return <div>{name}</div>;
});
```

### 2) useMemoå’ŒuseCallback
```javascript
// useMemo - ç¼“å­˜è®¡ç®—ç»“æœ
const total = useMemo(() => {
  return cart.reduce((sum, item) => sum + item.price, 0);
}, [cart]);

// useCallback - ç¼“å­˜å‡½æ•°
const handleClick = useCallback(() => {
  console.log('ç‚¹å‡»');
}, []);
```

### 3) è™šæ‹Ÿæ»šåŠ¨
```javascript
// ä½¿ç”¨react-window
import { FixedSizeList } from 'react-window';

<FixedSizeList
  height={500}
  itemCount={10000}
  itemSize={50}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>Item {index}</div>
  )}
</FixedSizeList>
```

**è®°å¿†å£è¯€ï¼š**
```
Vueä¼˜åŒ–ï¼šv-showé¢‘ç¹åˆ‡æ¢ã€keyç”¨idã€computedç¼“å­˜ã€keep-aliveå¤ç”¨
Reactä¼˜åŒ–ï¼šmemoé˜²é‡æ¸²ã€useMemoç¼“å­˜å€¼ã€useCallbackç¼“å­˜å‡½æ•°
```

---

# ä¸ƒã€Webpack/Viteä¼˜åŒ–

## 1. Webpackæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šç¼“å­˜åˆ†å‰²ã€æŒ‰éœ€æ‡’åŠ è½½ã€å¹¶è¡Œå‹ç¼©**

### 1) ç¼“å­˜ä¼˜åŒ–ï¼ˆCacheï¼‰

#### contenthashæ–‡ä»¶æŒ‡çº¹
```javascript
// webpack.config.js
module.exports = {
  output: {
    filename: '[name].[contenthash:8].js',  // å†…å®¹å˜åŒ–æ‰æ”¹å˜hash
    chunkFilename: '[name].[contenthash:8].chunk.js'
  }
};
```

**æ•ˆæœï¼š** æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œhashä¸å˜ï¼Œæµè§ˆå™¨ç›´æ¥ç”¨ç¼“å­˜

#### cacheæŒä¹…åŒ–ç¼“å­˜
```javascript
// webpack.config.js
module.exports = {
  cache: {
    type: 'filesystem',  // æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
    buildDependencies: {
      config: [__filename]  // é…ç½®å˜åŒ–æ—¶é‡æ–°æ„å»º
    }
  }
};
```

**æ•ˆæœï¼š** äºŒæ¬¡æ„å»ºé€Ÿåº¦æå‡90%ï¼ˆ30s â†’ 3sï¼‰

---

### 2) ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰â­â­â­â­â­

#### splitChunksæå–å…¬å…±ä»£ç 
```javascript
// webpack.config.js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // æå–ç¬¬ä¸‰æ–¹åº“
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: 10
        },
        // æå–å…¬å…±ä»£ç 
        common: {
          minChunks: 2,
          name: 'common',
          priority: 5,
          reuseExistingChunk: true
        }
      }
    }
  }
};
```

**æ•ˆæœï¼š**
- main.jsï¼š100KB â†’ 30KB
- vendor.jsï¼š70KBï¼ˆå¯é•¿æœŸç¼“å­˜ï¼‰
- common.jsï¼š10KB

#### åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰
```javascript
// âŒ ä¸å¥½ï¼šæ‰“åŒ…åˆ°ä¸€èµ·
import HeavyComponent from './HeavyComponent.vue';

// âœ… å¥½ï¼šæŒ‰éœ€åŠ è½½
const HeavyComponent = () => import(
  /* webpackChunkName: "heavy" */
  './HeavyComponent.vue'
);
```

---

### 3) æ„å»ºé€Ÿåº¦ä¼˜åŒ– â­â­â­â­â­

#### å¤šè¿›ç¨‹æ„å»º
```javascript
// webpack.config.js
const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        parallel: true,  // å¤šè¿›ç¨‹å¹¶è¡Œå‹ç¼©
        terserOptions: {
          compress: {
            drop_console: true  // åˆ é™¤console
          }
        }
      })
    ]
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          {
            loader: 'thread-loader',  // å¤šè¿›ç¨‹loader
            options: { workers: 4 }
          },
          'babel-loader'
        ]
      }
    ]
  }
};
```

**æ•ˆæœï¼š** æ„å»ºæ—¶é—´å‡å°‘40-60%

#### ç¼©å°æ„å»ºèŒƒå›´
```javascript
// webpack.config.js
module.exports = {
  resolve: {
    // æŒ‡å®šæ‰©å±•åï¼Œå‡å°‘æŸ¥æ‰¾
    extensions: ['.js', '.vue', '.json'],
    // åˆ«åï¼Œé¿å…å±‚å±‚æŸ¥æ‰¾
    alias: {
      '@': path.resolve(__dirname, 'src'),
      'vue$': 'vue/dist/vue.runtime.esm.js'
    },
    // æŒ‡å®šæ¨¡å—æŸ¥æ‰¾ç›®å½•
    modules: [path.resolve(__dirname, 'node_modules')]
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'),  // åªå¤„ç†src
        exclude: /node_modules/,  // æ’é™¤node_modules
        use: 'babel-loader'
      }
    ]
  }
};
```

#### noParseè·³è¿‡è§£æ
```javascript
// webpack.config.js
module.exports = {
  module: {
    noParse: /jquery|lodash/,  // ä¸è§£æè¿™äº›åº“ï¼ˆå·²ç»æ‰“åŒ…å¥½ï¼‰
  }
};
```

---

### 4) Tree Shaking â­â­â­â­â­

```javascript
// webpack.config.js
module.exports = {
  mode: 'production',  // ç”Ÿäº§æ¨¡å¼è‡ªåŠ¨å¼€å¯
  optimization: {
    usedExports: true,  // æ ‡è®°æœªä½¿ç”¨çš„å¯¼å‡º
    sideEffects: false  // å¼€å¯å‰¯ä½œç”¨æ£€æµ‹
  }
};

// package.json
{
  "sideEffects": [
    "*.css",
    "*.scss"
  ]
}
```

**è¦æ±‚ï¼š**
- ä½¿ç”¨ES6 Moduleï¼ˆimport/exportï¼‰
- ä¸è¦ç”¨CommonJSï¼ˆrequireï¼‰

---

### 5) DLLåŠ¨æ€é“¾æ¥åº“ï¼ˆå·²è¿‡æ—¶ï¼Œäº†è§£å³å¯ï¼‰

```javascript
// webpack.dll.config.js
const webpack = require('webpack');

module.exports = {
  entry: {
    vendor: ['vue', 'vue-router', 'vuex']
  },
  output: {
    filename: '[name].dll.js',
    library: '[name]_library'
  },
  plugins: [
    new webpack.DllPlugin({
      name: '[name]_library',
      path: path.join(__dirname, '[name]-manifest.json')
    })
  ]
};
```

**æ³¨æ„ï¼š** Webpack 5çš„æŒä¹…åŒ–ç¼“å­˜å·²æ›¿ä»£DLLï¼Œä¸æ¨èä½¿ç”¨

---

## 2. Viteæ€§èƒ½ä¼˜åŒ– â­â­â­â­â­

**å£è¯€ï¼šé¢„æ„å»ºã€æŒ‰éœ€ç¼–è¯‘ã€Rollupæ‰“åŒ…**

### 1) Vite vs Webpackå¯¹æ¯”

| å¯¹æ¯”é¡¹ | Webpack | Vite |
|--------|---------|------|
| **å¼€å‘æ¨¡å¼** | Bundleï¼ˆæ‰“åŒ…ï¼‰ | ESMï¼ˆåŸç”Ÿæ¨¡å—ï¼‰ |
| **å†·å¯åŠ¨** | æ…¢ï¼ˆ20-60sï¼‰ | å¿«ï¼ˆ1-3sï¼‰ |
| **çƒ­æ›´æ–°** | æ…¢ï¼ˆéœ€é‡æ–°æ‰“åŒ…ï¼‰ | å¿«ï¼ˆåªç¼–è¯‘æ”¹åŠ¨æ–‡ä»¶ï¼‰ |
| **ç”Ÿäº§æ„å»º** | Webpack | Rollup |
| **é€‚ç”¨åœºæ™¯** | å¤§å‹é¡¹ç›®ã€å¤æ‚é…ç½® | ç°ä»£æµè§ˆå™¨ã€å¿«é€Ÿå¼€å‘ |

### Viteå¿«çš„åŸå› 
1. **å¼€å‘æ—¶**ï¼šä¸æ‰“åŒ…ï¼Œåˆ©ç”¨æµè§ˆå™¨åŸç”ŸESM
2. **æŒ‰éœ€ç¼–è¯‘**ï¼šåªç¼–è¯‘å½“å‰é¡µé¢éœ€è¦çš„æ¨¡å—
3. **é¢„æ„å»º**ï¼šä¾èµ–é¢„æ„å»ºï¼ˆesbuildï¼Œæ¯”Webpackå¿«10-100å€ï¼‰

---

### 2) Viteä¼˜åŒ–é…ç½®

#### ä¾èµ–é¢„æ„å»ºä¼˜åŒ–
```javascript
// vite.config.js
export default {
  optimizeDeps: {
    // å¼ºåˆ¶é¢„æ„å»ºçš„ä¾èµ–
    include: [
      'vue',
      'vue-router',
      'pinia',
      'axios',
      'lodash-es'
    ],
    // æ’é™¤é¢„æ„å»º
    exclude: ['your-local-package']
  }
};
```

#### æ„å»ºä¼˜åŒ–
```javascript
// vite.config.js
export default {
  build: {
    // ä»£ç åˆ†å‰²
    rollupOptions: {
      output: {
        manualChunks: {
          // æå–Vueå…¨å®¶æ¡¶
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          // æå–UIåº“
          'ui-vendor': ['element-plus'],
          // æå–å·¥å…·åº“
          'utils': ['axios', 'dayjs', 'lodash-es']
        }
      }
    },
    // å‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    },
    // chunkå¤§å°è­¦å‘Š
    chunkSizeWarningLimit: 1000,
    // å°äº4KBçš„å›¾ç‰‡è½¬base64
    assetsInlineLimit: 4096
  }
};
```

#### å¼€å‘æœåŠ¡å™¨ä¼˜åŒ–
```javascript
// vite.config.js
export default {
  server: {
    // é¢„çƒ­å¸¸ç”¨æ–‡ä»¶
    warmup: {
      clientFiles: [
        './src/components/**/*.vue',
        './src/views/**/*.vue'
      ]
    },
    // æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
    fs: {
      cachedChecks: true
    }
  }
};
```

---

### 3) Viteæ’ä»¶ä¼˜åŒ–

#### è‡ªåŠ¨å¯¼å…¥
```javascript
// vite.config.js
import AutoImport from 'unplugin-auto-import/vite';
import Components from 'unplugin-vue-components/vite';
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers';

export default {
  plugins: [
    // è‡ªåŠ¨å¯¼å…¥Vue API
    AutoImport({
      imports: ['vue', 'vue-router', 'pinia'],
      resolvers: [ElementPlusResolver()]
    }),
    // è‡ªåŠ¨å¯¼å…¥ç»„ä»¶
    Components({
      resolvers: [ElementPlusResolver()]
    })
  ]
};
```

**æ•ˆæœï¼š** ä¸éœ€è¦æ‰‹åŠ¨importï¼Œè‡ªåŠ¨æŒ‰éœ€å¼•å…¥

#### å›¾ç‰‡ä¼˜åŒ–æ’ä»¶
```javascript
// vite.config.js
import { ViteImageOptimizer } from 'vite-plugin-image-optimizer';

export default {
  plugins: [
    ViteImageOptimizer({
      // å›¾ç‰‡å‹ç¼©
      png: { quality: 80 },
      jpeg: { quality: 80 },
      webp: { quality: 80 }
    })
  ]
};
```

#### gzipå‹ç¼©æ’ä»¶
```javascript
// vite.config.js
import viteCompression from 'vite-plugin-compression';

export default {
  plugins: [
    viteCompression({
      algorithm: 'gzip',
      ext: '.gz',
      threshold: 10240  // å¤§äº10KBæ‰å‹ç¼©
    })
  ]
};
```

---

### 4) Viteå¸¸è§é—®é¢˜ä¼˜åŒ–

#### é—®é¢˜1ï¼šé¦–æ¬¡å¯åŠ¨æ…¢
**åŸå› ï¼š** ä¾èµ–é¢„æ„å»ºè€—æ—¶

**è§£å†³ï¼š**
```javascript
// vite.config.js
export default {
  optimizeDeps: {
    // å¼ºåˆ¶é¢„æ„å»ºï¼Œé¿å…äºŒæ¬¡é¢„æ„å»º
    include: ['vue', 'vue-router', 'pinia', 'element-plus']
  }
};
```

#### é—®é¢˜2ï¼šçƒ­æ›´æ–°æ…¢
**åŸå› ï¼š** å¤§é‡æ–‡ä»¶ç›‘å¬

**è§£å†³ï¼š**
```javascript
// vite.config.js
export default {
  server: {
    watch: {
      // å¿½ç•¥ä¸éœ€è¦ç›‘å¬çš„æ–‡ä»¶
      ignored: ['**/node_modules/**', '**/.git/**']
    }
  }
};
```

#### é—®é¢˜3ï¼šæ‰“åŒ…ä½“ç§¯å¤§
**åŸå› ï¼š** ç¬¬ä¸‰æ–¹åº“ä½“ç§¯å¤§

**è§£å†³ï¼š**
```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      external: ['vue', 'element-plus'],  // å¤–éƒ¨åŒ–
      output: {
        globals: {
          vue: 'Vue',
          'element-plus': 'ElementPlus'
        }
      }
    }
  }
};

// index.htmlå¼•å…¥CDN
<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4"></script>
```

---

## 3. Webpack vs Viteé€‰æ‹©å»ºè®® â­â­â­â­

### é€‰æ‹©Webpackçš„åœºæ™¯
- âœ… å¤§å‹é¡¹ç›®ï¼ˆ>1000ä¸ªæ¨¡å—ï¼‰
- âœ… éœ€è¦å…¼å®¹IE11
- âœ… å¤æ‚çš„æ„å»ºéœ€æ±‚
- âœ… æˆç†Ÿçš„ç”Ÿæ€å’Œæ’ä»¶

### é€‰æ‹©Viteçš„åœºæ™¯
- âœ… æ–°é¡¹ç›®ï¼ˆæ¨èï¼‰
- âœ… Vue3/Reacté¡¹ç›®
- âœ… ç°ä»£æµè§ˆå™¨ï¼ˆES2015+ï¼‰
- âœ… å¿«é€Ÿå¼€å‘ä½“éªŒ

---

## 4. é¢è¯•é«˜é¢‘é¢˜ â­â­â­â­â­

### Q1: Webpackæ„å»ºé€Ÿåº¦ä¼˜åŒ–ï¼Ÿ

**ç­”æ¡ˆï¼ˆ5ä¸ªæ–¹é¢ï¼‰ï¼š**

1. **ç¼“å­˜**
   - cache: 'filesystem'æŒä¹…åŒ–ç¼“å­˜
   - babel-loaderçš„cacheDirectory

2. **å¤šè¿›ç¨‹**
   - thread-loaderå¤šè¿›ç¨‹loader
   - TerserPluginå¹¶è¡Œå‹ç¼©

3. **ç¼©å°èŒƒå›´**
   - include/excludeç²¾ç¡®åŒ¹é…
   - resolve.modulesæŒ‡å®šæŸ¥æ‰¾ç›®å½•

4. **DLLé¢„ç¼–è¯‘**ï¼ˆå·²è¿‡æ—¶ï¼‰
   - ç¬¬ä¸‰æ–¹åº“é¢„ç¼–è¯‘
   - Webpack 5ç”¨cacheæ›¿ä»£

5. **æŒ‰éœ€åŠ è½½**
   - åŠ¨æ€import
   - splitChunksä»£ç åˆ†å‰²

---

### Q2: Viteä¸ºä»€ä¹ˆæ¯”Webpackå¿«ï¼Ÿ

**ç­”æ¡ˆï¼ˆ3ä¸ªæ ¸å¿ƒåŸå› ï¼‰ï¼š**

1. **å¼€å‘æ—¶ä¸æ‰“åŒ…**
   - Webpackï¼šæ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆbundle
   - Viteï¼šåˆ©ç”¨æµè§ˆå™¨åŸç”ŸESM

2. **æŒ‰éœ€ç¼–è¯‘**
   - Webpackï¼šå¯åŠ¨æ—¶å…¨é‡ç¼–è¯‘
   - Viteï¼šåªç¼–è¯‘å½“å‰é¡µé¢éœ€è¦çš„

3. **esbuildé¢„æ„å»º**
   - Webpackï¼šJavaScriptç¼–è¯‘ï¼ˆæ…¢ï¼‰
   - Viteï¼šesbuildç¼–è¯‘ï¼ˆGoè¯­è¨€ï¼Œå¿«10-100å€ï¼‰

**å¯¹æ¯”ï¼š**
- Webpackå†·å¯åŠ¨ï¼š30-60s
- Viteå†·å¯åŠ¨ï¼š1-3s

---

### Q3: Tree ShakingåŸç†ï¼Ÿ

**ç­”æ¡ˆï¼š**

**åŸç†ï¼š** åŸºäºES6 Moduleçš„é™æ€åˆ†æï¼Œåˆ é™¤æœªä½¿ç”¨çš„ä»£ç 

**å·¥ä½œæµç¨‹ï¼š**
1. **æ ‡è®°é˜¶æ®µ**ï¼šæ ‡è®°æ‰€æœ‰ä½¿ç”¨çš„å¯¼å‡º
2. **æ¸…é™¤é˜¶æ®µ**ï¼šåˆ é™¤æœªä½¿ç”¨çš„å¯¼å‡º

**è¦æ±‚ï¼š**
- ä½¿ç”¨ES6 Moduleï¼ˆimport/exportï¼‰
- ä¸è¦ç”¨CommonJSï¼ˆrequire/module.exportsï¼‰
- package.jsonè®¾ç½®sideEffects

**æ•ˆæœï¼š** lodashä»70KBé™åˆ°5KBï¼ˆåªç”¨äº†1ä¸ªå‡½æ•°ï¼‰

---

### Q4: splitChunkså¦‚ä½•é…ç½®ï¼Ÿ

**ç­”æ¡ˆï¼ˆæœ€ä½³å®è·µï¼‰ï¼š**

```javascript
splitChunks: {
  chunks: 'all',
  cacheGroups: {
    // ç¬¬ä¸‰æ–¹åº“
    vendor: {
      test: /[\\/]node_modules[\\/]/,
      name: 'vendors',
      priority: 10
    },
    // å…¬å…±ä»£ç 
    common: {
      minChunks: 2,
      name: 'common',
      priority: 5
    }
  }
}
```

**æ•ˆæœï¼š**
- ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…ï¼Œå¯é•¿æœŸç¼“å­˜
- å…¬å…±ä»£ç æå–ï¼Œé¿å…é‡å¤æ‰“åŒ…
- é¦–å±åŠ è½½æ›´å¿«

---

**è®°å¿†å£è¯€ï¼š**
```
Webpackä¼˜åŒ–ï¼šç¼“å­˜åˆ†å‰²ã€å¤šè¿›ç¨‹å¹¶è¡Œã€ç¼©å°èŒƒå›´
Viteä¼˜åŒ–ï¼šé¢„æ„å»ºä¾èµ–ã€ä»£ç åˆ†å‰²ã€æ’ä»¶è‡ªåŠ¨åŒ–
Viteå¿«ä¸‰ç‚¹ï¼šä¸æ‰“åŒ…ã€æŒ‰éœ€ç¼–è¯‘ã€esbuildé¢„æ„å»º
```

---

# å…«ã€æ€§èƒ½ç›‘æ§

## 1. æ€§èƒ½æŒ‡æ ‡ â­â­â­â­â­

**å£è¯€ï¼šFCPé¦–ç»˜ã€LCPæœ€å¤§ã€FIDäº¤äº’ã€CLSåç§»ã€TTFBé¦–å­—èŠ‚**

### æ ¸å¿ƒWebæŒ‡æ ‡ï¼ˆCore Web Vitalsï¼‰

| æŒ‡æ ‡ | å«ä¹‰ | ç›®æ ‡å€¼ | å½±å“å› ç´  |
|------|------|--------|----------|
| **FCP** | é¦–æ¬¡å†…å®¹ç»˜åˆ¶ | <1.8s | HTMLã€CSSåŠ è½½é€Ÿåº¦ |
| **LCP** | æœ€å¤§å†…å®¹ç»˜åˆ¶ | <2.5s | å›¾ç‰‡ã€è§†é¢‘åŠ è½½ |
| **FID** | é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ | <100ms | JavaScriptæ‰§è¡Œ |
| **CLS** | ç´¯ç§¯å¸ƒå±€åç§» | <0.1 | åŠ¨æ€å†…å®¹åŠ è½½ |
| **TTFB** | é¦–å­—èŠ‚æ—¶é—´ | <600ms | æœåŠ¡å™¨å“åº”é€Ÿåº¦ |

### ä½¿ç”¨Performance APIç›‘æ§
```javascript
// 1. è·å–æ€§èƒ½æŒ‡æ ‡
window.addEventListener('load', () => {
  const perfData = performance.timing;
  const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
  const domReadyTime = perfData.domContentLoadedEventEnd - perfData.navigationStart;
  const ttfb = perfData.responseStart - perfData.navigationStart;

  console.log('é¡µé¢åŠ è½½æ—¶é—´:', pageLoadTime);
  console.log('DOMè§£ææ—¶é—´:', domReadyTime);
  console.log('é¦–å­—èŠ‚æ—¶é—´:', ttfb);
});

// 2. ä½¿ç”¨Web Vitalsåº“
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getFCP(console.log);
getLCP(console.log);
getTTFB(console.log);
```

---

## 2. æ€§èƒ½ç›‘æ§å·¥å…· â­â­â­â­

### 1) Chrome DevTools
```
1. Performanceé¢æ¿ï¼šå½•åˆ¶æ€§èƒ½
2. Lighthouseï¼šæ€§èƒ½è¯„åˆ†
3. Networké¢æ¿ï¼šç½‘ç»œç€‘å¸ƒå›¾
4. Coverageï¼šä»£ç è¦†ç›–ç‡
```

### 2) å‰ç«¯ç›‘æ§å¹³å°
- **Sentry** - é”™è¯¯ç›‘æ§
- **Google Analytics** - ç”¨æˆ·è¡Œä¸º
- **é˜¿é‡Œäº‘ARMS** - æ€§èƒ½ç›‘æ§
- **ç¥ç­–æ•°æ®** - åŸ‹ç‚¹åˆ†æ

**è®°å¿†å£è¯€ï¼š**
```
æ€§èƒ½æŒ‡æ ‡è®°äº”ä¸ªï¼šFCPã€LCPã€FIDã€CLSã€TTFB
é¦–ç»˜æœ€å¤§äº¤äº’åç§»é¦–å­—èŠ‚ã€DevToolså’ŒLighthouseæ˜¯å¥½å·¥å…·
```

---

# ä¹ã€é¢è¯•ç­”é¢˜æ¨¡æ¿

## é¢è¯•é¢˜ï¼šå¦‚ä½•è¿›è¡Œå‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼Ÿâ­â­â­â­â­

### ç­”é¢˜ç»“æ„ï¼ˆæ€»-åˆ†-æ€»ï¼‰

**ç¬¬ä¸€æ­¥ï¼šæ€»è¿°ï¼ˆå…­å¤§æ–¹å‘ï¼‰**
```
å‰ç«¯æ€§èƒ½ä¼˜åŒ–å¯ä»¥ä»6ä¸ªæ–¹å‘å…¥æ‰‹ï¼š
1. èµ„æºåŠ è½½ä¼˜åŒ–
2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–
3. JavaScriptä¼˜åŒ–
4. ç½‘ç»œä¼˜åŒ–
5. å›¾ç‰‡ä¼˜åŒ–
6. æ¡†æ¶å±‚é¢ä¼˜åŒ–
```

**ç¬¬äºŒæ­¥ï¼šåˆ†è¿°ï¼ˆ3-4ä¸ªé‡ç‚¹ï¼Œå¸¦ä»£ç ç¤ºä¾‹ï¼‰**

**1. èµ„æºåŠ è½½ä¼˜åŒ–ï¼ˆå¿…è¯´ï¼‰**
- å‡å°‘HTTPè¯·æ±‚ï¼šåˆå¹¶æ–‡ä»¶ã€CSSé›ªç¢§å›¾
- èµ„æºå‹ç¼©ï¼šGzip/Brotliå‹ç¼©
- æŒ‰éœ€åŠ è½½ï¼šè·¯ç”±æ‡’åŠ è½½ã€ç»„ä»¶å¼‚æ­¥åŠ è½½
- ä»£ç ç¤ºä¾‹ï¼š
```javascript
// è·¯ç”±æ‡’åŠ è½½
const Home = () => import('./Home.vue');
```

**2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼ˆå¿…è¯´ï¼‰**
- é¿å…é‡æ’é‡ç»˜ï¼šæ‰¹é‡ä¿®æ”¹DOMã€è¯»å†™åˆ†ç¦»
- ä½¿ç”¨transformä»£æ›¿top/left
- è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨
- ä»£ç ç¤ºä¾‹ï¼š
```javascript
// transformä»£æ›¿left
transform: translateX(100px);  // ä¸è§¦å‘é‡æ’
```

**3. ç½‘ç»œä¼˜åŒ–ï¼ˆæ¨èè¯´ï¼‰**
- CDNåŠ é€Ÿ
- HTTPç¼“å­˜ç­–ç•¥ï¼šå¼ºç¼“å­˜+åå•†ç¼“å­˜
- DNSé¢„è§£æã€èµ„æºé¢„åŠ è½½
- ä»£ç ç¤ºä¾‹ï¼š
```html
<link rel="preload" href="main.js" as="script">
```

**4. å›¾ç‰‡ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰**
- æ ¼å¼é€‰æ‹©ï¼šWebPä¼˜å…ˆ
- å›¾ç‰‡æ‡’åŠ è½½ï¼šIntersectionObserver
- å“åº”å¼å›¾ç‰‡ï¼šsrcset

**ç¬¬ä¸‰æ­¥ï¼šæ€»ç»“ï¼ˆç›‘æ§å’Œåº¦é‡ï¼‰**
```
æœ€åï¼Œæ€§èƒ½ä¼˜åŒ–è¦æœ‰æ•°æ®æ”¯æ’‘ï¼Œé€šè¿‡ï¼š
1. Chrome DevToolsã€Lighthouseè¯„ä¼°
2. ç›‘æ§FCPã€LCPã€FIDç­‰æ ¸å¿ƒæŒ‡æ ‡
3. å»ºç«‹æ€§èƒ½ç›‘æ§å¹³å°ï¼ŒæŒç»­ä¼˜åŒ–
```

---

## å…¶ä»–å¸¸è§è¿½é—®

### Q1: é‡æ’å’Œé‡ç»˜çš„åŒºåˆ«ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼š**
- **é‡æ’ï¼ˆReflowï¼‰**ï¼šå…ƒç´ ä½ç½®ã€å¤§å°å˜åŒ–ï¼Œéœ€é‡æ–°è®¡ç®—å¸ƒå±€ï¼Œ**å½±å“æ€§èƒ½**
  - è§¦å‘ï¼šä¿®æ”¹width/heightã€æ·»åŠ åˆ é™¤å…ƒç´ ã€æ”¹å˜å­—ä½“å¤§å°
- **é‡ç»˜ï¼ˆRepaintï¼‰**ï¼šå…ƒç´ å¤–è§‚å˜åŒ–ï¼Œ**ä¸å½±å“å¸ƒå±€**ï¼Œæ€§èƒ½å½±å“è¾ƒå°
  - è§¦å‘ï¼šä¿®æ”¹colorã€backgroundã€visibility

**ä¼˜åŒ–ï¼š**
- æ‰¹é‡ä¿®æ”¹DOM
- ä½¿ç”¨transform/opacityï¼ˆåªè§¦å‘åˆæˆå±‚ï¼Œä¸é‡æ’ä¸é‡ç»˜ï¼‰
- è¯»å†™åˆ†ç¦»

---

### Q2: è™šæ‹Ÿæ»šåŠ¨åŸç†ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼š**
åªæ¸²æŸ“å¯è§†åŒºåŸŸçš„å…ƒç´ ï¼Œå¤§å¹…å‡å°‘DOMæ•°é‡

**æ ¸å¿ƒæ­¥éª¤ï¼š**
1. è®¡ç®—å¯è§åŒºåŸŸï¼šæ ¹æ®scrollTopå’Œå®¹å™¨é«˜åº¦
2. åªæ¸²æŸ“å¯è§å…ƒç´ ï¼šå¦‚10000æ¡æ•°æ®åªæ¸²æŸ“20ä¸ª
3. ç”¨padding/transformæ’‘èµ·æ€»é«˜åº¦
4. ç›‘å¬scrolläº‹ä»¶æ›´æ–°å¯è§åŒºåŸŸ

**æ•ˆæœï¼š** 10000æ¡æ•°æ®ä»æ¸²æŸ“10000ä¸ªDOMé™åˆ°20ä¸ª

---

### Q3: é˜²æŠ–å’ŒèŠ‚æµçš„åŒºåˆ«ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§ | é˜²æŠ– | èŠ‚æµ |
|------|------|------|
| **åŸç†** | ç­‰å¾…åœæ­¢è§¦å‘åæ‰§è¡Œ | å›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œ |
| **æ‰§è¡Œæ¬¡æ•°** | 1æ¬¡ | å¤šæ¬¡ |
| **åœºæ™¯** | æœç´¢æ¡†ã€resize | æ»šåŠ¨ã€mousemove |
| **æ¯”å–»** | ç”µæ¢¯ç­‰äººé½äº†å†èµ° | åœ°é“å›ºå®šæ—¶é—´å‘è½¦ |

---

### Q4: å¦‚ä½•ä¼˜åŒ–é¦–å±åŠ è½½é€Ÿåº¦ï¼Ÿâ­â­â­â­â­

**ç­”æ¡ˆï¼ˆ5ä¸ªæ–¹é¢ï¼‰ï¼š**

1. **èµ„æºä¼˜åŒ–**
   - è·¯ç”±æ‡’åŠ è½½ã€ä»£ç åˆ†å‰²
   - å›¾ç‰‡æ‡’åŠ è½½ã€WebPæ ¼å¼
   - Gzipå‹ç¼©ã€Tree Shaking

2. **åŠ è½½ç­–ç•¥**
   - å…³é”®CSSå†…è”
   - å¼‚æ­¥åŠ è½½éå…³é”®èµ„æº
   - preload/prefetch

3. **æ¸²æŸ“ä¼˜åŒ–**
   - SSRæœåŠ¡ç«¯æ¸²æŸ“
   - éª¨æ¶å±ã€Loadingä¼˜åŒ–

4. **ç½‘ç»œä¼˜åŒ–**
   - CDNåŠ é€Ÿ
   - HTTP/2å¤šè·¯å¤ç”¨
   - å¼ºç¼“å­˜é™æ€èµ„æº

5. **ç›‘æ§ä¼˜åŒ–**
   - ç›‘æ§FCPã€LCPæŒ‡æ ‡
   - Lighthouseè¯„åˆ†ä¼˜åŒ–

---

## ğŸ¯ å¿…èƒŒé‡‘å¥

```
1. "æ€§èƒ½ä¼˜åŒ–éµå¾ª2-8åŸåˆ™ï¼š20%çš„ä¼˜åŒ–å¸¦æ¥80%çš„æå‡"
2. "ä¼˜å…ˆä¼˜åŒ–é¦–å±ï¼Œæ‡’åŠ è½½å…¶ä»–èµ„æº"
3. "é¿å…è¿‡æ—©ä¼˜åŒ–ï¼Œå…ˆæµ‹é‡å†ä¼˜åŒ–"
4. "æ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­è¿‡ç¨‹ï¼Œéœ€è¦ç›‘æ§å’Œè¿­ä»£"
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| é¦–å±åŠ è½½æ—¶é—´ | 5s | 1.5s | 70% |
| é¦–å±èµ„æºå¤§å° | 2MB | 500KB | 75% |
| é¦–å±è¯·æ±‚æ•° | 50ä¸ª | 15ä¸ª | 70% |
| LCP | 4s | 2s | 50% |
| Lighthouseåˆ†æ•° | 60åˆ† | 95åˆ† | +35åˆ† |

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

### å¿…é¡»æŒæ¡ï¼ˆé¢è¯•å¿…è€ƒï¼‰
1. âœ… é‡æ’é‡ç»˜åŸç†å’Œä¼˜åŒ–
2. âœ… é˜²æŠ–èŠ‚æµå®ç°
3. âœ… è™šæ‹Ÿæ»šåŠ¨åŸç†
4. âœ… å›¾ç‰‡æ‡’åŠ è½½å®ç°
5. âœ… HTTPç¼“å­˜ç­–ç•¥

### åŠ åˆ†é¡¹
1. â­ Web Workerä½¿ç”¨
2. â­ SSRæœåŠ¡ç«¯æ¸²æŸ“
3. â­ PWAæ€§èƒ½ä¼˜åŒ–
4. â­ æ€§èƒ½ç›‘æ§å¹³å°æ­å»º

### å®æˆ˜ç»ƒä¹ 
1. ç”¨Lighthouseåˆ†æçœŸå®é¡¹ç›®
2. å®ç°ä¸€ä¸ªè™šæ‹Ÿæ»šåŠ¨ç»„ä»¶
3. ä¼˜åŒ–ä¸€ä¸ªçœŸå®é¡µé¢ï¼Œå¯¹æ¯”ä¼˜åŒ–å‰åæ•°æ®

---

**ğŸ‰ æŒæ¡è¿™ä»½æ–‡æ¡£ï¼Œæ€§èƒ½ä¼˜åŒ–é¢è¯•é¢˜è½»æ¾æ‹¿ä¸‹ï¼è®°å¾—ç»“åˆå®é™…é¡¹ç›®ç»éªŒå›ç­”ï¼Œæ›´æœ‰è¯´æœåŠ›ï¼ğŸ’ª**
