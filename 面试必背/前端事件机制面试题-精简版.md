# å‰ç«¯äº‹ä»¶æœºåˆ¶é¢è¯•é¢˜-ç²¾ç®€ç‰ˆ â­â­â­â­â­

> ğŸ’¡ **æ ¸å¿ƒå£è¯€**: æ•è·ç›®æ ‡å†’æ³¡ã€çˆ¶ä»£å­å‡å†…å­˜ã€stopé˜»å†’æ³¡preventé˜»é»˜è®¤

---

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

| ä¸»é¢˜ | æ ¸å¿ƒå†…å®¹ | è®°å¿†å£è¯€ |
|------|---------|---------|
| äº‹ä»¶æµ | æ•è·â†’ç›®æ ‡â†’å†’æ³¡ | å¤–åˆ°å†…å†åˆ°å¤– |
| äº‹ä»¶å§”æ‰˜ | çˆ¶å…ƒç´ ä»£ç†å­å…ƒç´  | çˆ¶ä»£å­ã€å‡å†…å­˜ã€åŠ¨æ€ç»‘ |
| äº‹ä»¶å¯¹è±¡ | target vs currentTarget | targetæ˜¯æºã€currentTargetæ˜¯ç»‘ |
| addEventListener | typeã€listenerã€options | captureã€onceã€passiveã€signal |

---

## ä¸€ã€äº‹ä»¶æµä¸‰é˜¶æ®µ

### æ ¸å¿ƒæ¦‚å¿µ
äº‹ä»¶ä¼ æ’­åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š**æ•è·é˜¶æ®µï¼ˆå¤–â†’å†…ï¼‰â†’ ç›®æ ‡é˜¶æ®µ â†’ å†’æ³¡é˜¶æ®µï¼ˆå†…â†’å¤–ï¼‰**

```javascript
// æ•è·é˜¶æ®µè§¦å‘ï¼ˆtrueï¼‰
parent.addEventListener('click', () => console.log('çˆ¶æ•è·'), true);

// å†’æ³¡é˜¶æ®µè§¦å‘ï¼ˆfalseï¼Œé»˜è®¤ï¼‰
child.addEventListener('click', () => console.log('å­å†’æ³¡'), false);

// ç‚¹å‡»å­å…ƒç´ è¾“å‡ºï¼šçˆ¶æ•è· â†’ å­å†’æ³¡
```

### é˜»æ­¢ä¼ æ’­
```javascript
element.addEventListener('click', (e) => {
  e.stopPropagation();              // é˜»æ­¢å†’æ³¡
  e.preventDefault();                // é˜»æ­¢é»˜è®¤è¡Œä¸º
  e.stopImmediatePropagation();     // ç«‹å³åœæ­¢ï¼ˆåŒçº§ä¹Ÿä¸æ‰§è¡Œï¼‰
});
```

---

## äºŒã€äº‹ä»¶å§”æ‰˜

### æ ¸å¿ƒåŸç†
åˆ©ç”¨äº‹ä»¶å†’æ³¡ï¼Œåœ¨çˆ¶å…ƒç´ ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œé€šè¿‡ `event.target` åˆ¤æ–­äº‹ä»¶æº

### ä¼˜ç‚¹
- âœ… å‡å°‘å†…å­˜æ¶ˆè€—ï¼ˆåªç»‘å®šä¸€ä¸ªç›‘å¬å™¨ï¼‰
- âœ… åŠ¨æ€å…ƒç´ è‡ªåŠ¨æœ‰äº‹ä»¶
- âœ… ä»£ç ç®€æ´

### å®ç°ç¤ºä¾‹
```javascript
// âŒ ä¸å¥½ï¼šæ¯ä¸ªå…ƒç´ éƒ½ç»‘å®š
document.querySelectorAll('.item').forEach(item => {
  item.addEventListener('click', handleClick);
});

// âœ… å¥½ï¼šäº‹ä»¶å§”æ‰˜
document.querySelector('#list').addEventListener('click', (e) => {
  if (e.target.matches('.item')) {
    handleClick(e);
  }
});
```

### å®Œæ•´å®ç°
```javascript
class EventDelegate {
  constructor(parent, selector, eventType, handler) {
    parent.addEventListener(eventType, (e) => {
      let target = e.target;
      // å‘ä¸ŠæŸ¥æ‰¾åŒ¹é…å…ƒç´ 
      while (target && target !== parent) {
        if (target.matches(selector)) {
          handler.call(target, e);
          break;
        }
        target = target.parentElement;
      }
    });
  }
}

// ä½¿ç”¨
new EventDelegate(
  document.getElementById('list'),
  '.item',
  'click',
  function(e) {
    console.log('ç‚¹å‡»äº†:', this.textContent);
  }
);
```

---

## ä¸‰ã€äº‹ä»¶å¯¹è±¡

### target vs currentTarget
```javascript
// HTML: <div id="parent"><button id="child">ç‚¹å‡»</button></div>

document.getElementById('parent').addEventListener('click', (e) => {
  console.log(e.target.id);        // 'child' (çœŸæ­£ç‚¹å‡»çš„å…ƒç´ )
  console.log(e.currentTarget.id); // 'parent' (ç»‘å®šäº‹ä»¶çš„å…ƒç´ )
  console.log(this.id);            // 'parent' (this === currentTarget)
});
```

### å¸¸ç”¨å±æ€§
```javascript
element.addEventListener('click', (event) => {
  event.type           // äº‹ä»¶ç±»å‹ï¼š'click'
  event.target         // äº‹ä»¶æº
  event.currentTarget  // ç»‘å®šå…ƒç´ ï¼ˆthisï¼‰
  event.clientX/Y      // ç›¸å¯¹è§†å£åæ ‡
  event.pageX/Y        // ç›¸å¯¹é¡µé¢åæ ‡
  event.key            // æŒ‰é”®å€¼
  event.ctrlKey        // æ˜¯å¦æŒ‰ä¸‹Ctrl
});
```

---

## å››ã€addEventListener è¯¦è§£

### åŸºæœ¬è¯­æ³•
```javascript
element.addEventListener(type, listener, options);
```

### å‚æ•°è¯¦è§£

**1. options.capture - æ§åˆ¶äº‹ä»¶é˜¶æ®µ**
```javascript
// false: å†’æ³¡é˜¶æ®µï¼ˆé»˜è®¤ï¼‰
// true: æ•è·é˜¶æ®µ
element.addEventListener('click', handler, { capture: true });
```

**2. options.once - åªè§¦å‘ä¸€æ¬¡**
```javascript
button.addEventListener('click', () => {
  console.log('åªæ‰§è¡Œä¸€æ¬¡');
}, { once: true });
```

**3. options.passive - æ€§èƒ½ä¼˜åŒ–ï¼ˆé‡è¦ï¼‰**
```javascript
// å‘Šè¯‰æµè§ˆå™¨ä¸ä¼šè°ƒç”¨preventDefault()ï¼Œæå‡æ»šåŠ¨æ€§èƒ½
window.addEventListener('scroll', handleScroll, { passive: true });
```

**4. options.signal - æ‰¹é‡ç§»é™¤ç›‘å¬å™¨**
```javascript
const controller = new AbortController();

// æ·»åŠ å¤šä¸ªç›‘å¬å™¨
element.addEventListener('click', handler1, { signal: controller.signal });
element.addEventListener('mouseover', handler2, { signal: controller.signal });

// ä¸€æ¬¡æ€§ç§»é™¤æ‰€æœ‰
controller.abort();
```

### ç»„åˆä½¿ç”¨
```javascript
// å®æˆ˜ï¼šé¦–æ¬¡äº¤äº’æ£€æµ‹
const controller = new AbortController();

['click', 'keydown', 'scroll'].forEach(type => {
  document.addEventListener(type, () => {
    console.log('é¦–æ¬¡äº¤äº’');
    controller.abort(); // è§¦å‘åç«‹å³ç§»é™¤æ‰€æœ‰ç›‘å¬
  }, {
    once: true,
    passive: true,
    capture: true,
    signal: controller.signal
  });
});
```

---

## äº”ã€è‡ªå®šä¹‰äº‹ä»¶

### CustomEvent
```javascript
// åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶
const event = new CustomEvent('myEvent', {
  detail: { message: 'Hello' },
  bubbles: true,
  cancelable: true
});

// ç›‘å¬
element.addEventListener('myEvent', (e) => {
  console.log(e.detail.message); // 'Hello'
});

// è§¦å‘
element.dispatchEvent(event);
```

### EventEmitter å®ç°
```javascript
class EventEmitter {
  constructor() {
    this.events = {};
  }

  on(event, callback) {
    (this.events[event] ||= []).push(callback);
    return this;
  }

  emit(event, ...args) {
    this.events[event]?.forEach(cb => cb(...args));
    return this;
  }

  off(event, callback) {
    if (!callback) {
      delete this.events[event];
    } else {
      this.events[event] = this.events[event]?.filter(cb => cb !== callback);
    }
    return this;
  }

  once(event, callback) {
    const wrapper = (...args) => {
      callback(...args);
      this.off(event, wrapper);
    };
    this.on(event, wrapper);
    return this;
  }
}

// ä½¿ç”¨
const emitter = new EventEmitter();
emitter.on('login', (user) => console.log(`${user} ç™»å½•`));
emitter.emit('login', 'å¼ ä¸‰');
```

---

## å…­ã€Vue äº‹ä»¶æœºåˆ¶

### äº‹ä»¶ä¿®é¥°ç¬¦
```vue
<template>
  <!-- é˜»æ­¢å†’æ³¡ -->
  <div @click.stop="handle">é˜»æ­¢å†’æ³¡</div>

  <!-- é˜»æ­¢é»˜è®¤è¡Œä¸º -->
  <form @submit.prevent="submit">æäº¤</form>

  <!-- åªè§¦å‘ä¸€æ¬¡ -->
  <button @click.once="handle">åªè§¦å‘ä¸€æ¬¡</button>

  <!-- æ•è·é˜¶æ®µ -->
  <div @click.capture="handle">æ•è·</div>

  <!-- åªæœ‰ç‚¹å‡»è‡ªèº«æ‰è§¦å‘ -->
  <div @click.self="handle">åªè‡ªèº«</div>

  <!-- ä¿®é¥°ç¬¦ä¸²è” -->
  <a @click.stop.prevent="handle">é˜»æ­¢å†’æ³¡å’Œé»˜è®¤</a>

  <!-- æŒ‰é”®ä¿®é¥°ç¬¦ -->
  <input @keyup.enter="submit">
  <input @keyup.ctrl="handleCtrl">
</template>
```

### ç»„ä»¶é€šä¿¡
```javascript
// 1. Props + Emitï¼ˆçˆ¶å­ï¼‰
// çˆ¶ç»„ä»¶
<Child :msg="parentMsg" @update="handleUpdate" />

// å­ç»„ä»¶
props: ['msg']
methods: {
  sendToParent() {
    this.$emit('update', 'data');
  }
}

// 2. v-modelï¼ˆVue3ï¼‰
// çˆ¶ç»„ä»¶
<Child v-model:title="title" v-model:content="content" />

// å­ç»„ä»¶
props: ['title', 'content']
emits: ['update:title', 'update:content']
this.$emit('update:title', newTitle);

// 3. provide/injectï¼ˆè·¨çº§ï¼‰
// ç¥–å…ˆ
provide() {
  return { theme: this.theme };
}
// åä»£
inject: ['theme']
```

---

## ä¸ƒã€å¸¸è§é¢è¯•é¢˜

### 1. å®ç°ç‚¹å‡»å¤–éƒ¨å…³é—­
```javascript
function useClickOutside(elementRef, callback) {
  const handleClick = (e) => {
    if (elementRef.current && !elementRef.current.contains(e.target)) {
      callback();
    }
  };

  document.addEventListener('click', handleClick);
  return () => document.removeEventListener('click', handleClick);
}
```

### 2. é˜²æŠ–èŠ‚æµ
```javascript
// é˜²æŠ–ï¼šç­‰å¾…ä¸€æ®µæ—¶é—´åæ‰§è¡Œ
function debounce(fn, delay) {
  let timer = null;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
}

// èŠ‚æµï¼šå›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œ
function throttle(fn, delay) {
  let lastTime = 0;
  return function(...args) {
    const now = Date.now();
    if (now - lastTime >= delay) {
      fn.apply(this, args);
      lastTime = now;
    }
  };
}
```

### 3. ç§»é™¤äº‹ä»¶ç›‘å¬å™¨çš„å‘
```javascript
// âŒ é”™è¯¯ï¼šåŒ¿åå‡½æ•°æ— æ³•ç§»é™¤
element.addEventListener('click', () => console.log('click'));
element.removeEventListener('click', () => console.log('click')); // æ— æ•ˆ

// âœ… æ­£ç¡®ï¼šä¿å­˜å‡½æ•°å¼•ç”¨
const handler = () => console.log('click');
element.addEventListener('click', handler);
element.removeEventListener('click', handler); // æœ‰æ•ˆ

// âœ… æˆ–ä½¿ç”¨ once
element.addEventListener('click', () => console.log('click'), { once: true });

// âœ… æˆ–ä½¿ç”¨ signal
const controller = new AbortController();
element.addEventListener('click', () => console.log('click'), {
  signal: controller.signal
});
controller.abort(); // ç§»é™¤
```

---

## å…«ã€æœ€ä½³å®è·µ

### 1. é¿å…å†…å­˜æ³„æ¼
```javascript
class Component {
  constructor() {
    this.controller = new AbortController();
    this.handleResize = this.handleResize.bind(this);
  }

  mount() {
    window.addEventListener('resize', this.handleResize, {
      signal: this.controller.signal
    });
  }

  unmount() {
    this.controller.abort(); // æ¸…ç†æ‰€æœ‰ç›‘å¬å™¨
  }

  handleResize() {
    // å¤„ç†é€»è¾‘
  }
}
```

### 2. React ä¸­çš„äº‹ä»¶å¤„ç†
```javascript
function MyComponent() {
  useEffect(() => {
    const controller = new AbortController();

    window.addEventListener('resize', handleResize, {
      signal: controller.signal
    });

    return () => controller.abort(); // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
  }, []);
}
```

### 3. äº‹ä»¶å§”æ‰˜æœ€ä½³å®è·µ
```javascript
// ä½¿ç”¨ closest å‘ä¸ŠæŸ¥æ‰¾
container.addEventListener('click', (e) => {
  const item = e.target.closest('.item');
  if (item) {
    handleClick(item);
  }
});
```

---

## ğŸ“Œ æ ¸å¿ƒçŸ¥è¯†ç‚¹é€Ÿè®°

1. **äº‹ä»¶æµ**ï¼šæ•è·(å¤–â†’å†…) â†’ ç›®æ ‡ â†’ å†’æ³¡(å†…â†’å¤–)
2. **äº‹ä»¶å§”æ‰˜**ï¼šçˆ¶å…ƒç´ ä»£ç†å­å…ƒç´ ï¼Œå‡å°‘å†…å­˜ï¼Œæ”¯æŒåŠ¨æ€å…ƒç´ 
3. **target vs currentTarget**ï¼štargetæ˜¯äº‹ä»¶æºï¼ŒcurrentTargetæ˜¯ç»‘å®šå…ƒç´ 
4. **addEventListener**ï¼šæ¨èä½¿ç”¨ï¼Œæ”¯æŒå¤šä¸ªç›‘å¬å™¨å’Œé«˜çº§é€‰é¡¹
5. **optionsé‡è¦å‚æ•°**ï¼š
   - `capture`: æ§åˆ¶é˜¶æ®µ
   - `once`: åªè§¦å‘ä¸€æ¬¡
   - `passive`: æ€§èƒ½ä¼˜åŒ–ï¼ˆæ»šåŠ¨ï¼‰
   - `signal`: æ‰¹é‡ç§»é™¤
6. **é˜»æ­¢ä¼ æ’­**ï¼š`stopPropagation()`ã€`preventDefault()`
7. **å†…å­˜ç®¡ç†**ï¼šç»„ä»¶é”€æ¯æ—¶å¿…é¡»ç§»é™¤ç›‘å¬å™¨
